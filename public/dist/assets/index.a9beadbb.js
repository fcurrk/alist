import{cc as Z,Y as T,h as e,ac as ee,aP as $,V as I,b as B,c8 as d,cd as b,e as te,aE as M,bh as w,b_ as ne,ce as oe,cf as re,cg as se,ch as ae,a as ie,k as ce,m as g,ci as le,b0 as E,a7 as ue,bT as R,aC as ge,S as m,I as O,b2 as F,aj as de,C as P,bs as pe,bt as he,cj as me,aI as fe,ck as j,n as f,bi as we}from"./index.aa7ee244.js";import{a as be}from"./useTitle.08b9a4b8.js";import{s as Se,g as ke,a as _e}from"./webauthn-json.browser-ponyfill.1c672167.js";const Ie="https://github.com/fcurrk/alist";function $e(s){return Z(`${s}-${Ie}`)}const Ce=()=>{const s=T("#f1f3f5","#666666");return e(ee,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},ye=()=>{const s=$("sso_login_enabled"),o=I("sso_login_platform"),S=$("sso_compatibility_mode"),{searchParams:p,to:r}=B(),l=p.token;l!=null&&l!=""&&(d(l),r(decodeURIComponent(p.redirect||b||"/"),!0));function c(u){const n=u.data;n.token&&(d(n.token),r(decodeURIComponent(p.redirect||b||"/"),!0))}if(window.addEventListener("message",c),te(()=>{window.removeEventListener("message",c)}),s){const u=()=>{const h=w.getUri()+"/auth/sso?method=sso_get_token";if(S){window.location.href=h;return}window.open(h,"authPopup","width=500,height=600")};let n;switch(o){case"Github":n=ae;break;case"Microsoft":n=se;break;case"Google":n=re;break;case"Dingtalk":n=oe;break;default:n=ne}return e(M,{cursor:"pointer",boxSize:"$8",as:n,p:"$0_5",onclick:u})}},Ee=()=>{const s=I("logo").split(`
`);T(s[0],s.pop());const o=ie(),S=ce(()=>`${I("site_title")}`);be(S);const p=T("white","$neutral1"),[r,l]=g(localStorage.getItem("username")||""),[c,u]=g(localStorage.getItem("password")||""),[n,h]=g(""),[k,A]=g(!1),[_,D]=le("remember-pwd","false"),[C,U]=g(!1),[G,N]=E(async()=>C()?w.post("/auth/login/ldap",{username:r(),password:c(),otp_code:n()}):w.post("/auth/login/hash",{username:r(),password:$e(c()),otp_code:n()})),[,V]=E((t,a,i)=>w.post("/authn/webauthn_finish_login?username="+i,JSON.stringify(a),{headers:{session:t}})),[,H]=E(t=>w.get("/authn/webauthn_begin_login?username="+t)),{searchParams:y,to:v}=B(),J=$("webauthn_login_enabled"),K=async()=>{A(!k())},x=async()=>{if(k()){if(!Se()){f.error(o("users.webauthn_not_supported"));return}d(),_()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const t=await H(r());we(t,async a=>{try{const i=ke(a.options),Y=await _e(i),Q=await V(a.session,Y,r());j(Q,X=>{f.success(o("login.success")),d(X.token),v(decodeURIComponent(y.redirect||b||"/"),!0)})}catch(i){i instanceof Error&&f.error(i.message)}})}else{_()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",c())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await N();j(t,a=>{f.success(o("login.success")),d(a.token),v(decodeURIComponent(y.redirect||b||"/"),!0)},(a,i)=>{!L()&&i===402?W(!0):f.error(a)})}},[L,W]=g(!1),z=$("ldap_login_enabled"),q=I("ldap_login_tips");return z&&U(!0),e(fe,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ue,{get bgColor(){return p()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(R,{alignItems:"center",justifyContent:"space-around",get children(){return e(ge,{color:"$info9",fontSize:"$2xl",get children(){return S()}})}}),e(m,{get when(){return!L()},get fallback(){return e(O,{id:"totp",name:"otp",get placeholder(){return o("login.otp-tips")},get value(){return n()},onInput:t=>h(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})},get children(){return[e(O,{name:"username",get placeholder(){return o("login.username-tips")},get value(){return r()},onInput:t=>l(t.currentTarget.value)}),e(m,{get when(){return!k()},get children(){return e(O,{name:"password",get placeholder(){return o("login.password-tips")},type:"password",get value(){return c()},onInput:t=>u(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})}}),e(R,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(F,{get checked(){return _()==="true"},onChange:()=>D(_()==="true"?"false":"true"),get children(){return o("login.remember")}})}})]}}),e(de,{w:"$full",spacing:"$2",get children(){return[e(m,{get when(){return!k()},get children(){return e(P,{colorScheme:"primary",w:"$full",onClick:()=>{L()?h(""):(l(""),u(""))},get children(){return o("login.clear")}})}}),e(P,{w:"$full",get loading(){return G()},onClick:x,get children(){return o("login.login")}})]}}),e(m,{when:z,get children(){return e(F,{w:"$full",get checked(){return C()===!0},onChange:()=>U(!C()),children:q})}}),e(P,{w:"$full",colorScheme:"accent",onClick:()=>{d(),v(decodeURIComponent(y.redirect||b||"/"),!0)},get children(){return o("login.use_guest")}}),e(R,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(pe,{}),e(he,{}),e(ye,{}),e(m,{when:J,get children(){return e(M,{cursor:"pointer",boxSize:"$8",as:me,p:"$0_5",onclick:K})}})]}})]}}),e(Ce,{})]}})};export{Ee as default};
