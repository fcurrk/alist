import{cc as De,b as Pe,W as ke,cU as Fe,Q as de,aw as Be,ca as xe,cR as Le,ay as Ue,c3 as je,cV as Ne,aA as We,o as Ge,d as Ke,h as Se,Y as Ve,a8 as ze,p as Ae,cW as Re}from"./index.fcb15ca5.js";import{O as He,A as Ye}from"./icon.1404cb16.js";import{A as Xe,V as Je}from"./video_box.cd3d5412.js";import{H as Qe,a as Ze}from"./hls.215f945f.js";import"./index.9a171f1c.js";import"./index.e342f5dd.js";import"./Layout.ad78c83b.js";import"./index.d2279bb0.js";import"./FolderTree.0cdc296c.js";import"./index.59de9bd5.js";var Oe={exports:{}};(function(re,ne){var X=function(G){var V=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const r=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));r instanceof WebAssembly.Module&&(V=new WebAssembly.Instance(r)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(V?"yes":"no"));var h=this;h.canvas=G.canvas,h.renderMode=G.renderMode||(G.lossyRender?"lossy":"wasm-blend"),h.libassMemoryLimit=G.libassMemoryLimit||0,h.libassGlyphLimit=G.libassGlyphLimit||0,h.targetFps=G.targetFps||24,h.prescaleFactor=G.prescaleFactor||1,h.prescaleHeightLimit=G.prescaleHeightLimit||1080,h.maxRenderHeight=G.maxRenderHeight||0,h.dropAllAnimations=G.dropAllAnimations||!1,h.isOurCanvas=!1,h.video=G.video,h.canvasParent=null,h.fonts=G.fonts||[],h.availableFonts=G.availableFonts||[],h.fallbackFont=G.fallbackFont||"default.woff2",h.lazyFileLoading=G.lazyFileLoading||!1,h.onReadyEvent=G.onReady,V?h.workerUrl=G.workerUrl||"subtitles-octopus-worker.js":h.workerUrl=G.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",h.subUrl=G.subUrl,h.subContent=G.subContent||null,h.onErrorEvent=G.onError,h.debug=G.debug||!1,h.lastRenderTime=0,h.pixelRatio=window.devicePixelRatio||1,h.timeOffset=G.timeOffset||0,h.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var r=document.createElement("canvas"),e=r.getContext("2d");window.ImageData=function(){var i=0;if(arguments[0]instanceof Uint8ClampedArray)var n=arguments[i++];var t=arguments[i++],o=arguments[i],_=e.createImageData(t,o);return n&&_.data.set(n),_}}(),h.workerError=function(r){if(console.error("Worker error: ",r),h.onErrorEvent&&h.onErrorEvent(r),!h.debug)throw h.dispose(),new Error("Worker error: "+r)},h.init=function(){if(!window.Worker){h.workerError("worker not supported");return}h.worker||(h.worker=new Worker(h.workerUrl),h.worker.addEventListener("message",h.onWorkerMessage),h.worker.addEventListener("error",h.workerError)),h.workerActive=!1,h.createCanvas(),h.setVideo(G.video),h.setSubUrl(G.subUrl),h.worker.postMessage({target:"worker-init",width:h.canvas.width,height:h.canvas.height,URL:document.URL,currentScript:h.workerUrl,preMain:!0,renderMode:h.renderMode,subUrl:h.subUrl,subContent:h.subContent,fonts:h.fonts,availableFonts:h.availableFonts,fallbackFont:h.fallbackFont,lazyFileLoading:h.lazyFileLoading,debug:h.debug,targetFps:h.targetFps,libassMemoryLimit:h.libassMemoryLimit,libassGlyphLimit:h.libassGlyphLimit,dropAllAnimations:h.dropAllAnimations})},h.createCanvas=function(){h.canvas||(h.video?(h.isOurCanvas=!0,h.canvas=document.createElement("canvas"),h.canvas.className="libassjs-canvas",h.canvas.style.display="none",h.canvasParent=document.createElement("div"),h.canvasParent.className="libassjs-canvas-parent",h.canvasParent.appendChild(h.canvas),h.video.nextSibling?h.video.parentNode.insertBefore(h.canvasParent,h.video.nextSibling):h.video.parentNode.appendChild(h.canvasParent)):h.canvas||h.workerError("Don't know where to render: you should give video or canvas in options.")),h.ctx=h.canvas.getContext("2d"),h.bufferCanvas=document.createElement("canvas"),h.bufferCanvasCtx=h.bufferCanvas.getContext("2d"),h.bufferCanvas.width=1,h.bufferCanvas.height=1;var r=new Uint8ClampedArray([0,255,0,0]),e=new ImageData(r,1,1);h.bufferCanvasCtx.clearRect(0,0,1,1),h.ctx.clearRect(0,0,1,1);var i=h.ctx.getImageData(0,0,1,1).data;h.bufferCanvasCtx.putImageData(e,0,0),h.ctx.drawImage(h.bufferCanvas,0,0);var n=h.ctx.getImageData(0,0,1,1).data;h.hasAlphaBug=i[1]!=n[1],h.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function M(){h.setCurrentTime(h.video.currentTime+h.timeOffset)}function L(){h.setIsPaused(!1,h.video.currentTime+h.timeOffset)}function m(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function y(){h.video.removeEventListener("timeupdate",M,!1)}function c(){h.video.addEventListener("timeupdate",M,!1);var r=h.video.currentTime+h.timeOffset;h.setCurrentTime(r)}function d(){h.setRate(h.video.playbackRate)}function a(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function f(r){r.target.removeEventListener(r.type,f,!1),h.resize()}h.setVideo=function(r){h.video=r,h.video&&(h.video.addEventListener("timeupdate",M,!1),h.video.addEventListener("playing",L,!1),h.video.addEventListener("pause",m,!1),h.video.addEventListener("seeking",y,!1),h.video.addEventListener("seeked",c,!1),h.video.addEventListener("ratechange",d,!1),h.video.addEventListener("waiting",a,!1),document.addEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.addEventListener("resize",h.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(h.ro=new ResizeObserver(h.resizeWithTimeout),h.ro.observe(h.video)),h.video.videoWidth>0?h.resize():h.video.addEventListener("loadedmetadata",f,!1))},h.getVideoPosition=function(){var r=h.video.videoWidth/h.video.videoHeight,e=h.video.offsetWidth,i=h.video.offsetHeight,n=e/i,t=e,o=i;n>r?t=Math.floor(i*r):o=Math.floor(e/r);var _=(e-t)/2,p=(i-o)/2;return{width:t,height:o,x:_,y:p}},h.setSubUrl=function(r){h.subUrl=r},h.renderFrameData=null;function s(){var r=h.renderFramesData,e=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var i=0;i<r.canvases.length;i++){var n=r.canvases[i];h.bufferCanvas.width=n.w,h.bufferCanvas.height=n.h;var t=new Uint8ClampedArray(n.buffer);if(h.hasAlphaBug)for(var o=3;o<t.length;o=o+4)t[o]=t[o]>=1?t[o]:1;var _=new ImageData(t,n.w,n.h);h.bufferCanvasCtx.putImageData(_,0,0),h.ctx.drawImage(h.bufferCanvas,n.x,n.y)}if(h.debug){var p=Math.round(performance.now()-e),g=r.blendTime;console.log(typeof g<"u"?"render: "+Math.round(r.spentTime-g)+" ms, blend: "+Math.round(g)+" ms, draw: "+p+" ms; TOTAL="+Math.round(r.spentTime+p)+" ms":Math.round(r.spentTime)+" ms (+ "+p+" ms draw)"),h.renderStart=performance.now()}}function l(){var r=h.renderFramesData,e=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var i=0;i<r.bitmaps.length;i++){var n=r.bitmaps[i];h.ctx.drawImage(n.bitmap,n.x,n.y)}if(h.debug){var t=Math.round(performance.now()-e);console.log(r.bitmaps.length+" bitmaps, libass: "+Math.round(r.libassTime)+"ms, decode: "+Math.round(r.decodeTime)+"ms, draw: "+t+"ms"),h.renderStart=performance.now()}}h.workerActive=!1,h.frameId=0,h.onWorkerMessage=function(r){h.workerActive||(h.workerActive=!0,h.onReadyEvent&&h.onReadyEvent());var e=r.data;switch(e.target){case"stdout":{console.log(e.content);break}case"console-log":{console.log.apply(console,JSON.parse(e.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(e.content));break}case"console-info":{console.info.apply(console,JSON.parse(e.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(e.content));break}case"console-error":{console.error.apply(console,JSON.parse(e.content));break}case"stderr":{console.error(e.content);break}case"window":{window[e.method]();break}case"canvas":{switch(e.op){case"getContext":{h.ctx=h.canvas.getContext(e.type,e.attributes);break}case"resize":{h.resize(e.width,e.height);break}case"renderCanvas":{h.lastRenderTime<e.time&&(h.lastRenderTime=e.time,h.renderFramesData=e,window.requestAnimationFrame(s));break}case"renderFastCanvas":{h.lastRenderTime<e.time&&(h.lastRenderTime=e.time,h.renderFramesData=e,window.requestAnimationFrame(l));break}case"setObjectProperty":{h.canvas[e.object][e.property]=e.value;break}default:throw"eh?"}break}case"tick":{h.frameId=e.id,h.worker.postMessage({target:"tock",id:h.frameId});break}case"custom":{if(h.onCustomMessage)h.onCustomMessage(r);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{h.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+e.target}};function u(r,e){var i=h.prescaleFactor<=0?1:h.prescaleFactor;if(e<=0||r<=0)r=0,e=0;else{var n=i<1?-1:1,t=e;n*t*i<=n*h.prescaleHeightLimit?t*=i:n*t<n*h.prescaleHeightLimit&&(t=h.prescaleHeightLimit),h.maxRenderHeight>0&&t>h.maxRenderHeight&&(t=h.maxRenderHeight),r*=t/e,e=t}return{width:r,height:e}}h.resize=function(r,e,i,n){var t=null;if(i=i||0,n=n||0,(!r||!e)&&h.video){t=h.getVideoPosition();var o=u(t.width*h.pixelRatio,t.height*h.pixelRatio);r=o.width,e=o.height;var _=h.canvasParent.getBoundingClientRect().top-h.video.getBoundingClientRect().top;i=t.y-_,n=t.x}if(!r||!e){h.video||console.error("width or height is 0. You should specify width & height for resize.");return}(h.canvas.width!=r||h.canvas.height!=e||h.canvas.style.top!=i||h.canvas.style.left!=n)&&(h.canvas.width=r,h.canvas.height=e,t!=null&&(h.canvasParent.style.position="relative",h.canvas.style.display="block",h.canvas.style.position="absolute",h.canvas.style.width=t.width+"px",h.canvas.style.height=t.height+"px",h.canvas.style.top=i+"px",h.canvas.style.left=n+"px",h.canvas.style.pointerEvents="none"),h.worker.postMessage({target:"canvas",width:h.canvas.width,height:h.canvas.height}))},h.resizeWithTimeout=function(){h.resize(),setTimeout(h.resize,100)},h.runBenchmark=function(){h.worker.postMessage({target:"runBenchmark"})},h.customMessage=function(r,e){e=e||{},h.worker.postMessage({target:"custom",userData:r,preMain:e.preMain})},h.setCurrentTime=function(r){h.worker.postMessage({target:"video",currentTime:r})},h.setTrackByUrl=function(r){h.worker.postMessage({target:"set-track-by-url",url:r})},h.setTrack=function(r){h.worker.postMessage({target:"set-track",content:r})},h.freeTrack=function(r){h.worker.postMessage({target:"free-track"})},h.render=h.setCurrentTime,h.setIsPaused=function(r,e){h.worker.postMessage({target:"video",isPaused:r,currentTime:e})},h.setRate=function(r){h.worker.postMessage({target:"video",rate:r})},h.dispose=function(){h.worker.postMessage({target:"destroy"}),h.worker.terminate(),h.worker.removeEventListener("message",h.onWorkerMessage),h.worker.removeEventListener("error",h.workerError),h.workerActive=!1,h.worker=null,h.video&&(h.video.removeEventListener("timeupdate",M,!1),h.video.removeEventListener("playing",L,!1),h.video.removeEventListener("pause",m,!1),h.video.removeEventListener("seeking",y,!1),h.video.removeEventListener("seeked",c,!1),h.video.removeEventListener("ratechange",d,!1),h.video.removeEventListener("waiting",a,!1),h.video.removeEventListener("loadedmetadata",f,!1),document.removeEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.removeEventListener("resize",h.resizeWithTimeout,!1),h.video.parentNode.removeChild(h.canvasParent),h.video=null),h.ro&&(h.ro.disconnect(),h.ro=null),h.onCustomMessage=null,h.onErrorEvent=null,h.onReadyEvent=null},h.fetchFromWorker=function(r,e,i){try{var n=r.target,t=setTimeout(function(){_(Error("Error: Timeout while try to fetch "+n))},5e3),o=function(p){p.data.target==n&&(e(p.data),h.worker.removeEventListener("message",o),h.worker.removeEventListener("error",_),clearTimeout(t))},_=function(p){i(p),h.worker.removeEventListener("message",o),h.worker.removeEventListener("error",_),clearTimeout(t)};h.worker.addEventListener("message",o),h.worker.addEventListener("error",_),h.worker.postMessage(r)}catch(p){i(p)}},h.createEvent=function(r){h.worker.postMessage({target:"create-event",event:r})},h.getEvents=function(r,e){h.fetchFromWorker({target:"get-events"},function(i){r(i.events)},e)},h.setEvent=function(r,e){h.worker.postMessage({target:"set-event",event:r,index:e})},h.removeEvent=function(r){h.worker.postMessage({target:"remove-event",index:r})},h.createStyle=function(r){h.worker.postMessage({target:"create-style",style:r})},h.getStyles=function(r,e){h.fetchFromWorker({target:"get-styles"},function(i){r(i.styles)},e)},h.setStyle=function(r,e){h.worker.postMessage({target:"set-style",style:r,index:e})},h.removeStyle=function(r){h.worker.postMessage({target:"remove-style",index:r})},h.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),re.exports&&(re.exports=X)})(Oe);const $e=Oe.exports,qe= window.__dynamic_base__+"/assets/subtitles-octopus-worker-legacy.b6ac3ec1.js",et= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",tt= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",rt= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let oe=null;function be(re){oe.canvasParent&&(oe.canvasParent.style.display=re?"block":"none")}function nt(re){return ne=>(oe=new $e({availableFonts:{"times new roman":tt},fallbackFont:rt,legacyWorkerUrl:qe,workerUrl:et,video:ne.template.$video,...re}),oe.canvasParent.className="artplayer-plugin-ass",oe.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,ne.on("artplayer-plugin-ass:switch",X=>{oe.freeTrack(),oe.setTrackByUrl(X),be(!0)}),ne.on("subtitle",X=>be(X)),ne.on("artplayer-plugin-ass:visible",X=>be(X)),ne.on("subtitleOffset",X=>oe.timeOffset=X),ne.on("destroy",()=>oe.dispose()),{name:"artplayerPluginAss",instance:oe})}var we={exports:{}};(function(re,ne){(function(G,V){re.exports=V()})(self,function(){return function(){var X={"./node_modules/es6-promise/dist/es6-promise.js":function(M,L,m){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(y,c){M.exports=c()})(this,function(){function y(A){var w=typeof A;return A!==null&&(w==="object"||w==="function")}function c(A){return typeof A=="function"}var d=void 0;Array.isArray?d=Array.isArray:d=function(A){return Object.prototype.toString.call(A)==="[object Array]"};var a=d,f=0,s=void 0,l=void 0,u=function(w,C){x[f]=w,x[f+1]=C,f+=2,f===2&&(l?l(S):R())};function r(A){l=A}function e(A){u=A}var i=typeof window<"u"?window:void 0,n=i||{},t=n.MutationObserver||n.WebKitMutationObserver,o=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",_=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function p(){return function(){return process.nextTick(S)}}function g(){return typeof s<"u"?function(){s(S)}:v()}function b(){var A=0,w=new t(S),C=document.createTextNode("");return w.observe(C,{characterData:!0}),function(){C.data=A=++A%2}}function E(){var A=new MessageChannel;return A.port1.onmessage=S,function(){return A.port2.postMessage(0)}}function v(){var A=setTimeout;return function(){return A(S,1)}}var x=new Array(1e3);function S(){for(var A=0;A<f;A+=2){var w=x[A],C=x[A+1];w(C),x[A]=void 0,x[A+1]=void 0}f=0}function O(){try{var A=Function("return this")().require("vertx");return s=A.runOnLoop||A.runOnContext,g()}catch{return v()}}var R=void 0;o?R=p():t?R=b():_?R=E():i===void 0?R=O():R=v();function T(A,w){var C=this,I=new this.constructor(k);I[U]===void 0&&_e(I);var F=C._state;if(F){var j=arguments[F-1];u(function(){return he(F,I,j,C._result)})}else q(C,I,A,w);return I}function B(A){var w=this;if(A&&typeof A=="object"&&A.constructor===w)return A;var C=new w(k);return $(C,A),C}var U=Math.random().toString(36).substring(2);function k(){}var N=void 0,z=1,P=2;function W(){return new TypeError("You cannot resolve a promise with itself")}function ie(){return new TypeError("A promises callback cannot return that same promise.")}function K(A,w,C,I){try{A.call(w,C,I)}catch(F){return F}}function H(A,w,C){u(function(I){var F=!1,j=K(C,w,function(J){F||(F=!0,w!==J?$(I,J):Y(I,J))},function(J){F||(F=!0,D(I,J))},"Settle: "+(I._label||" unknown promise"));!F&&j&&(F=!0,D(I,j))},A)}function ee(A,w){w._state===z?Y(A,w._result):w._state===P?D(A,w._result):q(w,void 0,function(C){return $(A,C)},function(C){return D(A,C)})}function Q(A,w,C){w.constructor===A.constructor&&C===T&&w.constructor.resolve===B?ee(A,w):C===void 0?Y(A,w):c(C)?H(A,w,C):Y(A,w)}function $(A,w){if(A===w)D(A,W());else if(y(w)){var C=void 0;try{C=w.then}catch(I){D(A,I);return}Q(A,w,C)}else Y(A,w)}function ue(A){A._onerror&&A._onerror(A._result),se(A)}function Y(A,w){A._state===N&&(A._result=w,A._state=z,A._subscribers.length!==0&&u(se,A))}function D(A,w){A._state===N&&(A._state=P,A._result=w,u(ue,A))}function q(A,w,C,I){var F=A._subscribers,j=F.length;A._onerror=null,F[j]=w,F[j+z]=C,F[j+P]=I,j===0&&A._state&&u(se,A)}function se(A){var w=A._subscribers,C=A._state;if(w.length!==0){for(var I=void 0,F=void 0,j=A._result,J=0;J<w.length;J+=3)I=w[J],F=w[J+C],I?he(C,I,F,j):F(j);A._subscribers.length=0}}function he(A,w,C,I){var F=c(C),j=void 0,J=void 0,pe=!0;if(F){try{j=C(I)}catch(ge){pe=!1,J=ge}if(w===j){D(w,ie());return}}else j=I;w._state!==N||(F&&pe?$(w,j):pe===!1?D(w,J):A===z?Y(w,j):A===P&&D(w,j))}function le(A,w){try{w(function(I){$(A,I)},function(I){D(A,I)})}catch(C){D(A,C)}}var fe=0;function ce(){return fe++}function _e(A){A[U]=fe++,A._state=void 0,A._result=void 0,A._subscribers=[]}function ae(){return new Error("Array Methods must be provided an Array")}var te=function(){function A(w,C){this._instanceConstructor=w,this.promise=new w(k),this.promise[U]||_e(this.promise),a(C)?(this.length=C.length,this._remaining=C.length,this._result=new Array(this.length),this.length===0?Y(this.promise,this._result):(this.length=this.length||0,this._enumerate(C),this._remaining===0&&Y(this.promise,this._result))):D(this.promise,ae())}return A.prototype._enumerate=function(C){for(var I=0;this._state===N&&I<C.length;I++)this._eachEntry(C[I],I)},A.prototype._eachEntry=function(C,I){var F=this._instanceConstructor,j=F.resolve;if(j===B){var J=void 0,pe=void 0,ge=!1;try{J=C.then}catch(ye){ge=!0,pe=ye}if(J===T&&C._state!==N)this._settledAt(C._state,I,C._result);else if(typeof J!="function")this._remaining--,this._result[I]=C;else if(F===Z){var Ee=new F(k);ge?D(Ee,pe):Q(Ee,C,J),this._willSettleAt(Ee,I)}else this._willSettleAt(new F(function(ye){return ye(C)}),I)}else this._willSettleAt(j(C),I)},A.prototype._settledAt=function(C,I,F){var j=this.promise;j._state===N&&(this._remaining--,C===P?D(j,F):this._result[I]=F),this._remaining===0&&Y(j,this._result)},A.prototype._willSettleAt=function(C,I){var F=this;q(C,void 0,function(j){return F._settledAt(z,I,j)},function(j){return F._settledAt(P,I,j)})},A}();function me(A){return new te(this,A).promise}function ve(A){var w=this;return a(A)?new w(function(C,I){for(var F=A.length,j=0;j<F;j++)w.resolve(A[j]).then(C,I)}):new w(function(C,I){return I(new TypeError("You must pass an array to race."))})}function Ce(A){var w=this,C=new w(k);return D(C,A),C}function Te(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Me(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Z=function(){function A(w){this[U]=ce(),this._result=this._state=void 0,this._subscribers=[],k!==w&&(typeof w!="function"&&Te(),this instanceof A?le(this,w):Me())}return A.prototype.catch=function(C){return this.then(null,C)},A.prototype.finally=function(C){var I=this,F=I.constructor;return c(C)?I.then(function(j){return F.resolve(C()).then(function(){return j})},function(j){return F.resolve(C()).then(function(){throw j})}):I.then(C,C)},A}();Z.prototype.then=T,Z.all=me,Z.race=ve,Z.resolve=B,Z.reject=Ce,Z._setScheduler=r,Z._setAsap=e,Z._asap=u;function Ie(){var A=void 0;if(typeof m.g<"u")A=m.g;else if(typeof self<"u")A=self;else try{A=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var w=A.Promise;if(w){var C=null;try{C=Object.prototype.toString.call(w.resolve())}catch{}if(C==="[object Promise]"&&!w.cast)return}A.Promise=Z}return Z.polyfill=Ie,Z.Promise=Z,Z})},"./node_modules/events/events.js":function(M){var L=typeof Reflect=="object"?Reflect:null,m=L&&typeof L.apply=="function"?L.apply:function(v,x,S){return Function.prototype.apply.call(v,x,S)},y;L&&typeof L.ownKeys=="function"?y=L.ownKeys:Object.getOwnPropertySymbols?y=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:y=function(v){return Object.getOwnPropertyNames(v)};function c(E){console&&console.warn&&console.warn(E)}var d=Number.isNaN||function(v){return v!==v};function a(){a.init.call(this)}M.exports=a,M.exports.once=p,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var f=10;function s(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(E){if(typeof E!="number"||E<0||d(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");f=E}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||d(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function l(E){return E._maxListeners===void 0?a.defaultMaxListeners:E._maxListeners}a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(v){for(var x=[],S=1;S<arguments.length;S++)x.push(arguments[S]);var O=v==="error",R=this._events;if(R!==void 0)O=O&&R.error===void 0;else if(!O)return!1;if(O){var T;if(x.length>0&&(T=x[0]),T instanceof Error)throw T;var B=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw B.context=T,B}var U=R[v];if(U===void 0)return!1;if(typeof U=="function")m(U,this,x);else for(var k=U.length,N=t(U,k),S=0;S<k;++S)m(N[S],this,x);return!0};function u(E,v,x,S){var O,R,T;if(s(x),R=E._events,R===void 0?(R=E._events=Object.create(null),E._eventsCount=0):(R.newListener!==void 0&&(E.emit("newListener",v,x.listener?x.listener:x),R=E._events),T=R[v]),T===void 0)T=R[v]=x,++E._eventsCount;else if(typeof T=="function"?T=R[v]=S?[x,T]:[T,x]:S?T.unshift(x):T.push(x),O=l(E),O>0&&T.length>O&&!T.warned){T.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=E,B.type=v,B.count=T.length,c(B)}return E}a.prototype.addListener=function(v,x){return u(this,v,x,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(v,x){return u(this,v,x,!0)};function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function e(E,v,x){var S={fired:!1,wrapFn:void 0,target:E,type:v,listener:x},O=r.bind(S);return O.listener=x,S.wrapFn=O,O}a.prototype.once=function(v,x){return s(x),this.on(v,e(this,v,x)),this},a.prototype.prependOnceListener=function(v,x){return s(x),this.prependListener(v,e(this,v,x)),this},a.prototype.removeListener=function(v,x){var S,O,R,T,B;if(s(x),O=this._events,O===void 0)return this;if(S=O[v],S===void 0)return this;if(S===x||S.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete O[v],O.removeListener&&this.emit("removeListener",v,S.listener||x));else if(typeof S!="function"){for(R=-1,T=S.length-1;T>=0;T--)if(S[T]===x||S[T].listener===x){B=S[T].listener,R=T;break}if(R<0)return this;R===0?S.shift():o(S,R),S.length===1&&(O[v]=S[0]),O.removeListener!==void 0&&this.emit("removeListener",v,B||x)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(v){var x,S,O;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[v]),this;if(arguments.length===0){var R=Object.keys(S),T;for(O=0;O<R.length;++O)T=R[O],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=S[v],typeof x=="function")this.removeListener(v,x);else if(x!==void 0)for(O=x.length-1;O>=0;O--)this.removeListener(v,x[O]);return this};function i(E,v,x){var S=E._events;if(S===void 0)return[];var O=S[v];return O===void 0?[]:typeof O=="function"?x?[O.listener||O]:[O]:x?_(O):t(O,O.length)}a.prototype.listeners=function(v){return i(this,v,!0)},a.prototype.rawListeners=function(v){return i(this,v,!1)},a.listenerCount=function(E,v){return typeof E.listenerCount=="function"?E.listenerCount(v):n.call(E,v)},a.prototype.listenerCount=n;function n(E){var v=this._events;if(v!==void 0){var x=v[E];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};function t(E,v){for(var x=new Array(v),S=0;S<v;++S)x[S]=E[S];return x}function o(E,v){for(;v+1<E.length;v++)E[v]=E[v+1];E.pop()}function _(E){for(var v=new Array(E.length),x=0;x<v.length;++x)v[x]=E[x].listener||E[x];return v}function p(E,v){return new Promise(function(x,S){function O(T){E.removeListener(v,R),S(T)}function R(){typeof E.removeListener=="function"&&E.removeListener("error",O),x([].slice.call(arguments))}b(E,v,R,{once:!0}),v!=="error"&&g(E,O,{once:!0})})}function g(E,v,x){typeof E.on=="function"&&b(E,"error",v,x)}function b(E,v,x,S){if(typeof E.on=="function")S.once?E.once(v,x):E.on(v,x);else if(typeof E.addEventListener=="function")E.addEventListener(v,function O(R){S.once&&E.removeEventListener(v,O),x(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}},"./node_modules/webworkify-webpack/index.js":function(M,L,m){function y(r){var e={};function i(t){if(e[t])return e[t].exports;var o=e[t]={i:t,l:!1,exports:{}};return r[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=r,i.c=e,i.i=function(t){return t},i.d=function(t,o,_){i.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:_})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(o,"a",o),o},i.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},i.p="/",i.oe=function(t){throw console.error(t),t};var n=i(i.s=ENTRY_MODULE);return n.default||n}var c="[\\.|\\-|\\+|\\w|/|@]+",d="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";function a(r){return(r+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(r){return!isNaN(1*r)}function s(r,e,i){var n={};n[i]=[];var t=e.toString(),o=t.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return n;for(var _=o[1],p=new RegExp("(\\\\n|\\W)"+a(_)+d,"g"),g;g=p.exec(t);)g[3]!=="dll-reference"&&n[i].push(g[3]);for(p=new RegExp("\\("+a(_)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+d,"g");g=p.exec(t);)r[g[2]]||(n[i].push(g[1]),r[g[2]]=m(g[1]).m),n[g[2]]=n[g[2]]||[],n[g[2]].push(g[4]);for(var b=Object.keys(n),E=0;E<b.length;E++)for(var v=0;v<n[b[E]].length;v++)f(n[b[E]][v])&&(n[b[E]][v]=1*n[b[E]][v]);return n}function l(r){var e=Object.keys(r);return e.reduce(function(i,n){return i||r[n].length>0},!1)}function u(r,e){for(var i={main:[e]},n={main:[]},t={main:{}};l(i);)for(var o=Object.keys(i),_=0;_<o.length;_++){var p=o[_],g=i[p],b=g.pop();if(t[p]=t[p]||{},!(t[p][b]||!r[p][b])){t[p][b]=!0,n[p]=n[p]||[],n[p].push(b);for(var E=s(r,r[p][b],p),v=Object.keys(E),x=0;x<v.length;x++)i[v[x]]=i[v[x]]||[],i[v[x]]=i[v[x]].concat(E[v[x]])}}return n}M.exports=function(r,e){e=e||{};var i={main:m.m},n=e.all?{main:Object.keys(i.main)}:u(i,r),t="";Object.keys(n).filter(function(b){return b!=="main"}).forEach(function(b){for(var E=0;n[b][E];)E++;n[b].push(E),i[b][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",t=t+"var "+b+" = ("+y.toString().replace("ENTRY_MODULE",JSON.stringify(E))+")({"+n[b].map(function(v){return""+JSON.stringify(v)+": "+i[b][v].toString()}).join(",")+`});
`}),t=t+"new (("+y.toString().replace("ENTRY_MODULE",JSON.stringify(r))+")({"+n.main.map(function(b){return""+JSON.stringify(b)+": "+i.main[b].toString()}).join(",")+"}))(self);";var o=new window.Blob([t],{type:"text/javascript"});if(e.bare)return o;var _=window.URL||window.webkitURL||window.mozURL||window.msURL,p=_.createObjectURL(o),g=new window.Worker(p);return g.objectURL=p,g}},"./src/config.js":function(M,L,m){m.r(L),m.d(L,{defaultConfig:function(){return y},createDefaultConfig:function(){return c}});var y={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function c(){return Object.assign({},y)}},"./src/core/features.js":function(M,L,m){m.r(L);var y=m("./src/io/io-controller.js"),c=m("./src/config.js"),d=function(){function a(){}return a.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},a.supportNetworkStreamIO=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s=="fetch-stream-loader"||s=="xhr-moz-chunked-loader"},a.getNetworkLoaderTypeName=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s},a.supportNativeMediaPlayback=function(f){a.videoElement==null&&(a.videoElement=window.document.createElement("video"));var s=a.videoElement.canPlayType(f);return s==="probably"||s=="maybe"},a.getFeatureList=function(){var f={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return f.mseFlvPlayback=a.supportMSEH264Playback(),f.networkStreamIO=a.supportNetworkStreamIO(),f.networkLoaderName=a.getNetworkLoaderTypeName(),f.mseLiveFlvPlayback=f.mseFlvPlayback&&f.networkStreamIO,f.nativeMP4H264Playback=a.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),f.nativeWebmVP8Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),f.nativeWebmVP9Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp9"'),f},a}();L.default=d},"./src/core/media-info.js":function(M,L,m){m.r(L);var y=function(){function c(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return c.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&d&&a},c.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},c.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,f=this._search(a.times,d);return{index:f,milliseconds:a.times[f],fileposition:a.filepositions[f]}},c.prototype._search=function(d,a){var f=0,s=d.length-1,l=0,u=0,r=s;for(a<d[0]&&(f=0,u=r+1);u<=r;)if(l=u+Math.floor((r-u)/2),l===s||a>=d[l]&&a<d[l+1]){f=l;break}else d[l]<a?u=l+1:r=l-1;return f},c}();L.default=y},"./src/core/media-segment-info.js":function(M,L,m){m.r(L),m.d(L,{SampleInfo:function(){return y},MediaSegmentInfo:function(){return c},IDRSampleList:function(){return d},MediaSegmentInfoList:function(){return a}});var y=function(){function f(s,l,u,r,e){this.dts=s,this.pts=l,this.duration=u,this.originalDts=r,this.isSyncPoint=e,this.fileposition=null}return f}(),c=function(){function f(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return f.prototype.appendSyncPoint=function(s){s.isSyncPoint=!0,this.syncPoints.push(s)},f}(),d=function(){function f(){this._list=[]}return f.prototype.clear=function(){this._list=[]},f.prototype.appendArray=function(s){var l=this._list;s.length!==0&&(l.length>0&&s[0].originalDts<l[l.length-1].originalDts&&this.clear(),Array.prototype.push.apply(l,s))},f.prototype.getLastSyncPointBeforeDts=function(s){if(this._list.length==0)return null;var l=this._list,u=0,r=l.length-1,e=0,i=0,n=r;for(s<l[0].dts&&(u=0,i=n+1);i<=n;)if(e=i+Math.floor((n-i)/2),e===r||s>=l[e].dts&&s<l[e+1].dts){u=e;break}else l[e].dts<s?i=e+1:n=e-1;return this._list[u]},f}(),a=function(){function f(s){this._type=s,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),f.prototype.isEmpty=function(){return this._list.length===0},f.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},f.prototype._searchNearestSegmentBefore=function(s){var l=this._list;if(l.length===0)return-2;var u=l.length-1,r=0,e=0,i=u,n=0;if(s<l[0].originalBeginDts)return n=-1,n;for(;e<=i;)if(r=e+Math.floor((i-e)/2),r===u||s>l[r].lastSample.originalDts&&s<l[r+1].originalBeginDts){n=r;break}else l[r].originalBeginDts<s?e=r+1:i=r-1;return n},f.prototype._searchNearestSegmentAfter=function(s){return this._searchNearestSegmentBefore(s)+1},f.prototype.append=function(s){var l=this._list,u=s,r=this._lastAppendLocation,e=0;r!==-1&&r<l.length&&u.originalBeginDts>=l[r].lastSample.originalDts&&(r===l.length-1||r<l.length-1&&u.originalBeginDts<l[r+1].originalBeginDts)?e=r+1:l.length>0&&(e=this._searchNearestSegmentBefore(u.originalBeginDts)+1),this._lastAppendLocation=e,this._list.splice(e,0,u)},f.prototype.getLastSegmentBefore=function(s){var l=this._searchNearestSegmentBefore(s);return l>=0?this._list[l]:null},f.prototype.getLastSampleBefore=function(s){var l=this.getLastSegmentBefore(s);return l!=null?l.lastSample:null},f.prototype.getLastSyncPointBefore=function(s){for(var l=this._searchNearestSegmentBefore(s),u=this._list[l].syncPoints;u.length===0&&l>0;)l--,u=this._list[l].syncPoints;return u.length>0?u[u.length-1]:null},f}()},"./src/core/mse-controller.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/core/mse-events.js"),s=m("./src/core/media-segment-info.js"),l=m("./src/utils/exception.js"),u=function(){function r(e){this.TAG="MSEController",this._config=e,this._emitter=new(c()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new s.IDRSampleList}return r.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},r.prototype.on=function(e,i){this._emitter.addListener(e,i)},r.prototype.off=function(e,i){this._emitter.removeListener(e,i)},r.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new l.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var i=this._mediaSource=new window.MediaSource;i.addEventListener("sourceopen",this.e.onSourceOpen),i.addEventListener("sourceended",this.e.onSourceEnded),i.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},r.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var i in this._sourceBuffers){var n=this._pendingSegments[i];n.splice(0,n.length),this._pendingSegments[i]=null,this._pendingRemoveRanges[i]=null,this._lastInitSegments[i]=null;var t=this._sourceBuffers[i];if(t){if(e.readyState!=="closed"){try{e.removeSourceBuffer(t)}catch(o){d.default.e(this.TAG,o.message)}t.removeEventListener("error",this.e.onSourceBufferError),t.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[i]=null,this._sourceBuffers[i]=null}}if(e.readyState==="open")try{e.endOfStream()}catch(o){d.default.e(this.TAG,o.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},r.prototype.appendInitSegment=function(e,i){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(e),this._pendingSegments[e.type].push(e);return}var n=e,t=""+n.container;n.codec&&n.codec.length>0&&(t+=";codecs="+n.codec);var o=!1;if(d.default.v(this.TAG,"Received Initialization Segment, mimeType: "+t),this._lastInitSegments[n.type]=n,t!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])d.default.v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+t);else{o=!0;try{var _=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(t);_.addEventListener("error",this.e.onSourceBufferError),_.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(p){d.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message});return}}this._mimeTypes[n.type]=t}i||this._pendingSegments[n.type].push(n),o||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),a.default.safari&&n.container==="audio/mpeg"&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())},r.prototype.appendMediaSegment=function(e){var i=e;this._pendingSegments[i.type].push(i),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[i.type];n&&!n.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},r.prototype.seek=function(e){for(var i in this._sourceBuffers)if(!!this._sourceBuffers[i]){var n=this._sourceBuffers[i];if(this._mediaSource.readyState==="open")try{n.abort()}catch(b){d.default.e(this.TAG,b.message)}this._idrList.clear();var t=this._pendingSegments[i];if(t.splice(0,t.length),this._mediaSource.readyState!=="closed"){for(var o=0;o<n.buffered.length;o++){var _=n.buffered.start(o),p=n.buffered.end(o);this._pendingRemoveRanges[i].push({start:_,end:p})}if(n.updating||this._doRemoveRanges(),a.default.safari){var g=this._lastInitSegments[i];g&&(this._pendingSegments[i].push(g),n.updating||this._doAppendSegments())}}}},r.prototype.endOfStream=function(){var e=this._mediaSource,i=this._sourceBuffers;if(!e||e.readyState!=="open"){e&&e.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}i.video&&i.video.updating||i.audio&&i.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())},r.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},r.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var i in this._sourceBuffers){var n=this._sourceBuffers[i];if(n){var t=n.buffered;if(t.length>=1&&e-t.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},r.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var i in this._sourceBuffers){var n=this._sourceBuffers[i];if(n){for(var t=n.buffered,o=!1,_=0;_<t.length;_++){var p=t.start(_),g=t.end(_);if(p<=e&&e<g+3){if(e-p>=this._config.autoCleanupMaxBackwardDuration){o=!0;var b=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[i].push({start:p,end:b})}}else g<e&&(o=!0,this._pendingRemoveRanges[i].push({start:p,end:g}))}o&&!n.updating&&this._doRemoveRanges()}}},r.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var i=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(i)||n>i)&&(d.default.v(this.TAG,"Update MediaSource duration from "+i+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},r.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating))for(var i=this._sourceBuffers[e],n=this._pendingRemoveRanges[e];n.length&&!i.updating;){var t=n.shift();i.remove(t.start,t.end)}},r.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var i in e)if(!(!this._sourceBuffers[i]||this._sourceBuffers[i].updating)&&e[i].length>0){var n=e[i].shift();if(n.timestampOffset){var t=this._sourceBuffers[i].timestampOffset,o=n.timestampOffset/1e3,_=Math.abs(t-o);_>.1&&(d.default.v(this.TAG,"Update MPEG audio timestampOffset from "+t+" to "+o),this._sourceBuffers[i].timestampOffset=o),delete n.timestampOffset}if(!n.data||n.data.byteLength===0)continue;try{this._sourceBuffers[i].appendBuffer(n.data),this._isBufferFull=!1,i==="video"&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(p){this._pendingSegments[i].unshift(n),p.code===22?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(d.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message}))}}},r.prototype._onSourceOpen=function(){if(d.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var i=e.shift();this.appendInitSegment(i,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)},r.prototype._onSourceEnded=function(){d.default.v(this.TAG,"MediaSource onSourceEnded")},r.prototype._onSourceClose=function(){d.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},r.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},r.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},r.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)},r.prototype._onSourceBufferError=function(e){d.default.e(this.TAG,"SourceBuffer Error: "+e)},r}();L.default=u},"./src/core/mse-events.js":function(M,L,m){m.r(L);var y={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};L.default=y},"./src/core/transmuxer.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./node_modules/webworkify-webpack/index.js"),a=m.n(d),f=m("./src/utils/logger.js"),s=m("./src/utils/logging-control.js"),l=m("./src/core/transmuxing-controller.js"),u=m("./src/core/transmuxing-events.js"),r=m("./src/core/media-info.js"),e=function(){function i(n,t){if(this.TAG="Transmuxer",this._emitter=new(c()),t.enableWorker&&typeof Worker<"u")try{this._worker=a()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[n,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},s.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:s.default.getConfig()})}catch{f.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new l.default(n,t)}else this._controller=new l.default(n,t);if(this._controller){var o=this._controller;o.on(u.default.IO_ERROR,this._onIOError.bind(this)),o.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),o.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),o.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),o.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),o.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),o.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),o.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),o.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),o.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),o.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return i.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),s.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(n,t){this._emitter.addListener(n,t)},i.prototype.off=function(n,t){this._emitter.removeListener(n,t)},i.prototype.hasWorker=function(){return this._worker!=null},i.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},i.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},i.prototype.seek=function(n){this._worker?this._worker.postMessage({cmd:"seek",param:n}):this._controller.seek(n)},i.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},i.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},i.prototype._onInitSegment=function(n,t){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.INIT_SEGMENT,n,t)})},i.prototype._onMediaSegment=function(n,t){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.MEDIA_SEGMENT,n,t)})},i.prototype._onLoadingComplete=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(u.default.LOADING_COMPLETE)})},i.prototype._onRecoveredEarlyEof=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(u.default.RECOVERED_EARLY_EOF)})},i.prototype._onMediaInfo=function(n){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.MEDIA_INFO,n)})},i.prototype._onMetaDataArrived=function(n){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.METADATA_ARRIVED,n)})},i.prototype._onScriptDataArrived=function(n){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.SCRIPTDATA_ARRIVED,n)})},i.prototype._onStatisticsInfo=function(n){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.STATISTICS_INFO,n)})},i.prototype._onIOError=function(n,t){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.IO_ERROR,n,t)})},i.prototype._onDemuxError=function(n,t){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.DEMUX_ERROR,n,t)})},i.prototype._onRecommendSeekpoint=function(n){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.RECOMMEND_SEEKPOINT,n)})},i.prototype._onLoggingConfigChanged=function(n){this._worker&&this._worker.postMessage({cmd:"logging_config",param:n})},i.prototype._onWorkerMessage=function(n){var t=n.data,o=t.data;if(t.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(t.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,o.type,o.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(o,r.default.prototype),this._emitter.emit(t.msg,o);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(t.msg,o);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(t.msg,o.type,o.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,o);break;case"logcat_callback":f.default.emitter.emit("log",o.type,o.logcat);break}},i}();L.default=e},"./src/core/transmuxing-controller.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/core/media-info.js"),s=m("./src/demux/flv-demuxer.js"),l=m("./src/remux/mp4-remuxer.js"),u=m("./src/demux/demux-errors.js"),r=m("./src/io/io-controller.js"),e=m("./src/core/transmuxing-events.js"),i=function(){function n(t,o){this.TAG="TransmuxingController",this._emitter=new(c()),this._config=o,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),typeof t.cors!="boolean"&&(t.cors=!0),typeof t.withCredentials!="boolean"&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var _=0;this._mediaDataSource.segments.forEach(function(p){p.timestampBase=_,_+=p.duration,p.cors=t.cors,p.withCredentials=t.withCredentials,o.referrerPolicy&&(p.referrerPolicy=o.referrerPolicy)}),!isNaN(_)&&this._mediaDataSource.duration!==_&&(this._mediaDataSource.duration=_),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return n.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(t,o){this._emitter.addListener(t,o)},n.prototype.off=function(t,o){this._emitter.removeListener(t,o)},n.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},n.prototype._loadSegment=function(t,o){this._currentSegmentIndex=t;var _=this._mediaDataSource.segments[t],p=this._ioctl=new r.default(_,this._config,t);p.onError=this._onIOException.bind(this),p.onSeeked=this._onIOSeeked.bind(this),p.onComplete=this._onIOComplete.bind(this),p.onRedirect=this._onIORedirect.bind(this),p.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),o?this._demuxer.bindDataSource(this._ioctl):p.onDataArrival=this._onInitChunkArrival.bind(this),p.open(o)},n.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},n.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},n.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},n.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},n.prototype.seek=function(t){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var o=this._searchSegmentIndexContains(t);if(o===this._currentSegmentIndex){var _=this._mediaInfo.segments[o];if(_==null)this._pendingSeekTime=t;else{var p=_.getNearestKeyframe(t);this._remuxer.seek(p.milliseconds),this._ioctl.seek(p.fileposition),this._pendingResolveSeekPoint=p.milliseconds}}else{var g=this._mediaInfo.segments[o];if(g==null)this._pendingSeekTime=t,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(o);else{var p=g.getNearestKeyframe(t);this._internalAbort(),this._remuxer.seek(t),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[o].timestampBase,this._loadSegment(o,p.fileposition),this._pendingResolveSeekPoint=p.milliseconds,this._reportSegmentMediaInfo(o)}}this._enableStatisticsReporter()}},n.prototype._searchSegmentIndexContains=function(t){for(var o=this._mediaDataSource.segments,_=o.length-1,p=0;p<o.length;p++)if(t<o[p].timestampBase){_=p-1;break}return _},n.prototype._onInitChunkArrival=function(t,o){var _=this,p=null,g=0;if(o>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,g=this._demuxer.parseChunks(t,o);else if((p=s.default.probe(t)).match){this._demuxer=new s.default(p,this._config),this._remuxer||(this._remuxer=new l.default(this._config));var b=this._mediaDataSource;b.duration!=null&&!isNaN(b.duration)&&(this._demuxer.overridedDuration=b.duration),typeof b.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=b.hasAudio),typeof b.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=b.hasVideo),this._demuxer.timestampBase=b.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),g=this._demuxer.parseChunks(t,o)}else p=null,d.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){_._internalAbort()}),this._emitter.emit(e.default.DEMUX_ERROR,u.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),g=0;return g},n.prototype._onMediaInfo=function(t){var o=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},t),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,f.default.prototype));var _=Object.assign({},t);Object.setPrototypeOf(_,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=_,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var p=o._pendingSeekTime;o._pendingSeekTime=null,o.seek(p)})},n.prototype._onMetaDataArrived=function(t){this._emitter.emit(e.default.METADATA_ARRIVED,t)},n.prototype._onScriptDataArrived=function(t){this._emitter.emit(e.default.SCRIPTDATA_ARRIVED,t)},n.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},n.prototype._onIOComplete=function(t){var o=t,_=o+1;_<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(_)):(this._remuxer.flushStashedSamples(),this._emitter.emit(e.default.LOADING_COMPLETE),this._disableStatisticsReporter())},n.prototype._onIORedirect=function(t){var o=this._ioctl.extraData;this._mediaDataSource.segments[o].redirectedURL=t},n.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(e.default.RECOVERED_EARLY_EOF)},n.prototype._onIOException=function(t,o){d.default.e(this.TAG,"IOException: type = "+t+", code = "+o.code+", msg = "+o.msg),this._emitter.emit(e.default.IO_ERROR,t,o),this._disableStatisticsReporter()},n.prototype._onDemuxException=function(t,o){d.default.e(this.TAG,"DemuxException: type = "+t+", info = "+o),this._emitter.emit(e.default.DEMUX_ERROR,t,o)},n.prototype._onRemuxerInitSegmentArrival=function(t,o){this._emitter.emit(e.default.INIT_SEGMENT,t,o)},n.prototype._onRemuxerMediaSegmentArrival=function(t,o){if(this._pendingSeekTime==null&&(this._emitter.emit(e.default.MEDIA_SEGMENT,t,o),this._pendingResolveSeekPoint!=null&&t==="video")){var _=o.info.syncPoints,p=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.default.safari&&_.length>0&&_[0].originalDts===p&&(p=_[0].pts),this._emitter.emit(e.default.RECOMMEND_SEEKPOINT,p)}},n.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},n.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype._reportSegmentMediaInfo=function(t){var o=this._mediaInfo.segments[t],_=Object.assign({},o);_.duration=this._mediaInfo.duration,_.segmentCount=this._mediaInfo.segmentCount,delete _.segments,delete _.keyframesIndex,this._emitter.emit(e.default.MEDIA_INFO,_)},n.prototype._reportStatisticsInfo=function(){var t={};t.url=this._ioctl.currentURL,t.hasRedirect=this._ioctl.hasRedirect,t.hasRedirect&&(t.redirectedURL=this._ioctl.currentRedirectedURL),t.speed=this._ioctl.currentSpeed,t.loaderType=this._ioctl.loaderType,t.currentSegmentIndex=this._currentSegmentIndex,t.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(e.default.STATISTICS_INFO,t)},n}();L.default=i},"./src/core/transmuxing-events.js":function(M,L,m){m.r(L);var y={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};L.default=y},"./src/core/transmuxing-worker.js":function(M,L,m){m.r(L);var y=m("./src/utils/logging-control.js"),c=m("./src/utils/polyfill.js"),d=m("./src/core/transmuxing-controller.js"),a=m("./src/core/transmuxing-events.js"),f=function(s){var l=null,u=v.bind(this);c.default.install(),s.addEventListener("message",function(x){switch(x.data.cmd){case"init":l=new d.default(x.data.param[0],x.data.param[1]),l.on(a.default.IO_ERROR,g.bind(this)),l.on(a.default.DEMUX_ERROR,b.bind(this)),l.on(a.default.INIT_SEGMENT,r.bind(this)),l.on(a.default.MEDIA_SEGMENT,e.bind(this)),l.on(a.default.LOADING_COMPLETE,i.bind(this)),l.on(a.default.RECOVERED_EARLY_EOF,n.bind(this)),l.on(a.default.MEDIA_INFO,t.bind(this)),l.on(a.default.METADATA_ARRIVED,o.bind(this)),l.on(a.default.SCRIPTDATA_ARRIVED,_.bind(this)),l.on(a.default.STATISTICS_INFO,p.bind(this)),l.on(a.default.RECOMMEND_SEEKPOINT,E.bind(this));break;case"destroy":l&&(l.destroy(),l=null),s.postMessage({msg:"destroyed"});break;case"start":l.start();break;case"stop":l.stop();break;case"seek":l.seek(x.data.param);break;case"pause":l.pause();break;case"resume":l.resume();break;case"logging_config":{var S=x.data.param;y.default.applyConfig(S),S.enableCallback===!0?y.default.addLogListener(u):y.default.removeLogListener(u);break}}});function r(x,S){var O={msg:a.default.INIT_SEGMENT,data:{type:x,data:S}};s.postMessage(O,[S.data])}function e(x,S){var O={msg:a.default.MEDIA_SEGMENT,data:{type:x,data:S}};s.postMessage(O,[S.data])}function i(){var x={msg:a.default.LOADING_COMPLETE};s.postMessage(x)}function n(){var x={msg:a.default.RECOVERED_EARLY_EOF};s.postMessage(x)}function t(x){var S={msg:a.default.MEDIA_INFO,data:x};s.postMessage(S)}function o(x){var S={msg:a.default.METADATA_ARRIVED,data:x};s.postMessage(S)}function _(x){var S={msg:a.default.SCRIPTDATA_ARRIVED,data:x};s.postMessage(S)}function p(x){var S={msg:a.default.STATISTICS_INFO,data:x};s.postMessage(S)}function g(x,S){s.postMessage({msg:a.default.IO_ERROR,data:{type:x,info:S}})}function b(x,S){s.postMessage({msg:a.default.DEMUX_ERROR,data:{type:x,info:S}})}function E(x){s.postMessage({msg:a.default.RECOMMEND_SEEKPOINT,data:x})}function v(x,S){s.postMessage({msg:"logcat_callback",data:{type:x,logcat:S}})}};L.default=f},"./src/demux/amf-parser.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/utils/utf8-conv.js"),d=m("./src/utils/exception.js"),a=function(){var s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256}(),f=function(){function s(){}return s.parseScriptData=function(l,u,r){var e={};try{var i=s.parseValue(l,u,r),n=s.parseValue(l,u+i.size,r-i.size);e[i.data]=n.data}catch(t){y.default.e("AMF",t.toString())}return e},s.parseObject=function(l,u,r){if(r<3)throw new d.IllegalStateException("Data not enough when parse ScriptDataObject");var e=s.parseString(l,u,r),i=s.parseValue(l,u+e.size,r-e.size),n=i.objectEnd;return{data:{name:e.data,value:i.data},size:e.size+i.size,objectEnd:n}},s.parseVariable=function(l,u,r){return s.parseObject(l,u,r)},s.parseString=function(l,u,r){if(r<2)throw new d.IllegalStateException("Data not enough when parse String");var e=new DataView(l,u,r),i=e.getUint16(0,!a),n;return i>0?n=(0,c.default)(new Uint8Array(l,u+2,i)):n="",{data:n,size:2+i}},s.parseLongString=function(l,u,r){if(r<4)throw new d.IllegalStateException("Data not enough when parse LongString");var e=new DataView(l,u,r),i=e.getUint32(0,!a),n;return i>0?n=(0,c.default)(new Uint8Array(l,u+4,i)):n="",{data:n,size:4+i}},s.parseDate=function(l,u,r){if(r<10)throw new d.IllegalStateException("Data size invalid when parse Date");var e=new DataView(l,u,r),i=e.getFloat64(0,!a),n=e.getInt16(8,!a);return i+=n*60*1e3,{data:new Date(i),size:8+2}},s.parseValue=function(l,u,r){if(r<1)throw new d.IllegalStateException("Data not enough when parse Value");var e=new DataView(l,u,r),i=1,n=e.getUint8(0),t,o=!1;try{switch(n){case 0:t=e.getFloat64(1,!a),i+=8;break;case 1:{var _=e.getUint8(1);t=!!_,i+=1;break}case 2:{var p=s.parseString(l,u+1,r-1);t=p.data,i+=p.size;break}case 3:{t={};var g=0;for((e.getUint32(r-4,!a)&16777215)===9&&(g=3);i<r-4;){var b=s.parseObject(l,u+i,r-i-g);if(b.objectEnd)break;t[b.data.name]=b.data.value,i+=b.size}if(i<=r-3){var E=e.getUint32(i-1,!a)&16777215;E===9&&(i+=3)}break}case 8:{t={},i+=4;var g=0;for((e.getUint32(r-4,!a)&16777215)===9&&(g=3);i<r-8;){var v=s.parseVariable(l,u+i,r-i-g);if(v.objectEnd)break;t[v.data.name]=v.data.value,i+=v.size}if(i<=r-3){var E=e.getUint32(i-1,!a)&16777215;E===9&&(i+=3)}break}case 9:t=void 0,i=1,o=!0;break;case 10:{t=[];var x=e.getUint32(1,!a);i+=4;for(var S=0;S<x;S++){var O=s.parseValue(l,u+i,r-i);t.push(O.data),i+=O.size}break}case 11:{var R=s.parseDate(l,u+1,r-1);t=R.data,i+=R.size;break}case 12:{var T=s.parseString(l,u+1,r-1);t=T.data,i+=T.size;break}default:i=r,y.default.w("AMF","Unsupported AMF value type "+n)}}catch(B){y.default.e("AMF",B.toString())}return{data:t,size:i,objectEnd:o}},s}();L.default=f},"./src/demux/demux-errors.js":function(M,L,m){m.r(L);var y={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};L.default=y},"./src/demux/exp-golomb.js":function(M,L,m){m.r(L);var y=m("./src/utils/exception.js"),c=function(){function d(a){this.TAG="ExpGolomb",this._buffer=a,this._buffer_index=0,this._total_bytes=a.byteLength,this._total_bits=a.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return d.prototype.destroy=function(){this._buffer=null},d.prototype._fillCurrentWord=function(){var a=this._total_bytes-this._buffer_index;if(a<=0)throw new y.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var f=Math.min(4,a),s=new Uint8Array(4);s.set(this._buffer.subarray(this._buffer_index,this._buffer_index+f)),this._current_word=new DataView(s.buffer).getUint32(0,!1),this._buffer_index+=f,this._current_word_bits_left=f*8},d.prototype.readBits=function(a){if(a>32)throw new y.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(a<=this._current_word_bits_left){var f=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,f}var s=this._current_word_bits_left?this._current_word:0;s=s>>>32-this._current_word_bits_left;var l=a-this._current_word_bits_left;this._fillCurrentWord();var u=Math.min(l,this._current_word_bits_left),r=this._current_word>>>32-u;return this._current_word<<=u,this._current_word_bits_left-=u,s=s<<u|r,s},d.prototype.readBool=function(){return this.readBits(1)===1},d.prototype.readByte=function(){return this.readBits(8)},d.prototype._skipLeadingZero=function(){var a;for(a=0;a<this._current_word_bits_left;a++)if((this._current_word&2147483648>>>a)!==0)return this._current_word<<=a,this._current_word_bits_left-=a,a;return this._fillCurrentWord(),a+this._skipLeadingZero()},d.prototype.readUEG=function(){var a=this._skipLeadingZero();return this.readBits(a+1)-1},d.prototype.readSEG=function(){var a=this.readUEG();return a&1?a+1>>>1:-1*(a>>>1)},d}();L.default=c},"./src/demux/flv-demuxer.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/demux/amf-parser.js"),d=m("./src/demux/sps-parser.js"),a=m("./src/demux/demux-errors.js"),f=m("./src/core/media-info.js"),s=m("./src/utils/exception.js");function l(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}var u=function(){function r(e,i){this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new f.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}()}return r.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},r.probe=function(e){var i=new Uint8Array(e),n={match:!1};if(i[0]!==70||i[1]!==76||i[2]!==86||i[3]!==1)return n;var t=(i[4]&4)>>>2!==0,o=(i[4]&1)!==0,_=l(i,5);return _<9?n:{match:!0,consumed:_,dataOffset:_,hasAudioTrack:t,hasVideoTrack:o}},r.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(r.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),r.prototype.resetMediaInfo=function(){this._mediaInfo=new f.default},r.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},r.prototype.parseChunks=function(e,i){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new s.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var n=0,t=this._littleEndian;if(i===0)if(e.byteLength>13){var o=r.probe(e);n=o.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,i+n!==this._dataOffset&&y.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var _=new DataView(e,n),p=_.getUint32(0,!t);p!==0&&y.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4}for(;n<e.byteLength;){this._dispatch=!0;var _=new DataView(e,n);if(n+11+4>e.byteLength)break;var g=_.getUint8(0),b=_.getUint32(0,!t)&16777215;if(n+11+b+4>e.byteLength)break;if(g!==8&&g!==9&&g!==18){y.default.w(this.TAG,"Unsupported tag type "+g+", skipped"),n+=11+b+4;continue}var E=_.getUint8(4),v=_.getUint8(5),x=_.getUint8(6),S=_.getUint8(7),O=x|v<<8|E<<16|S<<24,R=_.getUint32(7,!t)&16777215;R!==0&&y.default.w(this.TAG,"Meet tag which has StreamID != 0!");var T=n+11;switch(g){case 8:this._parseAudioData(e,T,b,O);break;case 9:this._parseVideoData(e,T,b,O,i+n);break;case 18:this._parseScriptData(e,T,b);break}var B=_.getUint32(11+b,!t);B!==11+b&&y.default.w(this.TAG,"Invalid PrevTagSize "+B),n+=11+b+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n},r.prototype._parseScriptData=function(e,i,n){var t=c.default.parseScriptData(e,i,n);if(t.hasOwnProperty("onMetaData")){if(t.onMetaData==null||typeof t.onMetaData!="object"){y.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&y.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=t;var o=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},o)),typeof o.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=o.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof o.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=o.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof o.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=o.audiodatarate),typeof o.videodatarate=="number"&&(this._mediaInfo.videoDataRate=o.videodatarate),typeof o.width=="number"&&(this._mediaInfo.width=o.width),typeof o.height=="number"&&(this._mediaInfo.height=o.height),typeof o.duration=="number"){if(!this._durationOverrided){var _=Math.floor(o.duration*this._timescale);this._duration=_,this._mediaInfo.duration=_}}else this._mediaInfo.duration=0;if(typeof o.framerate=="number"){var p=Math.floor(o.framerate*1e3);if(p>0){var g=p/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=g,this._referenceFrameRate.fps_num=p,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=g}}if(typeof o.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var b=o.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(b),o.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=o,y.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(t).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},t))},r.prototype._parseKeyframesIndex=function(e){for(var i=[],n=[],t=1;t<e.times.length;t++){var o=this._timestampBase+Math.floor(e.times[t]*1e3);i.push(o),n.push(e.filepositions[t])}return{times:i,filepositions:n}},r.prototype._parseAudioData=function(e,i,n,t){if(n<=1){y.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var o=new DataView(e,i,n),_=o.getUint8(0),p=_>>>4;if(p!==2&&p!==10){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+p);return}var g=0,b=(_&12)>>>2;if(b>=0&&b<=4)g=this._flvSoundRateTable[b];else{this._onError(a.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+b);return}var E=_&1,v=this._audioMetadata,x=this._audioTrack;if(v||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),v=this._audioMetadata={},v.type="audio",v.id=x.id,v.timescale=this._timescale,v.duration=this._duration,v.audioSampleRate=g,v.channelCount=E===0?1:2),p===10){var S=this._parseAACAudioData(e,i+1,n-1);if(S==null)return;if(S.packetType===0){v.config&&y.default.w(this.TAG,"Found another AudioSpecificConfig!");var O=S.data;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.config=O.config,v.refSampleDuration=1024/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.originalCodec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}else if(S.packetType===1){var T=this._timestampBase+t,B={unit:S.data,length:S.data.byteLength,dts:T,pts:T};x.samples.push(B),x.length+=S.data.length}else y.default.e(this.TAG,"Flv: Unsupported AAC data type "+S.packetType)}else if(p===2){if(!v.codec){var O=this._parseMP3AudioData(e,i+1,n-1,!0);if(O==null)return;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.refSampleDuration=1152/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.codec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.audioDataRate=O.bitRate,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}var U=this._parseMP3AudioData(e,i+1,n-1,!1);if(U==null)return;var T=this._timestampBase+t,k={unit:U,length:U.byteLength,dts:T,pts:T};x.samples.push(k),x.length+=U.length}}},r.prototype._parseAACAudioData=function(e,i,n){if(n<=1){y.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var t={},o=new Uint8Array(e,i,n);return t.packetType=o[0],o[0]===0?t.data=this._parseAACAudioSpecificConfig(e,i+1,n-1):t.data=o.subarray(1),t},r.prototype._parseAACAudioSpecificConfig=function(e,i,n){var t=new Uint8Array(e,i,n),o=null,_=0,p=0,g=0,b=null;if(_=p=t[0]>>>3,g=(t[0]&7)<<1|t[1]>>>7,g<0||g>=this._mpegSamplingRates.length){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var E=this._mpegSamplingRates[g],v=(t[1]&120)>>>3;if(v<0||v>=8){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}_===5&&(b=(t[1]&7)<<1|t[2]>>>7,(t[2]&124)>>>2);var x=self.navigator.userAgent.toLowerCase();return x.indexOf("firefox")!==-1?g>=6?(_=5,o=new Array(4),b=g-3):(_=2,o=new Array(2),b=g):x.indexOf("android")!==-1?(_=2,o=new Array(2),b=g):(_=5,b=g,o=new Array(4),g>=6?b=g-3:v===1&&(_=2,o=new Array(2),b=g)),o[0]=_<<3,o[0]|=(g&15)>>>1,o[1]=(g&15)<<7,o[1]|=(v&15)<<3,_===5&&(o[1]|=(b&15)>>>1,o[2]=(b&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplingRate:E,channelCount:v,codec:"mp4a.40."+_,originalCodec:"mp4a.40."+p}},r.prototype._parseMP3AudioData=function(e,i,n,t){if(n<4){y.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var o=new Uint8Array(e,i,n),_=null;if(t){if(o[0]!==255)return;var p=o[1]>>>3&3,g=(o[1]&6)>>1,b=(o[2]&240)>>>4,E=(o[2]&12)>>>2,v=o[3]>>>6&3,x=v!==3?2:1,S=0,O=0,R="mp3";switch(p){case 0:S=this._mpegAudioV25SampleRateTable[E];break;case 2:S=this._mpegAudioV20SampleRateTable[E];break;case 3:S=this._mpegAudioV10SampleRateTable[E];break}switch(g){case 1:b<this._mpegAudioL3BitRateTable.length&&(O=this._mpegAudioL3BitRateTable[b]);break;case 2:b<this._mpegAudioL2BitRateTable.length&&(O=this._mpegAudioL2BitRateTable[b]);break;case 3:b<this._mpegAudioL1BitRateTable.length&&(O=this._mpegAudioL1BitRateTable[b]);break}_={bitRate:O,samplingRate:S,channelCount:x,codec:R,originalCodec:R}}else _=o;return _},r.prototype._parseVideoData=function(e,i,n,t,o){if(n<=1){y.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var _=new Uint8Array(e,i,n)[0],p=(_&240)>>>4,g=_&15;if(g!==7){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+g);return}this._parseAVCVideoPacket(e,i+1,n-1,t,o,p)}},r.prototype._parseAVCVideoPacket=function(e,i,n,t,o,_){if(n<4){y.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var p=this._littleEndian,g=new DataView(e,i,n),b=g.getUint8(0),E=g.getUint32(0,!p)&16777215,v=E<<8>>8;if(b===0)this._parseAVCDecoderConfigurationRecord(e,i+4,n-4);else if(b===1)this._parseAVCVideoData(e,i+4,n-4,t,o,_,v);else if(b!==2){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid video packet type "+b);return}},r.prototype._parseAVCDecoderConfigurationRecord=function(e,i,n){if(n<7){y.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var t=this._videoMetadata,o=this._videoTrack,_=this._littleEndian,p=new DataView(e,i,n);t?typeof t.avcc<"u"&&y.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),t=this._videoMetadata={},t.type="video",t.id=o.id,t.timescale=this._timescale,t.duration=this._duration);var g=p.getUint8(0),b=p.getUint8(1);if(p.getUint8(2),p.getUint8(3),g!==1||b===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(p.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(a.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var E=p.getUint8(5)&31;if(E===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else E>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+E);for(var v=6,x=0;x<E;x++){var S=p.getUint16(v,!_);if(v+=2,S!==0){var O=new Uint8Array(e,i+v,S);v+=S;var R=d.default.parseSPS(O);if(x===0){t.codecWidth=R.codec_size.width,t.codecHeight=R.codec_size.height,t.presentWidth=R.present_size.width,t.presentHeight=R.present_size.height,t.profile=R.profile_string,t.level=R.level_string,t.bitDepth=R.bit_depth,t.chromaFormat=R.chroma_format,t.sarRatio=R.sar_ratio,t.frameRate=R.frame_rate,(R.frame_rate.fixed===!1||R.frame_rate.fps_num===0||R.frame_rate.fps_den===0)&&(t.frameRate=this._referenceFrameRate);var T=t.frameRate.fps_den,B=t.frameRate.fps_num;t.refSampleDuration=t.timescale*(T/B);for(var U=O.subarray(1,4),k="avc1.",N=0;N<3;N++){var z=U[N].toString(16);z.length<2&&(z="0"+z),k+=z}t.codec=k;var P=this._mediaInfo;P.width=t.codecWidth,P.height=t.codecHeight,P.fps=t.frameRate.fps,P.profile=t.profile,P.level=t.level,P.refFrames=R.ref_frames,P.chromaFormat=R.chroma_format_string,P.sarNum=t.sarRatio.width,P.sarDen=t.sarRatio.height,P.videoCodec=k,P.hasAudio?P.audioCodec!=null&&(P.mimeType='video/x-flv; codecs="'+P.videoCodec+","+P.audioCodec+'"'):P.mimeType='video/x-flv; codecs="'+P.videoCodec+'"',P.isComplete()&&this._onMediaInfo(P)}}}var W=p.getUint8(v);if(W===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else W>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+W);v++;for(var x=0;x<W;x++){var S=p.getUint16(v,!_);v+=2,S!==0&&(v+=S)}t.avcc=new Uint8Array(n),t.avcc.set(new Uint8Array(e,i,n),0),y.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",t)},r.prototype._parseAVCVideoData=function(e,i,n,t,o,_,p){for(var g=this._littleEndian,b=new DataView(e,i,n),E=[],v=0,x=0,S=this._naluLengthSize,O=this._timestampBase+t,R=_===1;x<n;){if(x+4>=n){y.default.w(this.TAG,"Malformed Nalu near timestamp "+O+", offset = "+x+", dataSize = "+n);break}var T=b.getUint32(x,!g);if(S===3&&(T>>>=8),T>n-S){y.default.w(this.TAG,"Malformed Nalus near timestamp "+O+", NaluSize > DataSize!");return}var B=b.getUint8(x+S)&31;B===5&&(R=!0);var U=new Uint8Array(e,i+x,S+T),k={type:B,data:U};E.push(k),v+=U.byteLength,x+=S+T}if(E.length){var N=this._videoTrack,z={units:E,length:v,isKeyframe:R,dts:O,cts:p,pts:O+p};R&&(z.fileposition=o),N.samples.push(z),N.length+=v}},r}();L.default=u},"./src/demux/sps-parser.js":function(M,L,m){m.r(L);var y=m("./src/demux/exp-golomb.js"),c=function(){function d(){}return d._ebsp2rbsp=function(a){for(var f=a,s=f.byteLength,l=new Uint8Array(s),u=0,r=0;r<s;r++)r>=2&&f[r]===3&&f[r-1]===0&&f[r-2]===0||(l[u]=f[r],u++);return new Uint8Array(l.buffer,0,u)},d.parseSPS=function(a){var f=d._ebsp2rbsp(a),s=new y.default(f);s.readByte();var l=s.readByte();s.readByte();var u=s.readByte();s.readUEG();var r=d.getProfileString(l),e=d.getLevelString(u),i=1,n=420,t=[0,420,422,444],o=8;if((l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128||l===138||l===144)&&(i=s.readUEG(),i===3&&s.readBits(1),i<=3&&(n=t[i]),o=s.readUEG()+8,s.readUEG(),s.readBits(1),s.readBool()))for(var _=i!==3?8:12,p=0;p<_;p++)s.readBool()&&(p<6?d._skipScalingList(s,16):d._skipScalingList(s,64));s.readUEG();var g=s.readUEG();if(g===0)s.readUEG();else if(g===1){s.readBits(1),s.readSEG(),s.readSEG();for(var b=s.readUEG(),p=0;p<b;p++)s.readSEG()}var E=s.readUEG();s.readBits(1);var v=s.readUEG(),x=s.readUEG(),S=s.readBits(1);S===0&&s.readBits(1),s.readBits(1);var O=0,R=0,T=0,B=0,U=s.readBool();U&&(O=s.readUEG(),R=s.readUEG(),T=s.readUEG(),B=s.readUEG());var k=1,N=1,z=0,P=!0,W=0,ie=0,K=s.readBool();if(K){if(s.readBool()){var H=s.readByte(),ee=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Q=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];H>0&&H<16?(k=ee[H-1],N=Q[H-1]):H===255&&(k=s.readByte()<<8|s.readByte(),N=s.readByte()<<8|s.readByte())}if(s.readBool()&&s.readBool(),s.readBool()&&(s.readBits(4),s.readBool()&&s.readBits(24)),s.readBool()&&(s.readUEG(),s.readUEG()),s.readBool()){var $=s.readBits(32),ue=s.readBits(32);P=s.readBool(),W=ue,ie=$*2,z=W/ie}}var Y=1;(k!==1||N!==1)&&(Y=k/N);var D=0,q=0;if(i===0)D=1,q=2-S;else{var se=i===3?1:2,he=i===1?2:1;D=se,q=he*(2-S)}var le=(v+1)*16,fe=(2-S)*((x+1)*16);le-=(O+R)*D,fe-=(T+B)*q;var ce=Math.ceil(le*Y);return s.destroy(),s=null,{profile_string:r,level_string:e,bit_depth:o,ref_frames:E,chroma_format:n,chroma_format_string:d.getChromaFormatString(n),frame_rate:{fixed:P,fps:z,fps_den:ie,fps_num:W},sar_ratio:{width:k,height:N},codec_size:{width:le,height:fe},present_size:{width:ce,height:fe}}},d._skipScalingList=function(a,f){for(var s=8,l=8,u=0,r=0;r<f;r++)l!==0&&(u=a.readSEG(),l=(s+u+256)%256),s=l===0?s:l},d.getProfileString=function(a){switch(a){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},d.getLevelString=function(a){return(a/10).toFixed(1)},d.getChromaFormatString=function(a){switch(a){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},d}();L.default=c},"./src/flv.js":function(M,L,m){m.r(L);var y=m("./src/utils/polyfill.js"),c=m("./src/core/features.js"),d=m("./src/io/loader.js"),a=m("./src/player/flv-player.js"),f=m("./src/player/native-player.js"),s=m("./src/player/player-events.js"),l=m("./src/player/player-errors.js"),u=m("./src/utils/logging-control.js"),r=m("./src/utils/exception.js");y.default.install();function e(o,_){var p=o;if(p==null||typeof p!="object")throw new r.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!p.hasOwnProperty("type"))throw new r.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(p.type){case"flv":return new a.default(p,_);default:return new f.default(p,_)}}function i(){return c.default.supportMSEH264Playback()}function n(){return c.default.getFeatureList()}var t={};t.createPlayer=e,t.isSupported=i,t.getFeatureList=n,t.BaseLoader=d.BaseLoader,t.LoaderStatus=d.LoaderStatus,t.LoaderErrors=d.LoaderErrors,t.Events=s.default,t.ErrorTypes=l.ErrorTypes,t.ErrorDetails=l.ErrorDetails,t.FlvPlayer=a.default,t.NativePlayer=f.default,t.LoggingControl=u.default,Object.defineProperty(t,"version",{enumerable:!0,get:function(){return"1.6.2"}}),L.default=t},"./src/index.js":function(M,L,m){M.exports=m("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(M,L,m){m.r(L);var y=m("./src/utils/browser.js"),c=m("./src/io/loader.js"),d=m("./src/utils/exception.js"),a=function(){var s=function(l,u){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])},s(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");s(l,u);function r(){this.constructor=l}l.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}}(),f=function(s){a(l,s);function l(u,r){var e=s.call(this,"fetch-stream-loader")||this;return e.TAG="FetchStreamLoader",e._seekHandler=u,e._config=r,e._needStash=!0,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return l.isSupported=function(){try{var u=y.default.msedge&&y.default.version.minor>=15048,r=y.default.msedge?u:!0;return self.fetch&&self.ReadableStream&&r}catch{return!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),s.prototype.destroy.call(this)},l.prototype.open=function(u,r){var e=this;this._dataSource=u,this._range=r;var i=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(i=u.redirectedURL);var n=this._seekHandler.getConfig(i,r),t=new self.Headers;if(typeof n.headers=="object"){var o=n.headers;for(var _ in o)o.hasOwnProperty(_)&&t.append(_,o[_])}var p={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var _ in this._config.headers)t.append(_,this._config.headers[_]);u.cors===!1&&(p.mode="same-origin"),u.withCredentials&&(p.credentials="include"),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,p.signal=this._abortController.signal),this._status=c.LoaderStatus.kConnecting,self.fetch(n.url,p).then(function(g){if(e._requestAbort){e._status=c.LoaderStatus.kIdle,g.body.cancel();return}if(g.ok&&g.status>=200&&g.status<=299){if(g.url!==n.url&&e._onURLRedirect){var b=e._seekHandler.removeURLParameters(g.url);e._onURLRedirect(b)}var E=g.headers.get("Content-Length");return E!=null&&(e._contentLength=parseInt(E),e._contentLength!==0&&e._onContentLengthKnown&&e._onContentLengthKnown(e._contentLength)),e._pump.call(e,g.body.getReader())}else if(e._status=c.LoaderStatus.kError,e._onError)e._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:g.status,msg:g.statusText});else throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+g.status+" "+g.statusText)}).catch(function(g){if(!(e._abortController&&e._abortController.signal.aborted))if(e._status=c.LoaderStatus.kError,e._onError)e._onError(c.LoaderErrors.EXCEPTION,{code:-1,msg:g.message});else throw g})},l.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==c.LoaderStatus.kBuffering||!y.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},l.prototype._pump=function(u){var r=this;return u.read().then(function(e){if(e.done)if(r._contentLength!==null&&r._receivedLength<r._contentLength){r._status=c.LoaderStatus.kError;var i=c.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(r._onError)r._onError(i,n);else throw new d.RuntimeException(n.msg)}else r._status=c.LoaderStatus.kComplete,r._onComplete&&r._onComplete(r._range.from,r._range.from+r._receivedLength-1);else{if(r._abortController&&r._abortController.signal.aborted){r._status=c.LoaderStatus.kComplete;return}else if(r._requestAbort===!0)return r._status=c.LoaderStatus.kComplete,u.cancel();r._status=c.LoaderStatus.kBuffering;var t=e.value.buffer,o=r._range.from+r._receivedLength;r._receivedLength+=t.byteLength,r._onDataArrival&&r._onDataArrival(t,o,r._receivedLength),r._pump(u)}}).catch(function(e){if(r._abortController&&r._abortController.signal.aborted){r._status=c.LoaderStatus.kComplete;return}if(!(e.code===11&&y.default.msedge)){r._status=c.LoaderStatus.kError;var i=0,n=null;if((e.code===19||e.message==="network error")&&(r._contentLength===null||r._contentLength!==null&&r._receivedLength<r._contentLength)?(i=c.LoaderErrors.EARLY_EOF,n={code:e.code,msg:"Fetch stream meet Early-EOF"}):(i=c.LoaderErrors.EXCEPTION,n={code:e.code,msg:e.message}),r._onError)r._onError(i,n);else throw new d.RuntimeException(n.msg)}})},l}(c.BaseLoader);L.default=f},"./src/io/io-controller.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),d=m("./src/io/loader.js"),a=m("./src/io/fetch-stream-loader.js"),f=m("./src/io/xhr-moz-chunked-loader.js"),s=m("./src/io/xhr-range-loader.js"),l=m("./src/io/websocket-loader.js"),u=m("./src/io/range-seek-handler.js"),r=m("./src/io/param-seek-handler.js"),e=m("./src/utils/exception.js"),i=function(){function n(t,o,_){this.TAG="IOController",this._config=o,this._extraData=_,this._stashInitialSize=1024*384,o.stashInitialSize!=null&&o.stashInitialSize>0&&(this._stashInitialSize=o.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,o.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new c.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return n.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},n.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},n.prototype.isPaused=function(){return this._paused},Object.defineProperty(n.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(t){this._onSeeked=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(t){this._onRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(t){this._onRecoveredEarlyEof=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentSpeed",{get:function(){return this._loaderClass===s.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),n.prototype._selectSeekHandler=function(){var t=this._config;if(t.seekType==="range")this._seekHandler=new u.default(this._config.rangeLoadZeroStart);else if(t.seekType==="param"){var o=t.seekParamStart||"bstart",_=t.seekParamEnd||"bend";this._seekHandler=new r.default(o,_)}else if(t.seekType==="custom"){if(typeof t.customSeekHandler!="function")throw new e.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new t.customSeekHandler}else throw new e.InvalidArgumentException("Invalid seekType in config: "+t.seekType)},n.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=l.default;else if(a.default.isSupported())this._loaderClass=a.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(s.default.isSupported())this._loaderClass=s.default;else throw new e.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},n.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},n.prototype.open=function(t){this._currentRange={from:0,to:-1},t&&(this._currentRange.from=t),this._speedSampler.reset(),t||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},n.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},n.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},n.prototype.resume=function(){if(this._paused){this._paused=!1;var t=this._resumeFrom;this._resumeFrom=0,this._internalSeek(t,!0)}},n.prototype.seek=function(t){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(t,!0)},n.prototype._internalSeek=function(t,o){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(o),this._loader.destroy(),this._loader=null;var _={from:t,to:-1};this._currentRange={from:_.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,_),this._onSeeked&&this._onSeeked()},n.prototype.updateUrl=function(t){if(!t||typeof t!="string"||t.length===0)throw new e.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=t},n.prototype._expandBuffer=function(t){for(var o=this._stashSize;o+1024*1024*1<t;)o*=2;if(o+=1024*1024*1,o!==this._bufferSize){var _=new ArrayBuffer(o);if(this._stashUsed>0){var p=new Uint8Array(this._stashBuffer,0,this._stashUsed),g=new Uint8Array(_,0,o);g.set(p,0)}this._stashBuffer=_,this._bufferSize=o}},n.prototype._normalizeSpeed=function(t){var o=this._speedNormalizeList,_=o.length-1,p=0,g=0,b=_;if(t<o[0])return o[0];for(;g<=b;){if(p=g+Math.floor((b-g)/2),p===_||t>=o[p]&&t<o[p+1])return o[p];o[p]<t?g=p+1:b=p-1}},n.prototype._adjustStashSize=function(t){var o=0;this._config.isLive||t<512?o=t:t>=512&&t<=1024?o=Math.floor(t*1.5):o=t*2,o>8192&&(o=8192);var _=o*1024+1024*1024*1;this._bufferSize<_&&this._expandBuffer(_),this._stashSize=o*1024},n.prototype._dispatchChunks=function(t,o){return this._currentRange.to=o+t.byteLength-1,this._onDataArrival(t,o)},n.prototype._onURLRedirect=function(t){this._redirectedURL=t,this._onRedirect&&this._onRedirect(t)},n.prototype._onContentLengthKnown=function(t){t&&this._fullRequestFlag&&(this._totalLength=t,this._fullRequestFlag=!1)},n.prototype._onLoaderChunkArrival=function(t,o,_){if(!this._onDataArrival)throw new e.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(t.byteLength);var p=this._speedSampler.lastSecondKBps;if(p!==0){var g=this._normalizeSpeed(p);this._speedNormalized!==g&&(this._speedNormalized=g,this._adjustStashSize(g))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=o),this._stashUsed+t.byteLength<=this._stashSize){var v=new Uint8Array(this._stashBuffer,0,this._stashSize);v.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var S=this._stashBuffer.slice(0,this._stashUsed),b=this._dispatchChunks(S,this._stashByteStart);if(b<S.byteLength){if(b>0){var x=new Uint8Array(S,b);v.set(x,0),this._stashUsed=x.byteLength,this._stashByteStart+=b}}else this._stashUsed=0,this._stashByteStart+=b;this._stashUsed+t.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+t.byteLength),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var b=this._dispatchChunks(t,o);if(b<t.byteLength){var E=t.byteLength-b;E>this._bufferSize&&(this._expandBuffer(E),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(t,b),0),this._stashUsed+=E,this._stashByteStart=o+b}}}else if(this._stashUsed===0){var b=this._dispatchChunks(t,o);if(b<t.byteLength){var E=t.byteLength-b;E>this._bufferSize&&this._expandBuffer(E);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(t,b),0),this._stashUsed+=E,this._stashByteStart=o+b}}else{this._stashUsed+t.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+t.byteLength);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength;var b=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(b<this._stashUsed&&b>0){var x=new Uint8Array(this._stashBuffer,b);v.set(x,0)}this._stashUsed-=b,this._stashByteStart+=b}}},n.prototype._flushStashBuffer=function(t){if(this._stashUsed>0){var o=this._stashBuffer.slice(0,this._stashUsed),_=this._dispatchChunks(o,this._stashByteStart),p=o.byteLength-_;if(_<o.byteLength)if(t)y.default.w(this.TAG,p+" bytes unconsumed data remain when flush buffer, dropped");else{if(_>0){var g=new Uint8Array(this._stashBuffer,0,this._bufferSize),b=new Uint8Array(o,_);g.set(b,0),this._stashUsed=b.byteLength,this._stashByteStart+=_}return 0}return this._stashUsed=0,this._stashByteStart=0,p}return 0},n.prototype._onLoaderComplete=function(t,o){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},n.prototype._onLoaderError=function(t,o){switch(y.default.e(this.TAG,"Loader error, code = "+o.code+", msg = "+o.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,t=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF),t){case d.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var _=this._currentRange.to+1;_<this._totalLength&&(y.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(_,!1));return}t=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case d.LoaderErrors.CONNECTING_TIMEOUT:case d.LoaderErrors.HTTP_STATUS_CODE_INVALID:case d.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(t,o);else throw new e.RuntimeException("IOException: "+o.msg)},n}();L.default=i},"./src/io/loader.js":function(M,L,m){m.r(L),m.d(L,{LoaderStatus:function(){return c},LoaderErrors:function(){return d},BaseLoader:function(){return a}});var y=m("./src/utils/exception.js"),c={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function f(s){this._type=s||"undefined",this._status=c.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return f.prototype.destroy=function(){this._status=c.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},f.prototype.isWorking=function(){return this._status===c.kConnecting||this._status===c.kBuffering},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(s){this._onContentLengthKnown=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(s){this._onURLRedirect=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(s){this._onDataArrival=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(s){this._onError=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onComplete",{get:function(){return this._onComplete},set:function(s){this._onComplete=s},enumerable:!1,configurable:!0}),f.prototype.open=function(s,l){throw new y.NotImplementedException("Unimplemented abstract function!")},f.prototype.abort=function(){throw new y.NotImplementedException("Unimplemented abstract function!")},f}()},"./src/io/param-seek-handler.js":function(M,L,m){m.r(L);var y=function(){function c(d,a){this._startName=d,this._endName=a}return c.prototype.getConfig=function(d,a){var f=d;if(a.from!==0||a.to!==-1){var s=!0;f.indexOf("?")===-1&&(f+="?",s=!1),s&&(f+="&"),f+=this._startName+"="+a.from.toString(),a.to!==-1&&(f+="&"+this._endName+"="+a.to.toString())}return{url:f,headers:{}}},c.prototype.removeURLParameters=function(d){var a=d.split("?")[0],f=void 0,s=d.indexOf("?");s!==-1&&(f=d.substring(s+1));var l="";if(f!=null&&f.length>0)for(var u=f.split("&"),r=0;r<u.length;r++){var e=u[r].split("="),i=r>0;e[0]!==this._startName&&e[0]!==this._endName&&(i&&(l+="&"),l+=u[r])}return l.length===0?a:a+"?"+l},c}();L.default=y},"./src/io/range-seek-handler.js":function(M,L,m){m.r(L);var y=function(){function c(d){this._zeroStart=d||!1}return c.prototype.getConfig=function(d,a){var f={};if(a.from!==0||a.to!==-1){var s=void 0;a.to!==-1?s="bytes="+a.from.toString()+"-"+a.to.toString():s="bytes="+a.from.toString()+"-",f.Range=s}else this._zeroStart&&(f.Range="bytes=0-");return{url:d,headers:f}},c.prototype.removeURLParameters=function(d){return d},c}();L.default=y},"./src/io/speed-sampler.js":function(M,L,m){m.r(L);var y=function(){function c(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return c.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},c.prototype.addBytes=function(d){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=d,this._totalBytes+=d):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=d,this._totalBytes+=d):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=d,this._totalBytes+=d,this._lastCheckpoint=this._now())},Object.defineProperty(c.prototype,"currentKBps",{get:function(){this.addBytes(0);var d=(this._now()-this._lastCheckpoint)/1e3;return d==0&&(d=1),this._intervalBytes/d/1024},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"averageKBps",{get:function(){var d=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/d/1024},enumerable:!1,configurable:!0}),c}();L.default=y},"./src/io/websocket-loader.js":function(M,L,m){m.r(L);var y=m("./src/io/loader.js"),c=m("./src/utils/exception.js"),d=function(){var f=function(s,l){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,r){u.__proto__=r}||function(u,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(u[e]=r[e])},f(s,l)};return function(s,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");f(s,l);function u(){this.constructor=s}s.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),a=function(f){d(s,f);function s(){var l=f.call(this,"websocket-loader")||this;return l.TAG="WebSocketLoader",l._needStash=!0,l._ws=null,l._requestAbort=!1,l._receivedLength=0,l}return s.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},s.prototype.destroy=function(){this._ws&&this.abort(),f.prototype.destroy.call(this)},s.prototype.open=function(l){try{var u=this._ws=new self.WebSocket(l.url);u.binaryType="arraybuffer",u.onopen=this._onWebSocketOpen.bind(this),u.onclose=this._onWebSocketClose.bind(this),u.onmessage=this._onWebSocketMessage.bind(this),u.onerror=this._onWebSocketError.bind(this),this._status=y.LoaderStatus.kConnecting}catch(e){this._status=y.LoaderStatus.kError;var r={code:e.code,msg:e.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,r);else throw new c.RuntimeException(r.msg)}},s.prototype.abort=function(){var l=this._ws;l&&(l.readyState===0||l.readyState===1)&&(this._requestAbort=!0,l.close()),this._ws=null,this._status=y.LoaderStatus.kComplete},s.prototype._onWebSocketOpen=function(l){this._status=y.LoaderStatus.kBuffering},s.prototype._onWebSocketClose=function(l){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=y.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},s.prototype._onWebSocketMessage=function(l){var u=this;if(l.data instanceof ArrayBuffer)this._dispatchArrayBuffer(l.data);else if(l.data instanceof Blob){var r=new FileReader;r.onload=function(){u._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(l.data)}else{this._status=y.LoaderStatus.kError;var e={code:-1,msg:"Unsupported WebSocket message type: "+l.data.constructor.name};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,e);else throw new c.RuntimeException(e.msg)}},s.prototype._dispatchArrayBuffer=function(l){var u=l,r=this._receivedLength;this._receivedLength+=u.byteLength,this._onDataArrival&&this._onDataArrival(u,r,this._receivedLength)},s.prototype._onWebSocketError=function(l){this._status=y.LoaderStatus.kError;var u={code:l.code,msg:l.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,u);else throw new c.RuntimeException(u.msg)},s}(y.BaseLoader);L.default=a},"./src/io/xhr-moz-chunked-loader.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/loader.js"),d=m("./src/utils/exception.js"),a=function(){var s=function(l,u){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])},s(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");s(l,u);function r(){this.constructor=l}l.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}}(),f=function(s){a(l,s);function l(u,r){var e=s.call(this,"xhr-moz-chunked-loader")||this;return e.TAG="MozChunkedLoader",e._seekHandler=u,e._config=r,e._needStash=!0,e._xhr=null,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return l.isSupported=function(){try{var u=new XMLHttpRequest;return u.open("GET","https://example.com",!0),u.responseType="moz-chunked-arraybuffer",u.responseType==="moz-chunked-arraybuffer"}catch(r){return y.default.w("MozChunkedLoader",r.message),!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),s.prototype.destroy.call(this)},l.prototype.open=function(u,r){this._dataSource=u,this._range=r;var e=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(e=u.redirectedURL);var i=this._seekHandler.getConfig(e,r);this._requestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),u.withCredentials&&(n.withCredentials=!0),typeof i.headers=="object"){var t=i.headers;for(var o in t)t.hasOwnProperty(o)&&n.setRequestHeader(o,t[o])}if(typeof this._config.headers=="object"){var t=this._config.headers;for(var o in t)t.hasOwnProperty(o)&&n.setRequestHeader(o,t[o])}this._status=c.LoaderStatus.kConnecting,n.send()},l.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.LoaderStatus.kComplete},l.prototype._onReadyStateChange=function(u){var r=u.target;if(r.readyState===2){if(r.responseURL!=null&&r.responseURL!==this._requestURL&&this._onURLRedirect){var e=this._seekHandler.removeURLParameters(r.responseURL);this._onURLRedirect(e)}if(r.status!==0&&(r.status<200||r.status>299))if(this._status=c.LoaderStatus.kError,this._onError)this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText});else throw new d.RuntimeException("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText);else this._status=c.LoaderStatus.kBuffering}},l.prototype._onProgress=function(u){if(this._status!==c.LoaderStatus.kError){this._contentLength===null&&u.total!==null&&u.total!==0&&(this._contentLength=u.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var r=u.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,e,this._receivedLength)}},l.prototype._onLoadEnd=function(u){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===c.LoaderStatus.kError)return;this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},l.prototype._onXhrError=function(u){this._status=c.LoaderStatus.kError;var r=0,e=null;if(this._contentLength&&u.loaded<this._contentLength?(r=c.LoaderErrors.EARLY_EOF,e={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(r=c.LoaderErrors.EXCEPTION,e={code:-1,msg:u.constructor.name+" "+u.type}),this._onError)this._onError(r,e);else throw new d.RuntimeException(e.msg)},l}(c.BaseLoader);L.default=f},"./src/io/xhr-range-loader.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),d=m("./src/io/loader.js"),a=m("./src/utils/exception.js"),f=function(){var l=function(u,r){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},l(u,r)};return function(u,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");l(u,r);function e(){this.constructor=u}u.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}}(),s=function(l){f(u,l);function u(r,e){var i=l.call(this,"xhr-range-loader")||this;return i.TAG="RangeLoader",i._seekHandler=r,i._config=e,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new c.default,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}return u.isSupported=function(){try{var r=new XMLHttpRequest;return r.open("GET","https://example.com",!0),r.responseType="arraybuffer",r.responseType==="arraybuffer"}catch(e){return y.default.w("RangeLoader",e.message),!1}},u.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),l.prototype.destroy.call(this)},Object.defineProperty(u.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),u.prototype.open=function(r,e){this._dataSource=r,this._range=e,this._status=d.LoaderStatus.kConnecting;var i=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(i=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!i?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},u.prototype._openSubRange=function(){var r=this._currentChunkSizeKB*1024,e=this._range.from+this._receivedLength,i=e+r;this._contentLength!=null&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:e,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)},u.prototype._internalOpen=function(r,e){this._lastTimeLoaded=0;var i=r.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?i=this._currentRedirectedURL:r.redirectedURL!=null&&(i=r.redirectedURL));var n=this._seekHandler.getConfig(i,e);this._currentRequestURL=n.url;var t=this._xhr=new XMLHttpRequest;if(t.open("GET",n.url,!0),t.responseType="arraybuffer",t.onreadystatechange=this._onReadyStateChange.bind(this),t.onprogress=this._onProgress.bind(this),t.onload=this._onLoad.bind(this),t.onerror=this._onXhrError.bind(this),r.withCredentials&&(t.withCredentials=!0),typeof n.headers=="object"){var o=n.headers;for(var _ in o)o.hasOwnProperty(_)&&t.setRequestHeader(_,o[_])}if(typeof this._config.headers=="object"){var o=this._config.headers;for(var _ in o)o.hasOwnProperty(_)&&t.setRequestHeader(_,o[_])}t.send()},u.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete},u.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},u.prototype._onReadyStateChange=function(r){var e=r.target;if(e.readyState===2){if(e.responseURL!=null){var i=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else if(this._status=d.LoaderStatus.kError,this._onError)this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText});else throw new a.RuntimeException("RangeLoader: Http code invalid, "+e.status+" "+e.statusText)}},u.prototype._onProgress=function(r){if(this._status!==d.LoaderStatus.kError){if(this._contentLength===null){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var i=r.total;this._internalAbort(),i!=null&i!==0&&(this._totalLength=i)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,e){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=r.loaded-this._lastTimeLoaded;this._lastTimeLoaded=r.loaded,this._speedSampler.addBytes(n)}},u.prototype._normalizeSpeed=function(r){var e=this._chunkSizeKBList,i=e.length-1,n=0,t=0,o=i;if(r<e[0])return e[0];for(;t<=o;){if(n=t+Math.floor((o-t)/2),n===i||r>=e[n]&&r<e[n+1])return e[n];e[n]<r?t=n+1:o=n-1}},u.prototype._onLoad=function(r){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(e===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps)),e!==0){var i=this._normalizeSpeed(e);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var n=r.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var o=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():o=!0,this._onDataArrival&&this._onDataArrival(n,t,this._receivedLength),o&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},u.prototype._onXhrError=function(r){this._status=d.LoaderStatus.kError;var e=0,i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=d.LoaderErrors.EARLY_EOF,i={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=d.LoaderErrors.EXCEPTION,i={code:-1,msg:r.constructor.name+" "+r.type}),this._onError)this._onError(e,i);else throw new a.RuntimeException(i.msg)},u}(d.BaseLoader);L.default=s},"./src/player/flv-player.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),a=m("./src/utils/browser.js"),f=m("./src/player/player-events.js"),s=m("./src/core/transmuxer.js"),l=m("./src/core/transmuxing-events.js"),u=m("./src/core/mse-controller.js"),r=m("./src/core/mse-events.js"),e=m("./src/player/player-errors.js"),i=m("./src/config.js"),n=m("./src/utils/exception.js"),t=function(){function o(_,p){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(c()),this._config=(0,i.createDefaultConfig)(),typeof p=="object"&&Object.assign(this._config,p),_.type.toLowerCase()!=="flv")throw new n.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");_.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=_,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var g=a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661);this._alwaysSeekKeyframe=!!(g||a.default.msedge||a.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return o.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},o.prototype.on=function(_,p){var g=this;_===f.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.MEDIA_INFO,g.mediaInfo)}):_===f.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.STATISTICS_INFO,g.statisticsInfo)}),this._emitter.addListener(_,p)},o.prototype.off=function(_,p){this._emitter.removeListener(_,p)},o.prototype.attachMediaElement=function(_){var p=this;if(this._mediaElement=_,_.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),_.addEventListener("seeking",this.e.onvSeeking),_.addEventListener("canplay",this.e.onvCanPlay),_.addEventListener("stalled",this.e.onvStalled),_.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on(r.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(r.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(r.default.SOURCE_OPEN,function(){p._mseSourceOpened=!0,p._hasPendingLoad&&(p._hasPendingLoad=!1,p.load())}),this._msectl.on(r.default.ERROR,function(g){p._emitter.emit(f.default.ERROR,e.ErrorTypes.MEDIA_ERROR,e.ErrorDetails.MEDIA_MSE_ERROR,g)}),this._msectl.attachMediaElement(_),this._pendingSeekTime!=null)try{_.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},o.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},o.prototype.load=function(){var _=this;if(!this._mediaElement)throw new n.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new n.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new s.default(this._mediaDataSource,this._config),this._transmuxer.on(l.default.INIT_SEGMENT,function(p,g){_._msectl.appendInitSegment(g)}),this._transmuxer.on(l.default.MEDIA_SEGMENT,function(p,g){if(_._msectl.appendMediaSegment(g),_._config.lazyLoad&&!_._config.isLive){var b=_._mediaElement.currentTime;g.info.endDts>=(b+_._config.lazyLoadMaxDuration)*1e3&&_._progressChecker==null&&(d.default.v(_.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),_._suspendTransmuxer())}}),this._transmuxer.on(l.default.LOADING_COMPLETE,function(){_._msectl.endOfStream(),_._emitter.emit(f.default.LOADING_COMPLETE)}),this._transmuxer.on(l.default.RECOVERED_EARLY_EOF,function(){_._emitter.emit(f.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(l.default.IO_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,e.ErrorTypes.NETWORK_ERROR,p,g)}),this._transmuxer.on(l.default.DEMUX_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,e.ErrorTypes.MEDIA_ERROR,p,{code:-1,msg:g})}),this._transmuxer.on(l.default.MEDIA_INFO,function(p){_._mediaInfo=p,_._emitter.emit(f.default.MEDIA_INFO,Object.assign({},p))}),this._transmuxer.on(l.default.METADATA_ARRIVED,function(p){_._emitter.emit(f.default.METADATA_ARRIVED,p)}),this._transmuxer.on(l.default.SCRIPTDATA_ARRIVED,function(p){_._emitter.emit(f.default.SCRIPTDATA_ARRIVED,p)}),this._transmuxer.on(l.default.STATISTICS_INFO,function(p){_._statisticsInfo=_._fillStatisticsInfo(p),_._emitter.emit(f.default.STATISTICS_INFO,Object.assign({},_._statisticsInfo))}),this._transmuxer.on(l.default.RECOMMEND_SEEKPOINT,function(p){_._mediaElement&&!_._config.accurateSeek&&(_._requestSetTime=!0,_._mediaElement.currentTime=p/1e3)}),this._transmuxer.open()}},o.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},o.prototype.play=function(){return this._mediaElement.play()},o.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(_){this._mediaElement.volume=_},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(_){this._mediaElement.muted=_},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(_){this._mediaElement?this._internalSeek(_):this._pendingSeekTime=_},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),o.prototype._fillStatisticsInfo=function(_){if(_.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return _;var p=!0,g=0,b=0;if(this._mediaElement.getVideoPlaybackQuality){var E=this._mediaElement.getVideoPlaybackQuality();g=E.totalVideoFrames,b=E.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(g=this._mediaElement.webkitDecodedFrameCount,b=this._mediaElement.webkitDroppedFrameCount):p=!1;return p&&(_.decodedFrames=g,_.droppedFrames=b),_},o.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var _=this._mediaElement.buffered,p=this._mediaElement.currentTime,g=0,b=0;b<_.length;b++){var E=_.start(b),v=_.end(b);if(E<=p&&p<v){g=v;break}}g>=p+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(d.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},o.prototype._onmseBufferFull=function(){d.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},o.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},o.prototype._checkProgressAndResume=function(){for(var _=this._mediaElement.currentTime,p=this._mediaElement.buffered,g=!1,b=0;b<p.length;b++){var E=p.start(b),v=p.end(b);if(_>=E&&_<v){_>=v-this._config.lazyLoadRecoverDuration&&(g=!0);break}}g&&(window.clearInterval(this._progressChecker),this._progressChecker=null,g&&(d.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},o.prototype._isTimepointBuffered=function(_){for(var p=this._mediaElement.buffered,g=0;g<p.length;g++){var b=p.start(g),E=p.end(g);if(_>=b&&_<E)return!0}return!1},o.prototype._internalSeek=function(_){var p=this._isTimepointBuffered(_),g=!1,b=0;if(_<1&&this._mediaElement.buffered.length>0){var E=this._mediaElement.buffered.start(0);(E<1&&_<E||a.default.safari)&&(g=!0,b=a.default.safari?.1:E)}if(g)this._requestSetTime=!0,this._mediaElement.currentTime=b;else if(p){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=_;else{var v=this._msectl.getNearestKeyframe(Math.floor(_*1e3));this._requestSetTime=!0,v!=null?this._mediaElement.currentTime=v.dts/1e3:this._mediaElement.currentTime=_}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_)},o.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var _=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(_)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},o.prototype._checkAndResumeStuckPlayback=function(_){var p=this._mediaElement;if(_||!this._receivedCanPlay||p.readyState<2){var g=p.buffered;g.length>0&&p.currentTime<g.start(0)&&(d.default.w(this.TAG,"Playback seems stuck at "+p.currentTime+", seek to "+g.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=g.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},o.prototype._onvLoadedMetadata=function(_){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},o.prototype._onvSeeking=function(_){var p=this._mediaElement.currentTime,g=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(p<1&&g.length>0){var b=g.start(0);if(b<1&&p<b||a.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=a.default.safari?.1:b;return}}if(this._isTimepointBuffered(p)){if(this._alwaysSeekKeyframe){var E=this._msectl.getNearestKeyframe(Math.floor(p*1e3));E!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=E.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:p,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},o.prototype._onvCanPlay=function(_){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},o.prototype._onvStalled=function(_){this._checkAndResumeStuckPlayback(!0)},o.prototype._onvProgress=function(_){this._checkAndResumeStuckPlayback()},o}();L.default=t},"./src/player/native-player.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/player/player-events.js"),a=m("./src/config.js"),f=m("./src/utils/exception.js"),s=function(){function l(u,r){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(c()),this._config=(0,a.createDefaultConfig)(),typeof r=="object"&&Object.assign(this._config,r),u.type.toLowerCase()==="flv")throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(u.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+u.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=u,this._mediaElement=null}return l.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},l.prototype.on=function(u,r){var e=this;u===d.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(d.default.MEDIA_INFO,e.mediaInfo)}):u===d.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(d.default.STATISTICS_INFO,e.statisticsInfo)}),this._emitter.addListener(u,r)},l.prototype.off=function(u,r){this._emitter.removeListener(u,r)},l.prototype.attachMediaElement=function(u){if(this._mediaElement=u,u.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{u.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},l.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.load=function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},l.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.play=function(){return this._mediaElement.play()},l.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(u){this._mediaElement.volume=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(u){this._mediaElement.muted=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(u){this._mediaElement?this._mediaElement.currentTime=u:this._pendingSeekTime=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"mediaInfo",{get:function(){var u=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",r={mimeType:u+this._mediaDataSource.type};return this._mediaElement&&(r.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(r.width=this._mediaElement.videoWidth,r.height=this._mediaElement.videoHeight)),r},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"statisticsInfo",{get:function(){var u={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return u;var r=!0,e=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();e=n.totalVideoFrames,i=n.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(e=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):r=!1;return r&&(u.decodedFrames=e,u.droppedFrames=i),u},enumerable:!1,configurable:!0}),l.prototype._onvLoadedMetadata=function(u){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(d.default.MEDIA_INFO,this.mediaInfo)},l.prototype._reportStatisticsInfo=function(){this._emitter.emit(d.default.STATISTICS_INFO,this.statisticsInfo)},l}();L.default=s},"./src/player/player-errors.js":function(M,L,m){m.r(L),m.d(L,{ErrorTypes:function(){return d},ErrorDetails:function(){return a}});var y=m("./src/io/loader.js"),c=m("./src/demux/demux-errors.js"),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},a={NETWORK_EXCEPTION:y.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:y.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:y.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:y.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:c.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:c.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:c.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(M,L,m){m.r(L);var y={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};L.default=y},"./src/remux/aac-silent.js":function(M,L,m){m.r(L);var y=function(){function c(){}return c.getSilentFrame=function(d,a){if(d==="mp4a.40.2"){if(a===1)return new Uint8Array([0,200,0,128,35,128]);if(a===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(a===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(a===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(a===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(a===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(a===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},c}();L.default=y},"./src/remux/mp4-generator.js":function(M,L,m){m.r(L);var y=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var d in c.types)c.types.hasOwnProperty(d)&&(c.types[d]=[d.charCodeAt(0),d.charCodeAt(1),d.charCodeAt(2),d.charCodeAt(3)]);var a=c.constants={};a.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),a.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),a.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSC=a.STCO=a.STTS,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),a.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},c.box=function(d){for(var a=8,f=null,s=Array.prototype.slice.call(arguments,1),l=s.length,u=0;u<l;u++)a+=s[u].byteLength;f=new Uint8Array(a),f[0]=a>>>24&255,f[1]=a>>>16&255,f[2]=a>>>8&255,f[3]=a&255,f.set(d,4);for(var r=8,u=0;u<l;u++)f.set(s[u],r),r+=s[u].byteLength;return f},c.generateInitSegment=function(d){var a=c.box(c.types.ftyp,c.constants.FTYP),f=c.moov(d),s=new Uint8Array(a.byteLength+f.byteLength);return s.set(a,0),s.set(f,a.byteLength),s},c.moov=function(d){var a=c.mvhd(d.timescale,d.duration),f=c.trak(d),s=c.mvex(d);return c.box(c.types.moov,a,f,s)},c.mvhd=function(d,a){return c.box(c.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},c.trak=function(d){return c.box(c.types.trak,c.tkhd(d),c.mdia(d))},c.tkhd=function(d){var a=d.id,f=d.duration,s=d.presentWidth,l=d.presentHeight;return c.box(c.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>>8&255,s&255,0,0,l>>>8&255,l&255,0,0]))},c.mdia=function(d){return c.box(c.types.mdia,c.mdhd(d),c.hdlr(d),c.minf(d))},c.mdhd=function(d){var a=d.timescale,f=d.duration;return c.box(c.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,85,196,0,0]))},c.hdlr=function(d){var a=null;return d.type==="audio"?a=c.constants.HDLR_AUDIO:a=c.constants.HDLR_VIDEO,c.box(c.types.hdlr,a)},c.minf=function(d){var a=null;return d.type==="audio"?a=c.box(c.types.smhd,c.constants.SMHD):a=c.box(c.types.vmhd,c.constants.VMHD),c.box(c.types.minf,a,c.dinf(),c.stbl(d))},c.dinf=function(){var d=c.box(c.types.dinf,c.box(c.types.dref,c.constants.DREF));return d},c.stbl=function(d){var a=c.box(c.types.stbl,c.stsd(d),c.box(c.types.stts,c.constants.STTS),c.box(c.types.stsc,c.constants.STSC),c.box(c.types.stsz,c.constants.STSZ),c.box(c.types.stco,c.constants.STCO));return a},c.stsd=function(d){return d.type==="audio"?d.codec==="mp3"?c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp3(d)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp4a(d)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.avc1(d))},c.mp3=function(d){var a=d.channelCount,f=d.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types[".mp3"],s)},c.mp4a=function(d){var a=d.channelCount,f=d.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types.mp4a,s,c.esds(d))},c.esds=function(d){var a=d.config||[],f=a.length,s=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(a).concat([6,1,2]));return c.box(c.types.esds,s)},c.avc1=function(d){var a=d.avcc,f=d.codecWidth,s=d.codecHeight,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,f&255,s>>>8&255,s&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return c.box(c.types.avc1,l,c.box(c.types.avcC,a))},c.mvex=function(d){return c.box(c.types.mvex,c.trex(d))},c.trex=function(d){var a=d.id,f=new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return c.box(c.types.trex,f)},c.moof=function(d,a){return c.box(c.types.moof,c.mfhd(d.sequenceNumber),c.traf(d,a))},c.mfhd=function(d){var a=new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255]);return c.box(c.types.mfhd,a)},c.traf=function(d,a){var f=d.id,s=c.box(c.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),l=c.box(c.types.tfdt,new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255])),u=c.sdtp(d),r=c.trun(d,u.byteLength+16+16+8+16+8+8);return c.box(c.types.traf,s,l,r,u)},c.sdtp=function(d){for(var a=d.samples||[],f=a.length,s=new Uint8Array(4+f),l=0;l<f;l++){var u=a[l].flags;s[l+4]=u.isLeading<<6|u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy}return c.box(c.types.sdtp,s)},c.trun=function(d,a){var f=d.samples||[],s=f.length,l=12+16*s,u=new Uint8Array(l);a+=8+l,u.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255],0);for(var r=0;r<s;r++){var e=f[r].duration,i=f[r].size,n=f[r].flags,t=f[r].cts;u.set([e>>>24&255,e>>>16&255,e>>>8&255,e&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.isNonSync,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255],12+16*r)}return c.box(c.types.trun,u)},c.mdat=function(d){return c.box(c.types.mdat,d)},c}();y.init(),L.default=y},"./src/remux/mp4-remuxer.js":function(M,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/remux/mp4-generator.js"),d=m("./src/remux/aac-silent.js"),a=m("./src/utils/browser.js"),f=m("./src/core/media-segment-info.js"),s=m("./src/utils/exception.js"),l=function(){function u(r){this.TAG="MP4Remuxer",this._config=r,this._isLive=r.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new f.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new f.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661)),this._fillSilentAfterSeek=a.default.msedge||a.default.msie,this._mp3UseMpegAudio=!a.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return u.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},u.prototype.bindDataSource=function(r){return r.onDataAvailable=this.remux.bind(this),r.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(u.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(r){this._onInitSegment=r},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(r){this._onMediaSegment=r},enumerable:!1,configurable:!0}),u.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},u.prototype.seek=function(r){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},u.prototype.remux=function(r,e){if(!this._onMediaSegment)throw new s.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(r,e),this._remuxVideo(e),this._remuxAudio(r)},u.prototype._onTrackMetadataReceived=function(r,e){var i=null,n="mp4",t=e.codec;if(r==="audio")this._audioMeta=e,e.codec==="mp3"&&this._mp3UseMpegAudio?(n="mpeg",t="",i=new Uint8Array):i=c.default.generateInitSegment(e);else if(r==="video")this._videoMeta=e,i=c.default.generateInitSegment(e);else return;if(!this._onInitSegment)throw new s.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(r,{type:r,data:i.buffer,codec:t,container:r+"/"+n,mediaDuration:e.duration})},u.prototype._calculateDtsBase=function(r,e){this._dtsBaseInited||(r.samples&&r.samples.length&&(this._audioDtsBase=r.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},u.prototype.flushStashedSamples=function(){var r=this._videoStashedLastSample,e=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};r!=null&&(i.samples.push(r),i.length=r.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};e!=null&&(n.samples.push(e),n.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(n,!0)},u.prototype._remuxAudio=function(r,e){if(this._audioMeta!=null){var i=r,n=i.samples,t=void 0,o=-1,_=-1,p=this._audioMeta.refSampleDuration,g=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,b=this._dtsBaseInited&&this._audioNextDts===void 0,E=!1;if(!(!n||n.length===0)&&!(n.length===1&&!e)){var v=0,x=null,S=0;g?(v=0,S=i.length):(v=8,S=8+i.length);var O=null;if(n.length>1&&(O=n.pop(),S-=O.length),this._audioStashedLastSample!=null){var R=this._audioStashedLastSample;this._audioStashedLastSample=null,n.unshift(R),S+=R.length}O!=null&&(this._audioStashedLastSample=O);var T=n[0].dts-this._dtsBase;if(this._audioNextDts)t=T-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())t=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(E=!0);else{var B=this._audioSegmentInfoList.getLastSampleBefore(T);if(B!=null){var U=T-(B.originalDts+B.duration);U<=3&&(U=0);var k=B.dts+B.duration+U;t=T-k}else t=0}if(E){var N=T-t,z=this._videoSegmentInfoList.getLastSegmentBefore(T);if(z!=null&&z.beginDts<N){var P=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(P){var W=z.beginDts,ie=N-z.beginDts;y.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+W+", duration: "+ie),n.unshift({unit:P,dts:W,pts:W}),S+=P.byteLength}}else E=!1}for(var K=[],H=0;H<n.length;H++){var R=n[H],ee=R.unit,Q=R.dts-this._dtsBase,W=Q,$=!1,ue=null,Y=0;if(!(Q<-.001)){if(this._audioMeta.codec!=="mp3"){var D=Q,q=3;if(this._audioNextDts&&(D=this._audioNextDts),t=Q-D,t<=-q*p){y.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Q+" ms ,curRefDts: "+D+" ms)  due to dtsCorrection: "+t+" ms overlap.");continue}else if(t>=q*p&&this._fillAudioTimestampGap&&!a.default.safari){$=!0;var se=Math.floor(t/p);y.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+Q+" ms, curRefDts: "+D+" ms, ")+("dtsCorrection: "+Math.round(t)+" ms, generate: "+se+" frames")),W=Math.floor(D),Y=Math.floor(D+p)-W;var P=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);P==null&&(y.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),P=ee),ue=[];for(var he=0;he<se;he++){D=D+p;var le=Math.floor(D),fe=Math.floor(D+p)-le,ce={dts:le,pts:le,cts:0,unit:P,size:P.byteLength,duration:fe,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ue.push(ce),S+=ce.size}this._audioNextDts=D+p}else W=Math.floor(D),Y=Math.floor(D+p)-W,this._audioNextDts=D+p}else{if(W=Q-t,H!==n.length-1){var _e=n[H+1].dts-this._dtsBase-t;Y=_e-W}else if(O!=null){var _e=O.dts-this._dtsBase-t;Y=_e-W}else K.length>=1?Y=K[K.length-1].duration:Y=Math.floor(p);this._audioNextDts=W+Y}o===-1&&(o=W),K.push({dts:W,pts:W,cts:0,unit:R.unit,size:R.unit.byteLength,duration:Y,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),$&&K.push.apply(K,ue)}}if(K.length===0){i.samples=[],i.length=0;return}g?x=new Uint8Array(S):(x=new Uint8Array(S),x[0]=S>>>24&255,x[1]=S>>>16&255,x[2]=S>>>8&255,x[3]=S&255,x.set(c.default.types.mdat,4));for(var H=0;H<K.length;H++){var ee=K[H].unit;x.set(ee,v),v+=ee.byteLength}var ae=K[K.length-1];_=ae.dts+ae.duration;var te=new f.MediaSegmentInfo;te.beginDts=o,te.endDts=_,te.beginPts=o,te.endPts=_,te.originalBeginDts=K[0].originalDts,te.originalEndDts=ae.originalDts+ae.duration,te.firstSample=new f.SampleInfo(K[0].dts,K[0].pts,K[0].duration,K[0].originalDts,!1),te.lastSample=new f.SampleInfo(ae.dts,ae.pts,ae.duration,ae.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(te),i.samples=K,i.sequenceNumber++;var me=null;g?me=new Uint8Array:me=c.default.moof(i,o),i.samples=[],i.length=0;var ve={type:"audio",data:this._mergeBoxes(me,x).buffer,sampleCount:K.length,info:te};g&&b&&(ve.timestampOffset=o),this._onMediaSegment("audio",ve)}}},u.prototype._remuxVideo=function(r,e){if(this._videoMeta!=null){var i=r,n=i.samples,t=void 0,o=-1,_=-1,p=-1,g=-1;if(!(!n||n.length===0)&&!(n.length===1&&!e)){var b=8,E=null,v=8+r.length,x=null;if(n.length>1&&(x=n.pop(),v-=x.length),this._videoStashedLastSample!=null){var S=this._videoStashedLastSample;this._videoStashedLastSample=null,n.unshift(S),v+=S.length}x!=null&&(this._videoStashedLastSample=x);var O=n[0].dts-this._dtsBase;if(this._videoNextDts)t=O-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())t=0;else{var R=this._videoSegmentInfoList.getLastSampleBefore(O);if(R!=null){var T=O-(R.originalDts+R.duration);T<=3&&(T=0);var B=R.dts+R.duration+T;t=O-B}else t=0}for(var U=new f.MediaSegmentInfo,k=[],N=0;N<n.length;N++){var S=n[N],z=S.dts-this._dtsBase,P=S.isKeyframe,W=z-t,ie=S.cts,K=W+ie;o===-1&&(o=W,p=K);var H=0;if(N!==n.length-1){var ee=n[N+1].dts-this._dtsBase-t;H=ee-W}else if(x!=null){var ee=x.dts-this._dtsBase-t;H=ee-W}else k.length>=1?H=k[k.length-1].duration:H=Math.floor(this._videoMeta.refSampleDuration);if(P){var Q=new f.SampleInfo(W,K,H,S.dts,!0);Q.fileposition=S.fileposition,U.appendSyncPoint(Q)}k.push({dts:W,pts:K,cts:ie,units:S.units,size:S.length,isKeyframe:P,duration:H,originalDts:z,flags:{isLeading:0,dependsOn:P?2:1,isDependedOn:P?1:0,hasRedundancy:0,isNonSync:P?0:1}})}E=new Uint8Array(v),E[0]=v>>>24&255,E[1]=v>>>16&255,E[2]=v>>>8&255,E[3]=v&255,E.set(c.default.types.mdat,4);for(var N=0;N<k.length;N++)for(var $=k[N].units;$.length;){var ue=$.shift(),Y=ue.data;E.set(Y,b),b+=Y.byteLength}var D=k[k.length-1];if(_=D.dts+D.duration,g=D.pts+D.duration,this._videoNextDts=_,U.beginDts=o,U.endDts=_,U.beginPts=p,U.endPts=g,U.originalBeginDts=k[0].originalDts,U.originalEndDts=D.originalDts+D.duration,U.firstSample=new f.SampleInfo(k[0].dts,k[0].pts,k[0].duration,k[0].originalDts,k[0].isKeyframe),U.lastSample=new f.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(U),i.samples=k,i.sequenceNumber++,this._forceFirstIDR){var q=k[0].flags;q.dependsOn=2,q.isNonSync=0}var se=c.default.moof(i,o);i.samples=[],i.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(se,E).buffer,sampleCount:k.length,info:U})}}},u.prototype._mergeBoxes=function(r,e){var i=new Uint8Array(r.byteLength+e.byteLength);return i.set(r,0),i.set(e,r.byteLength),i},u}();L.default=l},"./src/utils/browser.js":function(M,L,m){m.r(L);var y={};function c(){var d=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(d)||/(opr)[\/]([\w.]+)/.exec(d)||/(chrome)[ \/]([\w.]+)/.exec(d)||/(iemobile)[\/]([\w.]+)/.exec(d)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||d.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(d)||d.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(d)||[],f=/(ipad)/.exec(d)||/(ipod)/.exec(d)||/(windows phone)/.exec(d)||/(iphone)/.exec(d)||/(kindle)/.exec(d)||/(android)/.exec(d)||/(windows)/.exec(d)||/(mac)/.exec(d)||/(linux)/.exec(d)||/(cros)/.exec(d)||[],s={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:f[0]||""},l={};if(s.browser){l[s.browser]=!0;var u=s.majorVersion.split(".");l.version={major:parseInt(s.majorVersion,10),string:s.version},u.length>1&&(l.version.minor=parseInt(u[1],10)),u.length>2&&(l.version.build=parseInt(u[2],10))}if(s.platform&&(l[s.platform]=!0),(l.chrome||l.opr||l.safari)&&(l.webkit=!0),l.rv||l.iemobile){l.rv&&delete l.rv;var r="msie";s.browser=r,l[r]=!0}if(l.edge){delete l.edge;var e="msedge";s.browser=e,l[e]=!0}if(l.opr){var i="opera";s.browser=i,l[i]=!0}if(l.safari&&l.android){var n="android";s.browser=n,l[n]=!0}l.name=s.browser,l.platform=s.platform;for(var t in y)y.hasOwnProperty(t)&&delete y[t];Object.assign(y,l)}c(),L.default=y},"./src/utils/exception.js":function(M,L,m){m.r(L),m.d(L,{RuntimeException:function(){return c},IllegalStateException:function(){return d},InvalidArgumentException:function(){return a},NotImplementedException:function(){return f}});var y=function(){var s=function(l,u){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])},s(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");s(l,u);function r(){this.constructor=l}l.prototype=u===null?Object.create(u):(r.prototype=u.prototype,new r)}}(),c=function(){function s(l){this._message=l}return Object.defineProperty(s.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),s.prototype.toString=function(){return this.name+": "+this.message},s}(),d=function(s){y(l,s);function l(u){return s.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),l}(c),a=function(s){y(l,s);function l(u){return s.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),l}(c),f=function(s){y(l,s);function l(u){return s.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),l}(c)},"./src/utils/logger.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=function(){function a(){}return a.e=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var l="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",l),a.ENABLE_ERROR&&(console.error?console.error(l):console.warn?console.warn(l):console.log(l))},a.i=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var l="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",l),a.ENABLE_INFO&&(console.info?console.info(l):console.log(l))},a.w=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var l="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",l),a.ENABLE_WARN&&(console.warn?console.warn(l):console.log(l))},a.d=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var l="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",l),a.ENABLE_DEBUG&&(console.debug?console.debug(l):console.log(l))},a.v=function(f,s){(!f||a.FORCE_GLOBAL_TAG)&&(f=a.GLOBAL_TAG);var l="["+f+"] > "+s;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",l),a.ENABLE_VERBOSE&&console.log(l)},a}();d.GLOBAL_TAG="flv.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new(c()),L.default=d},"./src/utils/logging-control.js":function(M,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),a=function(){function f(){}return Object.defineProperty(f,"forceGlobalTag",{get:function(){return d.default.FORCE_GLOBAL_TAG},set:function(s){d.default.FORCE_GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"globalTag",{get:function(){return d.default.GLOBAL_TAG},set:function(s){d.default.GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableAll",{get:function(){return d.default.ENABLE_VERBOSE&&d.default.ENABLE_DEBUG&&d.default.ENABLE_INFO&&d.default.ENABLE_WARN&&d.default.ENABLE_ERROR},set:function(s){d.default.ENABLE_VERBOSE=s,d.default.ENABLE_DEBUG=s,d.default.ENABLE_INFO=s,d.default.ENABLE_WARN=s,d.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableDebug",{get:function(){return d.default.ENABLE_DEBUG},set:function(s){d.default.ENABLE_DEBUG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableVerbose",{get:function(){return d.default.ENABLE_VERBOSE},set:function(s){d.default.ENABLE_VERBOSE=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableInfo",{get:function(){return d.default.ENABLE_INFO},set:function(s){d.default.ENABLE_INFO=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableWarn",{get:function(){return d.default.ENABLE_WARN},set:function(s){d.default.ENABLE_WARN=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableError",{get:function(){return d.default.ENABLE_ERROR},set:function(s){d.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),f.getConfig=function(){return{globalTag:d.default.GLOBAL_TAG,forceGlobalTag:d.default.FORCE_GLOBAL_TAG,enableVerbose:d.default.ENABLE_VERBOSE,enableDebug:d.default.ENABLE_DEBUG,enableInfo:d.default.ENABLE_INFO,enableWarn:d.default.ENABLE_WARN,enableError:d.default.ENABLE_ERROR,enableCallback:d.default.ENABLE_CALLBACK}},f.applyConfig=function(s){d.default.GLOBAL_TAG=s.globalTag,d.default.FORCE_GLOBAL_TAG=s.forceGlobalTag,d.default.ENABLE_VERBOSE=s.enableVerbose,d.default.ENABLE_DEBUG=s.enableDebug,d.default.ENABLE_INFO=s.enableInfo,d.default.ENABLE_WARN=s.enableWarn,d.default.ENABLE_ERROR=s.enableError,d.default.ENABLE_CALLBACK=s.enableCallback},f._notifyChange=function(){var s=f.emitter;if(s.listenerCount("change")>0){var l=f.getConfig();s.emit("change",l)}},f.registerListener=function(s){f.emitter.addListener("change",s)},f.removeListener=function(s){f.emitter.removeListener("change",s)},f.addLogListener=function(s){d.default.emitter.addListener("log",s),d.default.emitter.listenerCount("log")>0&&(d.default.ENABLE_CALLBACK=!0,f._notifyChange())},f.removeLogListener=function(s){d.default.emitter.removeListener("log",s),d.default.emitter.listenerCount("log")===0&&(d.default.ENABLE_CALLBACK=!1,f._notifyChange())},f}();a.emitter=new(c()),L.default=a},"./src/utils/polyfill.js":function(M,L,m){m.r(L);var y=function(){function c(){}return c.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,a){return d.__proto__=a,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(d),f=1;f<arguments.length;f++){var s=arguments[f];if(s!=null)for(var l in s)s.hasOwnProperty(l)&&(a[l]=s[l])}return a},typeof self.Promise!="function"&&m("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},c}();y.install(),L.default=y},"./src/utils/utf8-conv.js":function(M,L,m){m.r(L);function y(d,a,f){var s=d;if(a+f<s.length){for(;f--;)if((s[++a]&192)!==128)return!1;return!0}else return!1}function c(d){for(var a=[],f=d,s=0,l=d.length;s<l;){if(f[s]<128){a.push(String.fromCharCode(f[s])),++s;continue}else if(!(f[s]<192)){if(f[s]<224){if(y(f,s,1)){var u=(f[s]&31)<<6|f[s+1]&63;if(u>=128){a.push(String.fromCharCode(u&65535)),s+=2;continue}}}else if(f[s]<240){if(y(f,s,2)){var u=(f[s]&15)<<12|(f[s+1]&63)<<6|f[s+2]&63;if(u>=2048&&(u&63488)!==55296){a.push(String.fromCharCode(u&65535)),s+=3;continue}}}else if(f[s]<248&&y(f,s,3)){var u=(f[s]&7)<<18|(f[s+1]&63)<<12|(f[s+2]&63)<<6|f[s+3]&63;if(u>65536&&u<1114112){u-=65536,a.push(String.fromCharCode(u>>>10|55296)),a.push(String.fromCharCode(u&1023|56320)),s+=4;continue}}}a.push(String.fromCharCode(65533)),++s}return a.join("")}L.default=c}},G={};function V(M){var L=G[M];if(L!==void 0)return L.exports;var m=G[M]={exports:{}};return X[M].call(m.exports,m,m.exports,V),m.exports}V.m=X,function(){V.n=function(M){var L=M&&M.__esModule?function(){return M.default}:function(){return M};return V.d(L,{a:L}),L}}(),function(){V.d=function(M,L){for(var m in L)V.o(L,m)&&!V.o(M,m)&&Object.defineProperty(M,m,{enumerable:!0,get:L[m]})}}(),function(){V.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){V.o=function(M,L){return Object.prototype.hasOwnProperty.call(M,L)}}(),function(){V.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})}}();var h=V("./src/index.js");return h}()})})(we);const it=De(we.exports),st=ze("<span></span>"),mt=()=>{var f,s,l;const{pathname:re,searchParams:ne}=Pe(),{proxyLink:X}=ke(),G=Fe();let V=de.objs.filter(u=>u.type===He.VIDEO);V.length===0&&(V=[de.obj]);const h=()=>{const u=V.findIndex(r=>r.name===de.obj.name);u<V.length-1&&G(Ae(Re(location.pathname),V[u+1].name)+"?auto_fullscreen="+L.fullscreen)},M=()=>{const u=V.findIndex(r=>r.name===de.obj.name);u>0&&G(Ae(Re(location.pathname),V[u-1].name)+"?auto_fullscreen="+L.fullscreen)};let L,m={id:re(),container:"#video-player",url:de.raw_url,title:de.obj.name,volume:.5,autoplay:Be("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,controls:[{name:"previous-button",index:10,position:"left",html:'<svg fill="none" stroke-width="2" xmlns="http://www.w3.org/2000/svg" height="22" width="22" class="icon icon-tabler icon-tabler-player-track-prev-filled" width="1em" height="1em" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" style="overflow: visible; color: currentcolor;"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20.341 4.247l-8 7a1 1 0 0 0 0 1.506l8 7c.647 .565 1.659 .106 1.659 -.753v-14c0 -.86 -1.012 -1.318 -1.659 -.753z" stroke-width="0" fill="currentColor"></path><path d="M9.341 4.247l-8 7a1 1 0 0 0 0 1.506l8 7c.647 .565 1.659 .106 1.659 -.753v-14c0 -.86 -1.012 -1.318 -1.659 -.753z" stroke-width="0" fill="currentColor"></path></svg>',tooltip:"Previous",click:function(){M()}},{name:"next-button",index:11,position:"left",html:'<svg fill="none" stroke-width="2" xmlns="http://www.w3.org/2000/svg" height="22" width="22" class="icon icon-tabler icon-tabler-player-track-next-filled" width="1em" height="1em" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" style="overflow: visible; color: currentcolor;"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M2 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path><path d="M13 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path></svg>',tooltip:"Next",click:function(){h()}}],quality:[],plugins:[],whitelist:[],settings:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:xe(de.obj.name),customType:{flv:function(u,r){const e=it.createPlayer({type:"flv",url:r},{referrerPolicy:"same-origin"});e.attachMediaElement(u),e.load()},m3u8:function(u,r){const e=new Qe;e.loadSource(r),e.attachMedia(u),u.src||(u.src=r)}},lang:["en","zh-cn","zh-tw"].includes(Le().toLowerCase())?Le().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const y=de.related.filter(u=>{for(const r of[".srt",".ass",".vtt"])if(u.name.endsWith(r))return!0;return!1}),c=de.related.find(u=>{for(const r of[".xml"])if(u.name.endsWith(r))return!0;return!1});if(y.length!=0){let i=function(n){switch(u?"ass":"webvtt"){case"ass":L.subtitle.show=!1,L.emit("artplayer-plugin-ass:visible",n);break;case"webvtt":default:L.subtitle.show=n,L.emit("artplayer-plugin-ass:visible",!1);break}},u=!1;const r=y[0];xe(r.name).toLowerCase()==="ass"?(u=!0,(f=m.plugins)==null||f.push(nt({subUrl:X(r,!0)}))):m.subtitle={url:X(r,!0),type:xe(r.name)};const e=[{id:"setting_subtitle_display",html:"Display",tooltip:"Show",switch:!0,onSwitch:function(n){var o;n.tooltip=n.switch?"Hide":"Show",i(!n.switch);const t=(o=m.settings)==null?void 0:o.find(_=>_.id==="setting_subtitle");return t&&(t.tooltip=n.tooltip),!n.switch}}];y.forEach((n,t)=>{e.push({default:t===0,html:(()=>{const o=st.cloneNode(!0);return o.style.setProperty("display","inline-block"),o.style.setProperty("max-width","15em"),o.style.setProperty("text-overflow","ellipsis"),o.style.setProperty("overflow","hidden"),Ue(o,()=>n.name),je(()=>Ne(o,"title",n.name)),o})(),name:n.name,url:X(n,!0)})}),(s=m.settings)==null||s.push({id:"setting_subtitle",html:"Subtitle",tooltip:"Show",icon:Ye({size:24}),selector:e,onSelect:function(n){var o,_;xe(n.name).toLowerCase()==="ass"?(u=!0,this.emit("artplayer-plugin-ass:switch",n.url),i(!0)):(u=!1,this.subtitle.switch(n.url,{name:n.name}),this.once("subtitleLoad",i.bind(this,!0)));const t=e.find(p=>p.id==="setting_subtitle_display");return t&&!t.switch&&((_=(o=t.$html)==null?void 0:o.click)==null||_.call(o)),t==null?void 0:t.tooltip}})}c&&((l=m.plugins)==null||l.push(Ze({danmuku:X(c,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"}))),We(()=>{L=new Xe(m);let u;switch(ne.auto_fullscreen){case"true":u=!0;case"false":u=!1;default:u=!1}console.log(u),L.on("ready",()=>{L.fullscreen=u}),L.on("video:ended",()=>{!d()||h()})}),Ge(()=>{L==null||L.destroy()});const[d,a]=Ke();return Se(Je,{onAutoNextChange:a,get children(){return Se(Ve,{w:"$full",h:"60vh",id:"video-player"})}})};export{mt as default};
