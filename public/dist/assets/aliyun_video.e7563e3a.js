import{b as w,W as x,Q as n,aw as v,cR as f,ca as k,aR as _,b3 as F,_ as W,aA as j,b4 as A,n as L,o as O,d as R,h as m,Y as S}from"./index.72a87752.js";import{O as C}from"./icon.7ff2e255.js";import{A as P,V as z}from"./video_box.a2678b75.js";import{H as B,a as I}from"./hls.6a6fb68a.js";import"./index.0fc4a4c5.js";import"./index.a7dafa97.js";import"./Layout.54ff7759.js";import"./index.fe4a6ea7.js";import"./FolderTree.6dc1a0ba.js";const $=()=>{const{replace:h,pathname:d}=w(),{proxyLink:u}=x();let s=n.objs.filter(e=>e.type===C.VIDEO);s.length===0&&(s=[n.obj]);let o,i={id:d(),container:"#video-player",title:n.obj.name,volume:.5,autoplay:v("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:"m3u8",customType:{m3u8:function(e,t){const a=new B;a.loadSource(t),a.attachMedia(e),e.src||(e.src=t)}},lang:["en","zh-cn","zh-tw"].includes(f().toLowerCase())?f().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const l=n.related.find(e=>{for(const t of[".srt",".ass",".vtt"])if(e.name.endsWith(t))return!0;return!1}),c=n.related.find(e=>{for(const t of[".xml"])if(e.name.endsWith(t))return!0;return!1});l&&(i.subtitle={url:u(l,!0),type:k(l.name)}),c&&(i.plugins=[I({danmuku:u(c,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"})]);const[N,y]=_(()=>F.post("/fs/other",{path:d(),password:W(),method:"video_preview"}));j(async()=>{const e=await y();A(e,t=>{const a=t.video_preview_play_info.live_transcoding_task_list.filter(r=>r.url);if(a.length===0){L.error("No transcoding video found");return}i.url=a[a.length-1].url,i.quality=a.map((r,p)=>({html:r.template_id,url:r.url,default:p===a.length-1})),o=new P(i),o.on("video:ended",()=>{if(!g())return;const r=s.findIndex(p=>p.name===n.obj.name);r<s.length-1&&h(s[r+1].name)}),l&&o.on("video:play",r=>{o.subtitle.url=u(l,!0)})})}),O(()=>{o==null||o.destroy()});const[g,b]=R();return m(z,{onAutoNextChange:b,get children(){return m(S,{w:"$full",h:"60vh",id:"video-player"})}})};export{$ as default};
