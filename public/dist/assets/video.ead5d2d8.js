import{cn as Fe,co as Pe,u as at,o as Se,as as st,bH as Ve,cp as $e,j as ot,au as lt,f as Oe,a5 as ut,bs as ft,bg as dt,E as ct,aa as ht,bE as pt,ab as vt,a3 as mt}from"./index.5b70725d.js";import{a as gt}from"./useUtil.35aaa6cd.js";import{O as yt}from"./obj.fca5b341.js";import"./api.d7bd7cce.js";import"./useT.75b175bf.js";function we(Ee){throw new Error('Could not dynamically require "'+Ee+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ze={exports:{}};/*!
 * artplayer.js v4.5.6
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(Ee,Re){(function(M,P,y,T,p){var m=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Pe<"u"?Pe:{},D=typeof m.parcelRequireb749=="function"&&m.parcelRequireb749,_=D.cache||{},g=typeof we=="function"&&we.bind(Ee);function o(n,d){if(!_[n]){if(!M[n]){var u=typeof m.parcelRequireb749=="function"&&m.parcelRequireb749;if(!d&&u)return u(n,!0);if(D)return D(n,!0);if(g&&typeof n=="string")return g(n);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}e.resolve=function(s){var i=M[n][1][s];return i!=null?i:s},e.cache={};var t=_[n]=new o.Module(n);M[n][0].call(t.exports,e,t,t.exports,this)}return _[n].exports;function e(s){var i=e.resolve(s);return i===!1?{}:o(i)}}o.isParcelRequire=!0,o.Module=function(n){this.id=n,this.bundle=o,this.exports={}},o.modules=M,o.cache=_,o.parent=D,o.register=function(n,d){M[n]=[function(u,h){h.exports=d},{}]},Object.defineProperty(o,"root",{get:function(){return m.parcelRequireb749}}),m.parcelRequireb749=o;for(var r=0;r<P.length;r++)o(P[r]);var l=o(y);Ee.exports=l})({E13ST:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("bundle-text:./style/index.less"),m=T.interopDefault(p),D=M("option-validator"),_=T.interopDefault(D),g=M("./utils/emitter"),o=T.interopDefault(g),r=M("./utils"),l=M("./scheme"),n=T.interopDefault(l),d=M("./config"),u=T.interopDefault(d),h=M("./whitelist"),t=T.interopDefault(h),e=M("./template"),s=T.interopDefault(e),i=M("./i18n"),f=T.interopDefault(i),c=M("./player"),a=T.interopDefault(c),v=M("./control"),S=T.interopDefault(v),x=M("./contextmenu"),E=T.interopDefault(x),L=M("./info"),b=T.interopDefault(L),A=M("./subtitle"),O=T.interopDefault(A),R=M("./events"),I=T.interopDefault(R),C=M("./hotkey"),F=T.interopDefault(C),w=M("./layer"),k=T.interopDefault(w),B=M("./loading"),U=T.interopDefault(B),N=M("./notice"),j=T.interopDefault(N),K=M("./mask"),V=T.interopDefault(K),H=M("./icons"),Y=T.interopDefault(H),q=M("./setting"),$=T.interopDefault(q),G=M("./storage"),re=T.interopDefault(G),Q=M("./plugins"),ee=T.interopDefault(Q),se=M("./mobile"),ae=T.interopDefault(se);let oe=0;const fe=[];class te extends o.default{constructor(de,ce){super(),this.id=++oe;const he=r.mergeDeep(te.option,de);this.option=(0,_.default)(he,n.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isDestroy=!1,this.whitelist=new t.default(this),this.template=new s.default(this),this.events=new I.default(this),this.whitelist.state?(this.storage=new re.default(this),this.icons=new Y.default(this),this.i18n=new f.default(this),this.notice=new j.default(this),this.player=new a.default(this),this.layers=new k.default(this),this.controls=new S.default(this),this.contextmenu=new E.default(this),this.subtitle=new O.default(this),this.info=new b.default(this),this.loading=new U.default(this),this.hotkey=new F.default(this),this.mask=new V.default(this),this.setting=new $.default(this),this.plugins=new ee.default(this)):this.mobile=new ae.default(this),typeof ce=="function"&&this.on("ready",()=>ce.call(this)),fe.push(this)}static get instances(){return fe}static get version(){return"4.5.6"}static get env(){return"production"}static get build(){return"1663600884176"}static get config(){return u.default}static get utils(){return r}static get scheme(){return n.default}static get Emitter(){return o.default}static get validator(){return _.default}static get kindOf(){return _.default.kindOf}static get html(){return s.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:r.isSafari?"auto":"metadata"},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}destroy(de=!0){this.events.destroy(),this.template.destroy(de),fe.splice(fe.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(y.default=te,te.NOTICE_TIME=2e3,te.SETTING_WIDTH=250,te.SETTING_ITEM_WIDTH=200,te.SETTING_ITEM_HEIGHT=35,te.INDICATOR_SIZE=14,te.INDICATOR_SIZE_ICON=16,te.INDICATOR_SIZE_MOBILE=18,te.INDICATOR_SIZE_MOBILE_ICON=20,te.VOLUME_PANEL_WIDTH=60,te.VOLUME_HANDLE_WIDTH=12,te.RESIZE_TIME=500,te.SCROLL_TIME=200,te.SCROLL_GAP=50,te.AUTO_PLAYBACK_MAX=10,te.AUTO_PLAYBACK_MIN=5,te.AUTO_PLAYBACK_TIMEOUT=3e3,te.RECONNECT_TIME_MAX=5,te.RECONNECT_SLEEP_TIME=1e3,te.CONTROL_HIDE_TIME=3e3,te.DB_CLICE_TIME=300,te.MOBILE_AUTO_PLAYBACKRATE=3,te.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,te.MOBILE_AUTO_ORIENTATION_TIME=200,te.INFO_LOOP_TIME=1e3,te.FAST_FORWARD_VALUE=3,te.FAST_FORWARD_TIME=1e3,te.TOUCH_MOVE_RATIO=.5,typeof document<"u"&&!document.getElementById("artplayer-style")){const le=r.createElement("style");le.id="artplayer-style",le.textContent=m.default,document.head.appendChild(le)}typeof window<"u"&&(window.Artplayer=te),console.log(`%c ArtPlayer %c ${te.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"6U764","option-validator":"eaJBf","./utils/emitter":"1SgiG","./utils":"5yYFo","./scheme":"3izFE","./config":"ej4fZ","./whitelist":"7CkCt","./template":"8iGAh","./i18n":"3mM4M","./player":"bCaa0","./control":"3qXcr","./contextmenu":"hTnNz","./info":"bfwuE","./subtitle":"bWZ2U","./events":"9oLaG","./hotkey":"cKO4X","./layer":"kZD92","./loading":"c9b9e","./notice":"SxQeL","./mask":"aJ0dF","./icons":"jx1Wu","./setting":"hdF39","./storage":"bCcu0","./plugins":"1v13t","./mobile":"eD5Ch","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"6U764":[function(M,P,y){P.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:all;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#fff;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;display:none;position:absolute;bottom:8px;left:0}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.9;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;display:flex}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-onlyText{padding:0 10px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner{height:100%}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:#00c9ff}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:50px;right:10px;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover,.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:#00c9ff}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:#00c9ff;cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:#00c9ff}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],eaJBf:[function(M,P,y){P.exports=function(){function T(r){return(T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l})(r)}var p=Object.prototype.toString,m=function(r){if(r===void 0)return"undefined";if(r===null)return"null";var l=T(r);if(l==="boolean")return"boolean";if(l==="string")return"string";if(l==="number")return"number";if(l==="symbol")return"symbol";if(l==="function")return function(n){return D(n)==="GeneratorFunction"}(r)?"generatorfunction":"function";if(function(n){return Array.isArray?Array.isArray(n):n instanceof Array}(r))return"array";if(function(n){return!(!n.constructor||typeof n.constructor.isBuffer!="function")&&n.constructor.isBuffer(n)}(r))return"buffer";if(function(n){try{if(typeof n.length=="number"&&typeof n.callee=="function")return!0}catch(d){if(d.message.indexOf("callee")!==-1)return!0}return!1}(r))return"arguments";if(function(n){return n instanceof Date||typeof n.toDateString=="function"&&typeof n.getDate=="function"&&typeof n.setDate=="function"}(r))return"date";if(function(n){return n instanceof Error||typeof n.message=="string"&&n.constructor&&typeof n.constructor.stackTraceLimit=="number"}(r))return"error";if(function(n){return n instanceof RegExp||typeof n.flags=="string"&&typeof n.ignoreCase=="boolean"&&typeof n.multiline=="boolean"&&typeof n.global=="boolean"}(r))return"regexp";switch(D(r)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(n){return typeof n.throw=="function"&&typeof n.return=="function"&&typeof n.next=="function"}(r))return"generator";switch(l=p.call(r)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return l.slice(8,-1).toLowerCase().replace(/\s/g,"")};function D(r){return r.constructor?r.constructor.name:null}function _(r,l){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return g(r,l,n),o(r,l,n),function(d,u,h){var t=m(u),e=m(d);if(t==="object"){if(e!=="object")throw new Error("[Type Error]: '".concat(h.join("."),"' require 'object' type, but got '").concat(e,"'"));Object.keys(u).forEach(function(s){var i=d[s],f=u[s],c=h.slice();c.push(s),g(i,f,c),o(i,f,c),_(i,f,c)})}if(t==="array"){if(e!=="array")throw new Error("[Type Error]: '".concat(h.join("."),"' require 'array' type, but got '").concat(e,"'"));d.forEach(function(s,i){var f=d[i],c=u[i]||u[0],a=h.slice();a.push(i),g(f,c,a),o(f,c,a),_(f,c,a)})}}(r,l,n),r}function g(r,l,n){if(m(l)==="string"){var d=m(r);if(l[0]==="?"&&(l=l.slice(1)+"|undefined"),!(-1<l.indexOf("|")?l.split("|").map(function(u){return u.toLowerCase().trim()}).filter(Boolean).some(function(u){return d===u}):l.toLowerCase().trim()===d))throw new Error("[Type Error]: '".concat(n.join("."),"' require '").concat(l,"' type, but got '").concat(d,"'"))}}function o(r,l,n){if(m(l)==="function"){var d=l(r,m(r),n);if(d!==!0){var u=m(d);throw u==="string"?new Error(d):u==="error"?d:new Error("[Validator Error]: The scheme for '".concat(n.join("."),"' validator require return true, but got '").concat(d,"'"))}}}return _.kindOf=m,_}()},{}],"1SgiG":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=class{on(T,p,m){const D=this.e||(this.e={});return(D[T]||(D[T]=[])).push({fn:p,ctx:m}),this}once(T,p,m){const D=this;function _(...g){D.off(T,_),p.apply(m,g)}return _._=p,this.on(T,_,m)}emit(T,...p){const m=((this.e||(this.e={}))[T]||[]).slice();for(let D=0;D<m.length;D+=1)m[D].fn.apply(m[D].ctx,p);return this}off(T,p){const m=this.e||(this.e={}),D=m[T],_=[];if(D&&p)for(let g=0,o=D.length;g<o;g+=1)D[g].fn!==p&&D[g].fn._!==p&&_.push(D[g]);return _.length?m[T]=_:delete m[T],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b7MJY:[function(M,P,y){y.interopDefault=function(T){return T&&T.__esModule?T:{default:T}},y.defineInteropFlag=function(T){Object.defineProperty(T,"__esModule",{value:!0})},y.exportAll=function(T,p){return Object.keys(T).forEach(function(m){m==="default"||m==="__esModule"||p.hasOwnProperty(m)||Object.defineProperty(p,m,{enumerable:!0,get:function(){return T[m]}})}),p},y.export=function(T,p,m){Object.defineProperty(T,p,{enumerable:!0,get:m})}},{}],"5yYFo":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./dom");T.exportAll(p,y);var m=M("./error");T.exportAll(m,y);var D=M("./subtitle");T.exportAll(D,y);var _=M("./file");T.exportAll(_,y);var g=M("./property");T.exportAll(g,y);var o=M("./time");T.exportAll(o,y);var r=M("./format");T.exportAll(r,y);var l=M("./compatibility");T.exportAll(l,y)},{"./dom":"fqaW9","./error":"kNZvP","./subtitle":"eZUgm","./file":"dYeSt","./property":"5ynPA","./time":"kXYeR","./format":"anS7L","./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fqaW9:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"query",()=>m),T.export(y,"queryAll",()=>D),T.export(y,"addClass",()=>_),T.export(y,"removeClass",()=>g),T.export(y,"hasClass",()=>o),T.export(y,"append",()=>r),T.export(y,"remove",()=>l),T.export(y,"setStyle",()=>n),T.export(y,"setStyles",()=>d),T.export(y,"getStyle",()=>u),T.export(y,"sublings",()=>h),T.export(y,"inverseClass",()=>t),T.export(y,"tooltip",()=>e),T.export(y,"isInViewport",()=>s),T.export(y,"includeFromEvent",()=>i),T.export(y,"replaceElement",()=>f),T.export(y,"createElement",()=>c);var p=M("./compatibility");function m(a,v=document){return v.querySelector(a)}function D(a,v=document){return Array.from(v.querySelectorAll(a))}function _(a,v){return a.classList.add(v)}function g(a,v){return a.classList.remove(v)}function o(a,v){return a.classList.contains(v)}function r(a,v){return v instanceof Element?a.appendChild(v):a.insertAdjacentHTML("beforeend",String(v)),a.lastElementChild||a.lastChild}function l(a){return a.parentNode.removeChild(a)}function n(a,v,S){return a.style[v]=S,a}function d(a,v){return Object.keys(v).forEach(S=>{n(a,S,v[S])}),a}function u(a,v,S=!0){const x=window.getComputedStyle(a,null).getPropertyValue(v);return S?parseFloat(x):x}function h(a){return Array.from(a.parentElement.children).filter(v=>v!==a)}function t(a,v){h(a).forEach(S=>g(S,v)),_(a,v)}function e(a,v,S="top"){p.isMobile||(a.setAttribute("aria-label",v),_(a,"hint--rounded"),_(a,`hint--${S}`))}function s(a,v=0){const S=a.getBoundingClientRect(),x=window.innerHeight||document.documentElement.clientHeight,E=window.innerWidth||document.documentElement.clientWidth,L=S.top-v<=x&&S.top+S.height+v>=0,b=S.left-v<=E+v&&S.left+S.width+v>=0;return L&&b}function i(a,v){return a.composedPath&&a.composedPath().indexOf(v)>-1}function f(a,v){return v.parentNode.replaceChild(a,v),a}function c(a){return document.createElement(a)}},{"./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],e9wVp:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"userAgent",()=>p),T.export(y,"isMobile",()=>m),T.export(y,"isSafari",()=>D),T.export(y,"isWechat",()=>_),T.export(y,"isIE",()=>g),T.export(y,"isAndroid",()=>o),T.export(y,"isIOS",()=>r);const p=typeof window<"u"?window.navigator.userAgent:"",m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(p),D=/^((?!chrome|android).)*safari/i.test(p),_=/MicroMessenger/i.test(p),g=/MSIE|Trident/i.test(p),o=/android/i.test(p),r=/iPad|iPhone|iPod/i.test(p)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNZvP:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"ArtPlayerError",()=>p),T.export(y,"errorHandle",()=>m);class p extends Error{constructor(_,g){super(_),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,g||this.constructor),this.name="ArtPlayerError"}}function m(D,_){if(!D)throw new p(_);return D}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eZUgm:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");function p(_){return`WEBVTT \r
\r
`.concat((g=_,g.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(o,r,l)=>{let n=l.slice(0,3);return l.length===1&&(n=l+"00"),l.length===2&&(n=l+"0"),`${r},${n}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var g}function m(_){return URL.createObjectURL(new Blob([_],{type:"text/vtt"}))}function D(_){const g=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function o(r=""){return r.split(/[:.]/).map((l,n,d)=>{if(n===d.length-1){if(l.length===1)return`.${l}00`;if(l.length===2)return`.${l}0`}else if(l.length===1)return(n===0?"0":":0")+l;return n===0?l:n===d.length-1?`.${l}`:`:${l}`}).join("")}return`WEBVTT

${_.split(/\r?\n/).map(r=>{const l=r.match(g);return l?{start:o(l[1].trim()),end:o(l[2].trim()),text:l[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(n=>n.trim()).join(`
`)}:null}).filter(r=>r).map((r,l)=>r?`${l+1}
${r.start} --> ${r.end}
${r.text}`:"").filter(r=>r.trim()).join(`

`)}`}T.defineInteropFlag(y),T.export(y,"srtToVtt",()=>p),T.export(y,"vttToBlob",()=>m),T.export(y,"assToVtt",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dYeSt:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");function p(D){return D.includes("?")?p(D.split("?")[0]):D.includes("#")?p(D.split("#")[0]):D.trim().toLowerCase().split(".").pop()}function m(D,_){const g=document.createElement("a");g.style.display="none",g.href=D,g.download=_,document.body.appendChild(g),g.click(),document.body.removeChild(g)}T.defineInteropFlag(y),T.export(y,"getExt",()=>p),T.export(y,"download",()=>m)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5ynPA":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"def",()=>p),T.export(y,"has",()=>D),T.export(y,"get",()=>_),T.export(y,"mergeDeep",()=>g);const p=Object.defineProperty,{hasOwnProperty:m}=Object.prototype;function D(o,r){return m.call(o,r)}function _(o,r){return Object.getOwnPropertyDescriptor(o,r)}function g(...o){const r=l=>l&&typeof l=="object"&&!Array.isArray(l);return o.reduce((l,n)=>(Object.keys(n).forEach(d=>{const u=l[d],h=n[d];Array.isArray(u)&&Array.isArray(h)?l[d]=u.concat(...h):!r(u)||!r(h)||h instanceof Element?l[d]=h:l[d]=g(u,h)}),l),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXYeR:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");function p(_=0){return new Promise(g=>setTimeout(g,_))}function m(_,g,o){let r;function l(...n){clearTimeout(r),r=setTimeout(function(){r=null,_.apply(o,n)},g)}return l.clearTimeout=function(){clearTimeout(r)},l}function D(_,g){let o,r,l=!1;return function n(...d){if(l)return o=d,void(r=this);l=!0,_.apply(this,d),setTimeout(()=>{l=!1,o&&(n.apply(r,o),o=null,r=null)},g)}}T.defineInteropFlag(y),T.export(y,"sleep",()=>p),T.export(y,"debounce",()=>m),T.export(y,"throttle",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],anS7L:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");function p(_,g,o){return Math.max(Math.min(_,Math.max(g,o)),Math.min(g,o))}function m(_){const g=Math.floor(_/3600),o=Math.floor((_-3600*g)/60),r=Math.floor(_-3600*g-60*o);return(g>0?[g,o,r]:[o,r]).map(l=>l<10?`0${l}`:String(l)).join(":")}function D(_){return _.replace(/[&<>'"]/g,g=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[g]||g)}T.defineInteropFlag(y),T.export(y,"clamp",()=>p),T.export(y,"secondToTime",()=>m),T.export(y,"escape",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3izFE":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"ComponentOption",()=>n);var p=M("../utils");const m="array",D="boolean",_="string",g="number",o="object",r="function";function l(d,u,h){return(0,p.errorHandle)(u===_||u===g||d instanceof Element,`${h.join(".")} require '${_}' or 'Element' type`)}const n={html:l,disable:`?${D}`,name:`?${_}`,index:`?${g}`,style:`?${o}`,click:`?${r}`,mounted:`?${r}`,tooltip:`?${_}|${g}`,width:`?${g}`,selector:`?${m}`,onSelect:`?${r}`,switch:`?${D}`,onSwitch:`?${r}`,range:`?${m}`,onRange:`?${r}`};y.default={id:_,container:l,url:_,poster:_,title:_,type:_,theme:_,lang:_,volume:g,isLive:D,muted:D,autoplay:D,autoSize:D,autoMini:D,loop:D,flip:D,playbackRate:D,aspectRatio:D,screenshot:D,setting:D,hotkey:D,pip:D,mutex:D,backdrop:D,fullscreen:D,fullscreenWeb:D,subtitleOffset:D,miniProgressBar:D,useSSR:D,playsInline:D,lock:D,fastForward:D,autoPlayback:D,autoOrientation:D,airplay:D,plugins:[r],whitelist:[`${_}|${r}|regexp`],layers:[n],contextmenu:[n],settings:[n],controls:[{...n,position:(d,u,h)=>{const t=["top","left","right"];return(0,p.errorHandle)(t.includes(d),`${h.join(".")} only accept ${t.toString()} as parameters`)}}],quality:[{default:`?${D}`,html:_,url:_}],highlight:[{time:g,text:_}],thumbnails:{url:_,number:g,column:g,width:g,height:g},subtitle:{url:_,type:_,style:o,encoding:_},moreVideoAttr:o,icons:o,customType:o}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ej4fZ:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7CkCt":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("./utils");y.default=class{constructor(p){this.art=p}get state(){const{option:p,constructor:{kindOf:m}}=this.art;return!T.isMobile||p.whitelist.some(D=>{switch(m(D)){case"string":return D==="*"||T.userAgent.indexOf(D)>-1;case"function":return D(T.userAgent);case"regexp":return D.test(T.userAgent);default:return!1}})}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8iGAh":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("./utils");class p{constructor(D){this.art=D;const{option:_,constructor:g,whitelist:o}=D;_.container instanceof Element?this.$container=_.container:(this.$container=(0,T.query)(_.container),(0,T.errorHandle)(this.$container,`No container element found by ${_.container}`));const r=this.$container.tagName.toLowerCase();(0,T.errorHandle)(r==="div",`Unsupported container element type, only support 'div' but got '${r}'`),(0,T.errorHandle)(g.instances.every(l=>l.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=D.id,this.$original=this.$container.cloneNode(!0),o.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.5.6</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(D){return(0,T.query)(D,this.$container)}desktop(){const{option:D}=this.art;D.useSSR||(this.$container.innerHTML=p.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),D.backdrop&&((0,T.addClass)(this.$setting,"art-backdrop-filter"),(0,T.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,T.addClass)(this.$info,"art-backdrop-filter")),T.isMobile&&(0,T.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(D){D?(0,T.replaceElement)(this.$original,this.$container):(0,T.addClass)(this.$player,"art-destroy")}}y.default=p},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3mM4M":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils"),m=M("./zh-cn.json"),D=T.interopDefault(m),_=M("./zh-tw.json"),g=T.interopDefault(_),o=M("./pl.json"),r=T.interopDefault(o),l=M("./cs.json"),n=T.interopDefault(l),d=M("./es.json"),u=T.interopDefault(d);y.default=class{constructor(h){this.art=h,this.languages={"zh-cn":D.default,"zh-tw":g.default,pl:r.default,cs:n.default,es:u.default},this.init()}init(){const h=this.art.option.lang.toLowerCase();this.language=this.languages[h]||{}}get(h){return this.language[h]||h}update(h){this.languages=(0,p.mergeDeep)(this.languages,h),this.init()}}},{"../utils":"5yYFo","./zh-cn.json":"1f1tr","./zh-tw.json":"3hy9S","./pl.json":"aFOXc","./cs.json":"aNfUP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY","./es.json":"aKEKs"}],"1f1tr":[function(M,P,y){P.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],"3hy9S":[function(M,P,y){P.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],aFOXc:[function(M,P,y){P.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],aNfUP:[function(M,P,y){P.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],aKEKs:[function(M,P,y){P.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],bCaa0:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./urlMix"),m=T.interopDefault(p),D=M("./attrMix"),_=T.interopDefault(D),g=M("./playMix"),o=T.interopDefault(g),r=M("./pauseMix"),l=T.interopDefault(r),n=M("./toggleMix"),d=T.interopDefault(n),u=M("./seekMix"),h=T.interopDefault(u),t=M("./volumeMix"),e=T.interopDefault(t),s=M("./currentTimeMix"),i=T.interopDefault(s),f=M("./durationMix"),c=T.interopDefault(f),a=M("./switchMix"),v=T.interopDefault(a),S=M("./playbackRateMix"),x=T.interopDefault(S),E=M("./aspectRatioMix"),L=T.interopDefault(E),b=M("./screenshotMix"),A=T.interopDefault(b),O=M("./fullscreenMix"),R=T.interopDefault(O),I=M("./fullscreenWebMix"),C=T.interopDefault(I),F=M("./pipMix"),w=T.interopDefault(F),k=M("./loadedMix"),B=T.interopDefault(k),U=M("./playedMix"),N=T.interopDefault(U),j=M("./playingMix"),K=T.interopDefault(j),V=M("./autoSizeMix"),H=T.interopDefault(V),Y=M("./rectMix"),q=T.interopDefault(Y),$=M("./flipMix"),G=T.interopDefault($),re=M("./miniMix"),Q=T.interopDefault(re),ee=M("./loopMix"),se=T.interopDefault(ee),ae=M("./posterMix"),oe=T.interopDefault(ae),fe=M("./autoHeightMix"),te=T.interopDefault(fe),le=M("./themeMix"),de=T.interopDefault(le),ce=M("./titleMix"),he=T.interopDefault(ce),ve=M("./normalSizeMix"),me=T.interopDefault(ve),ue=M("./subtitleOffsetMix"),ge=T.interopDefault(ue),W=M("./airplayMix"),z=T.interopDefault(W),X=M("./optionInit"),J=T.interopDefault(X),ie=M("./eventInit"),ne=T.interopDefault(ie);y.default=class{constructor(Z){(0,m.default)(Z),(0,_.default)(Z),(0,o.default)(Z),(0,l.default)(Z),(0,d.default)(Z),(0,h.default)(Z),(0,e.default)(Z),(0,i.default)(Z),(0,c.default)(Z),(0,v.default)(Z),(0,x.default)(Z),(0,L.default)(Z),(0,A.default)(Z),(0,R.default)(Z),(0,C.default)(Z),(0,w.default)(Z),(0,B.default)(Z),(0,N.default)(Z),(0,K.default)(Z),(0,H.default)(Z),(0,q.default)(Z),(0,G.default)(Z),(0,Q.default)(Z),(0,se.default)(Z),(0,oe.default)(Z),(0,te.default)(Z),(0,de.default)(Z),(0,he.default)(Z),(0,me.default)(Z),(0,ge.default)(Z),(0,z.default)(Z),(0,ne.default)(Z),(0,J.default)(Z)}}},{"./urlMix":"9mMBB","./attrMix":"ghisN","./playMix":"l5N6R","./pauseMix":"fVR5i","./toggleMix":"cZiBO","./seekMix":"bsO1Q","./volumeMix":"ivSmC","./currentTimeMix":"8LbXb","./durationMix":"f7tNT","./switchMix":"ejQWi","./playbackRateMix":"kNcxE","./aspectRatioMix":"8v5yt","./screenshotMix":"eLUEv","./fullscreenMix":"ifvhR","./fullscreenWebMix":"dsFtO","./pipMix":"gYMLD","./loadedMix":"fMSRd","./playedMix":"iRHNE","./playingMix":"dQ40z","./autoSizeMix":"iF844","./rectMix":"1hAm8","./flipMix":"dhi4g","./miniMix":"eQPx9","./loopMix":"gQaVE","./posterMix":"7n9Pt","./autoHeightMix":"8Az1F","./themeMix":"kXlsI","./titleMix":"b8f4Q","./normalSizeMix":"4fP62","./subtitleOffsetMix":"gdNfa","./airplayMix":"bDxGv","./optionInit":"luxZi","./eventInit":"b25aJ","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9mMBB":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,template:{$video:D}}=p;(0,T.def)(p,"url",{get:()=>D.currentSrc,async set(_){if(_){const g=m.type||(0,T.getExt)(_),o=m.customType[g];g&&o?(await(0,T.sleep)(),p.loading.show=!0,o.call(p,D,_,p)):(p.url&&p.url!==_&&p.once("video:canplay",()=>{p.isReady&&p.emit("restart")}),D.src=_,p.option.url=_,p.emit("url",_))}else await(0,T.sleep)(),p.loading.show=!0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ghisN:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$video:m}}=p;(0,T.def)(p,"attr",{value(D,_){if(_===void 0)return m[D];m[D]=_}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l5N6R:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,notice:D,option:_,constructor:{instances:g},template:{$video:o}}=p;(0,T.def)(p,"play",{value:async function(){const r=await o.play();if(D.show=m.get("Play"),p.emit("play"),_.mutex)for(let l=0;l<g.length;l++){const n=g[l];n!==p&&n.pause()}return r}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fVR5i:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$video:m},i18n:D,notice:_}=p;(0,T.def)(p,"pause",{value(){const g=m.pause();return _.show=D.get("Pause"),p.emit("pause"),g}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cZiBO:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){(0,T.def)(p,"toggle",{value:()=>p.playing?p.pause():p.play()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bsO1Q:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{notice:m}=p;(0,T.def)(p,"seek",{set(D){p.currentTime=D,p.emit("seek",p.currentTime),p.duration&&(m.show=`${(0,T.secondToTime)(p.currentTime)} / ${(0,T.secondToTime)(p.duration)}`)}}),(0,T.def)(p,"forward",{set(D){p.seek=p.currentTime+D}}),(0,T.def)(p,"backward",{set(D){p.seek=p.currentTime-D}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ivSmC:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$video:m},i18n:D,notice:_,storage:g}=p;(0,T.def)(p,"volume",{get:()=>m.volume||0,set:o=>{m.volume=(0,T.clamp)(o,0,1),_.show=`${D.get("Volume")}: ${parseInt(100*m.volume,10)}`,m.volume!==0&&g.set("volume",m.volume),p.emit("volume",m.volume)}}),(0,T.def)(p,"muted",{get:()=>m.muted,set:o=>{m.muted=o,p.emit("volume",m.volume)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8LbXb":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{$video:m}=p.template;(0,T.def)(p,"currentTime",{get:()=>m.currentTime||0,set:D=>{D=parseFloat(D),Number.isNaN(D)||(m.currentTime=(0,T.clamp)(D,0,p.duration))}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f7tNT:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){(0,T.def)(p,"duration",{get:()=>{const{duration:m}=p.template.$video;return m===1/0?0:m||0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ejQWi:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,option:D,notice:_}=p;function g(o,r,l){return new Promise(n=>{if(o===p.url)return n(o);const{playing:d}=p;p.pause(),URL.revokeObjectURL(p.url),p.url=o,p.once("video:canplay",()=>{p.playbackRate=!1,p.aspectRatio=!1,p.flip="normal",p.autoSize=D.autoSize,p.currentTime=l,p.notice.show="",d&&p.play(),r&&(_.show=`${m.get("Switch Video")}: ${r}`),p.emit("switch",o),n(o)})})}(0,T.def)(p,"switchQuality",{value:(o,r)=>g(o,r,p.currentTime)}),(0,T.def)(p,"switchUrl",{value:(o,r)=>g(o,r,0)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNcxE:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$video:m},i18n:D,notice:_}=p;(0,T.def)(p,"playbackRate",{get:()=>m.playbackRate,set(g){if(g){if(g===m.playbackRate)return;const o=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4];(0,T.errorHandle)(o.includes(g),`'playbackRate' only accept ${o.toString()} as parameters`),m.playbackRate=g,_.show=`${D.get("Rate")}: ${g===1?D.get("Normal"):`${g}x`}`,p.emit("playbackRate",g)}else p.playbackRate=1,p.emit("playbackRate")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8v5yt":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$video:m,$player:D},i18n:_,notice:g}=p;(0,T.def)(p,"aspectRatio",{get:()=>D.dataset.aspectRatio||"default",set(o){o||(o="default");const r=["default","4:3","16:9"];if((0,T.errorHandle)(r.includes(o),`'aspectRatio' only accept ${r.toString()} as parameters`),o==="default")(0,T.setStyle)(m,"width",null),(0,T.setStyle)(m,"height",null),(0,T.setStyle)(m,"padding",null),delete D.dataset.aspectRatio;else{const l=o.split(":").map(Number),{videoWidth:n,videoHeight:d}=m,{clientWidth:u,clientHeight:h}=D,t=n/d,e=l[0]/l[1];if(t>e){const s=e*d/n;(0,T.setStyle)(m,"width",100*s+"%"),(0,T.setStyle)(m,"height","100%"),(0,T.setStyle)(m,"padding",`0 ${(u-u*s)/2}px`)}else{const s=n/e/d;(0,T.setStyle)(m,"width","100%"),(0,T.setStyle)(m,"height",100*s+"%"),(0,T.setStyle)(m,"padding",(h-h*s)/2+"px 0")}D.dataset.aspectRatio=o}g.show=`${_.get("Aspect Ratio")}: ${o==="default"?_.get("Default"):o}`,p.emit("aspectRatio",o)}}),(0,T.def)(p,"aspectRatioReset",{set(o){if(o){const{aspectRatio:r}=p;p.aspectRatio=r}}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eLUEv:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,notice:D,template:{$video:_}}=p,g=(0,T.createElement)("canvas");(0,T.def)(p,"getDataURL",{value:()=>new Promise((o,r)=>{try{g.width=_.videoWidth,g.height=_.videoHeight,g.getContext("2d").drawImage(_,0,0),o(g.toDataURL("image/png"))}catch(l){D.show=l,r(l)}})}),(0,T.def)(p,"getBlobUrl",{value:()=>new Promise((o,r)=>{try{g.width=_.videoWidth,g.height=_.videoHeight,g.getContext("2d").drawImage(_,0,0),g.toBlob(l=>{o(URL.createObjectURL(l))})}catch(l){D.show=l,r(l)}})}),(0,T.def)(p,"screenshot",{value:async()=>{const o=await p.getDataURL();return(0,T.download)(o,`${m.title||"artplayer"}_${(0,T.secondToTime)(_.currentTime)}.png`),p.emit("screenshot",o),o}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ifvhR:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../libs/screenfull"),m=T.interopDefault(p),D=M("../utils");y.default=function(_){const{i18n:g,notice:o,template:{$video:r,$player:l}}=_;_.once("video:loadedmetadata",()=>{var n;m.default.isEnabled?(n=_,(0,D.def)(n,"fullscreen",{get:()=>m.default.isFullscreen,async set(d){d?(n.normalSize="fullscreen",n.aspectRatioReset=!0,n.autoSize=!1,await m.default.request(l),(0,D.addClass)(l,"art-fullscreen"),n.emit("resize"),n.emit("fullscreen",!0),o.show=""):(n.aspectRatioReset=!0,n.autoSize=n.option.autoSize,await m.default.exit(),(0,D.removeClass)(l,"art-fullscreen"),n.emit("resize"),n.emit("fullscreen",!1),o.show="")}})):document.fullscreenEnabled||r.webkitSupportsFullscreen?(d=>{(0,D.def)(d,"fullscreen",{get:()=>r.webkitDisplayingFullscreen,set(u){u?(d.normalSize="fullscreen",r.webkitEnterFullscreen(),d.emit("fullscreen",!0),o.show=""):(r.webkitExitFullscreen(),d.emit("fullscreen",!1),o.show="")}})})(_):(0,D.def)(_,"fullscreen",{get:()=>!1,set(){o.show=g.get("Fullscreen Not Supported")}}),(0,D.def)(_,"fullscreen",(0,D.get)(_,"fullscreen"))})}},{"../libs/screenfull":"dXDKn","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dXDKn:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);const T=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],p=(()=>{if(typeof document>"u")return!1;const _=T[0],g={};for(const o of T)if(o[1]in document){for(const[r,l]of o.entries())g[_[r]]=l;return g}return!1})(),m={change:p.fullscreenchange,error:p.fullscreenerror};let D={request:(_=document.documentElement,g)=>new Promise((o,r)=>{const l=()=>{D.off("change",l),o()};D.on("change",l);const n=_[p.requestFullscreen](g);n instanceof Promise&&n.then(l).catch(r)}),exit:()=>new Promise((_,g)=>{if(!D.isFullscreen)return void _();const o=()=>{D.off("change",o),_()};D.on("change",o);const r=document[p.exitFullscreen]();r instanceof Promise&&r.then(o).catch(g)}),toggle:(_,g)=>D.isFullscreen?D.exit():D.request(_,g),onchange(_){D.on("change",_)},onerror(_){D.on("error",_)},on(_,g){const o=m[_];o&&document.addEventListener(o,g,!1)},off(_,g){const o=m[_];o&&document.removeEventListener(o,g,!1)},raw:p};Object.defineProperties(D,{isFullscreen:{get:()=>Boolean(document[p.fullscreenElement])},element:{enumerable:!0,get:()=>document[p.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[p.fullscreenEnabled])}}),p||(D={isEnabled:!1}),y.default=D},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dsFtO:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{notice:m,template:{$player:D}}=p;(0,T.def)(p,"fullscreenWeb",{get:()=>(0,T.hasClass)(D,"art-fullscreen-web"),set(_){_?(p.normalSize="fullscreenWeb",(0,T.addClass)(D,"art-fullscreen-web"),p.aspectRatioReset=!0,p.autoSize=!1,p.emit("resize"),p.emit("fullscreenWeb",!0),m.show=""):((0,T.removeClass)(D,"art-fullscreen-web"),p.aspectRatioReset=!0,p.autoSize=p.option.autoSize,p.emit("resize"),p.emit("fullscreenWeb",!1),m.show="")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gYMLD:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,notice:D,template:{$video:_}}=p;document.pictureInPictureEnabled?function(g){const{template:{$video:o},events:{proxy:r},notice:l}=g;o.disablePictureInPicture=!1,(0,T.def)(g,"pip",{get:()=>document.pictureInPictureElement,set(n){n?(g.normalSize="pip",o.requestPictureInPicture().catch(d=>{throw l.show=d,d})):document.exitPictureInPicture().catch(d=>{throw l.show=d,d})}}),r(o,"enterpictureinpicture",()=>{g.emit("pip",!0)}),r(o,"leavepictureinpicture",()=>{g.emit("pip",!1)})}(p):_.webkitSupportsPresentationMode?function(g){const{$video:o}=g.template;o.webkitSetPresentationMode("inline"),(0,T.def)(g,"pip",{get:()=>o.webkitPresentationMode==="picture-in-picture",set(r){r?(g.normalSize="pip",o.webkitSetPresentationMode("picture-in-picture"),g.emit("pip",!0)):(o.webkitSetPresentationMode("inline"),g.emit("pip",!1))}})}(p):(0,T.def)(p,"pip",{get:()=>!1,set(){D.show=m.get("PIP Not Supported")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fMSRd:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{$video:m}=p.template;(0,T.def)(p,"loaded",{get:()=>p.loadedTime/m.duration}),(0,T.def)(p,"loadedTime",{get:()=>m.buffered.length?m.buffered.end(m.buffered.length-1):0})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iRHNE:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){(0,T.def)(p,"played",{get:()=>p.currentTime/p.duration})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dQ40z:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{$video:m}=p.template;(0,T.def)(p,"playing",{get:()=>m.currentTime>0&&!m.paused&&!m.ended&&m.readyState>2})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iF844:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{$container:m,$player:D,$video:_}=p.template;(0,T.def)(p,"autoSize",{get:()=>(0,T.hasClass)(m,"art-auto-size"),set(g){if(g){const{videoWidth:o,videoHeight:r}=_,{width:l,height:n}=m.getBoundingClientRect(),d=o/r,u=l/n;if((0,T.addClass)(m,"art-auto-size"),u>d){const h=n*d/l*100;(0,T.setStyle)(D,"width",`${h}%`),(0,T.setStyle)(D,"height","100%")}else{const h=l/d/n*100;(0,T.setStyle)(D,"width","100%"),(0,T.setStyle)(D,"height",`${h}%`)}p.emit("autoSize",{width:p.width,height:p.height})}else(0,T.removeClass)(m,"art-auto-size"),(0,T.setStyle)(D,"width",null),(0,T.setStyle)(D,"height",null),p.emit("autoSize")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1hAm8":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){(0,T.def)(p,"rect",{get:()=>p.template.$player.getBoundingClientRect()});const m=["bottom","height","left","right","top","width"];for(let D=0;D<m.length;D++){const _=m[D];(0,T.def)(p,_,{get:()=>p.rect[_]})}(0,T.def)(p,"x",{get:()=>p.left+window.pageXOffset}),(0,T.def)(p,"y",{get:()=>p.top+window.pageYOffset})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dhi4g:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{template:{$player:m},i18n:D,notice:_}=p;(0,T.def)(p,"flip",{get:()=>m.dataset.flip||"normal",set(g){g||(g="normal");const o=["normal","horizontal","vertical"];(0,T.errorHandle)(o.includes(g),`'flip' only accept ${o.toString()} as parameters`),g==="normal"?delete m.dataset.flip:m.dataset.flip=g;const r=g.replace(g[0],g[0].toUpperCase());_.show=`${D.get("Video Flip")}: ${D.get(r)}`,p.emit("flip",g)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eQPx9:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,option:D,storage:_,events:{proxy:g},template:{$player:o,$miniClose:r,$miniTitle:l,$miniHeader:n}}=p;let d=!1,u=0,h=0,t=0,e=0;g(n,"mousedown",s=>{d=!0,u=s.pageX,h=s.pageY,t=p.left,e=p.top}),g(document,"mousemove",s=>{if(d){(0,T.addClass)(o,"art-is-dragging");const i=e+s.pageY-h,f=t+s.pageX-u;(0,T.setStyle)(o,"top",`${i}px`),(0,T.setStyle)(o,"left",`${f}px`),_.set("top",i),_.set("left",f)}}),g(document,"mouseup",()=>{d=!1,(0,T.removeClass)(o,"art-is-dragging")}),g(r,"click",()=>{p.mini=!1,d=!1,(0,T.removeClass)(o,"art-is-dragging")}),(0,T.append)(l,D.title||m.get("Mini Player")),(0,T.def)(p,"mini",{get:()=>(0,T.hasClass)(o,"art-mini"),set(s){if(s){p.normalSize="mini",p.autoSize=!1,(0,T.addClass)(o,"art-mini");const i=_.get("top"),f=_.get("left");if(i&&f)(0,T.setStyle)(o,"top",`${i}px`),(0,T.setStyle)(o,"left",`${f}px`),(0,T.isInViewport)(n)||(_.del("top"),_.del("left"),p.mini=!0);else{const c=window.innerHeight-p.height-50,a=window.innerWidth-p.width-50;_.set("top",c),_.set("left",a),(0,T.setStyle)(o,"top",`${c}px`),(0,T.setStyle)(o,"left",`${a}px`)}p.aspectRatio=!1,p.playbackRate=!1,p.notice.show="",p.emit("mini",!0)}else(0,T.removeClass)(o,"art-mini"),(0,T.setStyle)(o,"top",null),(0,T.setStyle)(o,"left",null),p.aspectRatio=!1,p.playbackRate=!1,p.autoSize=D.autoSize,p.notice.show="",p.emit("mini",!1)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gQaVE:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){let m=[];(0,T.def)(p,"loop",{get:()=>m,set:D=>{if(Array.isArray(D)&&typeof D[0]=="number"&&typeof D[1]=="number"){const _=(0,T.clamp)(D[0],0,Math.min(D[1],p.duration)),g=(0,T.clamp)(D[1],_,p.duration);g-_>=1?(m=[_,g],p.emit("loop",m)):(m=[],p.emit("loop"))}else m=[],p.emit("loop")}}),p.on("video:timeupdate",()=>{m.length&&(p.currentTime<m[0]||p.currentTime>m[1])&&(p.seek=m[0])})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7n9Pt":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,template:{$poster:D}}=p;(0,T.def)(p,"poster",{get:()=>m.poster,set(_){m.poster=_,(0,T.setStyle)(D,"backgroundImage",`url(${_})`)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8Az1F":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,template:{$container:D,$video:_}}=p,g=D.style.height;(0,T.def)(p,"autoHeight",{get:()=>(0,T.hasClass)(D,"art-auto-height"),set(o){if(o){const{clientWidth:r}=D,{videoHeight:l,videoWidth:n}=_,d=l*(r/n);(0,T.setStyle)(D,"height",d+"px"),(0,T.addClass)(D,"art-auto-height"),p.autoSize=m.autoSize,p.emit("autoHeight",d)}else(0,T.setStyle)(D,"height",g),(0,T.removeClass)(D,"art-auto-height"),p.autoSize=m.autoSize,p.emit("autoHeight")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXlsI:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,template:{$player:D}}=p;(0,T.def)(p,"theme",{get:()=>getComputedStyle(D).getPropertyValue("--theme"),set(_){m.theme=_,D.style.setProperty("--theme",_)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b8f4Q:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){(0,T.def)(p,"title",{get:()=>p.option.title,set(m){p.option.title=m}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4fP62":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const m=["mini","pip","fullscreen","fullscreenWeb"];(0,T.def)(p,"normalSize",{get:()=>m.every(D=>!p[D]),set(D){m.filter(_=>_!==D).forEach(_=>{p[_]&&(p[_]=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gdNfa:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{clamp:m}=p.constructor.utils,{notice:D,template:_,i18n:g}=p;let o=0,r=[];p.on("subtitle:switch",()=>{r=[]}),(0,T.def)(p,"subtitleOffset",{get:()=>o,set(l){if(_.$track&&_.$track.track){const n=Array.from(_.$track.track.cues);o=m(l,-5,5);for(let d=0;d<n.length;d++){const u=n[d];r[d]||(r[d]={startTime:u.startTime,endTime:u.endTime}),u.startTime=m(r[d].startTime+o,0,p.duration),u.endTime=m(r[d].endTime+o,0,p.duration)}p.subtitle.update(),D.show=`${g.get("Subtitle Offset")}: ${l}s`,p.emit("subtitleOffset",l)}else p.emit("subtitleOffset",0)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bDxGv:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,notice:D,events:{proxy:_},template:{$video:g}}=p;let o=!0;window.WebKitPlaybackTargetAvailabilityEvent&&g.webkitShowPlaybackTargetPicker?_(g,"webkitplaybacktargetavailabilitychanged",r=>{switch(r.availability){case"available":o=!0;break;case"not-available":o=!1}}):o=!1,(0,T.def)(p,"airplay",{value(){o?(g.webkitShowPlaybackTargetPicker(),p.emit("airplay")):D.show=m.get("AirPlay Not Available")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],luxZi:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,storage:D,template:{$video:_,$poster:g}}=p;Object.keys(m.moreVideoAttr).forEach(r=>{p.attr(r,m.moreVideoAttr[r])}),m.muted&&(p.muted=m.muted),m.volume&&(_.volume=(0,T.clamp)(m.volume,0,1));const o=D.get("volume");typeof o=="number"&&(_.volume=(0,T.clamp)(o,0,1)),m.poster&&(0,T.setStyle)(g,"backgroundImage",`url(${m.poster})`),m.autoplay&&(_.autoplay=m.autoplay),m.playsInline&&(_.playsInline=!0,_["webkit-playsinline"]=!0),m.theme&&(p.theme=m.theme),p.url=m.url}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b25aJ:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../config"),m=T.interopDefault(p),D=M("../utils");y.default=function(_){const{i18n:g,notice:o,option:r,constructor:l,events:{proxy:n},template:{$player:d,$video:u,$poster:h}}=_;let t=0;for(let e=0;e<m.default.events.length;e++)n(u,m.default.events[e],s=>{_.emit(`video:${s.type}`,s)});_.on("video:canplay",()=>{t=0,_.loading.show=!1}),_.once("video:canplay",()=>{_.loading.show=!1,_.controls.show=!0,_.mask.show=!0,_.isReady=!0,_.emit("ready")}),_.on("video:ended",()=>{r.loop?(_.seek=0,_.play(),_.controls.show=!1,_.mask.show=!1):(_.controls.show=!0,_.mask.show=!0)}),_.on("video:error",async()=>{t<l.RECONNECT_TIME_MAX?(await(0,D.sleep)(l.RECONNECT_SLEEP_TIME),t+=1,_.url=r.url,o.show=`${g.get("Reconnect")}: ${t}`,_.emit("error",t)):(_.mask.show=!0,_.loading.show=!1,_.controls.show=!0,(0,D.addClass)(d,"art-error"),await(0,D.sleep)(l.RECONNECT_SLEEP_TIME),o.show=g.get("Video Load Failed"),_.destroy(!1))}),_.on("video:loadedmetadata",()=>{_.autoSize=r.autoSize,D.isMobile&&(_.loading.show=!1,_.controls.show=!0,_.mask.show=!0)}),_.on("video:loadstart",()=>{_.loading.show=!0,_.mask.show=!1,_.controls.show=!0}),_.on("video:pause",()=>{_.controls.show=!0,_.mask.show=!0}),_.on("video:play",()=>{_.mask.show=!1,(0,D.setStyle)(h,"display","none")}),_.on("video:playing",()=>{_.mask.show=!1}),_.on("video:seeked",()=>{_.loading.show=!1}),_.on("video:seeking",()=>{_.loading.show=!0,_.mask.show=!1}),_.on("video:timeupdate",()=>{_.mask.show=!1}),_.on("video:waiting",()=>{_.loading.show=!0,_.mask.show=!1})}},{"../config":"ej4fZ","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3qXcr":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils"),m=M("../utils/component"),D=T.interopDefault(m),_=M("./fullscreen"),g=T.interopDefault(_),o=M("./fullscreenWeb"),r=T.interopDefault(o),l=M("./pip"),n=T.interopDefault(l),d=M("./playAndPause"),u=T.interopDefault(d),h=M("./progress"),t=T.interopDefault(h),e=M("./time"),s=T.interopDefault(e),i=M("./volume"),f=T.interopDefault(i),c=M("./setting"),a=T.interopDefault(c),v=M("./thumbnails"),S=T.interopDefault(v),x=M("./screenshot"),E=T.interopDefault(x),L=M("./quality"),b=T.interopDefault(L),A=M("./loop"),O=T.interopDefault(A),R=M("./airplay"),I=T.interopDefault(R);class C extends D.default{constructor(w){super(w),this.name="control";const{constructor:k,events:{proxy:B},template:{$player:U}}=w;let N=Date.now();B(U,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,p.removeClass)(U,"art-hide-cursor"),(0,p.addClass)(U,"art-hover"),N=Date.now()}),w.on("video:timeupdate",()=>{!w.isInput&&w.playing&&this.show&&Date.now()-N>=k.CONTROL_HIDE_TIME&&(this.show=!1,(0,p.addClass)(U,"art-hide-cursor"),(0,p.removeClass)(U,"art-hover"))}),this.init()}init(){const{option:w}=this.art;w.isLive||this.add((0,t.default)({name:"progress",position:"top",index:10})),!w.thumbnails.url||w.isLive||p.isMobile||this.add((0,S.default)({name:"thumbnails",position:"top",index:20})),this.add((0,O.default)({name:"loop",position:"top",index:30})),this.add((0,u.default)({name:"playAndPause",position:"left",index:10})),this.add((0,f.default)({name:"volume",position:"left",index:20})),w.isLive||this.add((0,s.default)({name:"time",position:"left",index:30})),w.quality.length&&this.add((0,b.default)({name:"quality",position:"right",index:10})),w.screenshot&&!p.isMobile&&this.add((0,E.default)({name:"screenshot",position:"right",index:20})),w.setting&&this.add((0,a.default)({name:"setting",position:"right",index:30})),w.pip&&this.add((0,n.default)({name:"pip",position:"right",index:40})),w.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,I.default)({name:"airplay",position:"right",index:50})),w.fullscreenWeb&&this.add((0,r.default)({name:"fullscreenWeb",position:"right",index:60})),w.fullscreen&&this.add((0,g.default)({name:"fullscreen",position:"right",index:70}));for(let k=0;k<w.controls.length;k++)this.add(w.controls[k])}add(w){const k=typeof w=="function"?w(this.art):w,{$progress:B,$controlsLeft:U,$controlsRight:N}=this.art.template;switch(k.position){case"top":this.$parent=B;break;case"left":this.$parent=U;break;case"right":this.$parent=N;break;default:(0,p.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(k)}}y.default=C},{"../utils":"5yYFo","../utils/component":"5MLcx","./fullscreen":"43BKT","./fullscreenWeb":"kQJHz","./pip":"aWne0","./playAndPause":"4z78f","./progress":"19nwD","./time":"lh90q","./volume":"hsA6A","./setting":"4rv3i","./thumbnails":"lTgvI","./screenshot":"71GuX","./quality":"f9VNW","./loop":"d1O2Q","./airplay":"aIzPt","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5MLcx":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./dom"),m=M("option-validator"),D=T.interopDefault(m),_=M("../scheme"),g=M("./property"),o=M("./error");y.default=class{constructor(r){this.id=0,this.art=r,this.add=this.add.bind(this)}get show(){return(0,p.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(r){const{$player:l}=this.art.template,n=`art-${this.name}-show`;r?(0,p.addClass)(l,n):(0,p.removeClass)(l,n),this.art.emit(this.name,r)}set toggle(r){r&&(this.show=!this.show)}add(r){const l=typeof r=="function"?r(this.art):r;if(l.html=l.html||"",(0,D.default)(l,_.ComponentOption),!this.$parent||!this.name||l.disable)return;const n=l.name||`${this.name}${this.id}`;(0,o.errorHandle)(!(0,g.has)(this,n),`Cannot add an existing name [${n}] to the [${this.name}]`),this.id+=1;const d=(0,p.createElement)("div");(0,p.addClass)(d,`art-${this.name}`),(0,p.addClass)(d,`art-${this.name}-${n}`);const u=Array.from(this.$parent.children);d.dataset.index=l.index||this.id;const h=u.find(t=>Number(t.dataset.index)>=Number(d.dataset.index));return h?h.insertAdjacentElement("beforebegin",d):(0,p.append)(this.$parent,d),l.html&&(0,p.append)(d,l.html),l.style&&(0,p.setStyles)(d,l.style),l.tooltip&&(0,p.tooltip)(d,l.tooltip),l.click&&this.art.events.proxy(d,"click",t=>{t.preventDefault(),l.click.call(this.art,this,t)}),l.selector&&["left","right"].includes(l.position)&&this.selector(l,d),l.mounted&&l.mounted.call(this.art,d),d.childNodes.length===1&&d.childNodes[0].nodeType===3&&(0,p.addClass)(d,"art-control-onlyText"),(0,g.def)(this,n,{value:d}),d}selector(r,l){const{hover:n,proxy:d}=this.art.events;(0,p.addClass)(l,"art-control-selector");const u=(0,p.createElement)("div");(0,p.addClass)(u,"art-selector-value"),(0,p.append)(u,r.html),l.innerText="",(0,p.append)(l,u);const h=r.selector.map((s,i)=>`<div class="art-selector-item ${s.default?"art-current":""}" data-index="${i}">${s.html}</div>`).join(""),t=(0,p.createElement)("div");(0,p.addClass)(t,"art-selector-list"),(0,p.append)(t,h),(0,p.append)(l,t);const e=()=>{const s=(0,p.getStyle)(l,"width")/2-(0,p.getStyle)(t,"width")/2;t.style.left=`${s}px`};n(l,e),d(t,"click",async s=>{const i=(s.composedPath()||[]).find(a=>(0,p.hasClass)(a,"art-selector-item"));if(!i)return;(0,p.inverseClass)(i,"art-current");const f=Number(i.dataset.index),c=r.selector[f]||{};if(u.innerText=i.innerText,r.onSelect){const a=await r.onSelect.call(this.art,c,i,s);typeof a!="string"&&typeof a!="number"||(u.innerHTML=a)}e(),this.art.emit("selector",c,i)})}}},{"./dom":"fqaW9","option-validator":"eaJBf","../scheme":"3izFE","./property":"5ynPA","./error":"kNZvP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"43BKT":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("Fullscreen"),mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m,r=(0,T.append)(D,g.fullscreenOn),l=(0,T.append)(D,g.fullscreenOff);(0,T.setStyle)(l,"display","none"),_(D,"click",()=>{m.fullscreen=!m.fullscreen}),m.on("fullscreen",n=>{n?((0,T.tooltip)(D,o.get("Exit Fullscreen")),(0,T.setStyle)(r,"display","none"),(0,T.setStyle)(l,"display","inline-flex")):((0,T.tooltip)(D,o.get("Fullscreen")),(0,T.setStyle)(r,"display","inline-flex"),(0,T.setStyle)(l,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kQJHz:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("Web Fullscreen"),mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m,r=(0,T.append)(D,g.fullscreenWebOn),l=(0,T.append)(D,g.fullscreenWebOff);(0,T.setStyle)(l,"display","none"),_(D,"click",()=>{m.fullscreenWeb=!m.fullscreenWeb}),m.on("fullscreenWeb",n=>{n?((0,T.tooltip)(D,o.get("Exit Web Fullscreen")),(0,T.setStyle)(r,"display","none"),(0,T.setStyle)(l,"display","inline-flex")):((0,T.tooltip)(D,o.get("Web Fullscreen")),(0,T.setStyle)(r,"display","inline-flex"),(0,T.setStyle)(l,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aWne0:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("PIP Mode"),mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m;(0,T.append)(D,g.pip),_(D,"click",()=>{m.pip=!m.pip}),m.on("pip",r=>{(0,T.tooltip)(D,o.get(r?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4z78f":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m,r=(0,T.append)(D,g.play),l=(0,T.append)(D,g.pause);function n(){(0,T.setStyle)(r,"display","flex"),(0,T.setStyle)(l,"display","none")}function d(){(0,T.setStyle)(r,"display","none"),(0,T.setStyle)(l,"display","flex")}(0,T.tooltip)(r,o.get("Play")),(0,T.tooltip)(l,o.get("Pause")),_(r,"click",()=>{m.play()}),_(l,"click",()=>{m.pause()}),m.playing?d():n(),m.on("video:playing",()=>{d()}),m.on("video:pause",()=>{n()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"19nwD":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y),T.export(y,"getPosFromEvent",()=>m);var p=M("../utils");function m(D,_){const{$progress:g}=D.template,{left:o}=g.getBoundingClientRect(),r=_.pageX,l=(0,p.clamp)(r-o,0,g.clientWidth),n=l/g.clientWidth*D.duration;return{second:n,time:(0,p.secondToTime)(n),width:l,percentage:(0,p.clamp)(l/g.clientWidth,0,1)}}y.default=function(D){return _=>{const{icons:g,option:o,events:{proxy:r}}=_;return{...D,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:l=>{let n=!1;const d=(0,p.query)(".art-progress-loaded",l),u=(0,p.query)(".art-progress-played",l),h=(0,p.query)(".art-progress-highlight",l),t=(0,p.query)(".art-progress-indicator",l),e=(0,p.query)(".art-progress-tip",l);(0,p.setStyle)(u,"backgroundColor","var(--theme)");let s=_.constructor.INDICATOR_SIZE;function i(f,c){f==="loaded"&&(0,p.setStyle)(d,"width",100*c+"%"),f==="played"&&((0,p.setStyle)(u,"width",100*c+"%"),(0,p.setStyle)(t,"left",`calc(${100*c}% - ${s/2}px)`))}g.indicator?(s=_.constructor.INDICATOR_SIZE_ICON,(0,p.append)(t,g.indicator)):(0,p.setStyles)(t,{backgroundColor:"var(--theme)"}),p.isMobile&&(s=_.constructor.INDICATOR_SIZE_MOBILE,g.indicator&&(s=_.constructor.INDICATOR_SIZE_MOBILE_ICON)),(0,p.setStyles)(t,{left:`-${s/2}px`,width:`${s}px`,height:`${s}px`}),_.on("video:loadedmetadata",()=>{for(let f=0;f<o.highlight.length;f++){const c=o.highlight[f],a=(0,p.clamp)(c.time,0,_.duration)/_.duration*100;(0,p.append)(h,`<span data-text="${c.text}" data-time="${c.time}" style="left: ${a}%"></span>`)}}),i("loaded",_.loaded),_.on("setBar",(f,c)=>{i(f,c)}),_.on("video:progress",()=>{i("loaded",_.loaded)}),_.on("video:timeupdate",()=>{i("played",_.played)}),_.on("video:ended",()=>{i("played",1)}),p.isMobile||(r(l,"click",f=>{if(f.target!==t){const{second:c,percentage:a}=m(_,f);i("played",a),_.seek=c}}),r(l,"mousemove",f=>{(0,p.setStyle)(e,"display","block"),(0,p.includeFromEvent)(f,h)?function(c){const{width:a}=m(_,c),{text:v}=c.target.dataset;e.innerHTML=v;const S=e.clientWidth;a<=S/2?(0,p.setStyle)(e,"left",0):a>l.clientWidth-S/2?(0,p.setStyle)(e,"left",l.clientWidth-S+"px"):(0,p.setStyle)(e,"left",a-S/2+"px")}(f):function(c){const{width:a,time:v}=m(_,c);e.innerHTML=v;const S=e.clientWidth;a<=S/2?(0,p.setStyle)(e,"left",0):a>l.clientWidth-S/2?(0,p.setStyle)(e,"left",l.clientWidth-S+"px"):(0,p.setStyle)(e,"left",a-S/2+"px")}(f)}),r(l,"mouseout",()=>{(0,p.setStyle)(e,"display","none")}),r(t,"mousedown",()=>{n=!0}),r(document,"mousemove",f=>{if(n){const{second:c,percentage:a}=m(_,f);i("played",a),_.seek=c}}),r(document,"mouseup",()=>{n&&(n=!1)}))}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lh90q:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,style:{cursor:"auto"},mounted:D=>{function _(){const o=`${(0,T.secondToTime)(m.currentTime)} / ${(0,T.secondToTime)(m.duration)}`;o!==D.innerText&&(D.innerText=o)}_();const g=["video:loadedmetadata","video:timeupdate","video:progress"];for(let o=0;o<g.length;o++)m.on(g[o],_)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hsA6A:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m;let r=!1;const l=m.constructor.VOLUME_PANEL_WIDTH,n=m.constructor.VOLUME_HANDLE_WIDTH,d=(0,T.append)(D,g.volume),u=(0,T.append)(D,g.volumeClose),h=(0,T.append)(D,'<div class="art-volume-panel"></div>'),t=(0,T.append)(h,'<div class="art-volume-slider-handle"></div>');function e(i){const{left:f}=h.getBoundingClientRect();return(0,T.clamp)(i.pageX-f-n/2,0,l-n/2)/(l-n)}function s(i=.7){if(m.muted||i===0)(0,T.setStyle)(d,"display","none"),(0,T.setStyle)(u,"display","flex"),(0,T.setStyle)(t,"left","0");else{const f=(l-n)*i;(0,T.setStyle)(d,"display","flex"),(0,T.setStyle)(u,"display","none"),(0,T.setStyle)(t,"left",`${f}px`)}}(0,T.tooltip)(d,o.get("Mute")),(0,T.setStyle)(u,"display","none"),T.isMobile&&(0,T.setStyle)(h,"display","none"),s(m.volume),m.on("video:volumechange",()=>{s(m.volume)}),_(d,"click",()=>{m.muted=!0}),_(u,"click",()=>{m.muted=!1}),_(h,"click",i=>{m.muted=!1,m.volume=e(i)}),_(t,"mousedown",()=>{r=!0}),_(D,"mousemove",i=>{r&&(m.muted=!1,m.volume=e(i))}),_(document,"mouseup",()=>{r&&(r=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4rv3i":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("Show Setting"),mounted:D=>{const{events:{proxy:_},icons:g,i18n:o}=m;(0,T.append)(D,g.setting),_(D,"click",()=>{m.setting.toggle=!0}),m.on("setting",r=>{(0,T.tooltip)(D,o.get(r?"Hide Setting":"Show Setting"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lTgvI:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils"),p=M("./progress");y.default=function(m){return D=>({...m,mounted:_=>{const{option:g,template:{$progress:o,$video:r},events:{proxy:l,loadImg:n}}=D;let d=null,u=!1,h=!1;l(o,"mousemove",async t=>{u||(u=!0,d=await n(g.thumbnails.url),h=!0),h&&((0,T.setStyle)(_,"display","block"),function(e){const{width:s}=(0,p.getPosFromEvent)(D,e),{url:i,number:f,column:c,width:a,height:v}=g.thumbnails,S=a||d.naturalWidth/c,x=v||S/(r.videoWidth/r.videoHeight),E=o.clientWidth/f,L=Math.floor(s/E),b=Math.ceil(L/c)-1,A=L%c||c-1;(0,T.setStyle)(_,"backgroundImage",`url(${i})`),(0,T.setStyle)(_,"height",`${x}px`),(0,T.setStyle)(_,"width",`${S}px`),(0,T.setStyle)(_,"backgroundPosition",`-${A*S}px -${b*x}px`),s<=S/2?(0,T.setStyle)(_,"left",0):s>o.clientWidth-S/2?(0,T.setStyle)(_,"left",o.clientWidth-S+"px"):(0,T.setStyle)(_,"left",s-S/2+"px")}(t))}),l(o,"mouseout",()=>{(0,T.setStyle)(_,"display","none")})}})}},{"../utils":"5yYFo","./progress":"19nwD","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"71GuX":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("Screenshot"),mounted:D=>{const{events:{proxy:_},icons:g}=m;(0,T.append)(D,g.screenshot),_(D,"click",()=>{m.screenshot()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f9VNW:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T){return p=>{const m=p.option.quality,D=m.find(_=>_.default)||m[0];return{...T,html:D?D.html:"",selector:m,onSelect(_){p.switchQuality(_.url,_.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],d1O2Q:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,mounted:D=>{const _=(0,T.append)(D,'<span class="art-loop-point"></span>'),g=(0,T.append)(D,'<span class="art-loop-point"></span>');m.on("loop",o=>{o?((0,T.setStyle)(D,"display","block"),(0,T.setStyle)(_,"left",`calc(${o[0]/m.duration*100}% - ${_.clientWidth}px)`),(0,T.setStyle)(g,"left",o[1]/m.duration*100+"%")):(0,T.setStyle)(D,"display","none")})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aIzPt:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>({...p,tooltip:m.i18n.get("AirPlay"),mounted:D=>{const{events:{proxy:_},icons:g}=m;(0,T.append)(D,g.airplay),_(D,"click",()=>m.airplay())}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hTnNz:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils"),m=M("../utils/component"),D=T.interopDefault(m),_=M("./playbackRate"),g=T.interopDefault(_),o=M("./aspectRatio"),r=T.interopDefault(o),l=M("./flip"),n=T.interopDefault(l),d=M("./info"),u=T.interopDefault(d),h=M("./version"),t=T.interopDefault(h),e=M("./close"),s=T.interopDefault(e);class i extends D.default{constructor(c){super(c),this.name="contextmenu",this.$parent=c.template.$contextmenu,p.isMobile||this.init()}init(){const{option:c,template:{$player:a,$contextmenu:v},events:{proxy:S}}=this.art;c.playbackRate&&this.add((0,g.default)({name:"playbackRate",index:10})),c.aspectRatio&&this.add((0,r.default)({name:"aspectRatio",index:20})),c.flip&&this.add((0,n.default)({name:"flip",index:30})),this.add((0,u.default)({name:"info",index:40})),this.add((0,t.default)({name:"version",index:50})),this.add((0,s.default)({name:"close",index:60}));for(let x=0;x<c.contextmenu.length;x++)this.add(c.contextmenu[x]);S(a,"contextmenu",x=>{x.preventDefault(),this.show=!0;const E=x.clientX,L=x.clientY,{height:b,width:A,left:O,top:R}=a.getBoundingClientRect(),{height:I,width:C}=v.getBoundingClientRect();let F=E-O,w=L-R;E+C>O+A&&(F=A-C),L+I>R+b&&(w=b-I),(0,p.setStyles)(v,{top:`${w}px`,left:`${F}px`})}),S(a,"click",x=>{(0,p.includeFromEvent)(x,v)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}y.default=i},{"../utils":"5yYFo","../utils/component":"5MLcx","./playbackRate":"1uTBJ","./aspectRatio":"cFKj0","./flip":"l7S3g","./info":"ihHBb","./version":"3q8wK","./close":"sLP7j","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1uTBJ":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>{const{i18n:D}=m;return{...p,html:`${D.get("Play Speed")}:<span data-value="0.5">0.5</span><span data-value="0.75">0.75</span><span data-value="1.0" class="art-current">${D.get("Normal")}</span><span data-value="1.25">1.25</span><span data-value="1.5">1.5</span><span data-value="2.0">2.0</span>`,click:(_,g)=>{const{value:o}=g.target.dataset;o&&(m.playbackRate=Number(o),_.show=!1)},mounted:_=>{m.on("playbackRate",g=>{const o=(0,T.queryAll)("span",_).find(r=>Number(r.dataset.value)===g);o&&(0,T.inverseClass)(o,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cFKj0:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>{const{i18n:D}=m;return{...p,html:`${D.get("Aspect Ratio")}:<span data-value="default" class="art-current">${D.get("Default")}</span><span data-value="4:3">4:3</span><span data-value="16:9">16:9</span>`,click:(_,g)=>{const{value:o}=g.target.dataset;o&&(m.aspectRatio=o,_.show=!1)},mounted:_=>{m.on("aspectRatio",g=>{const o=(0,T.queryAll)("span",_).find(r=>r.dataset.value===g);o&&(0,T.inverseClass)(o,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l7S3g:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){return m=>{const{i18n:D}=m;return{...p,html:`${D.get("Video Flip")}:<span data-value="normal" class="art-current">${D.get("Normal")}</span><span data-value="horizontal">${D.get("Horizontal")}</span><span data-value="vertical">${D.get("Vertical")}</span>`,click:(_,g)=>{const{value:o}=g.target.dataset;o&&(m.flip=o,_.show=!1)},mounted:_=>{m.on("flip",g=>{const o=(0,T.queryAll)("span",_).find(r=>r.dataset.value===g);o&&(0,T.inverseClass)(o,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ihHBb:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T){return p=>({...T,html:p.i18n.get("Video Info"),click:m=>{p.info.show=!0,m.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3q8wK":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T){return{...T,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.5.6</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],sLP7j:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T){return p=>({...T,html:p.i18n.get("Close"),click:m=>{m.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bfwuE:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./utils"),m=M("./utils/component"),D=T.interopDefault(m);class _ extends D.default{constructor(o){super(o),this.name="info",p.isMobile||this.init()}init(){const{constructor:o,events:{proxy:r},template:{$infoPanel:l,$infoClose:n,$video:d}}=this.art;r(n,"click",()=>{this.show=!1});let u=null;const h=(0,p.queryAll)("[data-video]",l)||[];this.art.on("destroy",()=>{clearTimeout(u)}),function t(){for(let e=0;e<h.length;e++){const s=h[e],i=d[s.dataset.video],f=typeof i=="number"?i.toFixed(2):i;s.innerText!==f&&(s.innerText=f)}u=setTimeout(t,o.INFO_LOOP_TIME)}()}}y.default=_},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bWZ2U:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./utils"),m=M("./utils/component"),D=T.interopDefault(m),_=M("option-validator"),g=T.interopDefault(_),o=M("./scheme"),r=T.interopDefault(o);class l extends D.default{constructor(d){super(d),this.name="subtitle",this.eventDestroy=()=>null,this.init(d.option.subtitle);let u=!1;d.on("video:timeupdate",()=>{if(!this.url)return;const h=this.art.template.$video.webkitDisplayingFullscreen;typeof h=="boolean"&&h!==u&&(u=h,this.createTrack(h?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(d){this.switch(d)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(d,u){const{$subtitle:h}=this.art.template;return typeof d=="object"?(0,p.setStyles)(h,d):(0,p.setStyle)(h,d,u)}update(){const{$subtitle:d}=this.art.template;d.innerHTML="",this.activeCue&&(d.innerHTML=this.activeCue.text.split(/\r?\n/).map(u=>`<p>${(0,p.escape)(u)}</p>`).join(""),this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(d,u={}){const{i18n:h,notice:t,option:e}=this.art,s={...e.subtitle,...u,url:d},i=await this.init(s);return u.name&&(t.show=`${h.get("Switch Subtitle")}: ${u.name}`),i}createTrack(d,u){const{template:h,proxy:t}=this.art,{$video:e,$track:s}=h,i=(0,p.createElement)("track");i.default=!0,i.kind=d,i.src=u,this.eventDestroy(),(0,p.remove)(s),(0,p.append)(e,i),h.$track=i,this.eventDestroy=t(this.textTrack,"cuechange",()=>this.update())}async init(d){const{notice:u,template:{$subtitle:h}}=this.art;if((0,g.default)(d,r.default.subtitle),d.url)return this.style(d.style),fetch(d.url).then(t=>t.arrayBuffer()).then(t=>{const e=new TextDecoder(d.encoding).decode(t);switch(this.art.emit("subtitleLoad",d.url),d.type||(0,p.getExt)(d.url)){case"srt":return(0,p.vttToBlob)((0,p.srtToVtt)(e));case"ass":return(0,p.vttToBlob)((0,p.assToVtt)(e));case"vtt":return(0,p.vttToBlob)(e);default:return d.url}}).then(t=>(h.innerHTML="",this.url===t||(URL.revokeObjectURL(this.url),this.createTrack("metadata",t),this.art.emit("subtitleSwitch",t)),t)).catch(t=>{throw u.show=t,t})}}y.default=l},{"./utils":"5yYFo","./utils/component":"5MLcx","option-validator":"eaJBf","./scheme":"3izFE","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9oLaG":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils/error"),m=M("./clickInit"),D=T.interopDefault(m),_=M("./hoverInit"),g=T.interopDefault(_),o=M("./mousemoveInit"),r=T.interopDefault(o),l=M("./resizeInit"),n=T.interopDefault(l),d=M("./gestureInit"),u=T.interopDefault(d),h=M("./viewInit"),t=T.interopDefault(h);y.default=class{constructor(e){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),e.whitelist.state&&((0,D.default)(e,this),(0,g.default)(e,this),(0,r.default)(e,this),(0,n.default)(e,this),(0,u.default)(e,this),(0,t.default)(e,this))}proxy(e,s,i,f={}){if(Array.isArray(s))return s.map(a=>this.proxy(e,a,i,f));e.addEventListener(s,i,f);const c=()=>e.removeEventListener(s,i,f);return this.destroyEvents.push(c),c}hover(e,s,i){s&&this.proxy(e,"mouseenter",s),i&&this.proxy(e,"mouseleave",i)}loadImg(e){return new Promise((s,i)=>{let f;if(e instanceof HTMLImageElement)f=e;else{if(typeof e!="string")return i(new p.ArtPlayerError("Unable to get Image"));f=new Image,f.src=e}if(f.complete)return s(f);this.proxy(f,"load",()=>s(f)),this.proxy(f,"error",()=>i(new p.ArtPlayerError(`Failed to load Image: ${f.src}`)))})}destroy(){for(let e=0;e<this.destroyEvents.length;e++)this.destroyEvents[e]()}}},{"../utils/error":"kNZvP","./clickInit":"hrnqi","./hoverInit":"eIqcL","./mousemoveInit":"hEy8X","./resizeInit":"9c8lQ","./gestureInit":"gzHdo","./viewInit":"cJlT5","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hrnqi:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p,m){const{constructor:D,template:{$player:_,$video:g}}=p;m.proxy(document,["click","contextmenu"],r=>{(0,T.includeFromEvent)(r,_)?(p.isInput=r.target.tagName==="INPUT",p.isFocus=!0,p.emit("focus")):(p.isInput=!1,p.isFocus=!1,p.emit("blur"))});let o=0;m.proxy(g,"click",()=>{const r=Date.now();r-o<=D.DB_CLICE_TIME?(p.emit("dblclick"),T.isMobile?p.isLock||p.toggle():p.fullscreen=!p.fullscreen):(p.emit("click"),T.isMobile||p.toggle()),o=r})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eIqcL:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p,m){const{$player:D}=p.template;m.hover(D,()=>{(0,T.addClass)(D,"art-hover"),p.emit("hover",!0)},()=>{(0,T.removeClass)(D,"art-hover"),p.emit("hover",!1)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hEy8X:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T,p){const{$player:m}=T.template;p.proxy(m,"mousemove",D=>{T.emit("mousemove",D)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9c8lQ":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p,m){const{option:D}=p,_=(0,T.throttle)(()=>{p.normalSize&&(p.autoSize=D.autoSize),p.aspectRatioReset=!0,p.notice.show="",p.emit("resize")},p.constructor.RESIZE_TIME);m.proxy(window,["orientationchange","resize"],()=>{_()}),screen&&screen.orientation&&screen.orientation.onchange&&m.proxy(screen.orientation,"change",()=>{_()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gzHdo:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p,m){if(T.isMobile&&!p.option.isLive){const{$video:D,$bottom:_,$controls:g}=p.template;let o=!1,r=0,l=0,n=0;const d=t=>{if(t.touches.length===1&&!p.isLock){o=!0;const{clientX:e,clientY:s}=t.touches[0];r=e,l=s,n=p.currentTime}},u=t=>{if(t.touches.length===1&&o&&p.duration){const e=p.plugins.autoOrientation&&p.plugins.autoOrientation.state,{clientX:s,clientY:i}=t.touches[0],f=(0,T.clamp)((s-r)/p.width,-1,1),c=(0,T.clamp)((i-l)/p.height,-1,1),a=e?c:f,v=(0,T.clamp)(n+p.duration*a*p.constructor.TOUCH_MOVE_RATIO,0,p.duration);p.seek=v,p.emit("setBar","played",(0,T.clamp)(v/p.duration,0,1)),p.notice.show=`${(0,T.secondToTime)(v)} / ${(0,T.secondToTime)(p.duration)}`}},h=()=>{o&&(r=0,l=0,n=0,o=!1)};m.proxy(_,"touchstart",t=>{(0,T.includeFromEvent)(t,g)||d(t)}),m.proxy(_,"touchmove",u),m.proxy(D,"touchstart",d),m.proxy(D,"touchmove",u),m.proxy(document,"touchend",h)}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cJlT5:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p,m){const{option:D,constructor:_,template:{$container:g}}=p,o=(0,T.throttle)(()=>{p.emit("view",(0,T.isInViewport)(g,_.SCROLL_GAP))},_.SCROLL_TIME);m.proxy(window,"scroll",()=>{o()}),p.on("view",r=>{D.autoMini&&(p.mini=!r)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cKO4X:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("./utils");y.default=class{constructor(p){this.art=p,this.keys={},p.option.hotkey&&!T.isMobile&&this.init()}init(){const{proxy:p}=this.art.events;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=5}),this.add(38,()=>{this.art.volume+=.1}),this.add(39,()=>{this.art.forward=5}),this.add(40,()=>{this.art.volume-=.1}),p(window,"keydown",m=>{if(this.art.isFocus){const D=document.activeElement.tagName.toUpperCase(),_=document.activeElement.getAttribute("contenteditable");if(D!=="INPUT"&&D!=="TEXTAREA"&&_!==""&&_!=="true"){const g=this.keys[m.keyCode];if(g){m.preventDefault();for(let o=0;o<g.length;o++)g[o].call(this.art,m);this.art.emit("hotkey",m)}}}})}add(p,m){return this.keys[p]?this.keys[p].push(m):this.keys[p]=[m],this}remove(p,m){if(this.keys[p]){const D=this.keys[p].indexOf(m);D!==-1&&this.keys[p].splice(D,1)}return this}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kZD92:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./utils/component"),m=T.interopDefault(p);class D extends m.default{constructor(g){super(g);const{option:o,template:{$layer:r}}=g;this.name="layer",this.$parent=r;for(let l=0;l<o.layers.length;l++)this.add(o.layers[l])}}y.default=D},{"./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],c9b9e:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./utils"),m=M("./utils/component"),D=T.interopDefault(m);class _ extends D.default{constructor(o){super(o),this.name="loading",(0,p.append)(o.template.$loading,o.icons.loading)}}y.default=_},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],SxQeL:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("./utils");y.default=class{constructor(p){this.art=p,this.timer=null}set show(p){const{constructor:m,template:{$player:D,$noticeInner:_}}=this.art;p?(_.innerText=p instanceof Error?p.message.trim():p,(0,T.addClass)(D,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{_.innerText="",(0,T.removeClass)(D,"art-notice-show")},m.NOTICE_TIME)):(0,T.removeClass)(D,"art-notice-show")}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aJ0dF:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./utils"),m=M("./utils/component"),D=T.interopDefault(m);class _ extends D.default{constructor(o){super(o),this.name="mask";const{template:r,icons:l,events:n}=o,d=(0,p.append)(r.$state,l.state),u=(0,p.append)(r.$state,l.error);(0,p.setStyle)(u,"display","none"),o.on("destroy",()=>{(0,p.setStyle)(d,"display","none"),(0,p.setStyle)(u,"display",null)}),n.proxy(r.$state,"click",()=>o.play())}}y.default=_},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jx1Wu:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils"),m=M("bundle-text:./loading.svg"),D=T.interopDefault(m),_=M("bundle-text:./state.svg"),g=T.interopDefault(_),o=M("bundle-text:./check.svg"),r=T.interopDefault(o),l=M("bundle-text:./play.svg"),n=T.interopDefault(l),d=M("bundle-text:./pause.svg"),u=T.interopDefault(d),h=M("bundle-text:./volume.svg"),t=T.interopDefault(h),e=M("bundle-text:./volume-close.svg"),s=T.interopDefault(e),i=M("bundle-text:./screenshot.svg"),f=T.interopDefault(i),c=M("bundle-text:./setting.svg"),a=T.interopDefault(c),v=M("bundle-text:./arrow-left.svg"),S=T.interopDefault(v),x=M("bundle-text:./arrow-right.svg"),E=T.interopDefault(x),L=M("bundle-text:./playback-rate.svg"),b=T.interopDefault(L),A=M("bundle-text:./aspect-ratio.svg"),O=T.interopDefault(A),R=M("bundle-text:./config.svg"),I=T.interopDefault(R),C=M("bundle-text:./pip.svg"),F=T.interopDefault(C),w=M("bundle-text:./lock.svg"),k=T.interopDefault(w),B=M("bundle-text:./unlock.svg"),U=T.interopDefault(B),N=M("bundle-text:./fullscreen-off.svg"),j=T.interopDefault(N),K=M("bundle-text:./fullscreen-on.svg"),V=T.interopDefault(K),H=M("bundle-text:./fullscreen-web-off.svg"),Y=T.interopDefault(H),q=M("bundle-text:./fullscreen-web-on.svg"),$=T.interopDefault(q),G=M("bundle-text:./switch-on.svg"),re=T.interopDefault(G),Q=M("bundle-text:./switch-off.svg"),ee=T.interopDefault(Q),se=M("bundle-text:./flip.svg"),ae=T.interopDefault(se),oe=M("bundle-text:./error.svg"),fe=T.interopDefault(oe),te=M("bundle-text:./close.svg"),le=T.interopDefault(te),de=M("bundle-text:./airplay.svg"),ce=T.interopDefault(de);y.default=class{constructor(he){const ve={loading:D.default,state:g.default,play:n.default,pause:u.default,check:r.default,volume:t.default,volumeClose:s.default,screenshot:f.default,setting:a.default,pip:F.default,arrowLeft:S.default,arrowRight:E.default,playbackRate:b.default,aspectRatio:O.default,config:I.default,lock:k.default,flip:ae.default,unlock:U.default,fullscreenOff:j.default,fullscreenOn:V.default,fullscreenWebOff:Y.default,fullscreenWebOn:$.default,switchOn:re.default,switchOff:ee.default,error:fe.default,close:le.default,airplay:ce.default,...he.option.icons};Object.keys(ve).forEach(me=>{(0,p.def)(this,me,{get:()=>{const ue=(0,p.createElement)("i");return(0,p.addClass)(ue,"art-icon"),(0,p.addClass)(ue,`art-icon-${me}`),(0,p.append)(ue,ve[me]),ue}})})}}},{"../utils":"5yYFo","bundle-text:./loading.svg":"gFMCI","bundle-text:./state.svg":"iYMJD","bundle-text:./check.svg":"hyrDV","bundle-text:./play.svg":"eZys6","bundle-text:./pause.svg":"hITjK","bundle-text:./volume.svg":"hNNiX","bundle-text:./volume-close.svg":"dC2M2","bundle-text:./screenshot.svg":"9hKk0","bundle-text:./setting.svg":"47p50","bundle-text:./arrow-left.svg":"5je49","bundle-text:./arrow-right.svg":"2HKZ5","bundle-text:./playback-rate.svg":"hdBpQ","bundle-text:./aspect-ratio.svg":"alUG1","bundle-text:./config.svg":"6B4Bn","bundle-text:./pip.svg":"2Ya1d","bundle-text:./lock.svg":"5Bna4","bundle-text:./unlock.svg":"daCyz","bundle-text:./fullscreen-off.svg":"bx7Yh","bundle-text:./fullscreen-on.svg":"fxY8n","bundle-text:./fullscreen-web-off.svg":"96euD","bundle-text:./fullscreen-web-on.svg":"ccnBB","bundle-text:./switch-on.svg":"26OlL","bundle-text:./switch-off.svg":"i0DjT","bundle-text:./flip.svg":"hdfqR","bundle-text:./error.svg":"9sWnY","bundle-text:./close.svg":"hxSqS","bundle-text:./airplay.svg":"52Tr6","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gFMCI:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],iYMJD:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],hyrDV:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],eZys6:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],hITjK:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],hNNiX:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],dC2M2:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"9hKk0":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"47p50":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],"5je49":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],"2HKZ5":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],hdBpQ:[function(M,P,y){P.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],alUG1:[function(M,P,y){P.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],"6B4Bn":[function(M,P,y){P.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2Ya1d":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],"5Bna4":[function(M,P,y){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],daCyz:[function(M,P,y){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bx7Yh:[function(M,P,y){P.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fxY8n:[function(M,P,y){P.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],"96euD":[function(M,P,y){P.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],ccnBB:[function(M,P,y){P.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"26OlL":[function(M,P,y){P.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],i0DjT:[function(M,P,y){P.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],hdfqR:[function(M,P,y){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9sWnY":[function(M,P,y){P.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],hxSqS:[function(M,P,y){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],"52Tr6":[function(M,P,y){P.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],hdF39:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./flip"),m=T.interopDefault(p),D=M("./aspectRatio"),_=T.interopDefault(D),g=M("./playbackRate"),o=T.interopDefault(g),r=M("./subtitleOffset"),l=T.interopDefault(r),n=M("../utils/component"),d=T.interopDefault(n),u=M("../utils");function h(s,i,f){for(let c=0;c<s.length;c++){const a=s[c];a.$parentItem=i,a.$parentList=f,a.selector&&h(a.selector,a,s)}return s}function t(s){return["string","number"].includes(typeof s)}class e extends d.default{constructor(i){super(i);const{option:f,events:{proxy:c},template:{$setting:a,$player:v}}=i;if(this.name="setting",this.$parent=a,this.option=[],this.events=[],this.cache=new Map,f.setting){f.playbackRate&&this.option.push((0,o.default)(i)),f.aspectRatio&&this.option.push((0,_.default)(i)),f.flip&&this.option.push((0,m.default)(i)),f.subtitleOffset&&this.option.push((0,l.default)(i));for(let S=0;S<f.settings.length;S++)this.option.push(f.settings[S]);this.option=h(this.option),this.init(this.option),i.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),c(v,"click",S=>{!this.show||(0,u.includeFromEvent)(S,i.controls.setting)||(0,u.includeFromEvent)(S,this.$parent)||(this.show=!1,this.init(this.option))})}}add(i){typeof i=="function"?this.option.push(i(this.art)):this.option.push(i),this.cache=new Map,this.events.forEach(f=>f()),this.events=[],this.$parent.innerHTML="",this.option=h(this.option),this.init(this.option)}creatHeader(i){const{icons:f,events:{proxy:c}}=this.art,a=(0,u.createElement)("div");(0,u.addClass)(a,"art-setting-item"),(0,u.addClass)(a,"art-setting-item-back");const v=(0,u.append)(a,'<div class="art-setting-item-left"></div>'),S=(0,u.createElement)("div");(0,u.addClass)(S,"art-setting-item-left-icon"),(0,u.append)(S,f.arrowLeft),(0,u.append)(v,S),(0,u.append)(v,i.$parentItem.html);const x=c(a,"click",()=>{this.init(i.$parentList)});return this.events.push(x),a}creatItem(i,f){const{icons:c,events:{proxy:a}}=this.art,v=(0,u.createElement)("div");(0,u.addClass)(v,"art-setting-item"),t(f.name)&&(v.dataset.name=f.name),t(f.value)&&(v.dataset.value=f.value);const S=(0,u.append)(v,'<div class="art-setting-item-left"></div>'),x=(0,u.append)(v,'<div class="art-setting-item-right"></div>'),E=(0,u.createElement)("div");switch((0,u.addClass)(E,"art-setting-item-left-icon"),i){case"switch":case"range":(0,u.append)(E,t(f.icon)||f.icon instanceof Element?f.icon:c.config);break;case"selector":f.selector&&f.selector.length?(0,u.append)(E,t(f.icon)||f.icon instanceof Element?f.icon:c.config):(0,u.append)(E,c.check)}(0,u.append)(S,E),f.$icon=E,(0,u.def)(f,"icon",{configurable:!0,get:()=>E.innerHTML,set(A){t(A)&&(E.innerHTML=A)}});const L=(0,u.createElement)("div");(0,u.addClass)(L,"art-setting-item-left-text"),(0,u.append)(L,f.html||""),(0,u.append)(S,L),f.$html=L,(0,u.def)(f,"html",{configurable:!0,get:()=>L.innerHTML,set(A){t(A)&&(L.innerHTML=A)}});const b=(0,u.createElement)("div");switch((0,u.addClass)(b,"art-setting-item-right-tooltip"),(0,u.append)(b,f.tooltip||""),(0,u.append)(x,b),f.$tooltip=b,(0,u.def)(f,"tooltip",{configurable:!0,get:()=>b.innerHTML,set(A){t(A)&&(b.innerHTML=A)}}),i){case"switch":{const A=(0,u.createElement)("div");(0,u.addClass)(A,"art-setting-item-right-icon");const O=(0,u.append)(A,c.switchOn),R=(0,u.append)(A,c.switchOff);(0,u.setStyle)(f.switch?R:O,"display","none"),(0,u.append)(x,A),f.$switch=f.switch,(0,u.def)(f,"switch",{configurable:!0,get:()=>f.$switch,set(I){f.$switch=I,I?((0,u.setStyle)(R,"display","none"),(0,u.setStyle)(O,"display",null)):((0,u.setStyle)(R,"display",null),(0,u.setStyle)(O,"display","none"))}});break}case"range":{const A=(0,u.createElement)("div");(0,u.addClass)(A,"art-setting-item-right-icon");const O=(0,u.append)(A,'<input type="range">');O.value=f.range[0]||0,O.min=f.range[1]||0,O.max=f.range[2]||10,O.step=f.range[3]||1,(0,u.addClass)(O,"art-setting-range"),(0,u.append)(x,A),f.$range=O,(0,u.def)(f,"range",{configurable:!0,get:()=>O.valueAsNumber,set(R){O.value=Number(R)}})}break;case"selector":if(f.selector&&f.selector.length){const A=(0,u.createElement)("div");(0,u.addClass)(A,"art-setting-item-right-icon"),(0,u.append)(A,c.arrowRight),(0,u.append)(x,A)}}switch(i){case"switch":if(f.onSwitch){const A=a(v,"click",async O=>{f.switch=await f.onSwitch.call(this.art,f,v,O)});this.events.push(A)}break;case"range":if(f.onRange&&f.$range){const A=a(f.$range,"change",async O=>{f.tooltip=await f.onRange.call(this.art,f,v,O)});this.events.push(A)}break;case"selector":{const A=a(v,"click",async O=>{if(f.selector&&f.selector.length)this.init(f.selector,f.width);else if((0,u.inverseClass)(v,"art-current"),f.$parentList&&this.init(f.$parentList),f.$parentItem&&f.$parentItem.onSelect){const R=await f.$parentItem.onSelect.call(this.art,f,v,O);f.$parentItem.$tooltip&&t(R)&&(f.$parentItem.$tooltip.innerHTML=R)}});this.events.push(A),f.default&&(0,u.addClass)(v,"art-current")}}return v}init(i,f){const{constructor:c}=this.art;if(this.cache.has(i)){const a=this.cache.get(i);(0,u.inverseClass)(a,"art-current"),(0,u.setStyle)(this.$parent,"width",`${a.dataset.width}px`),(0,u.setStyle)(this.$parent,"height",`${a.dataset.height}px`)}else{const a=(0,u.createElement)("div");(0,u.addClass)(a,"art-setting-panel"),a.dataset.width=f||c.SETTING_WIDTH,a.dataset.height=i.length*c.SETTING_ITEM_HEIGHT,i[0]&&i[0].$parentItem&&((0,u.append)(a,this.creatHeader(i[0])),a.dataset.height=Number(a.dataset.height)+c.SETTING_ITEM_HEIGHT);for(let v=0;v<i.length;v++){const S=i[v];(0,u.has)(S,"switch")?(0,u.append)(a,this.creatItem("switch",S)):(0,u.has)(S,"range")?(0,u.append)(a,this.creatItem("range",S)):(0,u.append)(a,this.creatItem("selector",S))}(0,u.append)(this.$parent,a),this.cache.set(i,a),(0,u.inverseClass)(a,"art-current"),(0,u.setStyle)(this.$parent,"width",`${a.dataset.width}px`),(0,u.setStyle)(this.$parent,"height",`${a.dataset.height}px`),i[0]&&i[0].$parentItem&&i[0].$parentItem.mounted&&i[0].$parentItem.mounted.call(this.art,a,i[0].$parentItem)}}}y.default=e},{"./flip":"eyzeE","./aspectRatio":"jTfLi","./playbackRate":"aowja","./subtitleOffset":"aPjJK","../utils/component":"5MLcx","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eyzeE:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,icons:D,constructor:_}=p,g={normal:"Normal",horizontal:"Horizontal",vertical:"Vertical"};function o(r,l,n){l&&(l.innerText=m.get(g[n]));const d=(0,T.queryAll)(".art-setting-item",r).find(u=>u.dataset.value===n);d&&(0,T.inverseClass)(d,"art-current")}return{width:_.SETTING_ITEM_WIDTH,html:m.get("Video Flip"),tooltip:m.get(g[p.flip]),icon:D.flip,selector:Object.keys(g).map(r=>({value:r,default:r===p.flip,html:m.get(g[r])})),onSelect(r){p.flip=r.value},mounted:(r,l)=>{o(r,l.$tooltip,p.flip),p.on("flip",()=>{o(r,l.$tooltip,p.flip)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jTfLi:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,icons:D,constructor:_}=p;function g(r){return r==="default"?m.get("Default"):r}function o(r,l,n){l&&(l.innerText=g(n));const d=(0,T.queryAll)(".art-setting-item",r).find(u=>u.dataset.value===n);d&&(0,T.inverseClass)(d,"art-current")}return{width:_.SETTING_ITEM_WIDTH,html:m.get("Aspect Ratio"),icon:D.aspectRatio,tooltip:g(p.aspectRatio),selector:["default","4:3","16:9"].map(r=>({value:r,default:r===p.aspectRatio,html:g(r)})),onSelect(r){p.aspectRatio=r.value},mounted:(r,l)=>{o(r,l.$tooltip,p.aspectRatio),p.on("aspectRatio",()=>{o(r,l.$tooltip,p.aspectRatio)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aowja:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,icons:D,constructor:_}=p;function g(r){return r===1?m.get("Normal"):r}function o(r,l,n){l&&(l.innerText=g(n));const d=(0,T.queryAll)(".art-setting-item",r).find(u=>Number(u.dataset.value)===n);d&&(0,T.inverseClass)(d,"art-current")}return{width:_.SETTING_ITEM_WIDTH,html:m.get("Play Speed"),tooltip:g(p.playbackRate),icon:D.playbackRate,selector:[.5,.75,1,1.25,1.5,2].map(r=>({value:r,default:r===p.playbackRate,html:g(r)})),onSelect(r){p.playbackRate=r.value},mounted:(r,l)=>{o(r,l.$tooltip,p.playbackRate),p.on("playbackRate",()=>{o(r,l.$tooltip,p.playbackRate)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aPjJK:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,icons:D,constructor:_}=p;function g(r){return r===0?m.get("Normal"):r}function o(r,l,n){l&&(l.innerText=g(n));const d=(0,T.queryAll)(".art-setting-item",r).find(u=>Number(u.dataset.value)===n);d&&(0,T.inverseClass)(d,"art-current")}return{width:_.SETTING_ITEM_WIDTH,html:m.get("Subtitle Offset"),tooltip:g(p.subtitleOffset),icon:D.subtitle,selector:[-5,-4,-3,-2,-1,0,1,2,3,4,5].map(r=>({value:r,default:r===p.subtitleOffset,html:g(r)})),onSelect(r){p.subtitleOffset=r.value},mounted:(r,l)=>{o(r,l.$tooltip,p.subtitleOffset),p.on("subtitleOffset",()=>{o(r,l.$tooltip,p.subtitleOffset)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bCcu0:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(T){try{const p=JSON.parse(window.localStorage.getItem(this.name))||{};return T?p[T]:p}catch{return T?this.settings[T]:this.settings}}set(T,p){try{const m=Object.assign({},this.get(),{[T]:p});window.localStorage.setItem(this.name,JSON.stringify(m))}catch{this.settings[T]=p}}del(T){try{const p=this.get();delete p[T],window.localStorage.setItem(this.name,JSON.stringify(p))}catch{delete this.settings[T]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1v13t":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("../utils"),m=M("./miniProgressBar"),D=T.interopDefault(m),_=M("./autoOrientation"),g=T.interopDefault(_),o=M("./autoPlayback"),r=T.interopDefault(o),l=M("./fastForward"),n=T.interopDefault(l),d=M("./lock"),u=T.interopDefault(d);y.default=class{constructor(h){this.art=h,this.id=0;const{option:t}=h;t.miniProgressBar&&!t.isLive&&this.add(D.default),t.lock&&p.isMobile&&this.add(u.default),t.autoPlayback&&!t.isLive&&this.add(r.default),t.autoOrientation&&p.isMobile&&this.add(g.default),t.fastForward&&p.isMobile&&!t.isLive&&this.add(n.default);for(let e=0;e<t.plugins.length;e++)this.add(t.plugins[e])}add(h){this.id+=1;const t=h.call(this,this.art),e=t&&t.name||h.name||`plugin${this.id}`;return(0,p.errorHandle)(!(0,p.has)(this,e),`Cannot add a plugin that already has the same name: ${e}`),(0,p.def)(this,e,{value:t}),this}}},{"../utils":"5yYFo","./miniProgressBar":"2h4YZ","./autoOrientation":"bcdCk","./autoPlayback":"1nHHC","./fastForward":"4gkmX","./lock":"ij5nM","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"2h4YZ":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function(T){return T.on("ready",()=>{T.layers.add({name:"miniProgressBar",mounted(p){T.on("destroy",()=>{p.style.display="none"}),T.on("video:timeupdate",()=>{p.style.width=100*T.played+"%"}),T.on("setBar",(m,D)=>{m==="played"&&(p.style.width=100*D+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bcdCk:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{option:m,constructor:D,template:{$player:_,$video:g}}=p;return p.on("fullscreenWeb",o=>{if(o){const{videoWidth:r,videoHeight:l}=g,{clientWidth:n,clientHeight:d}=document.documentElement;(r>l&&n<d||r<l&&n>d)&&setTimeout(()=>{(0,T.setStyle)(_,"width",`${d}px`),(0,T.setStyle)(_,"height",`${n}px`),(0,T.setStyle)(_,"transform-origin","0 0"),(0,T.setStyle)(_,"transform",`rotate(90deg) translate(0, -${n}px)`),(0,T.addClass)(_,"art-auto-orientation"),p.emit("resize")},D.MOBILE_AUTO_ORIENTATION_TIME)}else(0,T.hasClass)(_,"art-auto-orientation")&&((0,T.setStyle)(_,"width",null),(0,T.setStyle)(_,"height",null),(0,T.setStyle)(_,"transform",null),(0,T.setStyle)(_,"transform-origin",null),(0,T.removeClass)(_,"art-auto-orientation"),p.aspectRatioReset=!0,p.autoSize=m.autoSize,p.notice.show="",p.emit("resize"))}),p.on("fullscreen",async o=>{const r=screen.orientation.type;if(o){const{videoWidth:l,videoHeight:n}=g,{clientWidth:d,clientHeight:u}=document.documentElement;if(l>n&&d<u||l<n&&d>u){const h=r.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(h),(0,T.addClass)(_,"art-auto-orientation-fullscreen")}}else(0,T.hasClass)(_,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(r),(0,T.removeClass)(_,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,T.hasClass)(_,"art-auto-orientation")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1nHHC":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{i18n:m,icons:D,storage:_,constructor:g,events:{proxy:o},template:{$poster:r}}=p,l=p.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),n=(0,T.query)(".art-autoPlayback-last",l),d=(0,T.query)(".art-autoPlayback-jump",l),u=(0,T.query)(".art-autoPlayback-close",l);return p.on("video:timeupdate",()=>{const h=_.get("times")||{},t=Object.keys(h);t.length>g.AUTO_PLAYBACK_MAX&&delete h[t[0]],h[p.option.id||p.option.url]=p.currentTime,_.set("times",h)}),p.on("ready",()=>{const h=(_.get("times")||{})[p.option.id||p.option.url];h&&h>=g.AUTO_PLAYBACK_MIN&&((0,T.append)(u,D.close),(0,T.setStyle)(l,"display","flex"),n.innerText=`${m.get("Last Seen")} ${(0,T.secondToTime)(h)}`,d.innerText=m.get("Jump Play"),o(u,"click",()=>{(0,T.setStyle)(l,"display","none")}),o(d,"click",()=>{p.seek=h,p.play(),(0,T.setStyle)(r,"display","none"),(0,T.setStyle)(l,"display","none")}),p.once("video:timeupdate",()=>{setTimeout(()=>{(0,T.setStyle)(l,"display","none")},g.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return _.get("times")||{}},clear:()=>_.del("times"),delete(h){const t=_.get("times")||{};return delete t[h],_.set("times",t),t}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4gkmX":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{constructor:m,events:{proxy:D},template:{$player:_,$video:g}}=p;let o=null,r=!1;const l=()=>{clearTimeout(o),r&&(r=!1,p.playbackRate=1,(0,T.removeClass)(_,"art-fast-forward"))};return D(g,"touchstart",n=>{n.touches.length===1&&p.playing&&!p.isLock&&(o=setTimeout(()=>{r=!0,p.playbackRate=m.FAST_FORWARD_VALUE,(0,T.addClass)(_,"art-fast-forward")},m.FAST_FORWARD_TIME))}),D(document,"touchmove",l),D(document,"touchend",l),{name:"fastForward",get state(){return(0,T.hasClass)(_,"art-fast-forward")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ij5nM:[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y);var T=M("../utils");y.default=function(p){const{layers:m,icons:D,template:{$player:_}}=p;return m.add({name:"lock",mounted(g){const o=(0,T.append)(g,D.lock),r=(0,T.append)(g,D.unlock);(0,T.setStyle)(o,"display","none"),p.on("lock",l=>{l?((0,T.setStyle)(o,"display","inline-flex"),(0,T.setStyle)(r,"display","none")):((0,T.setStyle)(o,"display","none"),(0,T.setStyle)(r,"display","inline-flex"))})},click(){(0,T.hasClass)(_,"art-lock")?((0,T.removeClass)(_,"art-lock"),this.isLock=!1,p.emit("lock",!1)):((0,T.addClass)(_,"art-lock"),this.isLock=!0,p.emit("lock",!0))}}),{name:"lock",get state(){return(0,T.hasClass)(_,"art-lock")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eD5Ch:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./config"),m=T.interopDefault(p),D=M("./utils");y.default=class{constructor(_){const{option:g,events:{proxy:o},template:{$video:r}}=_;for(let d=0;d<m.default.events.length;d++)o(r,m.default.events[d],u=>{_.emit(`video:${u.type}`,u)});Object.keys(g.moreVideoAttr).forEach(d=>{r[d]=g.moreVideoAttr[d]}),g.muted&&(r.muted=g.muted),g.volume&&(r.volume=(0,D.clamp)(g.volume,0,1)),g.poster&&(r.poster=g.poster),g.autoplay&&(r.autoplay=g.autoplay),g.playsInline&&(r.playsInline=!0,r["webkit-playsinline"]=!0);const l=g.type||(0,D.getExt)(g.url),n=g.customType[l];l&&n?(n(r,g.url,_),_.emit("customType",l)):(r.src=g.url,_.emit("url",r.src))}}},{"./config":"ej4fZ","./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}]},["E13ST"],"E13ST")})(ze);const Et=Fe(ze.exports);var Ye={exports:{}};/*!
 * artplayer-plugin-danmuku.js v4.4.10
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(Ee,Re){(function(M,P,y,T,p){var m=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Pe<"u"?Pe:{},D=typeof m.parcelRequire93cf=="function"&&m.parcelRequire93cf,_=D.cache||{},g=typeof we=="function"&&we.bind(Ee);function o(n,d){if(!_[n]){if(!M[n]){var u=typeof m.parcelRequire93cf=="function"&&m.parcelRequire93cf;if(!d&&u)return u(n,!0);if(D)return D(n,!0);if(g&&typeof n=="string")return g(n);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}e.resolve=function(s){var i=M[n][1][s];return i!=null?i:s},e.cache={};var t=_[n]=new o.Module(n);M[n][0].call(t.exports,e,t,t.exports,this)}return _[n].exports;function e(s){var i=e.resolve(s);return i===!1?{}:o(i)}}o.isParcelRequire=!0,o.Module=function(n){this.id=n,this.bundle=o,this.exports={}},o.modules=M,o.cache=_,o.parent=D,o.register=function(n,d){M[n]=[function(u,h){h.exports=d},{}]},Object.defineProperty(o,"root",{get:function(){return m.parcelRequire93cf}}),m.parcelRequire93cf=o;for(var r=0;r<P.length;r++)o(P[r]);var l=o(y);Ee.exports=l})({E13ST:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./danmuku"),m=T.interopDefault(p),D=M("./setting"),_=T.interopDefault(D);function g(o){return r=>{(function(n){const{version:d,utils:{errorHandle:u}}=n.constructor,h=d.split(".").map(Number);u(h[0]+h[1]/100>=4.04,`Artplayer.js@${d} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 4.4.x \u7248\u672C\u4EE5\u4E0A`)})(r);const l=new m.default(r,o);return(0,_.default)(r,l),{name:"artplayerPluginDanmuku",emit:l.emit.bind(l),load:l.load.bind(l),config:l.config.bind(l),hide:l.hide.bind(l),show:l.show.bind(l),reset:l.reset.bind(l),get option(){return l.option},get isHide(){return l.isHide},get isStop(){return l.isStop}}}}y.default=g,g.env="production",g.version="4.4.10",g.build="1663552936745",typeof window<"u"&&(window.artplayerPluginDanmuku=g)},{"./danmuku":"8Gtnh","./setting":"jAkJm","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"8Gtnh":[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("./bilibili"),m=M("./getDanmuTop"),D=T.interopDefault(m);class _{constructor(o,r){const{constructor:l,template:n}=o;if(this.utils=l.utils,this.validator=l.validator,this.$danmuku=n.$danmuku,this.$player=n.$player,this.art=o,this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(r),this.option.useWorker)try{this.worker=new Worker(M("27c3930ee158179a"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),o.on("video:play",this.start),o.on("video:playing",this.start),o.on("video:pause",this.stop),o.on("video:waiting",this.stop),o.on("fullscreen",this.reset),o.on("fullscreenWeb",this.reset),o.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:o}=this.utils,r=this.option.margin[0],{clientHeight:l}=this.$player;return typeof r=="number"?o(r,0,l):typeof r=="string"&&r.endsWith("%")?o(l*(parseFloat(r)/100),0,l):_.option.margin[0]}get marginBottom(){const{clamp:o}=this.utils,r=this.option.margin[1],{clientHeight:l}=this.$player;return typeof r=="number"?o(r,0,l):typeof r=="string"&&r.endsWith("%")?o(l*(parseFloat(r)/100),0,l):_.option.margin[1]}filter(o,r){return this.queue.filter(l=>l.$state===o).map(r)}getLeft(o){const r=o.getBoundingClientRect();return this.isRotate?r.top:r.left}getRef(){const o=this.$refs.pop();if(o)return o;const r=document.createElement("div");return r.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,r}getReady(){const{currentTime:o}=this.art;return this.queue.filter(r=>r.$state==="ready"||r.$state==="wait"&&o+.1>=r.time&&r.time>=o-.1)}getEmits(){const o=[],{clientWidth:r}=this.$player,l=this.getLeft(this.$player);return this.filter("emit",n=>{const d=n.$ref.offsetTop,u=this.getLeft(n.$ref)-l,h=n.$ref.clientHeight,t=n.$ref.clientWidth,e=u+t,s=r-e,i=e/n.$restTime,f={};f.top=d,f.left=u,f.height=h,f.width=t,f.right=s,f.speed=i,f.distance=e,f.time=n.$restTime,f.mode=n.mode,o.push(f)}),o}getFontSize(o){const{clamp:r}=this.utils,{clientHeight:l}=this.$player;return typeof o=="number"?r(o,12,l):typeof o=="string"&&o.endsWith("%")?r(l*(parseFloat(o)/100),12,l):_.option.fontSize}postMessage(o={}){return new Promise(r=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)o.id=Date.now(),this.worker.postMessage(o),this.worker.onmessage=l=>{const{data:n}=l;n.id===o.id&&r(n)};else{const l=(0,D.default)(o);r({top:l})}})}async load(){try{let o=[];o=typeof this.option.danmuku=="function"?await this.option.danmuku():typeof this.option.danmuku.then=="function"?await this.option.danmuku:typeof this.option.danmuku=="string"?await(0,p.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.option.danmuku,this.utils.errorHandle(Array.isArray(o),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",o),this.queue=[],this.$danmuku.innerText="",o.forEach(r=>this.emit(r))}catch(o){throw this.art.emit("artplayerPluginDanmuku:error",o),o}return this}config(o){const{clamp:r}=this.utils;return this.option=Object.assign({},_.option,this.option,o),this.validator(this.option,_.scheme),this.option.speed=r(this.option.speed,1,10),this.option.opacity=r(this.option.opacity,0,1),this.option.lockTime=r(Math.floor(this.option.lockTime),0,60),this.option.maxLength=r(this.option.maxLength,0,500),this.option.minWidth=r(this.option.minWidth,0,500),this.option.maxWidth=r(this.option.maxWidth,0,1/0),o.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(o){o.$state="wait",o.$ref&&(o.$ref.style.visibility="hidden",o.$ref.style.marginLeft="0px",o.$ref.style.transform="translateX(0px)",o.$ref.style.transition="transform 0s linear 0s",this.$refs.push(o.$ref),o.$ref=null)}continue(){const{clientWidth:o}=this.$player;return this.filter("stop",r=>{switch(r.$state="emit",r.$lastStartTime=Date.now(),r.mode){case 0:{const l=o+r.$ref.clientWidth;r.$ref.style.transform=`translateX(${-l}px)`,r.$ref.style.transition=`transform ${r.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:o}=this.$player;return this.filter("emit",r=>{switch(r.$state="stop",r.mode){case 0:{const l=o-(this.getLeft(r.$ref)-this.getLeft(this.$player));r.$ref.style.transform=`translateX(${-l}px)`,r.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(o=>this.makeWait(o)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",n=>{const d=(Date.now()-n.$lastStartTime)/1e3;n.$restTime-=d,n.$lastStartTime=Date.now(),n.$restTime<=0&&this.makeWait(n)});const o=this.getReady(),{clientWidth:r,clientHeight:l}=this.$player;for(let n=0;n<o.length;n++){const d=o[n];d.$ref=this.getRef(),d.$ref.innerText=d.text,this.$danmuku.appendChild(d.$ref),d.$ref.style.left=`${r}px`,d.$ref.style.opacity=this.option.opacity,d.$ref.style.fontSize=`${this.option.fontSize}px`,d.$ref.style.color=d.color,d.$ref.style.border=d.border?`1px solid ${d.color}`:null,d.$ref.style.backgroundColor=d.border?"rgb(0 0 0 / 50%)":null,d.$ref.style.marginLeft="0px",d.$lastStartTime=Date.now(),d.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const u={mode:d.mode,height:d.$ref.clientHeight,speed:(r+d.$ref.clientWidth)/d.$restTime},{top:h}=await this.postMessage({target:u,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:r,clientHeight:l,marginBottom:this.marginBottom,marginTop:this.marginTop});if(d.$ref)if(this.isStop||h===void 0)d.$state="ready",this.$refs.push(d.$ref),d.$ref=null;else switch(d.$state="emit",d.$ref.style.visibility="visible",d.mode){case 0:{d.$ref.style.top=`${h}px`;const t=r+d.$ref.clientWidth;d.$ref.style.transform=`translateX(${-t}px)`,d.$ref.style.transition=`transform ${d.$restTime}s linear 0s`;break}case 1:d.$ref.style.left="50%",d.$ref.style.top=`${h}px`,d.$ref.style.marginLeft=`-${d.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(o=>this.makeWait(o)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(o){return this.validator(o,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),o.text.trim()&&this.option.filter(o)?(o.time?o.time=this.utils.clamp(o.time,0,1/0):o.time=this.art.currentTime+.5,o.mode===void 0&&(o.mode=this.option.mode),o.color===void 0&&(o.color=this.option.color),this.queue.push({...o,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("fullscreen",this.reset),this.art.off("fullscreenWeb",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}y.default=_},{"./bilibili":"KnwDr","./getDanmuTop":"2Abxf","27c3930ee158179a":"anHwN","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],KnwDr:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");function p(_){switch(_){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function m(_){if(typeof _!="string")return[];const g=_.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(g).map(o=>{const r=o.groups.p.split(",");return r.length>=8?{text:o.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(r[0]),mode:p(Number(r[1])),fontSize:Number(r[2]),color:`#${Number(r[3]).toString(16)}`,timestamp:Number(r[4]),pool:Number(r[5]),userID:r[6],rowID:Number(r[7])}:null}).filter(Boolean)}function D(_){return fetch(_).then(g=>g.text()).then(g=>m(g))}T.defineInteropFlag(y),T.export(y,"getMode",()=>p),T.export(y,"bilibiliDanmuParseFromXml",()=>m),T.export(y,"bilibiliDanmuParseFromUrl",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"9v6Cv":[function(M,P,y){y.interopDefault=function(T){return T&&T.__esModule?T:{default:T}},y.defineInteropFlag=function(T){Object.defineProperty(T,"__esModule",{value:!0})},y.exportAll=function(T,p){return Object.keys(T).forEach(function(m){m==="default"||m==="__esModule"||p.hasOwnProperty(m)||Object.defineProperty(p,m,{enumerable:!0,get:function(){return T[m]}})}),p},y.export=function(T,p,m){Object.defineProperty(T,p,{enumerable:!0,get:m})}},{}],"2Abxf":[function(M,P,y){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(y),y.default=function({target:T,emits:p,clientWidth:m,clientHeight:D,marginBottom:_,marginTop:g,antiOverlap:o}){const r=p.filter(n=>n.mode===T.mode&&n.top<=D-_).sort((n,d)=>n.top-d.top);if(r.length===0)return g;r.unshift({top:0,left:0,right:0,height:g,width:m,speed:0,distance:m}),r.push({top:D-_,left:0,right:0,height:_,width:m,speed:0,distance:m});for(let n=1;n<r.length;n+=1){const d=r[n],u=r[n-1],h=u.top+u.height;if(d.top-h>=T.height)return h}const l=[];for(let n=1;n<r.length-1;n+=1){const d=r[n];if(l.length){const u=l[l.length-1];u[0].top===d.top?u.push(d):l.push([d])}else l.push([d])}if(!o){switch(T.mode){case 0:l.sort((n,d)=>{const u=Math.min(...d.map(t=>t.right)),h=Math.min(...n.map(t=>t.right));return u*d.length-h*n.length});break;case 1:l.sort((n,d)=>{const u=Math.max(...d.map(h=>h.width));return Math.max(...n.map(h=>h.width))*n.length-u*d.length})}return l[0][0].top}switch(T.mode){case 0:{const n=l.find(d=>d.every(u=>m<u.distance?!1:T.speed<u.speed?!0:u.right/(T.speed-u.speed)>u.time));return n&&n[0]?n[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],anHwN:[function(M,P,y){P.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],jAkJm:[function(M,P,y){var T=M("@parcel/transformer-js/src/esmodule-helpers.js");T.defineInteropFlag(y);var p=M("bundle-text:./style.less"),m=T.interopDefault(p),D=M("bundle-text:./img/danmu-on.svg"),_=T.interopDefault(D),g=M("bundle-text:./img/danmu-off.svg"),o=T.interopDefault(g),r=M("bundle-text:./img/danmu-config.svg"),l=T.interopDefault(r),n=M("bundle-text:./img/danmu-style.svg"),d=T.interopDefault(n);if(y.default=function(u,h){const{option:t}=h,{template:{$controlsCenter:e,$player:s},constructor:{utils:{removeClass:i,addClass:f,append:c,setStyle:a,tooltip:v,query:S,inverseClass:x}}}=u;function E(R,I){const C=document.createElement("i");return c(C,R),f(C,"art-icon"),f(C,`art-icon-${I}`),C}const L=E(_.default,"danmu-on"),b=E(o.default,"danmu-off"),A=E(l.default,"danmu-config"),O=E(d.default,"danmu-style");(function(){const R=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map($=>`<div class="art-danmuku-style-panel-color${t.color===$?" art-current":""}" data-color="${$}" style="background-color:${$}"></div>`),I=c(e,`<div class="art-danmuku-emitter" style="max-width: ${t.maxWidth?`${t.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${R.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${t.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),C=S(".art-danmuku-style",I),F=S(".art-danmuku-input",I),w=S(".art-danmuku-send",I),k=S(".art-danmuku-style-panel-inner",I),B=S(".art-danmuku-style-panel-modes",I),U=S(".art-danmuku-style-panel-colors",I),N=t.mount||c(s,'<div class="art-layer-danmuku-emitter"></div>');u.option.backdrop&&f(k,"art-backdrop-filter"),t.theme&&f(I,`art-danmuku-theme-${t.theme}`);let j=null,K=t.mode,V=t.color;function H($){$<=0?(j=null,w.innerText="\u53D1\u9001",i(w,"art-disabled")):(w.innerText=$,j=setTimeout(()=>H($-1),1e3))}function Y(){const $={mode:K,color:V,border:!0,text:F.value.trim()};j===null&&t.beforeEmit($)&&(F.value="",h.emit($),f(w,"art-disabled"),H(t.lockTime),u.emit("artplayerPluginDanmuku:emit",$))}function q(){e.clientWidth<t.minWidth?(c(N,I),a(N,"display","flex"),f(I,"art-danmuku-mount"),t.mount||a(s,"marginBottom","40px")):(c(e,I),a(N,"display","none"),i(I,"art-danmuku-mount"),t.mount||a(s,"marginBottom",null))}c(C,O),u.proxy(w,"click",Y),u.proxy(F,"keypress",$=>{$.key==="Enter"&&($.preventDefault(),Y())}),u.proxy(B,"click",$=>{const{dataset:G}=$.target;G.mode&&(K=Number(G.mode),x($.target,"art-current"))}),u.proxy(U,"click",$=>{const{dataset:G}=$.target;G.color&&(V=G.color,x($.target,"art-current"))}),q(),u.on("resize",q),u.on("destroy",()=>{t.mount&&I.parentElement===t.mount&&t.mount.removeChild(I)})})(),u.controls.add({position:"right",name:"danmuku",click:function(){h.isHide?(h.show(),u.notice.show="\u5F39\u5E55\u663E\u793A",a(L,"display",null),a(b,"display","none")):(h.hide(),u.notice.show="\u5F39\u5E55\u9690\u85CF",a(L,"display","none"),a(b,"display",null))},mounted(R){c(R,L),c(R,b),v(R,"\u5F39\u5E55\u5F00\u5173"),a(b,"display","none")}}),u.setting.add({name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:A,selector:[{width:200,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(R){return h.config({speed:R.time}),R.html}},{width:200,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(R){return h.config({fontSize:R.fontSize}),R.html}},{width:200,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(R){return h.config({opacity:R.opacity}),R.html}},{width:200,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(R){return h.config({margin:R.margin}),R.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:t.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:t.antiOverlap,onSwitch:R=>(h.config({antiOverlap:!R.switch}),R.tooltip=R.switch?"\u5173\u95ED":"\u5F00\u542F",!R.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:t.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:t.synchronousPlayback,onSwitch:R=>(h.config({synchronousPlayback:!R.switch}),R.tooltip=R.switch?"\u5173\u95ED":"\u5F00\u542F",!R.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const u=document.createElement("style");u.id="artplayer-plugin-danmuku",u.textContent=m.default,document.head.appendChild(u)}},{"bundle-text:./style.less":"chNhY","bundle-text:./img/danmu-on.svg":"j5M2a","bundle-text:./img/danmu-off.svg":"d9WLf","bundle-text:./img/danmu-config.svg":"8Y3Ij","bundle-text:./img/danmu-style.svg":"hltwt","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],chNhY:[function(M,P,y){P.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;color:#fff;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#ffffff4d;border-radius:3px;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter *,.art-danmuku-emitter :before,.art-danmuku-emitter :after{box-sizing:border-box;margin:0;padding:0}.art-danmuku-emitter .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-danmuku-emitter .art-icon svg{fill:#fff}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 3px 3px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{height:34px;max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],j5M2a:[function(M,P,y){P.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],d9WLf:[function(M,P,y){P.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"8Y3Ij":[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],hltwt:[function(M,P,y){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}]},["E13ST"],"E13ST")})(Ye);const xt=Fe(Ye.exports);var Xe={exports:{}};(function(Ee,Re){(function(P,y){Ee.exports=y()})(self,function(){return function(){var M={"./node_modules/es6-promise/dist/es6-promise.js":function(p,m,D){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(_,g){p.exports=g()})(this,function(){function _(W){var z=typeof W;return W!==null&&(z==="object"||z==="function")}function g(W){return typeof W=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(W){return Object.prototype.toString.call(W)==="[object Array]"};var r=o,l=0,n=void 0,d=void 0,u=function(z,X){L[l]=z,L[l+1]=X,l+=2,l===2&&(d?d(b):O())};function h(W){d=W}function t(W){u=W}var e=typeof window<"u"?window:void 0,s=e||{},i=s.MutationObserver||s.WebKitMutationObserver,f=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",c=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function a(){return function(){return process.nextTick(b)}}function v(){return typeof n<"u"?function(){n(b)}:E()}function S(){var W=0,z=new i(b),X=document.createTextNode("");return z.observe(X,{characterData:!0}),function(){X.data=W=++W%2}}function x(){var W=new MessageChannel;return W.port1.onmessage=b,function(){return W.port2.postMessage(0)}}function E(){var W=setTimeout;return function(){return W(b,1)}}var L=new Array(1e3);function b(){for(var W=0;W<l;W+=2){var z=L[W],X=L[W+1];z(X),L[W]=void 0,L[W+1]=void 0}l=0}function A(){try{var W=Function("return this")().require("vertx");return n=W.runOnLoop||W.runOnContext,v()}catch{return E()}}var O=void 0;f?O=a():i?O=S():c?O=x():e===void 0?O=A():O=E();function R(W,z){var X=this,J=new this.constructor(F);J[C]===void 0&&fe(J);var ie=X._state;if(ie){var ne=arguments[ie-1];u(function(){return ee(ie,J,ne,X._result)})}else re(X,J,W,z);return J}function I(W){var z=this;if(W&&typeof W=="object"&&W.constructor===z)return W;var X=new z(F);return Y(X,W),X}var C=Math.random().toString(36).substring(2);function F(){}var w=void 0,k=1,B=2;function U(){return new TypeError("You cannot resolve a promise with itself")}function N(){return new TypeError("A promises callback cannot return that same promise.")}function j(W,z,X,J){try{W.call(z,X,J)}catch(ie){return ie}}function K(W,z,X){u(function(J){var ie=!1,ne=j(X,z,function(Z){ie||(ie=!0,z!==Z?Y(J,Z):$(J,Z))},function(Z){ie||(ie=!0,G(J,Z))},"Settle: "+(J._label||" unknown promise"));!ie&&ne&&(ie=!0,G(J,ne))},W)}function V(W,z){z._state===k?$(W,z._result):z._state===B?G(W,z._result):re(z,void 0,function(X){return Y(W,X)},function(X){return G(W,X)})}function H(W,z,X){z.constructor===W.constructor&&X===R&&z.constructor.resolve===I?V(W,z):X===void 0?$(W,z):g(X)?K(W,z,X):$(W,z)}function Y(W,z){if(W===z)G(W,U());else if(_(z)){var X=void 0;try{X=z.then}catch(J){G(W,J);return}H(W,z,X)}else $(W,z)}function q(W){W._onerror&&W._onerror(W._result),Q(W)}function $(W,z){W._state===w&&(W._result=z,W._state=k,W._subscribers.length!==0&&u(Q,W))}function G(W,z){W._state===w&&(W._state=B,W._result=z,u(q,W))}function re(W,z,X,J){var ie=W._subscribers,ne=ie.length;W._onerror=null,ie[ne]=z,ie[ne+k]=X,ie[ne+B]=J,ne===0&&W._state&&u(Q,W)}function Q(W){var z=W._subscribers,X=W._state;if(z.length!==0){for(var J=void 0,ie=void 0,ne=W._result,Z=0;Z<z.length;Z+=3)J=z[Z],ie=z[Z+X],J?ee(X,J,ie,ne):ie(ne);W._subscribers.length=0}}function ee(W,z,X,J){var ie=g(X),ne=void 0,Z=void 0,pe=!0;if(ie){try{ne=X(J)}catch(ye){pe=!1,Z=ye}if(z===ne){G(z,N());return}}else ne=J;z._state!==w||(ie&&pe?Y(z,ne):pe===!1?G(z,Z):W===k?$(z,ne):W===B&&G(z,ne))}function se(W,z){try{z(function(J){Y(W,J)},function(J){G(W,J)})}catch(X){G(W,X)}}var ae=0;function oe(){return ae++}function fe(W){W[C]=ae++,W._state=void 0,W._result=void 0,W._subscribers=[]}function te(){return new Error("Array Methods must be provided an Array")}var le=function(){function W(z,X){this._instanceConstructor=z,this.promise=new z(F),this.promise[C]||fe(this.promise),r(X)?(this.length=X.length,this._remaining=X.length,this._result=new Array(this.length),this.length===0?$(this.promise,this._result):(this.length=this.length||0,this._enumerate(X),this._remaining===0&&$(this.promise,this._result))):G(this.promise,te())}return W.prototype._enumerate=function(X){for(var J=0;this._state===w&&J<X.length;J++)this._eachEntry(X[J],J)},W.prototype._eachEntry=function(X,J){var ie=this._instanceConstructor,ne=ie.resolve;if(ne===I){var Z=void 0,pe=void 0,ye=!1;try{Z=X.then}catch(_e){ye=!0,pe=_e}if(Z===R&&X._state!==w)this._settledAt(X._state,J,X._result);else if(typeof Z!="function")this._remaining--,this._result[J]=X;else if(ie===ue){var xe=new ie(F);ye?G(xe,pe):H(xe,X,Z),this._willSettleAt(xe,J)}else this._willSettleAt(new ie(function(_e){return _e(X)}),J)}else this._willSettleAt(ne(X),J)},W.prototype._settledAt=function(X,J,ie){var ne=this.promise;ne._state===w&&(this._remaining--,X===B?G(ne,ie):this._result[J]=ie),this._remaining===0&&$(ne,this._result)},W.prototype._willSettleAt=function(X,J){var ie=this;re(X,void 0,function(ne){return ie._settledAt(k,J,ne)},function(ne){return ie._settledAt(B,J,ne)})},W}();function de(W){return new le(this,W).promise}function ce(W){var z=this;return r(W)?new z(function(X,J){for(var ie=W.length,ne=0;ne<ie;ne++)z.resolve(W[ne]).then(X,J)}):new z(function(X,J){return J(new TypeError("You must pass an array to race."))})}function he(W){var z=this,X=new z(F);return G(X,W),X}function ve(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function me(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ue=function(){function W(z){this[C]=oe(),this._result=this._state=void 0,this._subscribers=[],F!==z&&(typeof z!="function"&&ve(),this instanceof W?se(this,z):me())}return W.prototype.catch=function(X){return this.then(null,X)},W.prototype.finally=function(X){var J=this,ie=J.constructor;return g(X)?J.then(function(ne){return ie.resolve(X()).then(function(){return ne})},function(ne){return ie.resolve(X()).then(function(){throw ne})}):J.then(X,X)},W}();ue.prototype.then=R,ue.all=de,ue.race=ce,ue.resolve=I,ue.reject=he,ue._setScheduler=h,ue._setAsap=t,ue._asap=u;function ge(){var W=void 0;if(typeof D.g<"u")W=D.g;else if(typeof self<"u")W=self;else try{W=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var z=W.Promise;if(z){var X=null;try{X=Object.prototype.toString.call(z.resolve())}catch{}if(X==="[object Promise]"&&!z.cast)return}W.Promise=ue}return ue.polyfill=ge,ue.Promise=ue,ue})},"./node_modules/events/events.js":function(p){var m=typeof Reflect=="object"?Reflect:null,D=m&&typeof m.apply=="function"?m.apply:function(E,L,b){return Function.prototype.apply.call(E,L,b)},_;m&&typeof m.ownKeys=="function"?_=m.ownKeys:Object.getOwnPropertySymbols?_=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:_=function(E){return Object.getOwnPropertyNames(E)};function g(x){console&&console.warn&&console.warn(x)}var o=Number.isNaN||function(E){return E!==E};function r(){r.init.call(this)}p.exports=r,p.exports.once=a,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var l=10;function n(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(x){if(typeof x!="number"||x<0||o(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");l=x}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||o(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function d(x){return x._maxListeners===void 0?r.defaultMaxListeners:x._maxListeners}r.prototype.getMaxListeners=function(){return d(this)},r.prototype.emit=function(E){for(var L=[],b=1;b<arguments.length;b++)L.push(arguments[b]);var A=E==="error",O=this._events;if(O!==void 0)A=A&&O.error===void 0;else if(!A)return!1;if(A){var R;if(L.length>0&&(R=L[0]),R instanceof Error)throw R;var I=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw I.context=R,I}var C=O[E];if(C===void 0)return!1;if(typeof C=="function")D(C,this,L);else for(var F=C.length,w=i(C,F),b=0;b<F;++b)D(w[b],this,L);return!0};function u(x,E,L,b){var A,O,R;if(n(L),O=x._events,O===void 0?(O=x._events=Object.create(null),x._eventsCount=0):(O.newListener!==void 0&&(x.emit("newListener",E,L.listener?L.listener:L),O=x._events),R=O[E]),R===void 0)R=O[E]=L,++x._eventsCount;else if(typeof R=="function"?R=O[E]=b?[L,R]:[R,L]:b?R.unshift(L):R.push(L),A=d(x),A>0&&R.length>A&&!R.warned){R.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=x,I.type=E,I.count=R.length,g(I)}return x}r.prototype.addListener=function(E,L){return u(this,E,L,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(E,L){return u(this,E,L,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(x,E,L){var b={fired:!1,wrapFn:void 0,target:x,type:E,listener:L},A=h.bind(b);return A.listener=L,b.wrapFn=A,A}r.prototype.once=function(E,L){return n(L),this.on(E,t(this,E,L)),this},r.prototype.prependOnceListener=function(E,L){return n(L),this.prependListener(E,t(this,E,L)),this},r.prototype.removeListener=function(E,L){var b,A,O,R,I;if(n(L),A=this._events,A===void 0)return this;if(b=A[E],b===void 0)return this;if(b===L||b.listener===L)--this._eventsCount===0?this._events=Object.create(null):(delete A[E],A.removeListener&&this.emit("removeListener",E,b.listener||L));else if(typeof b!="function"){for(O=-1,R=b.length-1;R>=0;R--)if(b[R]===L||b[R].listener===L){I=b[R].listener,O=R;break}if(O<0)return this;O===0?b.shift():f(b,O),b.length===1&&(A[E]=b[0]),A.removeListener!==void 0&&this.emit("removeListener",E,I||L)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(E){var L,b,A;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[E]),this;if(arguments.length===0){var O=Object.keys(b),R;for(A=0;A<O.length;++A)R=O[A],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(L=b[E],typeof L=="function")this.removeListener(E,L);else if(L!==void 0)for(A=L.length-1;A>=0;A--)this.removeListener(E,L[A]);return this};function e(x,E,L){var b=x._events;if(b===void 0)return[];var A=b[E];return A===void 0?[]:typeof A=="function"?L?[A.listener||A]:[A]:L?c(A):i(A,A.length)}r.prototype.listeners=function(E){return e(this,E,!0)},r.prototype.rawListeners=function(E){return e(this,E,!1)},r.listenerCount=function(x,E){return typeof x.listenerCount=="function"?x.listenerCount(E):s.call(x,E)},r.prototype.listenerCount=s;function s(x){var E=this._events;if(E!==void 0){var L=E[x];if(typeof L=="function")return 1;if(L!==void 0)return L.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function i(x,E){for(var L=new Array(E),b=0;b<E;++b)L[b]=x[b];return L}function f(x,E){for(;E+1<x.length;E++)x[E]=x[E+1];x.pop()}function c(x){for(var E=new Array(x.length),L=0;L<E.length;++L)E[L]=x[L].listener||x[L];return E}function a(x,E){return new Promise(function(L,b){function A(R){x.removeListener(E,O),b(R)}function O(){typeof x.removeListener=="function"&&x.removeListener("error",A),L([].slice.call(arguments))}S(x,E,O,{once:!0}),E!=="error"&&v(x,A,{once:!0})})}function v(x,E,L){typeof x.on=="function"&&S(x,"error",E,L)}function S(x,E,L,b){if(typeof x.on=="function")b.once?x.once(E,L):x.on(E,L);else if(typeof x.addEventListener=="function")x.addEventListener(E,function A(O){b.once&&x.removeEventListener(E,A),L(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}},"./node_modules/webworkify-webpack/index.js":function(p,m,D){function _(h){var t={};function e(i){if(t[i])return t[i].exports;var f=t[i]={i,l:!1,exports:{}};return h[i].call(f.exports,f,f.exports,e),f.l=!0,f.exports}e.m=h,e.c=t,e.i=function(i){return i},e.d=function(i,f,c){e.o(i,f)||Object.defineProperty(i,f,{configurable:!1,enumerable:!0,get:c})},e.r=function(i){Object.defineProperty(i,"__esModule",{value:!0})},e.n=function(i){var f=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(f,"a",f),f},e.o=function(i,f){return Object.prototype.hasOwnProperty.call(i,f)},e.p="/",e.oe=function(i){throw console.error(i),i};var s=e(e.s=ENTRY_MODULE);return s.default||s}var g="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+g+").*?\\)";function r(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function l(h){return!isNaN(1*h)}function n(h,t,e){var s={};s[e]=[];var i=t.toString(),f=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!f)return s;for(var c=f[1],a=new RegExp("(\\\\n|\\W)"+r(c)+o,"g"),v;v=a.exec(i);)v[3]!=="dll-reference"&&s[e].push(v[3]);for(a=new RegExp("\\("+r(c)+'\\("(dll-reference\\s('+g+'))"\\)\\)'+o,"g");v=a.exec(i);)h[v[2]]||(s[e].push(v[1]),h[v[2]]=D(v[1]).m),s[v[2]]=s[v[2]]||[],s[v[2]].push(v[4]);for(var S=Object.keys(s),x=0;x<S.length;x++)for(var E=0;E<s[S[x]].length;E++)l(s[S[x]][E])&&(s[S[x]][E]=1*s[S[x]][E]);return s}function d(h){var t=Object.keys(h);return t.reduce(function(e,s){return e||h[s].length>0},!1)}function u(h,t){for(var e={main:[t]},s={main:[]},i={main:{}};d(e);)for(var f=Object.keys(e),c=0;c<f.length;c++){var a=f[c],v=e[a],S=v.pop();if(i[a]=i[a]||{},!(i[a][S]||!h[a][S])){i[a][S]=!0,s[a]=s[a]||[],s[a].push(S);for(var x=n(h,h[a][S],a),E=Object.keys(x),L=0;L<E.length;L++)e[E[L]]=e[E[L]]||[],e[E[L]]=e[E[L]].concat(x[E[L]])}}return s}p.exports=function(h,t){t=t||{};var e={main:D.m},s=t.all?{main:Object.keys(e.main)}:u(e,h),i="";Object.keys(s).filter(function(S){return S!=="main"}).forEach(function(S){for(var x=0;s[S][x];)x++;s[S].push(x),e[S][x]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+S+" = ("+_.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+s[S].map(function(E){return""+JSON.stringify(E)+": "+e[S][E].toString()}).join(",")+`});
`}),i=i+"new (("+_.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+s.main.map(function(S){return""+JSON.stringify(S)+": "+e.main[S].toString()}).join(",")+"}))(self);";var f=new window.Blob([i],{type:"text/javascript"});if(t.bare)return f;var c=window.URL||window.webkitURL||window.mozURL||window.msURL,a=c.createObjectURL(f),v=new window.Worker(a);return v.objectURL=a,v}},"./src/config.js":function(p,m,D){D.r(m),D.d(m,{defaultConfig:function(){return _},createDefaultConfig:function(){return g}});var _={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function g(){return Object.assign({},_)}},"./src/core/features.js":function(p,m,D){D.r(m);var _=D("./src/io/io-controller.js"),g=D("./src/config.js"),o=function(){function r(){}return r.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},r.supportNetworkStreamIO=function(){var l=new _.default({},(0,g.createDefaultConfig)()),n=l.loaderType;return l.destroy(),n=="fetch-stream-loader"||n=="xhr-moz-chunked-loader"},r.getNetworkLoaderTypeName=function(){var l=new _.default({},(0,g.createDefaultConfig)()),n=l.loaderType;return l.destroy(),n},r.supportNativeMediaPlayback=function(l){r.videoElement==null&&(r.videoElement=window.document.createElement("video"));var n=r.videoElement.canPlayType(l);return n==="probably"||n=="maybe"},r.getFeatureList=function(){var l={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return l.mseFlvPlayback=r.supportMSEH264Playback(),l.networkStreamIO=r.supportNetworkStreamIO(),l.networkLoaderName=r.getNetworkLoaderTypeName(),l.mseLiveFlvPlayback=l.mseFlvPlayback&&l.networkStreamIO,l.nativeMP4H264Playback=r.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),l.nativeWebmVP8Playback=r.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),l.nativeWebmVP9Playback=r.supportNativeMediaPlayback('video/webm; codecs="vp9"'),l},r}();m.default=o},"./src/core/media-info.js":function(p,m,D){D.r(m);var _=function(){function g(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return g.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,r=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&r},g.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},g.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var r=this.keyframesIndex,l=this._search(r.times,o);return{index:l,milliseconds:r.times[l],fileposition:r.filepositions[l]}},g.prototype._search=function(o,r){var l=0,n=o.length-1,d=0,u=0,h=n;for(r<o[0]&&(l=0,u=h+1);u<=h;)if(d=u+Math.floor((h-u)/2),d===n||r>=o[d]&&r<o[d+1]){l=d;break}else o[d]<r?u=d+1:h=d-1;return l},g}();m.default=_},"./src/core/media-segment-info.js":function(p,m,D){D.r(m),D.d(m,{SampleInfo:function(){return _},MediaSegmentInfo:function(){return g},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return r}});var _=function(){function l(n,d,u,h,t){this.dts=n,this.pts=d,this.duration=u,this.originalDts=h,this.isSyncPoint=t,this.fileposition=null}return l}(),g=function(){function l(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return l.prototype.appendSyncPoint=function(n){n.isSyncPoint=!0,this.syncPoints.push(n)},l}(),o=function(){function l(){this._list=[]}return l.prototype.clear=function(){this._list=[]},l.prototype.appendArray=function(n){var d=this._list;n.length!==0&&(d.length>0&&n[0].originalDts<d[d.length-1].originalDts&&this.clear(),Array.prototype.push.apply(d,n))},l.prototype.getLastSyncPointBeforeDts=function(n){if(this._list.length==0)return null;var d=this._list,u=0,h=d.length-1,t=0,e=0,s=h;for(n<d[0].dts&&(u=0,e=s+1);e<=s;)if(t=e+Math.floor((s-e)/2),t===h||n>=d[t].dts&&n<d[t+1].dts){u=t;break}else d[t].dts<n?e=t+1:s=t-1;return this._list[u]},l}(),r=function(){function l(n){this._type=n,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),l.prototype.isEmpty=function(){return this._list.length===0},l.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},l.prototype._searchNearestSegmentBefore=function(n){var d=this._list;if(d.length===0)return-2;var u=d.length-1,h=0,t=0,e=u,s=0;if(n<d[0].originalBeginDts)return s=-1,s;for(;t<=e;)if(h=t+Math.floor((e-t)/2),h===u||n>d[h].lastSample.originalDts&&n<d[h+1].originalBeginDts){s=h;break}else d[h].originalBeginDts<n?t=h+1:e=h-1;return s},l.prototype._searchNearestSegmentAfter=function(n){return this._searchNearestSegmentBefore(n)+1},l.prototype.append=function(n){var d=this._list,u=n,h=this._lastAppendLocation,t=0;h!==-1&&h<d.length&&u.originalBeginDts>=d[h].lastSample.originalDts&&(h===d.length-1||h<d.length-1&&u.originalBeginDts<d[h+1].originalBeginDts)?t=h+1:d.length>0&&(t=this._searchNearestSegmentBefore(u.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,u)},l.prototype.getLastSegmentBefore=function(n){var d=this._searchNearestSegmentBefore(n);return d>=0?this._list[d]:null},l.prototype.getLastSampleBefore=function(n){var d=this.getLastSegmentBefore(n);return d!=null?d.lastSample:null},l.prototype.getLastSyncPointBefore=function(n){for(var d=this._searchNearestSegmentBefore(n),u=this._list[d].syncPoints;u.length===0&&d>0;)d--,u=this._list[d].syncPoints;return u.length>0?u[u.length-1]:null},l}()},"./src/core/mse-controller.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./src/utils/logger.js"),r=D("./src/utils/browser.js"),l=D("./src/core/mse-events.js"),n=D("./src/core/media-segment-info.js"),d=D("./src/utils/exception.js"),u=function(){function h(t){this.TAG="MSEController",this._config=t,this._emitter=new(g()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new n.IDRSampleList}return h.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(t,e){this._emitter.addListener(t,e)},h.prototype.off=function(t,e){this._emitter.removeListener(t,e)},h.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new d.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},h.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var s=this._pendingSegments[e];s.splice(0,s.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var i=this._sourceBuffers[e];if(i){if(t.readyState!=="closed"){try{t.removeSourceBuffer(i)}catch(f){o.default.e(this.TAG,f.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(f){o.default.e(this.TAG,f.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},h.prototype.appendInitSegment=function(t,e){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var s=t,i=""+s.container;s.codec&&s.codec.length>0&&(i+=";codecs="+s.codec);var f=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[s.type]=s,i!==this._mimeTypes[s.type]){if(this._mimeTypes[s.type])o.default.v(this.TAG,"Notice: "+s.type+" mimeType changed, origin: "+this._mimeTypes[s.type]+", target: "+i);else{f=!0;try{var c=this._sourceBuffers[s.type]=this._mediaSource.addSourceBuffer(i);c.addEventListener("error",this.e.onSourceBufferError),c.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(a){o.default.e(this.TAG,a.message),this._emitter.emit(l.default.ERROR,{code:a.code,msg:a.message});return}}this._mimeTypes[s.type]=i}e||this._pendingSegments[s.type].push(s),f||this._sourceBuffers[s.type]&&!this._sourceBuffers[s.type].updating&&this._doAppendSegments(),r.default.safari&&s.container==="audio/mpeg"&&s.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=s.mediaDuration/1e3,this._updateMediaSourceDuration())},h.prototype.appendMediaSegment=function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var s=this._sourceBuffers[e.type];s&&!s.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},h.prototype.seek=function(t){for(var e in this._sourceBuffers)if(!!this._sourceBuffers[e]){var s=this._sourceBuffers[e];if(this._mediaSource.readyState==="open")try{s.abort()}catch(S){o.default.e(this.TAG,S.message)}this._idrList.clear();var i=this._pendingSegments[e];if(i.splice(0,i.length),this._mediaSource.readyState!=="closed"){for(var f=0;f<s.buffered.length;f++){var c=s.buffered.start(f),a=s.buffered.end(f);this._pendingRemoveRanges[e].push({start:c,end:a})}if(s.updating||this._doRemoveRanges(),r.default.safari){var v=this._lastInitSegments[e];v&&(this._pendingSegments[e].push(v),s.updating||this._doAppendSegments())}}}},h.prototype.endOfStream=function(){var t=this._mediaSource,e=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},h.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},h.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var s=this._sourceBuffers[e];if(s){var i=s.buffered;if(i.length>=1&&t-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},h.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var s=this._sourceBuffers[e];if(s){for(var i=s.buffered,f=!1,c=0;c<i.length;c++){var a=i.start(c),v=i.end(c);if(a<=t&&t<v+3){if(t-a>=this._config.autoCleanupMaxBackwardDuration){f=!0;var S=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:a,end:S})}}else v<t&&(f=!0,this._pendingRemoveRanges[e].push({start:a,end:v}))}f&&!s.updating&&this._doRemoveRanges()}}},h.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,s=this._pendingMediaDuration;s>0&&(isNaN(e)||s>e)&&(o.default.v(this.TAG,"Update MediaSource duration from "+e+" to "+s),this._mediaSource.duration=s),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},h.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var e=this._sourceBuffers[t],s=this._pendingRemoveRanges[t];s.length&&!e.updating;){var i=s.shift();e.remove(i.start,i.end)}},h.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var e in t)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating)&&t[e].length>0){var s=t[e].shift();if(s.timestampOffset){var i=this._sourceBuffers[e].timestampOffset,f=s.timestampOffset/1e3,c=Math.abs(i-f);c>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+f),this._sourceBuffers[e].timestampOffset=f),delete s.timestampOffset}if(!s.data||s.data.byteLength===0)continue;try{this._sourceBuffers[e].appendBuffer(s.data),this._isBufferFull=!1,e==="video"&&s.hasOwnProperty("info")&&this._idrList.appendArray(s.info.syncPoints)}catch(a){this._pendingSegments[e].unshift(s),a.code===22?(this._isBufferFull||this._emitter.emit(l.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,a.message),this._emitter.emit(l.default.ERROR,{code:a.code,msg:a.message}))}}},h.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(l.default.SOURCE_OPEN)},h.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},h.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},h.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},h.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},h.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(l.default.UPDATE_END)},h.prototype._onSourceBufferError=function(t){o.default.e(this.TAG,"SourceBuffer Error: "+t)},h}();m.default=u},"./src/core/mse-events.js":function(p,m,D){D.r(m);var _={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=_},"./src/core/transmuxer.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./node_modules/webworkify-webpack/index.js"),r=D.n(o),l=D("./src/utils/logger.js"),n=D("./src/utils/logging-control.js"),d=D("./src/core/transmuxing-controller.js"),u=D("./src/core/transmuxing-events.js"),h=D("./src/core/media-info.js"),t=function(){function e(s,i){if(this.TAG="Transmuxer",this._emitter=new(g()),i.enableWorker&&typeof Worker<"u")try{this._worker=r()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[s,i]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},n.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:n.default.getConfig()})}catch{l.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new d.default(s,i)}else this._controller=new d.default(s,i);if(this._controller){var f=this._controller;f.on(u.default.IO_ERROR,this._onIOError.bind(this)),f.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),f.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),f.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),f.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),f.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),f.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),f.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),f.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),f.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),f.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),n.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(s,i){this._emitter.addListener(s,i)},e.prototype.off=function(s,i){this._emitter.removeListener(s,i)},e.prototype.hasWorker=function(){return this._worker!=null},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(s){this._worker?this._worker.postMessage({cmd:"seek",param:s}):this._controller.seek(s)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(s,i){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.INIT_SEGMENT,s,i)})},e.prototype._onMediaSegment=function(s,i){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.MEDIA_SEGMENT,s,i)})},e.prototype._onLoadingComplete=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(u.default.LOADING_COMPLETE)})},e.prototype._onRecoveredEarlyEof=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(u.default.RECOVERED_EARLY_EOF)})},e.prototype._onMediaInfo=function(s){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.MEDIA_INFO,s)})},e.prototype._onMetaDataArrived=function(s){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.METADATA_ARRIVED,s)})},e.prototype._onScriptDataArrived=function(s){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.SCRIPTDATA_ARRIVED,s)})},e.prototype._onStatisticsInfo=function(s){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.STATISTICS_INFO,s)})},e.prototype._onIOError=function(s,i){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.IO_ERROR,s,i)})},e.prototype._onDemuxError=function(s,i){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.DEMUX_ERROR,s,i)})},e.prototype._onRecommendSeekpoint=function(s){var i=this;Promise.resolve().then(function(){i._emitter.emit(u.default.RECOMMEND_SEEKPOINT,s)})},e.prototype._onLoggingConfigChanged=function(s){this._worker&&this._worker.postMessage({cmd:"logging_config",param:s})},e.prototype._onWorkerMessage=function(s){var i=s.data,f=i.data;if(i.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(i.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(i.msg,f.type,f.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(i.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(f,h.default.prototype),this._emitter.emit(i.msg,f);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(i.msg,f);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(i.msg,f.type,f.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(i.msg,f);break;case"logcat_callback":l.default.emitter.emit("log",f.type,f.logcat);break}},e}();m.default=t},"./src/core/transmuxing-controller.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./src/utils/logger.js"),r=D("./src/utils/browser.js"),l=D("./src/core/media-info.js"),n=D("./src/demux/flv-demuxer.js"),d=D("./src/remux/mp4-remuxer.js"),u=D("./src/demux/demux-errors.js"),h=D("./src/io/io-controller.js"),t=D("./src/core/transmuxing-events.js"),e=function(){function s(i,f){this.TAG="TransmuxingController",this._emitter=new(g()),this._config=f,i.segments||(i.segments=[{duration:i.duration,filesize:i.filesize,url:i.url}]),typeof i.cors!="boolean"&&(i.cors=!0),typeof i.withCredentials!="boolean"&&(i.withCredentials=!1),this._mediaDataSource=i,this._currentSegmentIndex=0;var c=0;this._mediaDataSource.segments.forEach(function(a){a.timestampBase=c,c+=a.duration,a.cors=i.cors,a.withCredentials=i.withCredentials,f.referrerPolicy&&(a.referrerPolicy=f.referrerPolicy)}),!isNaN(c)&&this._mediaDataSource.duration!==c&&(this._mediaDataSource.duration=c),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return s.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},s.prototype.on=function(i,f){this._emitter.addListener(i,f)},s.prototype.off=function(i,f){this._emitter.removeListener(i,f)},s.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},s.prototype._loadSegment=function(i,f){this._currentSegmentIndex=i;var c=this._mediaDataSource.segments[i],a=this._ioctl=new h.default(c,this._config,i);a.onError=this._onIOException.bind(this),a.onSeeked=this._onIOSeeked.bind(this),a.onComplete=this._onIOComplete.bind(this),a.onRedirect=this._onIORedirect.bind(this),a.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),f?this._demuxer.bindDataSource(this._ioctl):a.onDataArrival=this._onInitChunkArrival.bind(this),a.open(f)},s.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},s.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},s.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},s.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},s.prototype.seek=function(i){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var f=this._searchSegmentIndexContains(i);if(f===this._currentSegmentIndex){var c=this._mediaInfo.segments[f];if(c==null)this._pendingSeekTime=i;else{var a=c.getNearestKeyframe(i);this._remuxer.seek(a.milliseconds),this._ioctl.seek(a.fileposition),this._pendingResolveSeekPoint=a.milliseconds}}else{var v=this._mediaInfo.segments[f];if(v==null)this._pendingSeekTime=i,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(f);else{var a=v.getNearestKeyframe(i);this._internalAbort(),this._remuxer.seek(i),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[f].timestampBase,this._loadSegment(f,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(f)}}this._enableStatisticsReporter()}},s.prototype._searchSegmentIndexContains=function(i){for(var f=this._mediaDataSource.segments,c=f.length-1,a=0;a<f.length;a++)if(i<f[a].timestampBase){c=a-1;break}return c},s.prototype._onInitChunkArrival=function(i,f){var c=this,a=null,v=0;if(f>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,v=this._demuxer.parseChunks(i,f);else if((a=n.default.probe(i)).match){this._demuxer=new n.default(a,this._config),this._remuxer||(this._remuxer=new d.default(this._config));var S=this._mediaDataSource;S.duration!=null&&!isNaN(S.duration)&&(this._demuxer.overridedDuration=S.duration),typeof S.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=S.hasAudio),typeof S.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=S.hasVideo),this._demuxer.timestampBase=S.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),v=this._demuxer.parseChunks(i,f)}else a=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){c._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,u.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),v=0;return v},s.prototype._onMediaInfo=function(i){var f=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},i),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,l.default.prototype));var c=Object.assign({},i);Object.setPrototypeOf(c,l.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=c,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var a=f._pendingSeekTime;f._pendingSeekTime=null,f.seek(a)})},s.prototype._onMetaDataArrived=function(i){this._emitter.emit(t.default.METADATA_ARRIVED,i)},s.prototype._onScriptDataArrived=function(i){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,i)},s.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},s.prototype._onIOComplete=function(i){var f=i,c=f+1;c<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(c)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},s.prototype._onIORedirect=function(i){var f=this._ioctl.extraData;this._mediaDataSource.segments[f].redirectedURL=i},s.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},s.prototype._onIOException=function(i,f){o.default.e(this.TAG,"IOException: type = "+i+", code = "+f.code+", msg = "+f.msg),this._emitter.emit(t.default.IO_ERROR,i,f),this._disableStatisticsReporter()},s.prototype._onDemuxException=function(i,f){o.default.e(this.TAG,"DemuxException: type = "+i+", info = "+f),this._emitter.emit(t.default.DEMUX_ERROR,i,f)},s.prototype._onRemuxerInitSegmentArrival=function(i,f){this._emitter.emit(t.default.INIT_SEGMENT,i,f)},s.prototype._onRemuxerMediaSegmentArrival=function(i,f){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,i,f),this._pendingResolveSeekPoint!=null&&i==="video")){var c=f.info.syncPoints,a=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,r.default.safari&&c.length>0&&c[0].originalDts===a&&(a=c[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,a)}},s.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},s.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},s.prototype._reportSegmentMediaInfo=function(i){var f=this._mediaInfo.segments[i],c=Object.assign({},f);c.duration=this._mediaInfo.duration,c.segmentCount=this._mediaInfo.segmentCount,delete c.segments,delete c.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,c)},s.prototype._reportStatisticsInfo=function(){var i={};i.url=this._ioctl.currentURL,i.hasRedirect=this._ioctl.hasRedirect,i.hasRedirect&&(i.redirectedURL=this._ioctl.currentRedirectedURL),i.speed=this._ioctl.currentSpeed,i.loaderType=this._ioctl.loaderType,i.currentSegmentIndex=this._currentSegmentIndex,i.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,i)},s}();m.default=e},"./src/core/transmuxing-events.js":function(p,m,D){D.r(m);var _={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=_},"./src/core/transmuxing-worker.js":function(p,m,D){D.r(m);var _=D("./src/utils/logging-control.js"),g=D("./src/utils/polyfill.js"),o=D("./src/core/transmuxing-controller.js"),r=D("./src/core/transmuxing-events.js"),l=function(n){var d=null,u=E.bind(this);g.default.install(),n.addEventListener("message",function(L){switch(L.data.cmd){case"init":d=new o.default(L.data.param[0],L.data.param[1]),d.on(r.default.IO_ERROR,v.bind(this)),d.on(r.default.DEMUX_ERROR,S.bind(this)),d.on(r.default.INIT_SEGMENT,h.bind(this)),d.on(r.default.MEDIA_SEGMENT,t.bind(this)),d.on(r.default.LOADING_COMPLETE,e.bind(this)),d.on(r.default.RECOVERED_EARLY_EOF,s.bind(this)),d.on(r.default.MEDIA_INFO,i.bind(this)),d.on(r.default.METADATA_ARRIVED,f.bind(this)),d.on(r.default.SCRIPTDATA_ARRIVED,c.bind(this)),d.on(r.default.STATISTICS_INFO,a.bind(this)),d.on(r.default.RECOMMEND_SEEKPOINT,x.bind(this));break;case"destroy":d&&(d.destroy(),d=null),n.postMessage({msg:"destroyed"});break;case"start":d.start();break;case"stop":d.stop();break;case"seek":d.seek(L.data.param);break;case"pause":d.pause();break;case"resume":d.resume();break;case"logging_config":{var b=L.data.param;_.default.applyConfig(b),b.enableCallback===!0?_.default.addLogListener(u):_.default.removeLogListener(u);break}}});function h(L,b){var A={msg:r.default.INIT_SEGMENT,data:{type:L,data:b}};n.postMessage(A,[b.data])}function t(L,b){var A={msg:r.default.MEDIA_SEGMENT,data:{type:L,data:b}};n.postMessage(A,[b.data])}function e(){var L={msg:r.default.LOADING_COMPLETE};n.postMessage(L)}function s(){var L={msg:r.default.RECOVERED_EARLY_EOF};n.postMessage(L)}function i(L){var b={msg:r.default.MEDIA_INFO,data:L};n.postMessage(b)}function f(L){var b={msg:r.default.METADATA_ARRIVED,data:L};n.postMessage(b)}function c(L){var b={msg:r.default.SCRIPTDATA_ARRIVED,data:L};n.postMessage(b)}function a(L){var b={msg:r.default.STATISTICS_INFO,data:L};n.postMessage(b)}function v(L,b){n.postMessage({msg:r.default.IO_ERROR,data:{type:L,info:b}})}function S(L,b){n.postMessage({msg:r.default.DEMUX_ERROR,data:{type:L,info:b}})}function x(L){n.postMessage({msg:r.default.RECOMMEND_SEEKPOINT,data:L})}function E(L,b){n.postMessage({msg:"logcat_callback",data:{type:L,logcat:b}})}};m.default=l},"./src/demux/amf-parser.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/utils/utf8-conv.js"),o=D("./src/utils/exception.js"),r=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}(),l=function(){function n(){}return n.parseScriptData=function(d,u,h){var t={};try{var e=n.parseValue(d,u,h),s=n.parseValue(d,u+e.size,h-e.size);t[e.data]=s.data}catch(i){_.default.e("AMF",i.toString())}return t},n.parseObject=function(d,u,h){if(h<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var t=n.parseString(d,u,h),e=n.parseValue(d,u+t.size,h-t.size),s=e.objectEnd;return{data:{name:t.data,value:e.data},size:t.size+e.size,objectEnd:s}},n.parseVariable=function(d,u,h){return n.parseObject(d,u,h)},n.parseString=function(d,u,h){if(h<2)throw new o.IllegalStateException("Data not enough when parse String");var t=new DataView(d,u,h),e=t.getUint16(0,!r),s;return e>0?s=(0,g.default)(new Uint8Array(d,u+2,e)):s="",{data:s,size:2+e}},n.parseLongString=function(d,u,h){if(h<4)throw new o.IllegalStateException("Data not enough when parse LongString");var t=new DataView(d,u,h),e=t.getUint32(0,!r),s;return e>0?s=(0,g.default)(new Uint8Array(d,u+4,e)):s="",{data:s,size:4+e}},n.parseDate=function(d,u,h){if(h<10)throw new o.IllegalStateException("Data size invalid when parse Date");var t=new DataView(d,u,h),e=t.getFloat64(0,!r),s=t.getInt16(8,!r);return e+=s*60*1e3,{data:new Date(e),size:8+2}},n.parseValue=function(d,u,h){if(h<1)throw new o.IllegalStateException("Data not enough when parse Value");var t=new DataView(d,u,h),e=1,s=t.getUint8(0),i,f=!1;try{switch(s){case 0:i=t.getFloat64(1,!r),e+=8;break;case 1:{var c=t.getUint8(1);i=!!c,e+=1;break}case 2:{var a=n.parseString(d,u+1,h-1);i=a.data,e+=a.size;break}case 3:{i={};var v=0;for((t.getUint32(h-4,!r)&16777215)===9&&(v=3);e<h-4;){var S=n.parseObject(d,u+e,h-e-v);if(S.objectEnd)break;i[S.data.name]=S.data.value,e+=S.size}if(e<=h-3){var x=t.getUint32(e-1,!r)&16777215;x===9&&(e+=3)}break}case 8:{i={},e+=4;var v=0;for((t.getUint32(h-4,!r)&16777215)===9&&(v=3);e<h-8;){var E=n.parseVariable(d,u+e,h-e-v);if(E.objectEnd)break;i[E.data.name]=E.data.value,e+=E.size}if(e<=h-3){var x=t.getUint32(e-1,!r)&16777215;x===9&&(e+=3)}break}case 9:i=void 0,e=1,f=!0;break;case 10:{i=[];var L=t.getUint32(1,!r);e+=4;for(var b=0;b<L;b++){var A=n.parseValue(d,u+e,h-e);i.push(A.data),e+=A.size}break}case 11:{var O=n.parseDate(d,u+1,h-1);i=O.data,e+=O.size;break}case 12:{var R=n.parseString(d,u+1,h-1);i=R.data,e+=R.size;break}default:e=h,_.default.w("AMF","Unsupported AMF value type "+s)}}catch(I){_.default.e("AMF",I.toString())}return{data:i,size:e,objectEnd:f}},n}();m.default=l},"./src/demux/demux-errors.js":function(p,m,D){D.r(m);var _={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=_},"./src/demux/exp-golomb.js":function(p,m,D){D.r(m);var _=D("./src/utils/exception.js"),g=function(){function o(r){this.TAG="ExpGolomb",this._buffer=r,this._buffer_index=0,this._total_bytes=r.byteLength,this._total_bits=r.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var r=this._total_bytes-this._buffer_index;if(r<=0)throw new _.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var l=Math.min(4,r),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+l)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=l,this._current_word_bits_left=l*8},o.prototype.readBits=function(r){if(r>32)throw new _.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(r<=this._current_word_bits_left){var l=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,l}var n=this._current_word_bits_left?this._current_word:0;n=n>>>32-this._current_word_bits_left;var d=r-this._current_word_bits_left;this._fillCurrentWord();var u=Math.min(d,this._current_word_bits_left),h=this._current_word>>>32-u;return this._current_word<<=u,this._current_word_bits_left-=u,n=n<<u|h,n},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var r;for(r=0;r<this._current_word_bits_left;r++)if((this._current_word&2147483648>>>r)!==0)return this._current_word<<=r,this._current_word_bits_left-=r,r;return this._fillCurrentWord(),r+this._skipLeadingZero()},o.prototype.readUEG=function(){var r=this._skipLeadingZero();return this.readBits(r+1)-1},o.prototype.readSEG=function(){var r=this.readUEG();return r&1?r+1>>>1:-1*(r>>>1)},o}();m.default=g},"./src/demux/flv-demuxer.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/demux/amf-parser.js"),o=D("./src/demux/sps-parser.js"),r=D("./src/demux/demux-errors.js"),l=D("./src/core/media-info.js"),n=D("./src/utils/exception.js");function d(h,t){return h[t]<<24|h[t+1]<<16|h[t+2]<<8|h[t+3]}var u=function(){function h(t,e){this.TAG="FLVDemuxer",this._config=e,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new l.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256}()}return h.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},h.probe=function(t){var e=new Uint8Array(t),s={match:!1};if(e[0]!==70||e[1]!==76||e[2]!==86||e[3]!==1)return s;var i=(e[4]&4)>>>2!==0,f=(e[4]&1)!==0,c=d(e,5);return c<9?s:{match:!0,consumed:c,dataOffset:c,hasAudioTrack:i,hasVideoTrack:f}},h.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(h.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),h.prototype.resetMediaInfo=function(){this._mediaInfo=new l.default},h.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},h.prototype.parseChunks=function(t,e){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new n.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var s=0,i=this._littleEndian;if(e===0)if(t.byteLength>13){var f=h.probe(t);s=f.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,e+s!==this._dataOffset&&_.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var c=new DataView(t,s),a=c.getUint32(0,!i);a!==0&&_.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),s+=4}for(;s<t.byteLength;){this._dispatch=!0;var c=new DataView(t,s);if(s+11+4>t.byteLength)break;var v=c.getUint8(0),S=c.getUint32(0,!i)&16777215;if(s+11+S+4>t.byteLength)break;if(v!==8&&v!==9&&v!==18){_.default.w(this.TAG,"Unsupported tag type "+v+", skipped"),s+=11+S+4;continue}var x=c.getUint8(4),E=c.getUint8(5),L=c.getUint8(6),b=c.getUint8(7),A=L|E<<8|x<<16|b<<24,O=c.getUint32(7,!i)&16777215;O!==0&&_.default.w(this.TAG,"Meet tag which has StreamID != 0!");var R=s+11;switch(v){case 8:this._parseAudioData(t,R,S,A);break;case 9:this._parseVideoData(t,R,S,A,e+s);break;case 18:this._parseScriptData(t,R,S);break}var I=c.getUint32(11+S,!i);I!==11+S&&_.default.w(this.TAG,"Invalid PrevTagSize "+I),s+=11+S+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),s},h.prototype._parseScriptData=function(t,e,s){var i=g.default.parseScriptData(t,e,s);if(i.hasOwnProperty("onMetaData")){if(i.onMetaData==null||typeof i.onMetaData!="object"){_.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&_.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=i;var f=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},f)),typeof f.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=f.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof f.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=f.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof f.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=f.audiodatarate),typeof f.videodatarate=="number"&&(this._mediaInfo.videoDataRate=f.videodatarate),typeof f.width=="number"&&(this._mediaInfo.width=f.width),typeof f.height=="number"&&(this._mediaInfo.height=f.height),typeof f.duration=="number"){if(!this._durationOverrided){var c=Math.floor(f.duration*this._timescale);this._duration=c,this._mediaInfo.duration=c}}else this._mediaInfo.duration=0;if(typeof f.framerate=="number"){var a=Math.floor(f.framerate*1e3);if(a>0){var v=a/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=v,this._referenceFrameRate.fps_num=a,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=v}}if(typeof f.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var S=f.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(S),f.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=f,_.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(i).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},i))},h.prototype._parseKeyframesIndex=function(t){for(var e=[],s=[],i=1;i<t.times.length;i++){var f=this._timestampBase+Math.floor(t.times[i]*1e3);e.push(f),s.push(t.filepositions[i])}return{times:e,filepositions:s}},h.prototype._parseAudioData=function(t,e,s,i){if(s<=1){_.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var f=new DataView(t,e,s),c=f.getUint8(0),a=c>>>4;if(a!==2&&a!==10){this._onError(r.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a);return}var v=0,S=(c&12)>>>2;if(S>=0&&S<=4)v=this._flvSoundRateTable[S];else{this._onError(r.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+S);return}var x=c&1,E=this._audioMetadata,L=this._audioTrack;if(E||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),E=this._audioMetadata={},E.type="audio",E.id=L.id,E.timescale=this._timescale,E.duration=this._duration,E.audioSampleRate=v,E.channelCount=x===0?1:2),a===10){var b=this._parseAACAudioData(t,e+1,s-1);if(b==null)return;if(b.packetType===0){E.config&&_.default.w(this.TAG,"Found another AudioSpecificConfig!");var A=b.data;E.audioSampleRate=A.samplingRate,E.channelCount=A.channelCount,E.codec=A.codec,E.originalCodec=A.originalCodec,E.config=A.config,E.refSampleDuration=1024/E.audioSampleRate*E.timescale,_.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",E);var O=this._mediaInfo;O.audioCodec=E.originalCodec,O.audioSampleRate=E.audioSampleRate,O.audioChannelCount=E.channelCount,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}else if(b.packetType===1){var R=this._timestampBase+i,I={unit:b.data,length:b.data.byteLength,dts:R,pts:R};L.samples.push(I),L.length+=b.data.length}else _.default.e(this.TAG,"Flv: Unsupported AAC data type "+b.packetType)}else if(a===2){if(!E.codec){var A=this._parseMP3AudioData(t,e+1,s-1,!0);if(A==null)return;E.audioSampleRate=A.samplingRate,E.channelCount=A.channelCount,E.codec=A.codec,E.originalCodec=A.originalCodec,E.refSampleDuration=1152/E.audioSampleRate*E.timescale,_.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",E);var O=this._mediaInfo;O.audioCodec=E.codec,O.audioSampleRate=E.audioSampleRate,O.audioChannelCount=E.channelCount,O.audioDataRate=A.bitRate,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}var C=this._parseMP3AudioData(t,e+1,s-1,!1);if(C==null)return;var R=this._timestampBase+i,F={unit:C,length:C.byteLength,dts:R,pts:R};L.samples.push(F),L.length+=C.length}}},h.prototype._parseAACAudioData=function(t,e,s){if(s<=1){_.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var i={},f=new Uint8Array(t,e,s);return i.packetType=f[0],f[0]===0?i.data=this._parseAACAudioSpecificConfig(t,e+1,s-1):i.data=f.subarray(1),i},h.prototype._parseAACAudioSpecificConfig=function(t,e,s){var i=new Uint8Array(t,e,s),f=null,c=0,a=0,v=0,S=null;if(c=a=i[0]>>>3,v=(i[0]&7)<<1|i[1]>>>7,v<0||v>=this._mpegSamplingRates.length){this._onError(r.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var x=this._mpegSamplingRates[v],E=(i[1]&120)>>>3;if(E<0||E>=8){this._onError(r.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}c===5&&(S=(i[1]&7)<<1|i[2]>>>7,(i[2]&124)>>>2);var L=self.navigator.userAgent.toLowerCase();return L.indexOf("firefox")!==-1?v>=6?(c=5,f=new Array(4),S=v-3):(c=2,f=new Array(2),S=v):L.indexOf("android")!==-1?(c=2,f=new Array(2),S=v):(c=5,S=v,f=new Array(4),v>=6?S=v-3:E===1&&(c=2,f=new Array(2),S=v)),f[0]=c<<3,f[0]|=(v&15)>>>1,f[1]=(v&15)<<7,f[1]|=(E&15)<<3,c===5&&(f[1]|=(S&15)>>>1,f[2]=(S&1)<<7,f[2]|=2<<2,f[3]=0),{config:f,samplingRate:x,channelCount:E,codec:"mp4a.40."+c,originalCodec:"mp4a.40."+a}},h.prototype._parseMP3AudioData=function(t,e,s,i){if(s<4){_.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var f=new Uint8Array(t,e,s),c=null;if(i){if(f[0]!==255)return;var a=f[1]>>>3&3,v=(f[1]&6)>>1,S=(f[2]&240)>>>4,x=(f[2]&12)>>>2,E=f[3]>>>6&3,L=E!==3?2:1,b=0,A=0,O="mp3";switch(a){case 0:b=this._mpegAudioV25SampleRateTable[x];break;case 2:b=this._mpegAudioV20SampleRateTable[x];break;case 3:b=this._mpegAudioV10SampleRateTable[x];break}switch(v){case 1:S<this._mpegAudioL3BitRateTable.length&&(A=this._mpegAudioL3BitRateTable[S]);break;case 2:S<this._mpegAudioL2BitRateTable.length&&(A=this._mpegAudioL2BitRateTable[S]);break;case 3:S<this._mpegAudioL1BitRateTable.length&&(A=this._mpegAudioL1BitRateTable[S]);break}c={bitRate:A,samplingRate:b,channelCount:L,codec:O,originalCodec:O}}else c=f;return c},h.prototype._parseVideoData=function(t,e,s,i,f){if(s<=1){_.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var c=new Uint8Array(t,e,s)[0],a=(c&240)>>>4,v=c&15;if(v!==7){this._onError(r.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+v);return}this._parseAVCVideoPacket(t,e+1,s-1,i,f,a)}},h.prototype._parseAVCVideoPacket=function(t,e,s,i,f,c){if(s<4){_.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var a=this._littleEndian,v=new DataView(t,e,s),S=v.getUint8(0),x=v.getUint32(0,!a)&16777215,E=x<<8>>8;if(S===0)this._parseAVCDecoderConfigurationRecord(t,e+4,s-4);else if(S===1)this._parseAVCVideoData(t,e+4,s-4,i,f,c,E);else if(S!==2){this._onError(r.default.FORMAT_ERROR,"Flv: Invalid video packet type "+S);return}},h.prototype._parseAVCDecoderConfigurationRecord=function(t,e,s){if(s<7){_.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var i=this._videoMetadata,f=this._videoTrack,c=this._littleEndian,a=new DataView(t,e,s);i?typeof i.avcc<"u"&&_.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),i=this._videoMetadata={},i.type="video",i.id=f.id,i.timescale=this._timescale,i.duration=this._duration);var v=a.getUint8(0),S=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),v!==1||S===0){this._onError(r.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(a.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(r.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var x=a.getUint8(5)&31;if(x===0){this._onError(r.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else x>1&&_.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+x);for(var E=6,L=0;L<x;L++){var b=a.getUint16(E,!c);if(E+=2,b!==0){var A=new Uint8Array(t,e+E,b);E+=b;var O=o.default.parseSPS(A);if(L===0){i.codecWidth=O.codec_size.width,i.codecHeight=O.codec_size.height,i.presentWidth=O.present_size.width,i.presentHeight=O.present_size.height,i.profile=O.profile_string,i.level=O.level_string,i.bitDepth=O.bit_depth,i.chromaFormat=O.chroma_format,i.sarRatio=O.sar_ratio,i.frameRate=O.frame_rate,(O.frame_rate.fixed===!1||O.frame_rate.fps_num===0||O.frame_rate.fps_den===0)&&(i.frameRate=this._referenceFrameRate);var R=i.frameRate.fps_den,I=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(R/I);for(var C=A.subarray(1,4),F="avc1.",w=0;w<3;w++){var k=C[w].toString(16);k.length<2&&(k="0"+k),F+=k}i.codec=F;var B=this._mediaInfo;B.width=i.codecWidth,B.height=i.codecHeight,B.fps=i.frameRate.fps,B.profile=i.profile,B.level=i.level,B.refFrames=O.ref_frames,B.chromaFormat=O.chroma_format_string,B.sarNum=i.sarRatio.width,B.sarDen=i.sarRatio.height,B.videoCodec=F,B.hasAudio?B.audioCodec!=null&&(B.mimeType='video/x-flv; codecs="'+B.videoCodec+","+B.audioCodec+'"'):B.mimeType='video/x-flv; codecs="'+B.videoCodec+'"',B.isComplete()&&this._onMediaInfo(B)}}}var U=a.getUint8(E);if(U===0){this._onError(r.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else U>1&&_.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+U);E++;for(var L=0;L<U;L++){var b=a.getUint16(E,!c);E+=2,b!==0&&(E+=b)}i.avcc=new Uint8Array(s),i.avcc.set(new Uint8Array(t,e,s),0),_.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)},h.prototype._parseAVCVideoData=function(t,e,s,i,f,c,a){for(var v=this._littleEndian,S=new DataView(t,e,s),x=[],E=0,L=0,b=this._naluLengthSize,A=this._timestampBase+i,O=c===1;L<s;){if(L+4>=s){_.default.w(this.TAG,"Malformed Nalu near timestamp "+A+", offset = "+L+", dataSize = "+s);break}var R=S.getUint32(L,!v);if(b===3&&(R>>>=8),R>s-b){_.default.w(this.TAG,"Malformed Nalus near timestamp "+A+", NaluSize > DataSize!");return}var I=S.getUint8(L+b)&31;I===5&&(O=!0);var C=new Uint8Array(t,e+L,b+R),F={type:I,data:C};x.push(F),E+=C.byteLength,L+=b+R}if(x.length){var w=this._videoTrack,k={units:x,length:E,isKeyframe:O,dts:A,cts:a,pts:A+a};O&&(k.fileposition=f),w.samples.push(k),w.length+=E}},h}();m.default=u},"./src/demux/sps-parser.js":function(p,m,D){D.r(m);var _=D("./src/demux/exp-golomb.js"),g=function(){function o(){}return o._ebsp2rbsp=function(r){for(var l=r,n=l.byteLength,d=new Uint8Array(n),u=0,h=0;h<n;h++)h>=2&&l[h]===3&&l[h-1]===0&&l[h-2]===0||(d[u]=l[h],u++);return new Uint8Array(d.buffer,0,u)},o.parseSPS=function(r){var l=o._ebsp2rbsp(r),n=new _.default(l);n.readByte();var d=n.readByte();n.readByte();var u=n.readByte();n.readUEG();var h=o.getProfileString(d),t=o.getLevelString(u),e=1,s=420,i=[0,420,422,444],f=8;if((d===100||d===110||d===122||d===244||d===44||d===83||d===86||d===118||d===128||d===138||d===144)&&(e=n.readUEG(),e===3&&n.readBits(1),e<=3&&(s=i[e]),f=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var c=e!==3?8:12,a=0;a<c;a++)n.readBool()&&(a<6?o._skipScalingList(n,16):o._skipScalingList(n,64));n.readUEG();var v=n.readUEG();if(v===0)n.readUEG();else if(v===1){n.readBits(1),n.readSEG(),n.readSEG();for(var S=n.readUEG(),a=0;a<S;a++)n.readSEG()}var x=n.readUEG();n.readBits(1);var E=n.readUEG(),L=n.readUEG(),b=n.readBits(1);b===0&&n.readBits(1),n.readBits(1);var A=0,O=0,R=0,I=0,C=n.readBool();C&&(A=n.readUEG(),O=n.readUEG(),R=n.readUEG(),I=n.readUEG());var F=1,w=1,k=0,B=!0,U=0,N=0,j=n.readBool();if(j){if(n.readBool()){var K=n.readByte(),V=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],H=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];K>0&&K<16?(F=V[K-1],w=H[K-1]):K===255&&(F=n.readByte()<<8|n.readByte(),w=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var Y=n.readBits(32),q=n.readBits(32);B=n.readBool(),U=q,N=Y*2,k=U/N}}var $=1;(F!==1||w!==1)&&($=F/w);var G=0,re=0;if(e===0)G=1,re=2-b;else{var Q=e===3?1:2,ee=e===1?2:1;G=Q,re=ee*(2-b)}var se=(E+1)*16,ae=(2-b)*((L+1)*16);se-=(A+O)*G,ae-=(R+I)*re;var oe=Math.ceil(se*$);return n.destroy(),n=null,{profile_string:h,level_string:t,bit_depth:f,ref_frames:x,chroma_format:s,chroma_format_string:o.getChromaFormatString(s),frame_rate:{fixed:B,fps:k,fps_den:N,fps_num:U},sar_ratio:{width:F,height:w},codec_size:{width:se,height:ae},present_size:{width:oe,height:ae}}},o._skipScalingList=function(r,l){for(var n=8,d=8,u=0,h=0;h<l;h++)d!==0&&(u=r.readSEG(),d=(n+u+256)%256),n=d===0?n:d},o.getProfileString=function(r){switch(r){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(r){return(r/10).toFixed(1)},o.getChromaFormatString=function(r){switch(r){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();m.default=g},"./src/flv.js":function(p,m,D){D.r(m);var _=D("./src/utils/polyfill.js"),g=D("./src/core/features.js"),o=D("./src/io/loader.js"),r=D("./src/player/flv-player.js"),l=D("./src/player/native-player.js"),n=D("./src/player/player-events.js"),d=D("./src/player/player-errors.js"),u=D("./src/utils/logging-control.js"),h=D("./src/utils/exception.js");_.default.install();function t(f,c){var a=f;if(a==null||typeof a!="object")throw new h.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!a.hasOwnProperty("type"))throw new h.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(a.type){case"flv":return new r.default(a,c);default:return new l.default(a,c)}}function e(){return g.default.supportMSEH264Playback()}function s(){return g.default.getFeatureList()}var i={};i.createPlayer=t,i.isSupported=e,i.getFeatureList=s,i.BaseLoader=o.BaseLoader,i.LoaderStatus=o.LoaderStatus,i.LoaderErrors=o.LoaderErrors,i.Events=n.default,i.ErrorTypes=d.ErrorTypes,i.ErrorDetails=d.ErrorDetails,i.FlvPlayer=r.default,i.NativePlayer=l.default,i.LoggingControl=u.default,Object.defineProperty(i,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=i},"./src/index.js":function(p,m,D){p.exports=D("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(p,m,D){D.r(m);var _=D("./src/utils/browser.js"),g=D("./src/io/loader.js"),o=D("./src/utils/exception.js"),r=function(){var n=function(d,u){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},n(d,u)};return function(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");n(d,u);function h(){this.constructor=d}d.prototype=u===null?Object.create(u):(h.prototype=u.prototype,new h)}}(),l=function(n){r(d,n);function d(u,h){var t=n.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=u,t._config=h,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return d.isSupported=function(){try{var u=_.default.msedge&&_.default.version.minor>=15048,h=_.default.msedge?u:!0;return self.fetch&&self.ReadableStream&&h}catch{return!1}},d.prototype.destroy=function(){this.isWorking()&&this.abort(),n.prototype.destroy.call(this)},d.prototype.open=function(u,h){var t=this;this._dataSource=u,this._range=h;var e=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(e=u.redirectedURL);var s=this._seekHandler.getConfig(e,h),i=new self.Headers;if(typeof s.headers=="object"){var f=s.headers;for(var c in f)f.hasOwnProperty(c)&&i.append(c,f[c])}var a={method:"GET",headers:i,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var c in this._config.headers)i.append(c,this._config.headers[c]);u.cors===!1&&(a.mode="same-origin"),u.withCredentials&&(a.credentials="include"),u.referrerPolicy&&(a.referrerPolicy=u.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,a.signal=this._abortController.signal),this._status=g.LoaderStatus.kConnecting,self.fetch(s.url,a).then(function(v){if(t._requestAbort){t._status=g.LoaderStatus.kIdle,v.body.cancel();return}if(v.ok&&v.status>=200&&v.status<=299){if(v.url!==s.url&&t._onURLRedirect){var S=t._seekHandler.removeURLParameters(v.url);t._onURLRedirect(S)}var x=v.headers.get("Content-Length");return x!=null&&(t._contentLength=parseInt(x),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,v.body.getReader())}else if(t._status=g.LoaderStatus.kError,t._onError)t._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:v.status,msg:v.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+v.status+" "+v.statusText)}).catch(function(v){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=g.LoaderStatus.kError,t._onError)t._onError(g.LoaderErrors.EXCEPTION,{code:-1,msg:v.message});else throw v})},d.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==g.LoaderStatus.kBuffering||!_.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},d.prototype._pump=function(u){var h=this;return u.read().then(function(t){if(t.done)if(h._contentLength!==null&&h._receivedLength<h._contentLength){h._status=g.LoaderStatus.kError;var e=g.LoaderErrors.EARLY_EOF,s={code:-1,msg:"Fetch stream meet Early-EOF"};if(h._onError)h._onError(e,s);else throw new o.RuntimeException(s.msg)}else h._status=g.LoaderStatus.kComplete,h._onComplete&&h._onComplete(h._range.from,h._range.from+h._receivedLength-1);else{if(h._abortController&&h._abortController.signal.aborted){h._status=g.LoaderStatus.kComplete;return}else if(h._requestAbort===!0)return h._status=g.LoaderStatus.kComplete,u.cancel();h._status=g.LoaderStatus.kBuffering;var i=t.value.buffer,f=h._range.from+h._receivedLength;h._receivedLength+=i.byteLength,h._onDataArrival&&h._onDataArrival(i,f,h._receivedLength),h._pump(u)}}).catch(function(t){if(h._abortController&&h._abortController.signal.aborted){h._status=g.LoaderStatus.kComplete;return}if(!(t.code===11&&_.default.msedge)){h._status=g.LoaderStatus.kError;var e=0,s=null;if((t.code===19||t.message==="network error")&&(h._contentLength===null||h._contentLength!==null&&h._receivedLength<h._contentLength)?(e=g.LoaderErrors.EARLY_EOF,s={code:t.code,msg:"Fetch stream meet Early-EOF"}):(e=g.LoaderErrors.EXCEPTION,s={code:t.code,msg:t.message}),h._onError)h._onError(e,s);else throw new o.RuntimeException(s.msg)}})},d}(g.BaseLoader);m.default=l},"./src/io/io-controller.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/io/speed-sampler.js"),o=D("./src/io/loader.js"),r=D("./src/io/fetch-stream-loader.js"),l=D("./src/io/xhr-moz-chunked-loader.js"),n=D("./src/io/xhr-range-loader.js"),d=D("./src/io/websocket-loader.js"),u=D("./src/io/range-seek-handler.js"),h=D("./src/io/param-seek-handler.js"),t=D("./src/utils/exception.js"),e=function(){function s(i,f,c){this.TAG="IOController",this._config=f,this._extraData=c,this._stashInitialSize=1024*384,f.stashInitialSize!=null&&f.stashInitialSize>0&&(this._stashInitialSize=f.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,f.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=i,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(i.url),this._refTotalLength=i.filesize?i.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new g.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return s.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},s.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},s.prototype.isPaused=function(){return this._paused},Object.defineProperty(s.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"extraData",{get:function(){return this._extraData},set:function(i){this._extraData=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(i){this._onDataArrival=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(i){this._onSeeked=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onError",{get:function(){return this._onError},set:function(i){this._onError=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onComplete",{get:function(){return this._onComplete},set:function(i){this._onComplete=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(i){this._onRedirect=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(i){this._onRecoveredEarlyEof=i},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentSpeed",{get:function(){return this._loaderClass===n.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),s.prototype._selectSeekHandler=function(){var i=this._config;if(i.seekType==="range")this._seekHandler=new u.default(this._config.rangeLoadZeroStart);else if(i.seekType==="param"){var f=i.seekParamStart||"bstart",c=i.seekParamEnd||"bend";this._seekHandler=new h.default(f,c)}else if(i.seekType==="custom"){if(typeof i.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new i.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+i.seekType)},s.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=d.default;else if(r.default.isSupported())this._loaderClass=r.default;else if(l.default.isSupported())this._loaderClass=l.default;else if(n.default.isSupported())this._loaderClass=n.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},s.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},s.prototype.open=function(i){this._currentRange={from:0,to:-1},i&&(this._currentRange.from=i),this._speedSampler.reset(),i||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},s.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},s.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},s.prototype.resume=function(){if(this._paused){this._paused=!1;var i=this._resumeFrom;this._resumeFrom=0,this._internalSeek(i,!0)}},s.prototype.seek=function(i){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(i,!0)},s.prototype._internalSeek=function(i,f){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(f),this._loader.destroy(),this._loader=null;var c={from:i,to:-1};this._currentRange={from:c.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,c),this._onSeeked&&this._onSeeked()},s.prototype.updateUrl=function(i){if(!i||typeof i!="string"||i.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=i},s.prototype._expandBuffer=function(i){for(var f=this._stashSize;f+1024*1024*1<i;)f*=2;if(f+=1024*1024*1,f!==this._bufferSize){var c=new ArrayBuffer(f);if(this._stashUsed>0){var a=new Uint8Array(this._stashBuffer,0,this._stashUsed),v=new Uint8Array(c,0,f);v.set(a,0)}this._stashBuffer=c,this._bufferSize=f}},s.prototype._normalizeSpeed=function(i){var f=this._speedNormalizeList,c=f.length-1,a=0,v=0,S=c;if(i<f[0])return f[0];for(;v<=S;){if(a=v+Math.floor((S-v)/2),a===c||i>=f[a]&&i<f[a+1])return f[a];f[a]<i?v=a+1:S=a-1}},s.prototype._adjustStashSize=function(i){var f=0;this._config.isLive||i<512?f=i:i>=512&&i<=1024?f=Math.floor(i*1.5):f=i*2,f>8192&&(f=8192);var c=f*1024+1024*1024*1;this._bufferSize<c&&this._expandBuffer(c),this._stashSize=f*1024},s.prototype._dispatchChunks=function(i,f){return this._currentRange.to=f+i.byteLength-1,this._onDataArrival(i,f)},s.prototype._onURLRedirect=function(i){this._redirectedURL=i,this._onRedirect&&this._onRedirect(i)},s.prototype._onContentLengthKnown=function(i){i&&this._fullRequestFlag&&(this._totalLength=i,this._fullRequestFlag=!1)},s.prototype._onLoaderChunkArrival=function(i,f,c){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(i.byteLength);var a=this._speedSampler.lastSecondKBps;if(a!==0){var v=this._normalizeSpeed(a);this._speedNormalized!==v&&(this._speedNormalized=v,this._adjustStashSize(v))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=f),this._stashUsed+i.byteLength<=this._stashSize){var E=new Uint8Array(this._stashBuffer,0,this._stashSize);E.set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength}else{var E=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var b=this._stashBuffer.slice(0,this._stashUsed),S=this._dispatchChunks(b,this._stashByteStart);if(S<b.byteLength){if(S>0){var L=new Uint8Array(b,S);E.set(L,0),this._stashUsed=L.byteLength,this._stashByteStart+=S}}else this._stashUsed=0,this._stashByteStart+=S;this._stashUsed+i.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+i.byteLength),E=new Uint8Array(this._stashBuffer,0,this._bufferSize)),E.set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength}else{var S=this._dispatchChunks(i,f);if(S<i.byteLength){var x=i.byteLength-S;x>this._bufferSize&&(this._expandBuffer(x),E=new Uint8Array(this._stashBuffer,0,this._bufferSize)),E.set(new Uint8Array(i,S),0),this._stashUsed+=x,this._stashByteStart=f+S}}}else if(this._stashUsed===0){var S=this._dispatchChunks(i,f);if(S<i.byteLength){var x=i.byteLength-S;x>this._bufferSize&&this._expandBuffer(x);var E=new Uint8Array(this._stashBuffer,0,this._bufferSize);E.set(new Uint8Array(i,S),0),this._stashUsed+=x,this._stashByteStart=f+S}}else{this._stashUsed+i.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+i.byteLength);var E=new Uint8Array(this._stashBuffer,0,this._bufferSize);E.set(new Uint8Array(i),this._stashUsed),this._stashUsed+=i.byteLength;var S=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(S<this._stashUsed&&S>0){var L=new Uint8Array(this._stashBuffer,S);E.set(L,0)}this._stashUsed-=S,this._stashByteStart+=S}}},s.prototype._flushStashBuffer=function(i){if(this._stashUsed>0){var f=this._stashBuffer.slice(0,this._stashUsed),c=this._dispatchChunks(f,this._stashByteStart),a=f.byteLength-c;if(c<f.byteLength)if(i)_.default.w(this.TAG,a+" bytes unconsumed data remain when flush buffer, dropped");else{if(c>0){var v=new Uint8Array(this._stashBuffer,0,this._bufferSize),S=new Uint8Array(f,c);v.set(S,0),this._stashUsed=S.byteLength,this._stashByteStart+=c}return 0}return this._stashUsed=0,this._stashByteStart=0,a}return 0},s.prototype._onLoaderComplete=function(i,f){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},s.prototype._onLoaderError=function(i,f){switch(_.default.e(this.TAG,"Loader error, code = "+f.code+", msg = "+f.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,i=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),i){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var c=this._currentRange.to+1;c<this._totalLength&&(_.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(c,!1));return}i=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(i,f);else throw new t.RuntimeException("IOException: "+f.msg)},s}();m.default=e},"./src/io/loader.js":function(p,m,D){D.r(m),D.d(m,{LoaderStatus:function(){return g},LoaderErrors:function(){return o},BaseLoader:function(){return r}});var _=D("./src/utils/exception.js"),g={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},r=function(){function l(n){this._type=n||"undefined",this._status=g.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return l.prototype.destroy=function(){this._status=g.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},l.prototype.isWorking=function(){return this._status===g.kConnecting||this._status===g.kBuffering},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(n){this._onContentLengthKnown=n},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(n){this._onURLRedirect=n},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(n){this._onDataArrival=n},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onError",{get:function(){return this._onError},set:function(n){this._onError=n},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onComplete",{get:function(){return this._onComplete},set:function(n){this._onComplete=n},enumerable:!1,configurable:!0}),l.prototype.open=function(n,d){throw new _.NotImplementedException("Unimplemented abstract function!")},l.prototype.abort=function(){throw new _.NotImplementedException("Unimplemented abstract function!")},l}()},"./src/io/param-seek-handler.js":function(p,m,D){D.r(m);var _=function(){function g(o,r){this._startName=o,this._endName=r}return g.prototype.getConfig=function(o,r){var l=o;if(r.from!==0||r.to!==-1){var n=!0;l.indexOf("?")===-1&&(l+="?",n=!1),n&&(l+="&"),l+=this._startName+"="+r.from.toString(),r.to!==-1&&(l+="&"+this._endName+"="+r.to.toString())}return{url:l,headers:{}}},g.prototype.removeURLParameters=function(o){var r=o.split("?")[0],l=void 0,n=o.indexOf("?");n!==-1&&(l=o.substring(n+1));var d="";if(l!=null&&l.length>0)for(var u=l.split("&"),h=0;h<u.length;h++){var t=u[h].split("="),e=h>0;t[0]!==this._startName&&t[0]!==this._endName&&(e&&(d+="&"),d+=u[h])}return d.length===0?r:r+"?"+d},g}();m.default=_},"./src/io/range-seek-handler.js":function(p,m,D){D.r(m);var _=function(){function g(o){this._zeroStart=o||!1}return g.prototype.getConfig=function(o,r){var l={};if(r.from!==0||r.to!==-1){var n=void 0;r.to!==-1?n="bytes="+r.from.toString()+"-"+r.to.toString():n="bytes="+r.from.toString()+"-",l.Range=n}else this._zeroStart&&(l.Range="bytes=0-");return{url:o,headers:l}},g.prototype.removeURLParameters=function(o){return o},g}();m.default=_},"./src/io/speed-sampler.js":function(p,m,D){D.r(m);var _=function(){function g(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return g.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},g.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(g.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),g}();m.default=_},"./src/io/websocket-loader.js":function(p,m,D){D.r(m);var _=D("./src/io/loader.js"),g=D("./src/utils/exception.js"),o=function(){var l=function(n,d){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,h){u.__proto__=h}||function(u,h){for(var t in h)Object.prototype.hasOwnProperty.call(h,t)&&(u[t]=h[t])},l(n,d)};return function(n,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");l(n,d);function u(){this.constructor=n}n.prototype=d===null?Object.create(d):(u.prototype=d.prototype,new u)}}(),r=function(l){o(n,l);function n(){var d=l.call(this,"websocket-loader")||this;return d.TAG="WebSocketLoader",d._needStash=!0,d._ws=null,d._requestAbort=!1,d._receivedLength=0,d}return n.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},n.prototype.destroy=function(){this._ws&&this.abort(),l.prototype.destroy.call(this)},n.prototype.open=function(d){try{var u=this._ws=new self.WebSocket(d.url);u.binaryType="arraybuffer",u.onopen=this._onWebSocketOpen.bind(this),u.onclose=this._onWebSocketClose.bind(this),u.onmessage=this._onWebSocketMessage.bind(this),u.onerror=this._onWebSocketError.bind(this),this._status=_.LoaderStatus.kConnecting}catch(t){this._status=_.LoaderStatus.kError;var h={code:t.code,msg:t.message};if(this._onError)this._onError(_.LoaderErrors.EXCEPTION,h);else throw new g.RuntimeException(h.msg)}},n.prototype.abort=function(){var d=this._ws;d&&(d.readyState===0||d.readyState===1)&&(this._requestAbort=!0,d.close()),this._ws=null,this._status=_.LoaderStatus.kComplete},n.prototype._onWebSocketOpen=function(d){this._status=_.LoaderStatus.kBuffering},n.prototype._onWebSocketClose=function(d){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=_.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},n.prototype._onWebSocketMessage=function(d){var u=this;if(d.data instanceof ArrayBuffer)this._dispatchArrayBuffer(d.data);else if(d.data instanceof Blob){var h=new FileReader;h.onload=function(){u._dispatchArrayBuffer(h.result)},h.readAsArrayBuffer(d.data)}else{this._status=_.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+d.data.constructor.name};if(this._onError)this._onError(_.LoaderErrors.EXCEPTION,t);else throw new g.RuntimeException(t.msg)}},n.prototype._dispatchArrayBuffer=function(d){var u=d,h=this._receivedLength;this._receivedLength+=u.byteLength,this._onDataArrival&&this._onDataArrival(u,h,this._receivedLength)},n.prototype._onWebSocketError=function(d){this._status=_.LoaderStatus.kError;var u={code:d.code,msg:d.message};if(this._onError)this._onError(_.LoaderErrors.EXCEPTION,u);else throw new g.RuntimeException(u.msg)},n}(_.BaseLoader);m.default=r},"./src/io/xhr-moz-chunked-loader.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/io/loader.js"),o=D("./src/utils/exception.js"),r=function(){var n=function(d,u){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},n(d,u)};return function(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");n(d,u);function h(){this.constructor=d}d.prototype=u===null?Object.create(u):(h.prototype=u.prototype,new h)}}(),l=function(n){r(d,n);function d(u,h){var t=n.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=u,t._config=h,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return d.isSupported=function(){try{var u=new XMLHttpRequest;return u.open("GET","https://example.com",!0),u.responseType="moz-chunked-arraybuffer",u.responseType==="moz-chunked-arraybuffer"}catch(h){return _.default.w("MozChunkedLoader",h.message),!1}},d.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),n.prototype.destroy.call(this)},d.prototype.open=function(u,h){this._dataSource=u,this._range=h;var t=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(t=u.redirectedURL);var e=this._seekHandler.getConfig(t,h);this._requestURL=e.url;var s=this._xhr=new XMLHttpRequest;if(s.open("GET",e.url,!0),s.responseType="moz-chunked-arraybuffer",s.onreadystatechange=this._onReadyStateChange.bind(this),s.onprogress=this._onProgress.bind(this),s.onloadend=this._onLoadEnd.bind(this),s.onerror=this._onXhrError.bind(this),u.withCredentials&&(s.withCredentials=!0),typeof e.headers=="object"){var i=e.headers;for(var f in i)i.hasOwnProperty(f)&&s.setRequestHeader(f,i[f])}if(typeof this._config.headers=="object"){var i=this._config.headers;for(var f in i)i.hasOwnProperty(f)&&s.setRequestHeader(f,i[f])}this._status=g.LoaderStatus.kConnecting,s.send()},d.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=g.LoaderStatus.kComplete},d.prototype._onReadyStateChange=function(u){var h=u.target;if(h.readyState===2){if(h.responseURL!=null&&h.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(h.responseURL);this._onURLRedirect(t)}if(h.status!==0&&(h.status<200||h.status>299))if(this._status=g.LoaderStatus.kError,this._onError)this._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:h.status,msg:h.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+h.status+" "+h.statusText);else this._status=g.LoaderStatus.kBuffering}},d.prototype._onProgress=function(u){if(this._status!==g.LoaderStatus.kError){this._contentLength===null&&u.total!==null&&u.total!==0&&(this._contentLength=u.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var h=u.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=h.byteLength,this._onDataArrival&&this._onDataArrival(h,t,this._receivedLength)}},d.prototype._onLoadEnd=function(u){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===g.LoaderStatus.kError)return;this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},d.prototype._onXhrError=function(u){this._status=g.LoaderStatus.kError;var h=0,t=null;if(this._contentLength&&u.loaded<this._contentLength?(h=g.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(h=g.LoaderErrors.EXCEPTION,t={code:-1,msg:u.constructor.name+" "+u.type}),this._onError)this._onError(h,t);else throw new o.RuntimeException(t.msg)},d}(g.BaseLoader);m.default=l},"./src/io/xhr-range-loader.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/io/speed-sampler.js"),o=D("./src/io/loader.js"),r=D("./src/utils/exception.js"),l=function(){var d=function(u,h){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},d(u,h)};return function(u,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");d(u,h);function t(){this.constructor=u}u.prototype=h===null?Object.create(h):(t.prototype=h.prototype,new t)}}(),n=function(d){l(u,d);function u(h,t){var e=d.call(this,"xhr-range-loader")||this;return e.TAG="RangeLoader",e._seekHandler=h,e._config=t,e._needStash=!1,e._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],e._currentChunkSizeKB=384,e._currentSpeedNormalized=0,e._zeroSpeedChunkCount=0,e._xhr=null,e._speedSampler=new g.default,e._requestAbort=!1,e._waitForTotalLength=!1,e._totalLengthReceived=!1,e._currentRequestURL=null,e._currentRedirectedURL=null,e._currentRequestRange=null,e._totalLength=null,e._contentLength=null,e._receivedLength=0,e._lastTimeLoaded=0,e}return u.isSupported=function(){try{var h=new XMLHttpRequest;return h.open("GET","https://example.com",!0),h.responseType="arraybuffer",h.responseType==="arraybuffer"}catch(t){return _.default.w("RangeLoader",t.message),!1}},u.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),d.prototype.destroy.call(this)},Object.defineProperty(u.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),u.prototype.open=function(h,t){this._dataSource=h,this._range=t,this._status=o.LoaderStatus.kConnecting;var e=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(e=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!e?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},u.prototype._openSubRange=function(){var h=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,e=t+h;this._contentLength!=null&&e-this._range.from>=this._contentLength&&(e=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:e},this._internalOpen(this._dataSource,this._currentRequestRange)},u.prototype._internalOpen=function(h,t){this._lastTimeLoaded=0;var e=h.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?e=this._currentRedirectedURL:h.redirectedURL!=null&&(e=h.redirectedURL));var s=this._seekHandler.getConfig(e,t);this._currentRequestURL=s.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",s.url,!0),i.responseType="arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),h.withCredentials&&(i.withCredentials=!0),typeof s.headers=="object"){var f=s.headers;for(var c in f)f.hasOwnProperty(c)&&i.setRequestHeader(c,f[c])}if(typeof this._config.headers=="object"){var f=this._config.headers;for(var c in f)f.hasOwnProperty(c)&&i.setRequestHeader(c,f[c])}i.send()},u.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},u.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},u.prototype._onReadyStateChange=function(h){var t=h.target;if(t.readyState===2){if(t.responseURL!=null){var e=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&e!==this._currentRedirectedURL&&(this._currentRedirectedURL=e,this._onURLRedirect&&this._onURLRedirect(e))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new r.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},u.prototype._onProgress=function(h){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var e=h.total;this._internalAbort(),e!=null&e!==0&&(this._totalLength=e)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var s=h.loaded-this._lastTimeLoaded;this._lastTimeLoaded=h.loaded,this._speedSampler.addBytes(s)}},u.prototype._normalizeSpeed=function(h){var t=this._chunkSizeKBList,e=t.length-1,s=0,i=0,f=e;if(h<t[0])return t[0];for(;i<=f;){if(s=i+Math.floor((f-i)/2),s===e||h>=t[s]&&h<t[s+1])return t[s];t[s]<h?i=s+1:f=s-1}},u.prototype._onLoad=function(h){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var e=this._normalizeSpeed(t);this._currentSpeedNormalized!==e&&(this._currentSpeedNormalized=e,this._currentChunkSizeKB=e)}var s=h.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=s.byteLength;var f=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():f=!0,this._onDataArrival&&this._onDataArrival(s,i,this._receivedLength),f&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},u.prototype._onXhrError=function(h){this._status=o.LoaderStatus.kError;var t=0,e=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=o.LoaderErrors.EARLY_EOF,e={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=o.LoaderErrors.EXCEPTION,e={code:-1,msg:h.constructor.name+" "+h.type}),this._onError)this._onError(t,e);else throw new r.RuntimeException(e.msg)},u}(o.BaseLoader);m.default=n},"./src/player/flv-player.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./src/utils/logger.js"),r=D("./src/utils/browser.js"),l=D("./src/player/player-events.js"),n=D("./src/core/transmuxer.js"),d=D("./src/core/transmuxing-events.js"),u=D("./src/core/mse-controller.js"),h=D("./src/core/mse-events.js"),t=D("./src/player/player-errors.js"),e=D("./src/config.js"),s=D("./src/utils/exception.js"),i=function(){function f(c,a){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(g()),this._config=(0,e.createDefaultConfig)(),typeof a=="object"&&Object.assign(this._config,a),c.type.toLowerCase()!=="flv")throw new s.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");c.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=c,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var v=r.default.chrome&&(r.default.version.major<50||r.default.version.major===50&&r.default.version.build<2661);this._alwaysSeekKeyframe=!!(v||r.default.msedge||r.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return f.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(c,a){var v=this;c===l.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){v._emitter.emit(l.default.MEDIA_INFO,v.mediaInfo)}):c===l.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){v._emitter.emit(l.default.STATISTICS_INFO,v.statisticsInfo)}),this._emitter.addListener(c,a)},f.prototype.off=function(c,a){this._emitter.removeListener(c,a)},f.prototype.attachMediaElement=function(c){var a=this;if(this._mediaElement=c,c.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),c.addEventListener("seeking",this.e.onvSeeking),c.addEventListener("canplay",this.e.onvCanPlay),c.addEventListener("stalled",this.e.onvStalled),c.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on(h.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(h.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(h.default.SOURCE_OPEN,function(){a._mseSourceOpened=!0,a._hasPendingLoad&&(a._hasPendingLoad=!1,a.load())}),this._msectl.on(h.default.ERROR,function(v){a._emitter.emit(l.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,v)}),this._msectl.attachMediaElement(c),this._pendingSeekTime!=null)try{c.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},f.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},f.prototype.load=function(){var c=this;if(!this._mediaElement)throw new s.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new s.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new n.default(this._mediaDataSource,this._config),this._transmuxer.on(d.default.INIT_SEGMENT,function(a,v){c._msectl.appendInitSegment(v)}),this._transmuxer.on(d.default.MEDIA_SEGMENT,function(a,v){if(c._msectl.appendMediaSegment(v),c._config.lazyLoad&&!c._config.isLive){var S=c._mediaElement.currentTime;v.info.endDts>=(S+c._config.lazyLoadMaxDuration)*1e3&&c._progressChecker==null&&(o.default.v(c.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),c._suspendTransmuxer())}}),this._transmuxer.on(d.default.LOADING_COMPLETE,function(){c._msectl.endOfStream(),c._emitter.emit(l.default.LOADING_COMPLETE)}),this._transmuxer.on(d.default.RECOVERED_EARLY_EOF,function(){c._emitter.emit(l.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(d.default.IO_ERROR,function(a,v){c._emitter.emit(l.default.ERROR,t.ErrorTypes.NETWORK_ERROR,a,v)}),this._transmuxer.on(d.default.DEMUX_ERROR,function(a,v){c._emitter.emit(l.default.ERROR,t.ErrorTypes.MEDIA_ERROR,a,{code:-1,msg:v})}),this._transmuxer.on(d.default.MEDIA_INFO,function(a){c._mediaInfo=a,c._emitter.emit(l.default.MEDIA_INFO,Object.assign({},a))}),this._transmuxer.on(d.default.METADATA_ARRIVED,function(a){c._emitter.emit(l.default.METADATA_ARRIVED,a)}),this._transmuxer.on(d.default.SCRIPTDATA_ARRIVED,function(a){c._emitter.emit(l.default.SCRIPTDATA_ARRIVED,a)}),this._transmuxer.on(d.default.STATISTICS_INFO,function(a){c._statisticsInfo=c._fillStatisticsInfo(a),c._emitter.emit(l.default.STATISTICS_INFO,Object.assign({},c._statisticsInfo))}),this._transmuxer.on(d.default.RECOMMEND_SEEKPOINT,function(a){c._mediaElement&&!c._config.accurateSeek&&(c._requestSetTime=!0,c._mediaElement.currentTime=a/1e3)}),this._transmuxer.open()}},f.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},f.prototype.play=function(){return this._mediaElement.play()},f.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(c){this._mediaElement.volume=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(c){this._mediaElement.muted=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(c){this._mediaElement?this._internalSeek(c):this._pendingSeekTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),f.prototype._fillStatisticsInfo=function(c){if(c.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return c;var a=!0,v=0,S=0;if(this._mediaElement.getVideoPlaybackQuality){var x=this._mediaElement.getVideoPlaybackQuality();v=x.totalVideoFrames,S=x.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(v=this._mediaElement.webkitDecodedFrameCount,S=this._mediaElement.webkitDroppedFrameCount):a=!1;return a&&(c.decodedFrames=v,c.droppedFrames=S),c},f.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var c=this._mediaElement.buffered,a=this._mediaElement.currentTime,v=0,S=0;S<c.length;S++){var x=c.start(S),E=c.end(S);if(x<=a&&a<E){v=E;break}}v>=a+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},f.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},f.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},f.prototype._checkProgressAndResume=function(){for(var c=this._mediaElement.currentTime,a=this._mediaElement.buffered,v=!1,S=0;S<a.length;S++){var x=a.start(S),E=a.end(S);if(c>=x&&c<E){c>=E-this._config.lazyLoadRecoverDuration&&(v=!0);break}}v&&(window.clearInterval(this._progressChecker),this._progressChecker=null,v&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},f.prototype._isTimepointBuffered=function(c){for(var a=this._mediaElement.buffered,v=0;v<a.length;v++){var S=a.start(v),x=a.end(v);if(c>=S&&c<x)return!0}return!1},f.prototype._internalSeek=function(c){var a=this._isTimepointBuffered(c),v=!1,S=0;if(c<1&&this._mediaElement.buffered.length>0){var x=this._mediaElement.buffered.start(0);(x<1&&c<x||r.default.safari)&&(v=!0,S=r.default.safari?.1:x)}if(v)this._requestSetTime=!0,this._mediaElement.currentTime=S;else if(a){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=c;else{var E=this._msectl.getNearestKeyframe(Math.floor(c*1e3));this._requestSetTime=!0,E!=null?this._mediaElement.currentTime=E.dts/1e3:this._mediaElement.currentTime=c}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c)},f.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var c=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(c)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},f.prototype._checkAndResumeStuckPlayback=function(c){var a=this._mediaElement;if(c||!this._receivedCanPlay||a.readyState<2){var v=a.buffered;v.length>0&&a.currentTime<v.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+a.currentTime+", seek to "+v.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=v.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},f.prototype._onvLoadedMetadata=function(c){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},f.prototype._onvSeeking=function(c){var a=this._mediaElement.currentTime,v=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(a<1&&v.length>0){var S=v.start(0);if(S<1&&a<S||r.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=r.default.safari?.1:S;return}}if(this._isTimepointBuffered(a)){if(this._alwaysSeekKeyframe){var x=this._msectl.getNearestKeyframe(Math.floor(a*1e3));x!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=x.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:a,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},f.prototype._onvCanPlay=function(c){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},f.prototype._onvStalled=function(c){this._checkAndResumeStuckPlayback(!0)},f.prototype._onvProgress=function(c){this._checkAndResumeStuckPlayback()},f}();m.default=i},"./src/player/native-player.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./src/player/player-events.js"),r=D("./src/config.js"),l=D("./src/utils/exception.js"),n=function(){function d(u,h){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(g()),this._config=(0,r.createDefaultConfig)(),typeof h=="object"&&Object.assign(this._config,h),u.type.toLowerCase()==="flv")throw new l.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(u.hasOwnProperty("segments"))throw new l.InvalidArgumentException("NativePlayer("+u.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=u,this._mediaElement=null}return d.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(u,h){var t=this;u===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(o.default.MEDIA_INFO,t.mediaInfo)}):u===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(o.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(u,h)},d.prototype.off=function(u,h){this._emitter.removeListener(u,h)},d.prototype.attachMediaElement=function(u){if(this._mediaElement=u,u.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{u.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},d.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},d.prototype.load=function(){if(!this._mediaElement)throw new l.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},d.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},d.prototype.play=function(){return this._mediaElement.play()},d.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(u){this._mediaElement.volume=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(u){this._mediaElement.muted=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(u){this._mediaElement?this._mediaElement.currentTime=u:this._pendingSeekTime=u},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"mediaInfo",{get:function(){var u=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",h={mimeType:u+this._mediaDataSource.type};return this._mediaElement&&(h.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(h.width=this._mediaElement.videoWidth,h.height=this._mediaElement.videoHeight)),h},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"statisticsInfo",{get:function(){var u={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return u;var h=!0,t=0,e=0;if(this._mediaElement.getVideoPlaybackQuality){var s=this._mediaElement.getVideoPlaybackQuality();t=s.totalVideoFrames,e=s.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,e=this._mediaElement.webkitDroppedFrameCount):h=!1;return h&&(u.decodedFrames=t,u.droppedFrames=e),u},enumerable:!1,configurable:!0}),d.prototype._onvLoadedMetadata=function(u){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},d.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},d}();m.default=n},"./src/player/player-errors.js":function(p,m,D){D.r(m),D.d(m,{ErrorTypes:function(){return o},ErrorDetails:function(){return r}});var _=D("./src/io/loader.js"),g=D("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},r={NETWORK_EXCEPTION:_.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:_.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:_.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:_.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:g.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:g.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:g.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(p,m,D){D.r(m);var _={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=_},"./src/remux/aac-silent.js":function(p,m,D){D.r(m);var _=function(){function g(){}return g.getSilentFrame=function(o,r){if(o==="mp4a.40.2"){if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},g}();m.default=_},"./src/remux/mp4-generator.js":function(p,m,D){D.r(m);var _=function(){function g(){}return g.init=function(){g.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in g.types)g.types.hasOwnProperty(o)&&(g.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var r=g.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},g.box=function(o){for(var r=8,l=null,n=Array.prototype.slice.call(arguments,1),d=n.length,u=0;u<d;u++)r+=n[u].byteLength;l=new Uint8Array(r),l[0]=r>>>24&255,l[1]=r>>>16&255,l[2]=r>>>8&255,l[3]=r&255,l.set(o,4);for(var h=8,u=0;u<d;u++)l.set(n[u],h),h+=n[u].byteLength;return l},g.generateInitSegment=function(o){var r=g.box(g.types.ftyp,g.constants.FTYP),l=g.moov(o),n=new Uint8Array(r.byteLength+l.byteLength);return n.set(r,0),n.set(l,r.byteLength),n},g.moov=function(o){var r=g.mvhd(o.timescale,o.duration),l=g.trak(o),n=g.mvex(o);return g.box(g.types.moov,r,l,n)},g.mvhd=function(o,r){return g.box(g.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},g.trak=function(o){return g.box(g.types.trak,g.tkhd(o),g.mdia(o))},g.tkhd=function(o){var r=o.id,l=o.duration,n=o.presentWidth,d=o.presentHeight;return g.box(g.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,n&255,0,0,d>>>8&255,d&255,0,0]))},g.mdia=function(o){return g.box(g.types.mdia,g.mdhd(o),g.hdlr(o),g.minf(o))},g.mdhd=function(o){var r=o.timescale,l=o.duration;return g.box(g.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,85,196,0,0]))},g.hdlr=function(o){var r=null;return o.type==="audio"?r=g.constants.HDLR_AUDIO:r=g.constants.HDLR_VIDEO,g.box(g.types.hdlr,r)},g.minf=function(o){var r=null;return o.type==="audio"?r=g.box(g.types.smhd,g.constants.SMHD):r=g.box(g.types.vmhd,g.constants.VMHD),g.box(g.types.minf,r,g.dinf(),g.stbl(o))},g.dinf=function(){var o=g.box(g.types.dinf,g.box(g.types.dref,g.constants.DREF));return o},g.stbl=function(o){var r=g.box(g.types.stbl,g.stsd(o),g.box(g.types.stts,g.constants.STTS),g.box(g.types.stsc,g.constants.STSC),g.box(g.types.stsz,g.constants.STSZ),g.box(g.types.stco,g.constants.STCO));return r},g.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp3(o)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp4a(o)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.avc1(o))},g.mp3=function(o){var r=o.channelCount,l=o.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,l>>>8&255,l&255,0,0]);return g.box(g.types[".mp3"],n)},g.mp4a=function(o){var r=o.channelCount,l=o.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,l>>>8&255,l&255,0,0]);return g.box(g.types.mp4a,n,g.esds(o))},g.esds=function(o){var r=o.config||[],l=r.length,n=new Uint8Array([0,0,0,0,3,23+l,0,1,0,4,15+l,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([l]).concat(r).concat([6,1,2]));return g.box(g.types.esds,n)},g.avc1=function(o){var r=o.avcc,l=o.codecWidth,n=o.codecHeight,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>>8&255,l&255,n>>>8&255,n&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return g.box(g.types.avc1,d,g.box(g.types.avcC,r))},g.mvex=function(o){return g.box(g.types.mvex,g.trex(o))},g.trex=function(o){var r=o.id,l=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return g.box(g.types.trex,l)},g.moof=function(o,r){return g.box(g.types.moof,g.mfhd(o.sequenceNumber),g.traf(o,r))},g.mfhd=function(o){var r=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return g.box(g.types.mfhd,r)},g.traf=function(o,r){var l=o.id,n=g.box(g.types.tfhd,new Uint8Array([0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255])),d=g.box(g.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255])),u=g.sdtp(o),h=g.trun(o,u.byteLength+16+16+8+16+8+8);return g.box(g.types.traf,n,d,h,u)},g.sdtp=function(o){for(var r=o.samples||[],l=r.length,n=new Uint8Array(4+l),d=0;d<l;d++){var u=r[d].flags;n[d+4]=u.isLeading<<6|u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy}return g.box(g.types.sdtp,n)},g.trun=function(o,r){var l=o.samples||[],n=l.length,d=12+16*n,u=new Uint8Array(d);r+=8+d,u.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(var h=0;h<n;h++){var t=l[h].duration,e=l[h].size,s=l[h].flags,i=l[h].cts;u.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.isNonSync,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255],12+16*h)}return g.box(g.types.trun,u)},g.mdat=function(o){return g.box(g.types.mdat,o)},g}();_.init(),m.default=_},"./src/remux/mp4-remuxer.js":function(p,m,D){D.r(m);var _=D("./src/utils/logger.js"),g=D("./src/remux/mp4-generator.js"),o=D("./src/remux/aac-silent.js"),r=D("./src/utils/browser.js"),l=D("./src/core/media-segment-info.js"),n=D("./src/utils/exception.js"),d=function(){function u(h){this.TAG="MP4Remuxer",this._config=h,this._isLive=h.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new l.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new l.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(r.default.chrome&&(r.default.version.major<50||r.default.version.major===50&&r.default.version.build<2661)),this._fillSilentAfterSeek=r.default.msedge||r.default.msie,this._mp3UseMpegAudio=!r.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return u.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},u.prototype.bindDataSource=function(h){return h.onDataAvailable=this.remux.bind(this),h.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(u.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(h){this._onInitSegment=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(h){this._onMediaSegment=h},enumerable:!1,configurable:!0}),u.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},u.prototype.seek=function(h){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},u.prototype.remux=function(h,t){if(!this._onMediaSegment)throw new n.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(h,t),this._remuxVideo(t),this._remuxAudio(h)},u.prototype._onTrackMetadataReceived=function(h,t){var e=null,s="mp4",i=t.codec;if(h==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(s="mpeg",i="",e=new Uint8Array):e=g.default.generateInitSegment(t);else if(h==="video")this._videoMeta=t,e=g.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new n.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(h,{type:h,data:e.buffer,codec:i,container:h+"/"+s,mediaDuration:t.duration})},u.prototype._calculateDtsBase=function(h,t){this._dtsBaseInited||(h.samples&&h.samples.length&&(this._audioDtsBase=h.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},u.prototype.flushStashedSamples=function(){var h=this._videoStashedLastSample,t=this._audioStashedLastSample,e={type:"video",id:1,sequenceNumber:0,samples:[],length:0};h!=null&&(e.samples.push(h),e.length=h.length);var s={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(s.samples.push(t),s.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(e,!0),this._remuxAudio(s,!0)},u.prototype._remuxAudio=function(h,t){if(this._audioMeta!=null){var e=h,s=e.samples,i=void 0,f=-1,c=-1,a=this._audioMeta.refSampleDuration,v=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,S=this._dtsBaseInited&&this._audioNextDts===void 0,x=!1;if(!(!s||s.length===0)&&!(s.length===1&&!t)){var E=0,L=null,b=0;v?(E=0,b=e.length):(E=8,b=8+e.length);var A=null;if(s.length>1&&(A=s.pop(),b-=A.length),this._audioStashedLastSample!=null){var O=this._audioStashedLastSample;this._audioStashedLastSample=null,s.unshift(O),b+=O.length}A!=null&&(this._audioStashedLastSample=A);var R=s[0].dts-this._dtsBase;if(this._audioNextDts)i=R-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())i=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(x=!0);else{var I=this._audioSegmentInfoList.getLastSampleBefore(R);if(I!=null){var C=R-(I.originalDts+I.duration);C<=3&&(C=0);var F=I.dts+I.duration+C;i=R-F}else i=0}if(x){var w=R-i,k=this._videoSegmentInfoList.getLastSegmentBefore(R);if(k!=null&&k.beginDts<w){var B=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(B){var U=k.beginDts,N=w-k.beginDts;_.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+U+", duration: "+N),s.unshift({unit:B,dts:U,pts:U}),b+=B.byteLength}}else x=!1}for(var j=[],K=0;K<s.length;K++){var O=s[K],V=O.unit,H=O.dts-this._dtsBase,U=H,Y=!1,q=null,$=0;if(!(H<-.001)){if(this._audioMeta.codec!=="mp3"){var G=H,re=3;if(this._audioNextDts&&(G=this._audioNextDts),i=H-G,i<=-re*a){_.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+H+" ms ,curRefDts: "+G+" ms)  due to dtsCorrection: "+i+" ms overlap.");continue}else if(i>=re*a&&this._fillAudioTimestampGap&&!r.default.safari){Y=!0;var Q=Math.floor(i/a);_.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+H+" ms, curRefDts: "+G+" ms, ")+("dtsCorrection: "+Math.round(i)+" ms, generate: "+Q+" frames")),U=Math.floor(G),$=Math.floor(G+a)-U;var B=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);B==null&&(_.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),B=V),q=[];for(var ee=0;ee<Q;ee++){G=G+a;var se=Math.floor(G),ae=Math.floor(G+a)-se,oe={dts:se,pts:se,cts:0,unit:B,size:B.byteLength,duration:ae,originalDts:H,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};q.push(oe),b+=oe.size}this._audioNextDts=G+a}else U=Math.floor(G),$=Math.floor(G+a)-U,this._audioNextDts=G+a}else{if(U=H-i,K!==s.length-1){var fe=s[K+1].dts-this._dtsBase-i;$=fe-U}else if(A!=null){var fe=A.dts-this._dtsBase-i;$=fe-U}else j.length>=1?$=j[j.length-1].duration:$=Math.floor(a);this._audioNextDts=U+$}f===-1&&(f=U),j.push({dts:U,pts:U,cts:0,unit:O.unit,size:O.unit.byteLength,duration:$,originalDts:H,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Y&&j.push.apply(j,q)}}if(j.length===0){e.samples=[],e.length=0;return}v?L=new Uint8Array(b):(L=new Uint8Array(b),L[0]=b>>>24&255,L[1]=b>>>16&255,L[2]=b>>>8&255,L[3]=b&255,L.set(g.default.types.mdat,4));for(var K=0;K<j.length;K++){var V=j[K].unit;L.set(V,E),E+=V.byteLength}var te=j[j.length-1];c=te.dts+te.duration;var le=new l.MediaSegmentInfo;le.beginDts=f,le.endDts=c,le.beginPts=f,le.endPts=c,le.originalBeginDts=j[0].originalDts,le.originalEndDts=te.originalDts+te.duration,le.firstSample=new l.SampleInfo(j[0].dts,j[0].pts,j[0].duration,j[0].originalDts,!1),le.lastSample=new l.SampleInfo(te.dts,te.pts,te.duration,te.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(le),e.samples=j,e.sequenceNumber++;var de=null;v?de=new Uint8Array:de=g.default.moof(e,f),e.samples=[],e.length=0;var ce={type:"audio",data:this._mergeBoxes(de,L).buffer,sampleCount:j.length,info:le};v&&S&&(ce.timestampOffset=f),this._onMediaSegment("audio",ce)}}},u.prototype._remuxVideo=function(h,t){if(this._videoMeta!=null){var e=h,s=e.samples,i=void 0,f=-1,c=-1,a=-1,v=-1;if(!(!s||s.length===0)&&!(s.length===1&&!t)){var S=8,x=null,E=8+h.length,L=null;if(s.length>1&&(L=s.pop(),E-=L.length),this._videoStashedLastSample!=null){var b=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(b),E+=b.length}L!=null&&(this._videoStashedLastSample=L);var A=s[0].dts-this._dtsBase;if(this._videoNextDts)i=A-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())i=0;else{var O=this._videoSegmentInfoList.getLastSampleBefore(A);if(O!=null){var R=A-(O.originalDts+O.duration);R<=3&&(R=0);var I=O.dts+O.duration+R;i=A-I}else i=0}for(var C=new l.MediaSegmentInfo,F=[],w=0;w<s.length;w++){var b=s[w],k=b.dts-this._dtsBase,B=b.isKeyframe,U=k-i,N=b.cts,j=U+N;f===-1&&(f=U,a=j);var K=0;if(w!==s.length-1){var V=s[w+1].dts-this._dtsBase-i;K=V-U}else if(L!=null){var V=L.dts-this._dtsBase-i;K=V-U}else F.length>=1?K=F[F.length-1].duration:K=Math.floor(this._videoMeta.refSampleDuration);if(B){var H=new l.SampleInfo(U,j,K,b.dts,!0);H.fileposition=b.fileposition,C.appendSyncPoint(H)}F.push({dts:U,pts:j,cts:N,units:b.units,size:b.length,isKeyframe:B,duration:K,originalDts:k,flags:{isLeading:0,dependsOn:B?2:1,isDependedOn:B?1:0,hasRedundancy:0,isNonSync:B?0:1}})}x=new Uint8Array(E),x[0]=E>>>24&255,x[1]=E>>>16&255,x[2]=E>>>8&255,x[3]=E&255,x.set(g.default.types.mdat,4);for(var w=0;w<F.length;w++)for(var Y=F[w].units;Y.length;){var q=Y.shift(),$=q.data;x.set($,S),S+=$.byteLength}var G=F[F.length-1];if(c=G.dts+G.duration,v=G.pts+G.duration,this._videoNextDts=c,C.beginDts=f,C.endDts=c,C.beginPts=a,C.endPts=v,C.originalBeginDts=F[0].originalDts,C.originalEndDts=G.originalDts+G.duration,C.firstSample=new l.SampleInfo(F[0].dts,F[0].pts,F[0].duration,F[0].originalDts,F[0].isKeyframe),C.lastSample=new l.SampleInfo(G.dts,G.pts,G.duration,G.originalDts,G.isKeyframe),this._isLive||this._videoSegmentInfoList.append(C),e.samples=F,e.sequenceNumber++,this._forceFirstIDR){var re=F[0].flags;re.dependsOn=2,re.isNonSync=0}var Q=g.default.moof(e,f);e.samples=[],e.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Q,x).buffer,sampleCount:F.length,info:C})}}},u.prototype._mergeBoxes=function(h,t){var e=new Uint8Array(h.byteLength+t.byteLength);return e.set(h,0),e.set(t,h.byteLength),e},u}();m.default=d},"./src/utils/browser.js":function(p,m,D){D.r(m);var _={};function g(){var o=self.navigator.userAgent.toLowerCase(),r=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],l=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],n={browser:r[5]||r[3]||r[1]||"",version:r[2]||r[4]||"0",majorVersion:r[4]||r[2]||"0",platform:l[0]||""},d={};if(n.browser){d[n.browser]=!0;var u=n.majorVersion.split(".");d.version={major:parseInt(n.majorVersion,10),string:n.version},u.length>1&&(d.version.minor=parseInt(u[1],10)),u.length>2&&(d.version.build=parseInt(u[2],10))}if(n.platform&&(d[n.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv||d.iemobile){d.rv&&delete d.rv;var h="msie";n.browser=h,d[h]=!0}if(d.edge){delete d.edge;var t="msedge";n.browser=t,d[t]=!0}if(d.opr){var e="opera";n.browser=e,d[e]=!0}if(d.safari&&d.android){var s="android";n.browser=s,d[s]=!0}d.name=n.browser,d.platform=n.platform;for(var i in _)_.hasOwnProperty(i)&&delete _[i];Object.assign(_,d)}g(),m.default=_},"./src/utils/exception.js":function(p,m,D){D.r(m),D.d(m,{RuntimeException:function(){return g},IllegalStateException:function(){return o},InvalidArgumentException:function(){return r},NotImplementedException:function(){return l}});var _=function(){var n=function(d,u){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},n(d,u)};return function(d,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");n(d,u);function h(){this.constructor=d}d.prototype=u===null?Object.create(u):(h.prototype=u.prototype,new h)}}(),g=function(){function n(d){this._message=d}return Object.defineProperty(n.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),n.prototype.toString=function(){return this.name+": "+this.message},n}(),o=function(n){_(d,n);function d(u){return n.call(this,u)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),d}(g),r=function(n){_(d,n);function d(u){return n.call(this,u)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),d}(g),l=function(n){_(d,n);function d(u){return n.call(this,u)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),d}(g)},"./src/utils/logger.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=function(){function r(){}return r.e=function(l,n){(!l||r.FORCE_GLOBAL_TAG)&&(l=r.GLOBAL_TAG);var d="["+l+"] > "+n;r.ENABLE_CALLBACK&&r.emitter.emit("log","error",d),r.ENABLE_ERROR&&(console.error?console.error(d):console.warn?console.warn(d):console.log(d))},r.i=function(l,n){(!l||r.FORCE_GLOBAL_TAG)&&(l=r.GLOBAL_TAG);var d="["+l+"] > "+n;r.ENABLE_CALLBACK&&r.emitter.emit("log","info",d),r.ENABLE_INFO&&(console.info?console.info(d):console.log(d))},r.w=function(l,n){(!l||r.FORCE_GLOBAL_TAG)&&(l=r.GLOBAL_TAG);var d="["+l+"] > "+n;r.ENABLE_CALLBACK&&r.emitter.emit("log","warn",d),r.ENABLE_WARN&&(console.warn?console.warn(d):console.log(d))},r.d=function(l,n){(!l||r.FORCE_GLOBAL_TAG)&&(l=r.GLOBAL_TAG);var d="["+l+"] > "+n;r.ENABLE_CALLBACK&&r.emitter.emit("log","debug",d),r.ENABLE_DEBUG&&(console.debug?console.debug(d):console.log(d))},r.v=function(l,n){(!l||r.FORCE_GLOBAL_TAG)&&(l=r.GLOBAL_TAG);var d="["+l+"] > "+n;r.ENABLE_CALLBACK&&r.emitter.emit("log","verbose",d),r.ENABLE_VERBOSE&&console.log(d)},r}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(g()),m.default=o},"./src/utils/logging-control.js":function(p,m,D){D.r(m);var _=D("./node_modules/events/events.js"),g=D.n(_),o=D("./src/utils/logger.js"),r=function(){function l(){}return Object.defineProperty(l,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(n){o.default.FORCE_GLOBAL_TAG=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(n){o.default.GLOBAL_TAG=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(n){o.default.ENABLE_VERBOSE=n,o.default.ENABLE_DEBUG=n,o.default.ENABLE_INFO=n,o.default.ENABLE_WARN=n,o.default.ENABLE_ERROR=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(n){o.default.ENABLE_DEBUG=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(n){o.default.ENABLE_VERBOSE=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(n){o.default.ENABLE_INFO=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(n){o.default.ENABLE_WARN=n,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(n){o.default.ENABLE_ERROR=n,l._notifyChange()},enumerable:!1,configurable:!0}),l.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},l.applyConfig=function(n){o.default.GLOBAL_TAG=n.globalTag,o.default.FORCE_GLOBAL_TAG=n.forceGlobalTag,o.default.ENABLE_VERBOSE=n.enableVerbose,o.default.ENABLE_DEBUG=n.enableDebug,o.default.ENABLE_INFO=n.enableInfo,o.default.ENABLE_WARN=n.enableWarn,o.default.ENABLE_ERROR=n.enableError,o.default.ENABLE_CALLBACK=n.enableCallback},l._notifyChange=function(){var n=l.emitter;if(n.listenerCount("change")>0){var d=l.getConfig();n.emit("change",d)}},l.registerListener=function(n){l.emitter.addListener("change",n)},l.removeListener=function(n){l.emitter.removeListener("change",n)},l.addLogListener=function(n){o.default.emitter.addListener("log",n),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,l._notifyChange())},l.removeLogListener=function(n){o.default.emitter.removeListener("log",n),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,l._notifyChange())},l}();r.emitter=new(g()),m.default=r},"./src/utils/polyfill.js":function(p,m,D){D.r(m);var _=function(){function g(){}return g.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,r){return o.__proto__=r,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(o),l=1;l<arguments.length;l++){var n=arguments[l];if(n!=null)for(var d in n)n.hasOwnProperty(d)&&(r[d]=n[d])}return r},typeof self.Promise!="function"&&D("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},g}();_.install(),m.default=_},"./src/utils/utf8-conv.js":function(p,m,D){D.r(m);function _(o,r,l){var n=o;if(r+l<n.length){for(;l--;)if((n[++r]&192)!==128)return!1;return!0}else return!1}function g(o){for(var r=[],l=o,n=0,d=o.length;n<d;){if(l[n]<128){r.push(String.fromCharCode(l[n])),++n;continue}else if(!(l[n]<192)){if(l[n]<224){if(_(l,n,1)){var u=(l[n]&31)<<6|l[n+1]&63;if(u>=128){r.push(String.fromCharCode(u&65535)),n+=2;continue}}}else if(l[n]<240){if(_(l,n,2)){var u=(l[n]&15)<<12|(l[n+1]&63)<<6|l[n+2]&63;if(u>=2048&&(u&63488)!==55296){r.push(String.fromCharCode(u&65535)),n+=3;continue}}}else if(l[n]<248&&_(l,n,3)){var u=(l[n]&7)<<18|(l[n+1]&63)<<12|(l[n+2]&63)<<6|l[n+3]&63;if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(u&1023|56320)),n+=4;continue}}}r.push(String.fromCharCode(65533)),++n}return r.join("")}m.default=g}},P={};function y(p){var m=P[p];if(m!==void 0)return m.exports;var D=P[p]={exports:{}};return M[p].call(D.exports,D,D.exports,y),D.exports}y.m=M,function(){y.n=function(p){var m=p&&p.__esModule?function(){return p.default}:function(){return p};return y.d(m,{a:m}),m}}(),function(){y.d=function(p,m){for(var D in m)y.o(m,D)&&!y.o(p,D)&&Object.defineProperty(p,D,{enumerable:!0,get:m[D]})}}(),function(){y.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){y.o=function(p,m){return Object.prototype.hasOwnProperty.call(p,m)}}(),function(){y.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})}}();var T=y("./src/index.js");return T}()})})(Xe);const _t=Fe(Xe.exports);var Je={exports:{}};(function(Ee,Re){typeof window<"u"&&function(P,y){Ee.exports=y()}(Pe,function(){return function(M){var P={};function y(T){if(P[T])return P[T].exports;var p=P[T]={i:T,l:!1,exports:{}};return M[T].call(p.exports,p,p.exports,y),p.l=!0,p.exports}return y.m=M,y.c=P,y.d=function(T,p,m){y.o(T,p)||Object.defineProperty(T,p,{enumerable:!0,get:m})},y.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},y.t=function(T,p){if(p&1&&(T=y(T)),p&8||p&4&&typeof T=="object"&&T&&T.__esModule)return T;var m=Object.create(null);if(y.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:T}),p&2&&typeof T!="string")for(var D in T)y.d(m,D,function(_){return T[_]}.bind(null,D));return m},y.n=function(T){var p=T&&T.__esModule?function(){return T.default}:function(){return T};return y.d(p,"a",p),p},y.o=function(T,p){return Object.prototype.hasOwnProperty.call(T,p)},y.p="/dist/",y(y.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(M,P,y){var T=Object.prototype.hasOwnProperty,p="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(p=!1));function D(r,l,n){this.fn=r,this.context=l,this.once=n||!1}function _(r,l,n,d,u){if(typeof n!="function")throw new TypeError("The listener must be a function");var h=new D(n,d||r,u),t=p?p+l:l;return r._events[t]?r._events[t].fn?r._events[t]=[r._events[t],h]:r._events[t].push(h):(r._events[t]=h,r._eventsCount++),r}function g(r,l){--r._eventsCount===0?r._events=new m:delete r._events[l]}function o(){this._events=new m,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],n,d;if(this._eventsCount===0)return l;for(d in n=this._events)T.call(n,d)&&l.push(p?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(n)):l},o.prototype.listeners=function(l){var n=p?p+l:l,d=this._events[n];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,h=d.length,t=new Array(h);u<h;u++)t[u]=d[u].fn;return t},o.prototype.listenerCount=function(l){var n=p?p+l:l,d=this._events[n];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,n,d,u,h,t){var e=p?p+l:l;if(!this._events[e])return!1;var s=this._events[e],i=arguments.length,f,c;if(s.fn){switch(s.once&&this.removeListener(l,s.fn,void 0,!0),i){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,n),!0;case 3:return s.fn.call(s.context,n,d),!0;case 4:return s.fn.call(s.context,n,d,u),!0;case 5:return s.fn.call(s.context,n,d,u,h),!0;case 6:return s.fn.call(s.context,n,d,u,h,t),!0}for(c=1,f=new Array(i-1);c<i;c++)f[c-1]=arguments[c];s.fn.apply(s.context,f)}else{var a=s.length,v;for(c=0;c<a;c++)switch(s[c].once&&this.removeListener(l,s[c].fn,void 0,!0),i){case 1:s[c].fn.call(s[c].context);break;case 2:s[c].fn.call(s[c].context,n);break;case 3:s[c].fn.call(s[c].context,n,d);break;case 4:s[c].fn.call(s[c].context,n,d,u);break;default:if(!f)for(v=1,f=new Array(i-1);v<i;v++)f[v-1]=arguments[v];s[c].fn.apply(s[c].context,f)}}return!0},o.prototype.on=function(l,n,d){return _(this,l,n,d,!1)},o.prototype.once=function(l,n,d){return _(this,l,n,d,!0)},o.prototype.removeListener=function(l,n,d,u){var h=p?p+l:l;if(!this._events[h])return this;if(!n)return g(this,h),this;var t=this._events[h];if(t.fn)t.fn===n&&(!u||t.once)&&(!d||t.context===d)&&g(this,h);else{for(var e=0,s=[],i=t.length;e<i;e++)(t[e].fn!==n||u&&!t[e].once||d&&t[e].context!==d)&&s.push(t[e]);s.length?this._events[h]=s.length===1?s[0]:s:g(this,h)}return this},o.prototype.removeAllListeners=function(l){var n;return l?(n=p?p+l:l,this._events[n]&&g(this,n)):(this._events=new m,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=p,o.EventEmitter=o,M.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(M,P,y){(function(T){var p=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,m=/^(?=([^\/?#]*))\1([^]*)$/,D=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(o,r,l){if(l=l||{},o=o.trim(),r=r.trim(),!r){if(!l.alwaysNormalize)return o;var n=g.parseURL(o);if(!n)throw new Error("Error trying to parse base URL.");return n.path=g.normalizePath(n.path),g.buildURLFromParts(n)}var d=g.parseURL(r);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return l.alwaysNormalize?(d.path=g.normalizePath(d.path),g.buildURLFromParts(d)):r;var u=g.parseURL(o);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&u.path[0]!=="/"){var h=m.exec(u.path);u.netLoc=h[1],u.path=h[2]}u.netLoc&&!u.path&&(u.path="/");var t={scheme:u.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(t.netLoc=u.netLoc,d.path[0]!=="/"))if(!d.path)t.path=u.path,d.params||(t.params=u.params,d.query||(t.query=u.query));else{var e=u.path,s=e.substring(0,e.lastIndexOf("/")+1)+d.path;t.path=g.normalizePath(s)}return t.path===null&&(t.path=l.alwaysNormalize?g.normalizePath(d.path):d.path),g.buildURLFromParts(t)},parseURL:function(o){var r=p.exec(o);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(D,"");o.length!==(o=o.replace(_,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}};M.exports=g})()},"./node_modules/webworkify-webpack/index.js":function(M,P,y){function T(l){var n={};function d(h){if(n[h])return n[h].exports;var t=n[h]={i:h,l:!1,exports:{}};return l[h].call(t.exports,t,t.exports,d),t.l=!0,t.exports}d.m=l,d.c=n,d.i=function(h){return h},d.d=function(h,t,e){d.o(h,t)||Object.defineProperty(h,t,{configurable:!1,enumerable:!0,get:e})},d.r=function(h){Object.defineProperty(h,"__esModule",{value:!0})},d.n=function(h){var t=h&&h.__esModule?function(){return h.default}:function(){return h};return d.d(t,"a",t),t},d.o=function(h,t){return Object.prototype.hasOwnProperty.call(h,t)},d.p="/",d.oe=function(h){throw console.error(h),h};var u=d(d.s=ENTRY_MODULE);return u.default||u}var p="[\\.|\\-|\\+|\\w|/|@]+",m="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+p+").*?\\)";function D(l){return(l+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(l){return!isNaN(1*l)}function g(l,n,d){var u={};u[d]=[];var h=n.toString(),t=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!t)return u;for(var e=t[1],s=new RegExp("(\\\\n|\\W)"+D(e)+m,"g"),i;i=s.exec(h);)i[3]!=="dll-reference"&&u[d].push(i[3]);for(s=new RegExp("\\("+D(e)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+m,"g");i=s.exec(h);)l[i[2]]||(u[d].push(i[1]),l[i[2]]=y(i[1]).m),u[i[2]]=u[i[2]]||[],u[i[2]].push(i[4]);for(var f=Object.keys(u),c=0;c<f.length;c++)for(var a=0;a<u[f[c]].length;a++)_(u[f[c]][a])&&(u[f[c]][a]=1*u[f[c]][a]);return u}function o(l){var n=Object.keys(l);return n.reduce(function(d,u){return d||l[u].length>0},!1)}function r(l,n){for(var d={main:[n]},u={main:[]},h={main:{}};o(d);)for(var t=Object.keys(d),e=0;e<t.length;e++){var s=t[e],i=d[s],f=i.pop();if(h[s]=h[s]||{},!(h[s][f]||!l[s][f])){h[s][f]=!0,u[s]=u[s]||[],u[s].push(f);for(var c=g(l,l[s][f],s),a=Object.keys(c),v=0;v<a.length;v++)d[a[v]]=d[a[v]]||[],d[a[v]]=d[a[v]].concat(c[a[v]])}}return u}M.exports=function(l,n){n=n||{};var d={main:y.m},u=n.all?{main:Object.keys(d.main)}:r(d,l),h="";Object.keys(u).filter(function(f){return f!=="main"}).forEach(function(f){for(var c=0;u[f][c];)c++;u[f].push(c),d[f][c]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+f+" = ("+T.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+u[f].map(function(a){return""+JSON.stringify(a)+": "+d[f][a].toString()}).join(",")+`});
`}),h=h+"new (("+T.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+u.main.map(function(f){return""+JSON.stringify(f)+": "+d.main[f].toString()}).join(",")+"}))(self);";var t=new window.Blob([h],{type:"text/javascript"});if(n.bare)return t;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,s=e.createObjectURL(t),i=new window.Worker(s);return i.objectURL=s,i}},"./src/config.ts":function(M,P,y){y.r(P),y.d(P,"hlsDefaultConfig",function(){return v}),y.d(P,"mergeConfig",function(){return x}),y.d(P,"enableStreamingMode",function(){return E});var T=y("./src/controller/abr-controller.ts"),p=y("./src/controller/audio-stream-controller.ts"),m=y("./src/controller/audio-track-controller.ts"),D=y("./src/controller/subtitle-stream-controller.ts"),_=y("./src/controller/subtitle-track-controller.ts"),g=y("./src/controller/buffer-controller.ts"),o=y("./src/controller/timeline-controller.ts"),r=y("./src/controller/cap-level-controller.ts"),l=y("./src/controller/fps-controller.ts"),n=y("./src/controller/eme-controller.ts"),d=y("./src/controller/cmcd-controller.ts"),u=y("./src/utils/xhr-loader.ts"),h=y("./src/utils/fetch-loader.ts"),t=y("./src/utils/cues.ts"),e=y("./src/utils/mediakeys-helper.ts"),s=y("./src/utils/logger.ts");function i(){return i=Object.assign?Object.assign.bind():function(L){for(var b=1;b<arguments.length;b++){var A=arguments[b];for(var O in A)Object.prototype.hasOwnProperty.call(A,O)&&(L[O]=A[O])}return L},i.apply(this,arguments)}function f(L,b){var A=Object.keys(L);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(L);b&&(O=O.filter(function(R){return Object.getOwnPropertyDescriptor(L,R).enumerable})),A.push.apply(A,O)}return A}function c(L){for(var b=1;b<arguments.length;b++){var A=arguments[b]!=null?arguments[b]:{};b%2?f(Object(A),!0).forEach(function(O){a(L,O,A[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(A)):f(Object(A)).forEach(function(O){Object.defineProperty(L,O,Object.getOwnPropertyDescriptor(A,O))})}return L}function a(L,b,A){return b in L?Object.defineProperty(L,b,{value:A,enumerable:!0,configurable:!0,writable:!0}):L[b]=A,L}var v=c(c({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:u.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:T.default,bufferController:g.default,capLevelController:r.default,fpsController:l.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},S()),{},{subtitleStreamController:D.SubtitleStreamController,subtitleTrackController:_.default,timelineController:o.TimelineController,audioStreamController:p.default,audioTrackController:m.default,emeController:n.default,cmcdController:d.default});function S(){return{cueHandler:t.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function x(L,b){if((b.liveSyncDurationCount||b.liveMaxLatencyDurationCount)&&(b.liveSyncDuration||b.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(b.liveMaxLatencyDurationCount!==void 0&&(b.liveSyncDurationCount===void 0||b.liveMaxLatencyDurationCount<=b.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(b.liveMaxLatencyDuration!==void 0&&(b.liveSyncDuration===void 0||b.liveMaxLatencyDuration<=b.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return i({},L,b)}function E(L){var b=L.loader;if(b!==h.default&&b!==u.default)s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1;else{var A=Object(h.fetchSupported)();A&&(L.loader=h.default,L.progressive=!0,L.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/utils/ewma-bandwidth-estimator.ts"),m=y("./src/events.ts"),D=y("./src/utils/buffer-helper.ts"),_=y("./src/errors.ts"),g=y("./src/types/loader.ts"),o=y("./src/utils/logger.ts");function r(d,u){for(var h=0;h<u.length;h++){var t=u[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function l(d,u,h){return u&&r(d.prototype,u),h&&r(d,h),Object.defineProperty(d,"prototype",{writable:!1}),d}var n=function(){function d(h){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=h;var t=h.config;this.bwEstimator=new p.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var u=d.prototype;return u.registerListeners=function(){var t=this.hls;t.on(m.Events.FRAG_LOADING,this.onFragLoading,this),t.on(m.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(m.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var t=this.hls;t.off(m.Events.FRAG_LOADING,this.onFragLoading,this),t.off(m.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(m.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},u.onFragLoading=function(t,e){var s=e.frag;if(s.type===g.PlaylistLevelType.MAIN&&!this.timer){var i;this.fragCurrent=s,this.partCurrent=(i=e.part)!=null?i:null,this.timer=self.setInterval(this.onCheck,100)}},u.onLevelLoaded=function(t,e){var s=this.hls.config;e.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},u._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,s=this.hls,i=s.autoLevelEnabled,f=s.config,c=s.media;if(!(!t||!c)){var a=e?e.stats:t.stats,v=e?e.duration:t.duration;if(a.aborted){o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!i||c.paused||!c.playbackRate||!c.readyState)){var S=performance.now()-a.loading.start,x=Math.abs(c.playbackRate);if(!(S<=500*v/x)){var E=s.levels,L=s.minAutoLevel,b=E[t.level],A=a.total||Math.max(a.loaded,Math.round(v*b.maxBitrate/8)),O=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/S),R=(A-a.loaded)/O,I=c.currentTime,C=(D.BufferHelper.bufferInfo(c,I,f.maxBufferHole).end-I)/x;if(!(C>=2*v/x||R<=C)){var F=Number.POSITIVE_INFINITY,w;for(w=t.level-1;w>L;w--){var k=E[w].maxBitrate;if(F=v*k/(8*.8*O),F<C)break}if(!(F>=R)){var B=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+w+`
      Current BW estimate: `+(Object(T.isFiniteNumber)(B)?(B/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),s.nextLoadLevel=w,this.bwEstimator.sample(S,a.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),s.trigger(m.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a})}}}}}},u.onFragLoaded=function(t,e){var s=e.frag,i=e.part;if(s.type===g.PlaylistLevelType.MAIN&&Object(T.isFiniteNumber)(s.sn)){var f=i?i.stats:s.stats,c=i?i.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[s.level],v=(a.loaded?a.loaded.bytes:0)+f.loaded,S=(a.loaded?a.loaded.duration:0)+c;a.loaded={bytes:v,duration:S},a.realBitrate=Math.round(8*v/S)}if(s.bitrateTest){var x={stats:f,frag:s,part:i,id:s.type};this.onFragBuffered(m.Events.FRAG_BUFFERED,x)}}},u.onFragBuffered=function(t,e){var s=e.frag,i=e.part,f=i?i.stats:s.stats;if(!f.aborted&&!(s.type!==g.PlaylistLevelType.MAIN||s.sn==="initSegment")){var c=f.parsing.end-f.loading.start;this.bwEstimator.sample(c,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}},u.onError=function(t,e){switch(e.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},u.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},u.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,s=this.hls,i=s.maxAutoLevel,f=s.config,c=s.minAutoLevel,a=s.media,v=e?e.duration:t?t.duration:0,S=a?a.currentTime:0,x=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,E=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,L=(D.BufferHelper.bufferInfo(a,S,f.maxBufferHole).end-S)/x,b=this.findBestLevel(E,c,i,L,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(b>=0)return b;o.logger.trace((L?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var A=v?Math.min(v,f.maxStarvationDelay):f.maxStarvationDelay,O=f.abrBandWidthFactor,R=f.abrBandWidthUpFactor;if(!L){var I=this.bitrateTestDelay;if(I){var C=v?Math.min(v,f.maxLoadingDelay):f.maxLoadingDelay;A=C-I,o.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*A)+" ms"),O=R=1}}return b=this.findBestLevel(E,c,i,L+A,O,R),Math.max(b,0)},u.findBestLevel=function(t,e,s,i,f,c){for(var a,v=this.fragCurrent,S=this.partCurrent,x=this.lastLoadedFragLevel,E=this.hls.levels,L=E[x],b=!!(L!=null&&(a=L.details)!==null&&a!==void 0&&a.live),A=L==null?void 0:L.codecSet,O=S?S.duration:v?v.duration:0,R=s;R>=e;R--){var I=E[R];if(!(!I||A&&I.codecSet!==A)){var C=I.details,F=(S?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||O,w=void 0;R<=x?w=f*t:w=c*t;var k=E[R].maxBitrate,B=k*F/w;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(w)+"/"+k+"/"+F+"/"+i+"/"+B),w>k&&(!B||b&&!this.bitrateTestDelay||B<i))return R}}return-1},l(d,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&!e.canEstimate())return t;var s=this.getNextABRAutoLevel();return t!==-1&&this.hls.levels[s].loadError?t:(t!==-1&&(s=Math.min(t,s)),s)},set:function(t){this._nextAutoLevel=t}}]),d}();P.default=n},"./src/controller/audio-stream-controller.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/controller/base-stream-controller.ts"),m=y("./src/events.ts"),D=y("./src/utils/buffer-helper.ts"),_=y("./src/controller/fragment-tracker.ts"),g=y("./src/types/level.ts"),o=y("./src/types/loader.ts"),r=y("./src/loader/fragment.ts"),l=y("./src/demux/chunk-cache.ts"),n=y("./src/demux/transmuxer-interface.ts"),d=y("./src/types/transmuxer.ts"),u=y("./src/controller/fragment-finders.ts"),h=y("./src/utils/discontinuities.ts"),t=y("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(a){for(var v=1;v<arguments.length;v++){var S=arguments[v];for(var x in S)Object.prototype.hasOwnProperty.call(S,x)&&(a[x]=S[x])}return a},e.apply(this,arguments)}function s(a,v){a.prototype=Object.create(v.prototype),a.prototype.constructor=a,i(a,v)}function i(a,v){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,E){return x.__proto__=E,x},i(a,v)}var f=100,c=function(a){s(v,a);function v(x,E){var L;return L=a.call(this,x,E,"[audio-stream-controller]")||this,L.videoBuffer=null,L.videoTrackCC=-1,L.waitingVideoCC=-1,L.audioSwitch=!1,L.trackId=-1,L.waitingData=null,L.mainDetails=null,L.bufferFlushed=!1,L.cachedTrackLoadedData=null,L._registerListeners(),L}var S=v.prototype;return S.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},S._registerListeners=function(){var E=this.hls;E.on(m.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.on(m.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(m.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(m.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),E.on(m.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),E.on(m.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),E.on(m.Events.ERROR,this.onError,this),E.on(m.Events.BUFFER_RESET,this.onBufferReset,this),E.on(m.Events.BUFFER_CREATED,this.onBufferCreated,this),E.on(m.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),E.on(m.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),E.on(m.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S._unregisterListeners=function(){var E=this.hls;E.off(m.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.off(m.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(m.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(m.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),E.off(m.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),E.off(m.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),E.off(m.Events.ERROR,this.onError,this),E.off(m.Events.BUFFER_RESET,this.onBufferReset,this),E.off(m.Events.BUFFER_CREATED,this.onBufferCreated,this),E.off(m.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),E.off(m.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),E.off(m.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S.onInitPtsFound=function(E,L){var b=L.frag,A=L.id,O=L.initPTS;if(A==="main"){var R=b.cc;this.initPTS[b.cc]=O,this.log("InitPTS for cc: "+R+" found from main: "+O),this.videoTrackCC=R,this.state===p.State.WAITING_INIT_PTS&&this.tick()}},S.startLoad=function(E){if(!this.levels){this.startPosition=E,this.state=p.State.STOPPED;return}var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(f),this.fragLoadError=0,L>0&&E===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),E=L,this.state=p.State.IDLE):(this.loadedmetadata=!1,this.state=p.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=E,this.tick()},S.doTick=function(){switch(this.state){case p.State.IDLE:this.doTickIdle();break;case p.State.WAITING_TRACK:{var E,L=this.levels,b=this.trackId,A=L==null||(E=L[b])===null||E===void 0?void 0:E.details;if(A){if(this.waitForCdnTuneIn(A))break;this.state=p.State.WAITING_INIT_PTS}break}case p.State.FRAG_LOADING_WAITING_RETRY:{var O,R=performance.now(),I=this.retryDate;(!I||R>=I||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=p.State.IDLE);break}case p.State.WAITING_INIT_PTS:{var C=this.waitingData;if(C){var F=C.frag,w=C.part,k=C.cache,B=C.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=p.State.FRAG_LOADING;var U=k.flush(),N={frag:F,part:w,payload:U,networkDetails:null};this._handleFragmentLoadProgress(N),B&&a.prototype._handleFragmentLoadComplete.call(this,N)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),K=D.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),V=Object(u.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,F);V<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=p.State.IDLE}}this.onTickEnd()},S.clearWaitingFragment=function(){var E=this.waitingData;E&&(this.fragmentTracker.removeFragment(E.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=p.State.IDLE)},S.resetLoadingState=function(){this.clearWaitingFragment(),a.prototype.resetLoadingState.call(this)},S.onTickEnd=function(){var E=this.media;if(!(!E||!E.readyState)){var L=this.mediaBuffer?this.mediaBuffer:E,b=L.buffered;!this.loadedmetadata&&b.length&&(this.loadedmetadata=!0),this.lastCurrentTime=E.currentTime}},S.doTickIdle=function(){var E,L,b=this.hls,A=this.levels,O=this.media,R=this.trackId,I=b.config;if(!(!A||!A[R])&&!(!O&&(this.startFragRequested||!I.startFragPrefetch))){var C=A[R],F=C.details;if(!F||F.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(F)){this.state=p.State.WAITING_TRACK;return}var w=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&w&&(this.bufferFlushed=!1,this.afterBufferFlushed(w,r.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var k=this.getFwdBufferInfo(w,o.PlaylistLevelType.AUDIO);if(k!==null){var B=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN),U=k.len,N=this.getMaxBufferLength(B==null?void 0:B.len),j=this.audioSwitch;if(!(U>=N&&!j)){if(!j&&this._streamEnded(k,F)){b.trigger(m.Events.BUFFER_EOS,{type:"audio"}),this.state=p.State.ENDED;return}var K=F.fragments,V=K[0].start,H=k.end;if(j&&O){var Y=this.getLoadPosition();H=Y,F.PTSKnown&&Y<V&&(k.end>V||k.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),O.currentTime=V+.05)}if(!(B&&H>B.end+F.targetduration)&&!((!B||!B.len)&&k.len)){var q=this.getNextFragment(H,F);if(!q){this.bufferFlushed=!0;return}((E=q.decryptdata)===null||E===void 0?void 0:E.keyFormat)==="identity"&&!((L=q.decryptdata)!==null&&L!==void 0&&L.key)?this.loadKey(q,F):this.loadFragment(q,F,H)}}}}},S.getMaxBufferLength=function(E){var L=a.prototype.getMaxBufferLength.call(this);return E?Math.max(L,E):L},S.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},S.onAudioTracksUpdated=function(E,L){var b=L.audioTracks;this.resetTransmuxer(),this.levels=b.map(function(A){return new g.Level(A)})},S.onAudioTrackSwitching=function(E,L){var b=!!L.url;this.trackId=L.id;var A=this.fragCurrent;A!=null&&A.loader&&A.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),b?this.setInterval(f):this.resetTransmuxer(),b?(this.audioSwitch=!0,this.state=p.State.IDLE):this.state=p.State.STOPPED,this.tick()},S.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},S.onLevelLoaded=function(E,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(m.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},S.onAudioTrackLoaded=function(E,L){var b;if(this.mainDetails==null){this.cachedTrackLoadedData=L;return}var A=this.levels,O=L.details,R=L.id;if(!A){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var I=A[R],C=0;if(O.live||(b=I.details)!==null&&b!==void 0&&b.live){var F=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!F)return;!I.details&&O.hasProgramDateTime&&F.hasProgramDateTime?(Object(h.alignMediaPlaylistByPDT)(O,F),C=O.fragments[0].start):C=this.alignPlaylists(O,I.details)}I.details=O,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!O.live)&&this.setStartPosition(I.details,C),this.state===p.State.WAITING_TRACK&&!this.waitForCdnTuneIn(O)&&(this.state=p.State.IDLE),this.tick()},S._handleFragmentLoadProgress=function(E){var L,b=E.frag,A=E.part,O=E.payload,R=this.config,I=this.trackId,C=this.levels;if(!C){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+b.sn+" of level "+b.level+" will not be buffered");return}var F=C[I];console.assert(F,"Audio track is defined on fragment load progress");var w=F.details;console.assert(w,"Audio track details are defined on fragment load progress");var k=R.defaultAudioCodec||F.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new n.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var U=this.initPTS[b.cc],N=(L=b.initSegment)===null||L===void 0?void 0:L.data;if(U!==void 0){var j=!1,K=A?A.index:-1,V=K!==-1,H=new d.ChunkMetadata(b.level,b.sn,b.stats.chunkCount,O.byteLength,K,V);B.push(O,N,k,"",b,A,w.totalduration,j,H,U)}else{this.log("Unknown video PTS for cc "+b.cc+", waiting for video PTS before demuxing audio frag "+b.sn+" of ["+w.startSN+" ,"+w.endSN+"],track "+I);var Y=this.waitingData=this.waitingData||{frag:b,part:A,cache:new l.default,complete:!1},q=Y.cache;q.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=p.State.WAITING_INIT_PTS}},S._handleFragmentLoadComplete=function(E){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,E)},S.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},S.onBufferCreated=function(E,L){var b=L.tracks.audio;b&&(this.mediaBuffer=b.buffer||null),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer||null)},S.onFragBuffered=function(E,L){var b=L.frag,A=L.part;if(b.type===o.PlaylistLevelType.AUDIO){if(this.fragContextChanged(b)){this.warn("Fragment "+b.sn+(A?" p: "+A.index:"")+" of level "+b.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}b.sn!=="initSegment"&&(this.fragPrevious=b,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(m.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(b,A)}},S.onError=function(E,L){switch(L.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,L);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==p.State.ERROR&&this.state!==p.State.STOPPED&&(this.state=L.fatal?p.State.ERROR:p.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===p.State.PARSING||this.state===p.State.PARSED)){var b=!0,A=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);A&&A.len>.5&&(b=!this.reduceMaxBufferLength(A.len)),b&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},S.onBufferFlushed=function(E,L){var b=L.type;b===r.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},S._handleTransmuxComplete=function(E){var L,b="audio",A=this.hls,O=E.remuxResult,R=E.chunkMeta,I=this.getCurrentContext(R);if(!I){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(R.level);return}var C=I.frag,F=I.part,w=I.level.details,k=O.audio,B=O.text,U=O.id3,N=O.initSegment;if(!(this.fragContextChanged(C)||!w)){if(this.state=p.State.PARSING,this.audioSwitch&&k&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,C,R),A.trigger(m.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:b,tracks:N.tracks})),k){var j=k.startPTS,K=k.endPTS,V=k.startDTS,H=k.endDTS;F&&(F.elementaryStreams[r.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:K,startDTS:V,endDTS:H}),C.setElementaryStreamInfo(r.ElementaryStreamTypes.AUDIO,j,K,V,H),this.bufferFragmentData(k,C,F,R)}if(U!=null&&(L=U.samples)!==null&&L!==void 0&&L.length){var Y=e({id:b,frag:C,details:w},U);A.trigger(m.Events.FRAG_PARSING_METADATA,Y)}if(B){var q=e({id:b,frag:C,details:w},B);A.trigger(m.Events.FRAG_PARSING_USERDATA,q)}}},S._bufferInitSegment=function(E,L,b){if(this.state===p.State.PARSING){E.video&&delete E.video;var A=E.audio;if(!!A){A.levelCodec=A.codec,A.id="audio",this.log("Init audio buffer, container:"+A.container+", codecs[parsed]=["+A.codec+"]"),this.hls.trigger(m.Events.BUFFER_CODECS,E);var O=A.initSegment;if(O!=null&&O.byteLength){var R={type:"audio",frag:L,part:null,chunkMeta:b,parent:L.type,data:O};this.hls.trigger(m.Events.BUFFER_APPENDING,R)}this.tick()}}},S.loadFragment=function(E,L,b){var A=this.fragmentTracker.getState(E);this.fragCurrent=E,(this.audioSwitch||A===_.FragmentState.NOT_LOADED||A===_.FragmentState.PARTIAL)&&(E.sn==="initSegment"?this._loadInitSegment(E):L.live&&!Object(T.isFiniteNumber)(this.initPTS[E.cc])?(this.log("Waiting for video PTS in continuity counter "+E.cc+" of live stream before loading audio fragment "+E.sn+" of level "+this.trackId),this.state=p.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,E,L,b)))},S.completeAudioSwitch=function(){var E=this.hls,L=this.media,b=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,E.trigger(m.Events.AUDIO_TRACK_SWITCHED,{id:b})},v}(p.default);P.default=c},"./src/controller/audio-track-controller.ts":function(M,P,y){y.r(P);var T=y("./src/events.ts"),p=y("./src/errors.ts"),m=y("./src/controller/base-playlist-controller.ts"),D=y("./src/types/loader.ts");function _(n,d){for(var u=0;u<d.length;u++){var h=d[u];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(n,h.key,h)}}function g(n,d,u){return d&&_(n.prototype,d),u&&_(n,u),Object.defineProperty(n,"prototype",{writable:!1}),n}function o(n,d){n.prototype=Object.create(d.prototype),n.prototype.constructor=n,r(n,d)}function r(n,d){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,t){return h.__proto__=t,h},r(n,d)}var l=function(n){o(d,n);function d(h){var t;return t=n.call(this,h,"[audio-track-controller]")||this,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}var u=d.prototype;return u.registerListeners=function(){var t=this.hls;t.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(T.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(T.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(T.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var t=this.hls;t.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(T.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(T.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(T.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,n.prototype.destroy.call(this)},u.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},u.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},u.onAudioTrackLoaded=function(t,e){var s=e.id,i=e.details,f=this.tracksInGroup[s];if(!f){this.warn("Invalid audio track id "+s);return}var c=f.details;f.details=e.details,this.log("audioTrack "+s+" loaded ["+i.startSN+"-"+i.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,c))},u.onLevelLoading=function(t,e){this.switchLevel(e.level)},u.onLevelSwitching=function(t,e){this.switchLevel(e.level)},u.switchLevel=function(t){var e=this.hls.levels[t];if(!!(e!=null&&e.audioGroupIds)){var s=e.audioGroupIds[e.urlId];if(this.groupId!==s){this.groupId=s;var i=this.tracks.filter(function(c){return!s||c.groupId===s});this.selectDefaultTrack&&!i.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var f={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(T.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},u.onError=function(t,e){n.prototype.onError.call(this,t,e),!(e.fatal||!e.context)&&e.context.type===D.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},u.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var s=e[this.trackId];this.log("Now switching to audio-track index "+t);var i=e[t],f=i.id,c=i.groupId,a=c===void 0?"":c,v=i.name,S=i.type,x=i.url;if(this.trackId=t,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(T.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:a,name:v,type:S,url:x}),!(i.details&&!i.details.live)){var E=this.switchParams(i.url,s==null?void 0:s.details);this.loadPlaylist(E)}},u.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,s=this.findTrackId(e)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},u.findTrackId=function(t){for(var e=this.tracksInGroup,s=0;s<e.length;s++){var i=e[s];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},u.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var s=e.id,i=e.groupId,f=e.url;if(t)try{f=t.addDirectives(f)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(T.Events.AUDIO_TRACK_LOADING,{url:f,id:s,groupId:i,deliveryDirectives:t||null})}},g(d,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),d}(m.default);P.default=l},"./src/controller/base-playlist-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return g});var T=y("./src/polyfills/number.ts"),p=y("./src/types/level.ts"),m=y("./src/controller/level-helper.ts"),D=y("./src/utils/logger.ts"),_=y("./src/errors.ts"),g=function(){function o(l,n){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=D.logger.log.bind(D.logger,n+":"),this.warn=D.logger.warn.bind(D.logger,n+":"),this.hls=l}var r=o.prototype;return r.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},r.onError=function(n,d){d.fatal&&d.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},r.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},r.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},r.stopLoad=function(){this.canLoad=!1,this.clearTimer()},r.switchParams=function(n,d){var u=d==null?void 0:d.renditionReports;if(u)for(var h=0;h<u.length;h++){var t=u[h],e=""+t.URI;if(e===n.slice(-e.length)){var s=parseInt(t["LAST-MSN"]),i=parseInt(t["LAST-PART"]);if(d&&this.hls.config.lowLatencyMode){var f=Math.min(d.age-d.partTarget,d.targetduration);i!==void 0&&f>d.partTarget&&(i+=1)}if(Object(T.isFiniteNumber)(s))return new p.HlsUrlParameters(s,Object(T.isFiniteNumber)(i)?i:void 0,p.HlsSkip.No)}}},r.loadPlaylist=function(n){},r.shouldLoadTrack=function(n){return this.canLoad&&n&&!!n.url&&(!n.details||n.details.live)},r.playlistLoaded=function(n,d,u){var h=this,t=d.details,e=d.stats,s=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(t.advancedDateTime=Date.now()-s,t.live||u!=null&&u.live){if(t.reloaded(u),u&&this.log("live playlist "+n+" "+(t.advanced?"REFRESHED "+t.lastPartSn+"-"+t.lastPartIndex:"MISSED")),u&&t.fragments.length>0&&Object(m.mergeDetails)(u,t),!this.canLoad||!t.live)return;var i,f=void 0,c=void 0;if(t.canBlockReload&&t.endSN&&t.advanced){var a=this.hls.config.lowLatencyMode,v=t.lastPartSn,S=t.endSN,x=t.lastPartIndex,E=x!==-1,L=v===S,b=a?0:x;E?(f=L?S+1:v,c=L?b:x+1):f=S+1;var A=t.age,O=A+t.ageHeader,R=Math.min(O-t.partTarget,t.targetduration*1.5);if(R>0){if(u&&R>u.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+u.tuneInGoal+" to: "+R+" with playlist age: "+t.age),R=0;else{var I=Math.floor(R/t.targetduration);if(f+=I,c!==void 0){var C=Math.round(R%t.targetduration/t.partTarget);c+=C}this.log("CDN Tune-in age: "+t.ageHeader+"s last advanced "+A.toFixed(2)+"s goal: "+R+" skip sn "+I+" to part "+c)}t.tuneInGoal=R}if(i=this.getDeliveryDirectives(t,d.deliveryDirectives,f,c),a||!L){this.loadPlaylist(i);return}}else i=this.getDeliveryDirectives(t,d.deliveryDirectives,f,c);var F=Object(m.computeReloadInterval)(t,e);f!==void 0&&t.canBlockReload&&(F-=t.partTarget||1),this.log("reload live playlist "+n+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return h.loadPlaylist(i)},F)}else this.clearTimer()},r.getDeliveryDirectives=function(n,d,u,h){var t=Object(p.getSkipValue)(n,u);return d!=null&&d.skip&&n.deltaUpdateFailed&&(u=d.msn,h=d.part,t=p.HlsSkip.No),new p.HlsUrlParameters(u,h,t)},r.retryLoadingOrFail=function(n){var d=this,u=this.hls.config,h=this.retryCount<u.levelLoadingMaxRetry;if(h){var t;if(this.retryCount++,n.details.indexOf("LoadTimeOut")>-1&&(t=n.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+n.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return d.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+n.details+'"')}}else this.warn('cannot recover from error "'+n.details+'"'),this.clearTimer(),n.fatal=!0;return h},o}()},"./src/controller/base-stream-controller.ts":function(M,P,y){y.r(P),y.d(P,"State",function(){return S}),y.d(P,"default",function(){return x});var T=y("./src/polyfills/number.ts"),p=y("./src/task-loop.ts"),m=y("./src/controller/fragment-tracker.ts"),D=y("./src/utils/buffer-helper.ts"),_=y("./src/utils/logger.ts"),g=y("./src/events.ts"),o=y("./src/errors.ts"),r=y("./src/types/transmuxer.ts"),l=y("./src/utils/mp4-tools.ts"),n=y("./src/utils/discontinuities.ts"),d=y("./src/controller/fragment-finders.ts"),u=y("./src/controller/level-helper.ts"),h=y("./src/loader/fragment-loader.ts"),t=y("./src/crypt/decrypter.ts"),e=y("./src/utils/time-ranges.ts"),s=y("./src/types/loader.ts");function i(E,L){for(var b=0;b<L.length;b++){var A=L[b];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(E,A.key,A)}}function f(E,L,b){return L&&i(E.prototype,L),b&&i(E,b),Object.defineProperty(E,"prototype",{writable:!1}),E}function c(E){if(E===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E}function a(E,L){E.prototype=Object.create(L.prototype),E.prototype.constructor=E,v(E,L)}function v(E,L){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,O){return A.__proto__=O,A},v(E,L)}var S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},x=function(E){a(L,E);function L(A,O,R){var I;return I=E.call(this)||this,I.hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=S.STOPPED,I.media=null,I.mediaBuffer=null,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=R,I.log=_.logger.log.bind(_.logger,R+":"),I.warn=_.logger.warn.bind(_.logger,R+":"),I.hls=A,I.fragmentLoader=new h.default(A.config),I.fragmentTracker=O,I.config=A.config,I.decrypter=new t.default(A,A.config),A.on(g.Events.KEY_LOADED,I.onKeyLoaded,c(I)),A.on(g.Events.LEVEL_SWITCHING,I.onLevelSwitching,c(I)),I}var b=L.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(O){},b.stopLoad=function(){this.fragmentLoader.abort();var O=this.fragCurrent;O&&this.fragmentTracker.removeFragment(O),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=S.STOPPED},b._streamEnded=function(O,R){var I=this.fragCurrent,C=this.fragmentTracker;if(!R.live&&I&&this.media&&I.sn>=R.endSN&&!O.nextStart){var F=R.partList;if(F!=null&&F.length){var w=F[F.length-1],k=D.BufferHelper.isBuffered(this.media,w.start+w.duration/2);return k}var B=C.getState(I);return B===m.FragmentState.PARTIAL||B===m.FragmentState.OK}return!1},b.onMediaAttached=function(O,R){var I=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===S.STOPPED&&this.startLoad(C.startPosition)},b.onMediaDetaching=function(){var O=this.media;O!=null&&O.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),O&&this.onvseeking&&this.onvended&&(O.removeEventListener("seeking",this.onvseeking),O.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var O=this.config,R=this.fragCurrent,I=this.media,C=this.mediaBuffer,F=this.state,w=I?I.currentTime:0,k=D.BufferHelper.bufferInfo(C||I,w,O.maxBufferHole);if(this.log("media seeking to "+(Object(T.isFiniteNumber)(w)?w.toFixed(3):w)+", state: "+F),F===S.ENDED)this.resetLoadingState();else if(R&&!k.len){var B=O.maxFragLookUpTolerance,U=R.start-B,N=R.start+R.duration+B,j=w>N;(w<U||j)&&(j&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=w),!this.loadedmetadata&&!k.len&&(this.nextLoadPosition=this.startPosition=w),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(O,R){if(!(this.state!==S.KEY_LOADING||R.frag!==this.fragCurrent||!this.levels)){this.state=S.IDLE;var I=this.levels[R.frag.level].details;I&&this.loadFragment(R.frag,I,R.frag.start)}},b.onLevelSwitching=function(O,R){this.fragLoadError=0},b.onHandlerDestroying=function(){this.stopLoad(),E.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=S.STOPPED,this.hls.off(g.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,E.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(O,R){this.log("Loading key for "+O.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level),this.state=S.KEY_LOADING,this.fragCurrent=O,this.hls.trigger(g.Events.KEY_LOADING,{frag:O})},b.loadFragment=function(O,R,I){this._loadFragForPlayback(O,R,I)},b._loadFragForPlayback=function(O,R,I){var C=this,F=function(k){if(C.fragContextChanged(O)){C.warn("Fragment "+O.sn+(k.part?" p: "+k.part.index:"")+" of level "+O.level+" was dropped during download."),C.fragmentTracker.removeFragment(O);return}O.stats.chunkCount++,C._handleFragmentLoadProgress(k)};this._doFragLoad(O,R,I,F).then(function(w){if(!!w){C.fragLoadError=0;var k=C.state;if(C.fragContextChanged(O)){(k===S.FRAG_LOADING||!C.fragCurrent&&k===S.PARSING)&&(C.fragmentTracker.removeFragment(O),C.state=S.IDLE);return}"payload"in w&&(C.log("Loaded fragment "+O.sn+" of level "+O.level),C.hls.trigger(g.Events.FRAG_LOADED,w)),C._handleFragmentLoadComplete(w)}}).catch(function(w){C.state===S.STOPPED||C.state===S.ERROR||(C.warn(w),C.resetFragmentLoading(O))})},b.flushMainBuffer=function(O,R,I){if(I===void 0&&(I=null),!!(O-R)){var C={startOffset:O,endOffset:R,type:I};this.fragLoadError=0,this.hls.trigger(g.Events.BUFFER_FLUSHING,C)}},b._loadInitSegment=function(O){var R=this;this._doFragLoad(O).then(function(I){if(!I||R.fragContextChanged(O)||!R.levels)throw new Error("init load aborted");return I}).then(function(I){var C=R.hls,F=I.payload,w=O.decryptdata;if(F&&F.byteLength>0&&w&&w.key&&w.iv&&w.method==="AES-128"){var k=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(F),w.key.buffer,w.iv.buffer).then(function(B){var U=self.performance.now();return C.trigger(g.Events.FRAG_DECRYPTED,{frag:O,payload:B,stats:{tstart:k,tdecrypt:U}}),I.payload=B,I})}return I}).then(function(I){var C=R.fragCurrent,F=R.hls,w=R.levels;if(!w)throw new Error("init load aborted, missing levels");var k=w[O.level].details;console.assert(k,"Level details are defined when init segment is loaded");var B=O.stats;R.state=S.IDLE,R.fragLoadError=0,O.data=new Uint8Array(I.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),I.frag===C&&F.trigger(g.Events.FRAG_BUFFERED,{stats:B,frag:C,part:null,id:O.type}),R.tick()}).catch(function(I){R.state===S.STOPPED||R.state===S.ERROR||(R.warn(I),R.resetFragmentLoading(O))})},b.fragContextChanged=function(O){var R=this.fragCurrent;return!O||!R||O.level!==R.level||O.sn!==R.sn||O.urlId!==R.urlId},b.fragBufferedComplete=function(O,R){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+O.type+" sn: "+O.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level+" "+(I?e.default.toString(D.BufferHelper.getBuffered(I)):"(detached)")),this.state=S.IDLE,I&&(!this.loadedmetadata&&I.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},b.seekToStartPos=function(){},b._handleFragmentLoadComplete=function(O){var R=this.transmuxer;if(!!R){var I=O.frag,C=O.part,F=O.partsLoaded,w=!F||F.length===0||F.some(function(B){return!B}),k=new r.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,C?C.index:-1,!w);R.flush(k)}},b._handleFragmentLoadProgress=function(O){},b._doFragLoad=function(O,R,I,C){var F=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(O.start,I||0),this.config.lowLatencyMode&&R){var w=R.partList;if(w&&C){I>O.end&&R.fragmentHint&&(O=R.fragmentHint);var k=this.getNextPart(w,O,I);if(k>-1){var B=w[k];return this.log("Loading part sn: "+O.sn+" p: "+B.index+" cc: "+O.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+k+"-"+(w.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=S.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:O,part:w[k],targetBufferTime:I}),this.doFragPartsLoad(O,w,k,C).catch(function(U){return F.handleFragLoadError(U)})}else if(!O.url||this.loadedEndOfParts(w,I))return Promise.resolve(null)}}return this.log("Loading fragment "+O.sn+" cc: "+O.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(I.toFixed(3))),Object(T.isFiniteNumber)(O.sn)&&!this.bitrateTest&&(this.nextLoadPosition=O.start+O.duration),this.state=S.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:O,targetBufferTime:I}),this.fragmentLoader.load(O,C).catch(function(U){return F.handleFragLoadError(U)})},b.doFragPartsLoad=function(O,R,I,C){var F=this;return new Promise(function(w,k){var B=[],U=function N(j){var K=R[j];F.fragmentLoader.loadPart(O,K,C).then(function(V){B[K.index]=V;var H=V.part;F.hls.trigger(g.Events.FRAG_LOADED,V);var Y=R[j+1];if(Y&&Y.fragment===O)N(j+1);else return w({frag:O,part:H,partsLoaded:B})}).catch(k)};U(I)})},b.handleFragLoadError=function(O){var R=O.data;return R&&R.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(g.Events.ERROR,R),null},b._handleTransmuxerFlush=function(O){var R=this.getCurrentContext(O);if(!R||this.state!==S.PARSING){this.fragCurrent||(this.state=S.IDLE);return}var I=R.frag,C=R.part,F=R.level,w=self.performance.now();I.stats.parsing.end=w,C&&(C.stats.parsing.end=w),this.updateLevelTiming(I,C,F,O.partial)},b.getCurrentContext=function(O){var R=this.levels,I=O.level,C=O.sn,F=O.part;if(!R||!R[I])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+I+". The current chunk will not be buffered."),null;var w=R[I],k=F>-1?Object(u.getPartWith)(w,C,F):null,B=k?k.fragment:Object(u.getFragmentWithSN)(w,C,this.fragCurrent);return B?{frag:B,part:k,level:w}:null},b.bufferFragmentData=function(O,R,I,C){if(!(!O||this.state!==S.PARSING)){var F=O.data1,w=O.data2,k=F;if(F&&w&&(k=Object(l.appendUint8Array)(F,w)),!(!k||!k.length)){var B={type:O.type,frag:R,part:I,chunkMeta:C,parent:R.type,data:k};this.hls.trigger(g.Events.BUFFER_APPENDING,B),O.dropped&&O.independent&&!I&&this.flushBufferGap(R)}}},b.flushBufferGap=function(O){var R=this.media;if(!!R){if(!D.BufferHelper.isBuffered(R,R.currentTime)){this.flushMainBuffer(0,O.start);return}var I=R.currentTime,C=D.BufferHelper.bufferInfo(R,I,0),F=O.duration,w=Math.min(this.config.maxFragLookUpTolerance*2,F*.25),k=Math.max(Math.min(O.start-w,C.end-w),I+w);O.start-k>w&&this.flushMainBuffer(k,O.start)}},b.getFwdBufferInfo=function(O,R){var I=this.config,C=this.getLoadPosition();if(!Object(T.isFiniteNumber)(C))return null;var F=D.BufferHelper.bufferInfo(O,C,I.maxBufferHole);if(F.len===0&&F.nextStart!==void 0){var w=this.fragmentTracker.getBufferedFrag(C,R);if(w&&F.nextStart<w.end)return D.BufferHelper.bufferInfo(O,C,Math.max(F.nextStart,I.maxBufferHole))}return F},b.getMaxBufferLength=function(O){var R=this.config,I;return O?I=Math.max(8*R.maxBufferSize/O,R.maxBufferLength):I=R.maxBufferLength,Math.min(I,R.maxMaxBufferLength)},b.reduceMaxBufferLength=function(O){var R=this.config,I=O||R.maxBufferLength;return R.maxMaxBufferLength>=I?(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0):!1},b.getNextFragment=function(O,R){var I=R.fragments,C=I.length;if(!C)return null;var F=this.config,w=I[0].start,k;if(R.live){var B=F.initialLiveManifestSize;if(C<B)return this.warn("Not enough fragments to start playback (have: "+C+", need: "+B+")"),null;!R.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(k=this.getInitialLiveFragment(R,I),this.startPosition=k?this.hls.liveSyncPosition||k.start:O)}else O<=w&&(k=I[0]);if(!k){var U=F.lowLatencyMode?R.partEnd:R.fragmentEnd;k=this.getFragmentAtPosition(O,U,R)}return this.mapToInitFragWhenRequired(k)},b.mapToInitFragWhenRequired=function(O){return O!=null&&O.initSegment&&!(O!=null&&O.initSegment.data)&&!this.bitrateTest?O.initSegment:O},b.getNextPart=function(O,R,I){for(var C=-1,F=!1,w=!0,k=0,B=O.length;k<B;k++){var U=O[k];if(w=w&&!U.independent,C>-1&&I<U.start)break;var N=U.loaded;!N&&(F||U.independent||w)&&U.fragment===R&&(C=k),F=N}return C},b.loadedEndOfParts=function(O,R){var I=O[O.length-1];return I&&R>I.start&&I.loaded},b.getInitialLiveFragment=function(O,R){var I=this.fragPrevious,C=null;if(I){if(O.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),C=Object(d.findFragmentByPDT)(R,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var F=I.sn+1;if(F>=O.startSN&&F<=O.endSN){var w=R[F-O.startSN];I.cc===w.cc&&(C=w,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(d.findFragWithCC)(R,I.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var k=this.hls.liveSyncPosition;k!==null&&(C=this.getFragmentAtPosition(k,this.bitrateTest?O.fragmentEnd:O.edge,O))}return C},b.getFragmentAtPosition=function(O,R,I){var C=this.config,F=this.fragPrevious,w=I.fragments,k=I.endSN,B=I.fragmentHint,U=C.maxFragLookUpTolerance,N=!!(C.lowLatencyMode&&I.partList&&B);N&&B&&!this.bitrateTest&&(w=w.concat(B),k=B.sn);var j;if(O<R){var K=O>R-U?0:U;j=Object(d.findFragmentByPTS)(F,w,O,K)}else j=w[w.length-1];if(j){var V=j.sn-I.startSN;if(F&&j.sn===F.sn&&!N){var H=F&&j.level===F.level;if(H){var Y=w[V+1];j.sn<k&&this.fragmentTracker.getState(Y)!==m.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+Y.sn),j=Y):j=null}}}return j},b.synchronizeToLiveEdge=function(O){var R=this.config,I=this.media;if(!!I){var C=this.hls.liveSyncPosition,F=I.currentTime,w=O.fragments[0].start,k=O.edge,B=F>=w-R.maxFragLookUpTolerance&&F<=k;if(C!==null&&I.duration>C&&(F<C||!B)){var U=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*O.targetduration;(!B&&I.readyState<4||F<k-U)&&(this.loadedmetadata||(this.nextLoadPosition=C),I.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+k+", reset currentTime to : "+C.toFixed(3)),I.currentTime=C))}}},b.alignPlaylists=function(O,R){var I=this.levels,C=this.levelLastLoaded,F=this.fragPrevious,w=C!==null?I[C]:null,k=O.fragments.length;if(!k)return this.warn("No fragments in live playlist"),0;var B=O.fragments[0].start,U=!R,N=O.alignedSliding&&Object(T.isFiniteNumber)(B);if(U||!N&&!B){Object(n.alignStream)(F,w,O);var j=O.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+O.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+k),j}return B},b.waitForCdnTuneIn=function(O){var R=3;return O.live&&O.canBlockReload&&O.partTarget&&O.tuneInGoal>Math.max(O.partHoldBack,O.partTarget*R)},b.setStartPosition=function(O,R){var I=this.startPosition;if(I<R&&(I=-1),I===-1||this.lastCurrentTime===-1){var C=O.startTimeOffset;Object(T.isFiniteNumber)(C)?(I=R+C,C<0&&(I+=O.totalduration),I=Math.min(Math.max(R,I),R+O.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+I),this.startPosition=I):O.live?I=this.hls.liveSyncPosition||R:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},b.getLoadPosition=function(){var O=this.media,R=0;return this.loadedmetadata&&O?R=O.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},b.handleFragLoadAborted=function(O,R){this.transmuxer&&O.sn!=="initSegment"&&O.stats.aborted&&(this.warn("Fragment "+O.sn+(R?" part"+R.index:"")+" of level "+O.level+" was aborted"),this.resetFragmentLoading(O))},b.resetFragmentLoading=function(O){(!this.fragCurrent||!this.fragContextChanged(O)&&this.state!==S.FRAG_LOADING_WAITING_RETRY)&&(this.state=S.IDLE)},b.onFragmentOrKeyLoadError=function(O,R){if(!R.fatal){var I=R.frag;if(!(!I||I.type!==O)){var C=this.fragCurrent;console.assert(C&&I.sn===C.sn&&I.level===C.level&&I.urlId===C.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var w=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+O+" "+I.level+" failed to load, retrying in "+w+"ms"),this.retryDate=self.performance.now()+w,this.fragLoadError++,this.state=S.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(O===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=S.IDLE):(_.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=S.ERROR)}}},b.afterBufferFlushed=function(O,R,I){if(!!O){var C=D.BufferHelper.getBuffered(O);this.fragmentTracker.detectEvictedFragments(R,C,I),this.state===S.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE},b.resetStartWhenNotLoaded=function(O){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[O].details:null;R!=null&&R.live?(this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},b.updateLevelTiming=function(O,R,I,C){var F=this,w=I.details;console.assert(!!w,"level.details must be defined");var k=Object.keys(O.elementaryStreams).reduce(function(B,U){var N=O.elementaryStreams[U];if(N){var j=N.endPTS-N.startPTS;if(j<=0)return F.warn("Could not parse fragment "+O.sn+" "+U+" duration reliably ("+j+")"),B||!1;var K=C?0:Object(u.updateFragPTSDTS)(w,O,N.startPTS,N.endPTS,N.startDTS,N.endDTS);return F.hls.trigger(g.Events.LEVEL_PTS_UPDATED,{details:w,level:I,drift:K,type:U,frag:O,start:N.startPTS,end:N.endPTS}),!0}return B},!1);k||(this.warn("Found no media in fragment "+O.sn+" of level "+I.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=S.PARSED,this.hls.trigger(g.Events.FRAG_PARSED,{frag:O,part:R})},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(L,[{key:"state",get:function(){return this._state},set:function(O){var R=this._state;R!==O&&(this._state=O,this.log(R+"->"+O))}}]),L}(p.default)},"./src/controller/buffer-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return d});var T=y("./src/polyfills/number.ts"),p=y("./src/events.ts"),m=y("./src/utils/logger.ts"),D=y("./src/errors.ts"),_=y("./src/utils/buffer-helper.ts"),g=y("./src/utils/mediasource-helper.ts"),o=y("./src/loader/fragment.ts"),r=y("./src/controller/buffer-operation-queue.ts"),l=Object(g.getMediaSource)(),n=/([ha]vc.)(?:\.[^.,]+)+/,d=function(){function u(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var s=e.hls,i=e.media,f=e.mediaSource;m.logger.log("[buffer-controller]: Media source opened"),i&&(e.updateMediaElementDuration(),s.trigger(p.Events.MEDIA_ATTACHED,{media:i})),f&&f.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){m.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){m.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var h=u.prototype;return h.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},h.destroy=function(){this.unregisterListeners(),this.details=null},h.registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.Events.BUFFER_RESET,this.onBufferReset,this),e.on(p.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(p.Events.BUFFER_EOS,this.onBufferEos,this),e.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.Events.FRAG_PARSED,this.onFragParsed,this),e.on(p.Events.FRAG_CHANGED,this.onFragChanged,this)},h.unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.Events.BUFFER_RESET,this.onBufferReset,this),e.off(p.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(p.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(p.Events.BUFFER_EOS,this.onBufferEos,this),e.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.Events.FRAG_PARSED,this.onFragParsed,this),e.off(p.Events.FRAG_CHANGED,this.onFragChanged,this)},h._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new r.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},h.onManifestParsed=function(e,s){var i=2;(s.audio&&!s.video||!s.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,m.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},h.onMediaAttaching=function(e,s){var i=this.media=s.media;if(i&&l){var f=this.mediaSource=new l;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(f),this._objectUrl=i.src}},h.onMediaDetaching=function(){var e=this.media,s=this.mediaSource,i=this._objectUrl;if(s){if(m.logger.log("[buffer-controller]: media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(f){m.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):m.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(p.Events.MEDIA_DETACHED,void 0)},h.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(s){var i=e.sourceBuffer[s];try{i&&(e.removeBufferListeners(s),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[s]=void 0)}catch(f){m.logger.warn("[buffer-controller]: Failed to reset the "+s+" buffer",f)}}),this._initSourceBuffer()},h.onBufferCodecs=function(e,s){var i=this,f=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(c){if(f){var a=i.tracks[c];if(a&&typeof a.buffer.changeType=="function"){var v=s[c],S=v.id,x=v.codec,E=v.levelCodec,L=v.container,b=v.metadata,A=(a.levelCodec||a.codec).replace(n,"$1"),O=(E||x).replace(n,"$1");if(A!==O){var R=L+";codecs="+(E||x);i.appendChangeType(c,R),m.logger.log("[buffer-controller]: switching codec "+A+" to "+O),i.tracks[c]={buffer:a.buffer,codec:x,container:L,levelCodec:E,metadata:b,id:S}}}}else i.pendingTracks[c]=s[c]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},h.appendChangeType=function(e,s){var i=this,f=this.operationQueue,c={execute:function(){var v=i.sourceBuffer[e];v&&(m.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+s),v.changeType(s)),f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(v){m.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",v)}};f.append(c,e)},h.onBufferAppending=function(e,s){var i=this,f=this.hls,c=this.operationQueue,a=this.tracks,v=s.data,S=s.type,x=s.frag,E=s.part,L=s.chunkMeta,b=L.buffering[S],A=self.performance.now();b.start=A;var O=x.stats.buffering,R=E?E.stats.buffering:null;O.start===0&&(O.start=A),R&&R.start===0&&(R.start=A);var I=a.audio,C=S==="audio"&&L.id===1&&(I==null?void 0:I.container)==="audio/mpeg",F={execute:function(){if(b.executeStart=self.performance.now(),C){var k=i.sourceBuffer[S];if(k){var B=x.start-k.timestampOffset;Math.abs(B)>=.1&&(m.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+x.start+" (delta: "+B+") sn: "+x.sn+")"),k.timestampOffset=x.start)}}i.appendExecutor(v,S)},onStart:function(){},onComplete:function(){var k=self.performance.now();b.executeEnd=b.end=k,O.first===0&&(O.first=k),R&&R.first===0&&(R.first=k);var B=i.sourceBuffer,U={};for(var N in B)U[N]=_.BufferHelper.getBuffered(B[N]);i.appendError=0,i.hls.trigger(p.Events.BUFFER_APPENDED,{type:S,frag:x,part:E,chunkMeta:L,parent:x.type,timeRanges:U})},onError:function(k){m.logger.error("[buffer-controller]: Error encountered while trying to append to the "+S+" SourceBuffer",k);var B={type:D.ErrorTypes.MEDIA_ERROR,parent:x.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:k,fatal:!1};k.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=D.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,B.details=D.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>f.config.appendErrorMaxRetry&&(m.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0,f.stopLoad())),f.trigger(p.Events.ERROR,B)}};c.append(F,S)},h.onBufferFlushing=function(e,s){var i=this,f=this.operationQueue,c=function(v){return{execute:i.removeExecutor.bind(i,v,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(p.Events.BUFFER_FLUSHED,{type:v})},onError:function(x){m.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",x)}}};s.type?f.append(c(s.type),s.type):this.getSourceBufferTypes().forEach(function(a){f.append(c(a),a)})},h.onFragParsed=function(e,s){var i=this,f=s.frag,c=s.part,a=[],v=c?c.elementaryStreams:f.elementaryStreams;v[o.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(v[o.ElementaryStreamTypes.AUDIO]&&a.push("audio"),v[o.ElementaryStreamTypes.VIDEO]&&a.push("video"));var S=function(){var E=self.performance.now();f.stats.buffering.end=E,c&&(c.stats.buffering.end=E);var L=c?c.stats:f.stats;i.hls.trigger(p.Events.FRAG_BUFFERED,{frag:f,part:c,stats:L,id:f.type})};a.length===0&&m.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(S,a)},h.onFragChanged=function(e,s){this.flushBackBuffer()},h.onBufferEos=function(e,s){var i=this,f=this.getSourceBufferTypes().reduce(function(c,a){var v=i.sourceBuffer[a];return(!s.type||s.type===a)&&v&&!v.ended&&(v.ended=!0,m.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),c&&!!(!v||v.ended)},!0);f&&this.blockBuffers(function(){var c=i.mediaSource;!c||c.readyState!=="open"||c.endOfStream()})},h.onLevelUpdated=function(e,s){var i=s.details;!i.fragments.length||(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},h.flushBackBuffer=function(){var e=this.hls,s=this.details,i=this.media,f=this.sourceBuffer;if(!(!i||s===null)){var c=this.getSourceBufferTypes();if(!!c.length){var a=s.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(T.isFiniteNumber)(a)||a<0)){var v=i.currentTime,S=s.levelTargetDuration,x=Math.max(a,S),E=Math.floor(v/S)*S-x;c.forEach(function(L){var b=f[L];if(b){var A=_.BufferHelper.getBuffered(b);A.length>0&&E>A.start(0)&&(e.trigger(p.Events.BACK_BUFFER_REACHED,{bufferEnd:E}),s.live&&e.trigger(p.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:E}),e.trigger(p.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:E,type:L}))}})}}}},h.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,s=this.hls,i=this.media,f=this.mediaSource,c=e.fragments[0].start+e.totalduration,a=i.duration,v=Object(T.isFiniteNumber)(f.duration)?f.duration:0;e.live&&s.config.liveDurationInfinity?(m.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(e)):(c>v&&c>a||!Object(T.isFiniteNumber)(a))&&(m.logger.log("[buffer-controller]: Updating Media Source duration to "+c.toFixed(3)),f.duration=c)}},h.updateSeekableRange=function(e){var s=this.mediaSource,i=e.fragments,f=i.length;if(f&&e.live&&s!==null&&s!==void 0&&s.setLiveSeekableRange){var c=Math.max(0,i[0].start),a=Math.max(c,c+e.totalduration);s.setLiveSeekableRange(c,a)}},h.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,s=this.operationQueue,i=this.pendingTracks,f=Object.keys(i).length;if(f&&!e||f===2){this.createSourceBuffers(i),this.pendingTracks={};var c=this.getSourceBufferTypes();if(c.length===0){this.hls.trigger(p.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}c.forEach(function(a){s.executeNext(a)})}},h.createSourceBuffers=function(e){var s=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var c in e)if(!s[c]){var a=e[c];if(!a)throw Error("source buffer exists for track "+c+", however track does not");var v=a.levelCodec||a.codec,S=a.container+";codecs="+v;m.logger.log("[buffer-controller]: creating sourceBuffer("+S+")");try{var x=s[c]=i.addSourceBuffer(S),E=c;this.addBufferListener(E,"updatestart",this._onSBUpdateStart),this.addBufferListener(E,"updateend",this._onSBUpdateEnd),this.addBufferListener(E,"error",this._onSBUpdateError),this.tracks[c]={buffer:x,codec:v,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id},f++}catch(L){m.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+L.message),this.hls.trigger(p.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:L,mimeType:S})}}f&&this.hls.trigger(p.Events.BUFFER_CREATED,{tracks:this.tracks})},h._onSBUpdateStart=function(e){var s=this.operationQueue,i=s.current(e);i.onStart()},h._onSBUpdateEnd=function(e){var s=this.operationQueue,i=s.current(e);i.onComplete(),s.shiftAndExecuteNext(e)},h._onSBUpdateError=function(e,s){m.logger.error("[buffer-controller]: "+e+" SourceBuffer error",s),this.hls.trigger(p.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(s)},h.removeExecutor=function(e,s,i){var f=this.media,c=this.mediaSource,a=this.operationQueue,v=this.sourceBuffer,S=v[e];if(!f||!c||!S){m.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(e);return}var x=Object(T.isFiniteNumber)(f.duration)?f.duration:1/0,E=Object(T.isFiniteNumber)(c.duration)?c.duration:1/0,L=Math.max(0,s),b=Math.min(i,x,E);b>L?(m.logger.log("[buffer-controller]: Removing ["+L+","+b+"] from the "+e+" SourceBuffer"),console.assert(!S.updating,e+" sourceBuffer must not be updating"),S.remove(L,b)):a.shiftAndExecuteNext(e)},h.appendExecutor=function(e,s){var i=this.operationQueue,f=this.sourceBuffer,c=f[s];if(!c){m.logger.warn("[buffer-controller]: Attempting to append to the "+s+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(s);return}c.ended=!1,console.assert(!c.updating,s+" sourceBuffer must not be updating"),c.appendBuffer(e)},h.blockBuffers=function(e,s){var i=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){m.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var f=this.operationQueue,c=s.map(function(a){return f.appendBlocker(a)});Promise.all(c).then(function(){e(),s.forEach(function(a){var v=i.sourceBuffer[a];(!v||!v.updating)&&f.shiftAndExecuteNext(a)})})},h.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},h.addBufferListener=function(e,s,i){var f=this.sourceBuffer[e];if(!!f){var c=i.bind(this,e);this.listeners[e].push({event:s,listener:c}),f.addEventListener(s,c)}},h.removeBufferListeners=function(e){var s=this.sourceBuffer[e];!s||this.listeners[e].forEach(function(i){s.removeEventListener(i.event,i.listener)})},u}()},"./src/controller/buffer-operation-queue.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return p});var T=y("./src/utils/logger.ts"),p=function(){function m(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var D=m.prototype;return D.append=function(g,o){var r=this.queues[o];r.push(g),r.length===1&&this.buffers[o]&&this.executeNext(o)},D.insertAbort=function(g,o){var r=this.queues[o];r.unshift(g),this.executeNext(o)},D.appendBlocker=function(g){var o,r=new Promise(function(n){o=n}),l={execute:o,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(l,g),r},D.executeNext=function(g){var o=this.buffers,r=this.queues,l=o[g],n=r[g];if(n.length){var d=n[0];try{d.execute()}catch(u){T.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),d.onError(u),(!l||!l.updating)&&(n.shift(),this.executeNext(g))}}},D.shiftAndExecuteNext=function(g){this.queues[g].shift(),this.executeNext(g)},D.current=function(g){return this.queues[g][0]},m}()},"./src/controller/cap-level-controller.ts":function(M,P,y){y.r(P);var T=y("./src/events.ts");function p(_,g){for(var o=0;o<g.length;o++){var r=g[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(_,r.key,r)}}function m(_,g,o){return g&&p(_.prototype,g),o&&p(_,o),Object.defineProperty(_,"prototype",{writable:!1}),_}var D=function(){function _(o){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=o,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var g=_.prototype;return g.setStreamController=function(r){this.streamController=r},g.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},g.registerListeners=function(){var r=this.hls;r.on(T.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.unregisterListener=function(){var r=this.hls;r.off(T.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.onFpsDropLevelCapping=function(r,l){_.isLevelAllowed(l.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(l.droppedLevel)},g.onMediaAttaching=function(r,l){this.media=l.media instanceof HTMLVideoElement?l.media:null},g.onManifestParsed=function(r,l){var n=this.hls;this.restrictedLevels=[],this.firstLevel=l.firstLevel,n.config.capLevelToPlayerSize&&l.video&&this.startCapping()},g.onBufferCodecs=function(r,l){var n=this.hls;n.config.capLevelToPlayerSize&&l.video&&this.startCapping()},g.onMediaDetaching=function(){this.stopCapping()},g.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var r=this.hls.levels;if(r.length){var l=this.hls;l.autoLevelCapping=this.getMaxLevel(r.length-1),l.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=l.autoLevelCapping}}},g.getMaxLevel=function(r){var l=this,n=this.hls.levels;if(!n.length)return-1;var d=n.filter(function(u,h){return _.isLevelAllowed(h,l.restrictedLevels)&&h<=r});return this.clientRect=null,_.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},g.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},g.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},g.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,l={width:0,height:0};if(r){var n=r.getBoundingClientRect();l.width=n.width,l.height=n.height,!l.width&&!l.height&&(l.width=n.right-n.left||r.width||0,l.height=n.bottom-n.top||r.height||0)}return this.clientRect=l,l},_.isLevelAllowed=function(r,l){return l===void 0&&(l=[]),l.indexOf(r)===-1},_.getMaxLevelByMediaSize=function(r,l,n){if(!r||!r.length)return-1;for(var d=function(s,i){return i?s.width!==i.width||s.height!==i.height:!0},u=r.length-1,h=0;h<r.length;h+=1){var t=r[h];if((t.width>=l||t.height>=n)&&d(t,r[h+1])){u=h;break}}return u},m(_,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return r}}]),_}();P.default=D},"./src/controller/cmcd-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return d});var T=y("./src/events.ts"),p=y("./src/types/cmcd.ts"),m=y("./src/utils/buffer-helper.ts"),D=y("./src/utils/logger.ts");function _(u,h){for(var t=0;t<h.length;t++){var e=h[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(u,e.key,e)}}function g(u,h,t){return h&&_(u.prototype,h),t&&_(u,t),Object.defineProperty(u,"prototype",{writable:!1}),u}function o(u,h){var t=typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(t)return(t=t.call(u)).next.bind(t);if(Array.isArray(u)||(t=r(u))||h&&u&&typeof u.length=="number"){t&&(u=t);var e=0;return function(){return e>=u.length?{done:!0}:{done:!1,value:u[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r(u,h){if(!!u){if(typeof u=="string")return l(u,h);var t=Object.prototype.toString.call(u).slice(8,-1);if(t==="Object"&&u.constructor&&(t=u.constructor.name),t==="Map"||t==="Set")return Array.from(u);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(u,h)}}function l(u,h){(h==null||h>u.length)&&(h=u.length);for(var t=0,e=new Array(h);t<h;t++)e[t]=u[t];return e}function n(){return n=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var t=arguments[h];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(u[e]=t[e])}return u},n.apply(this,arguments)}var d=function(){function u(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(f){try{e.apply(f,{ot:p.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(c){D.logger.warn("Could not generate manifest CMCD data.",c)}},this.applyFragmentData=function(f){try{var c=f.frag,a=e.hls.levels[c.level],v=e.getObjectType(c),S={d:c.duration*1e3,ot:v};(v===p.CMCDObjectType.VIDEO||v===p.CMCDObjectType.AUDIO||v==p.CMCDObjectType.MUXED)&&(S.br=a.bitrate/1e3,S.tb=e.getTopBandwidth(v)/1e3,S.bl=e.getBufferLength(v)),e.apply(f,S)}catch(x){D.logger.warn("Could not generate segment CMCD data.",x)}},this.hls=t;var s=this.config=t.config,i=s.cmcd;i!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||u.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}var h=u.prototype;return h.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(T.Events.BUFFER_CREATED,this.onBufferCreated,this)},h.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(T.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},h.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},h.onMediaAttached=function(e,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},h.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},h.onBufferCreated=function(e,s){var i,f;this.audioBuffer=(i=s.tracks.audio)===null||i===void 0?void 0:i.buffer,this.videoBuffer=(f=s.tracks.video)===null||f===void 0?void 0:f.buffer},h.createData=function(){var e;return{v:p.CMCDVersion,sf:p.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},h.apply=function(e,s){s===void 0&&(s={}),n(s,this.createData());var i=s.ot===p.CMCDObjectType.INIT||s.ot===p.CMCDObjectType.VIDEO||s.ot===p.CMCDObjectType.MUXED;if(this.starved&&i&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering),this.useHeaders){var f=u.toHeaders(s);if(!Object.keys(f).length)return;e.headers||(e.headers={}),n(e.headers,f)}else{var c=u.toQuery(s);if(!c)return;e.url=u.appendQueryToUri(e.url,c)}},h.getObjectType=function(e){var s=e.type;if(s==="subtitle")return p.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return p.CMCDObjectType.INIT;if(s==="audio")return p.CMCDObjectType.AUDIO;if(s==="main")return this.hls.audioTracks.length?p.CMCDObjectType.VIDEO:p.CMCDObjectType.MUXED},h.getTopBandwidth=function(e){var s=0,i,f=this.hls;if(e===p.CMCDObjectType.AUDIO)i=f.audioTracks;else{var c=f.maxAutoLevel,a=c>-1?c+1:f.levels.length;i=f.levels.slice(0,a)}for(var v=o(i),S;!(S=v()).done;){var x=S.value;x.bitrate>s&&(s=x.bitrate)}return s>0?s:NaN},h.getBufferLength=function(e){var s=this.hls.media,i=e===p.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!i||!s)return NaN;var f=m.BufferHelper.bufferInfo(i,s.currentTime,this.config.maxBufferHole);return f.len*1e3},h.createPlaylistLoader=function(){var e=this.config.pLoader,s=this.applyPlaylistData,i=e||this.config.loader;return function(){function f(a){this.loader=void 0,this.loader=new i(a)}var c=f.prototype;return c.destroy=function(){this.loader.destroy()},c.abort=function(){this.loader.abort()},c.load=function(v,S,x){s(v),this.loader.load(v,S,x)},g(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},h.createFragmentLoader=function(){var e=this.config.fLoader,s=this.applyFragmentData,i=e||this.config.loader;return function(){function f(a){this.loader=void 0,this.loader=new i(a)}var c=f.prototype;return c.destroy=function(){this.loader.destroy()},c.abort=function(){this.loader.abort()},c.load=function(v,S,x){s(v),this.loader.load(v,S,x)},g(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},u.uuid=function(){var e=URL.createObjectURL(new Blob),s=e.toString();return URL.revokeObjectURL(e),s.slice(s.lastIndexOf("/")+1)},u.serialize=function(e){for(var s=[],i=function(C){return!Number.isNaN(C)&&C!=null&&C!==""&&C!==!1},f=function(C){return Math.round(C)},c=function(C){return f(C/100)*100},a=function(C){return encodeURIComponent(C)},v={br:f,d:f,bl:c,dl:c,mtp:c,nor:a,rtp:c,tb:f},S=Object.keys(e||{}).sort(),x=o(S),E;!(E=x()).done;){var L=E.value,b=e[L];if(!!i(b)&&!(L==="v"&&b===1)&&!(L=="pr"&&b===1)){var A=v[L];A&&(b=A(b));var O=typeof b,R=void 0;L==="ot"||L==="sf"||L==="st"?R=L+"="+b:O==="boolean"?R=L:O==="number"?R=L+"="+b:R=L+"="+JSON.stringify(b),s.push(R)}}return s.join(",")},u.toHeaders=function(e){for(var s=Object.keys(e),i={},f=["Object","Request","Session","Status"],c=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},v=0,S=s;v<S.length;v++){var x=S[v],E=a[x]!=null?a[x]:1;c[E][x]=e[x]}for(var L=0;L<c.length;L++){var b=u.serialize(c[L]);b&&(i["CMCD-"+f[L]]=b)}return i},u.toQuery=function(e){return"CMCD="+encodeURIComponent(u.serialize(e))},u.appendQueryToUri=function(e,s){if(!s)return e;var i=e.includes("?")?"&":"?";return""+e+i+s},u}()},"./src/controller/eme-controller.ts":function(M,P,y){y.r(P);var T=y("./src/events.ts"),p=y("./src/errors.ts"),m=y("./src/utils/logger.ts"),D=y("./src/utils/mediakeys-helper.ts");function _(d,u){for(var h=0;h<u.length;h++){var t=u[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function g(d,u,h){return u&&_(d.prototype,u),h&&_(d,h),Object.defineProperty(d,"prototype",{writable:!1}),d}var o=3,r=function(u,h,t){var e={audioCapabilities:[],videoCapabilities:[]};return u.forEach(function(s){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:t.audioRobustness||""})}),h.forEach(function(s){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:t.videoRobustness||""})}),[e]},l=function(u,h,t,e){switch(u){case D.KeySystems.WIDEVINE:return r(h,t,e);default:throw new Error("Unknown key-system: "+u)}},n=function(){function d(h){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=h,this._config=h.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var u=d.prototype;return u.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},u._registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this)},u._unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this)},u.getLicenseServerUrl=function(t){switch(t){case D.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},u._attemptKeySystemAccess=function(t,e,s){var i=this,f=l(t,e,s,this._drmSystemOptions);m.logger.log("Requesting encrypted media key-system access");var c=this.requestMediaKeySystemAccess(t,f);this.mediaKeysPromise=c.then(function(a){return i._onMediaKeySystemAccessObtained(t,a)}),c.catch(function(a){m.logger.error('Failed to obtain key-system "'+t+'" access:',a)})},u._onMediaKeySystemAccessObtained=function(t,e){var s=this;m.logger.log('Access for key-system "'+t+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(i);var f=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(c){return i.mediaKeys=c,m.logger.log('Media-keys created for key-system "'+t+'"'),s._onMediaKeysCreated(),c});return f.catch(function(c){m.logger.error("Failed to create media-keys:",c)}),f},u._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},u._onNewMediaKeySession=function(t){var e=this;m.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(s){e._onKeySessionMessage(t,s.message)},!1)},u._onKeySessionMessage=function(t,e){m.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(s){m.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),t.update(s).catch(function(i){m.logger.warn("Updating key-session failed: "+i)})})},u.onMediaEncrypted=function(t){var e=this;if(m.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise){m.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var s=function(f){!e._media||(e._attemptSetMediaKeys(f),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(s).catch(s)},u._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){m.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}m.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},u._generateRequestWithPreferredKeySession=function(t,e){var s=this,i=this._mediaKeysList[0];if(!i){m.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(i.mediaKeysSessionInitialized){m.logger.warn("Key-Session already initialized but requested again");return}var f=i.mediaKeysSession;if(!f){m.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){m.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}m.logger.log('Generating key-session request for "'+t+'" init data type'),i.mediaKeysSessionInitialized=!0,f.generateRequest(t,e).then(function(){m.logger.debug("Key-session generation succeeded")}).catch(function(c){m.logger.error("Error generating key-session request:",c),s.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},u._createLicenseXhr=function(t,e,s){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,s);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,i,t),f=void 0}catch(c){m.logger.error(c)}try{i.readyState||i.open("POST",t,!0),f&&f.call(this.hls,i,t)}catch(c){throw new Error("issue setting up KeySystem license XHR "+c)}return i},u._onLicenseRequestReadyStageChange=function(t,e,s,i){switch(t.readyState){case 4:if(t.status===200){this._requestLicenseFailureCount=0,m.logger.log("License request succeeded");var f=t.response,c=this._licenseResponseCallback;if(c)try{f=c.call(this.hls,t,e)}catch(v){m.logger.error(v)}i(f)}else{if(m.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>o){this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=o-this._requestLicenseFailureCount+1;m.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(s,i)}break}},u._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case D.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},u._requestLicense=function(t,e){m.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s){m.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var i=this.getLicenseServerUrl(s.mediaKeySystemDomain),f=this._createLicenseXhr(i,t,e);m.logger.log("Sending license request to URL: "+i);var c=this._generateLicenseRequestChallenge(s,t);f.send(c)}catch(a){m.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.KEY_SYSTEM_ERROR,details:p.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},u.onMediaAttached=function(t,e){if(!!this._emeEnabled){var s=e.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},u.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;!t||(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},u.onManifestParsed=function(t,e){if(!!this._emeEnabled){var s=e.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),i=e.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(D.KeySystems.WIDEVINE,s,i)}},g(d,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),d}();P.default=n},"./src/controller/fps-controller.ts":function(M,P,y){y.r(P);var T=y("./src/events.ts"),p=y("./src/utils/logger.ts"),m=function(){function D(g){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=g,this.registerListeners()}var _=D.prototype;return _.setStreamController=function(o){this.streamController=o},_.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(o,r){var l=this.hls.config;if(l.capLevelOnFPSDrop){var n=r.media instanceof self.HTMLVideoElement?r.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),l.fpsDroppedMonitoringPeriod)}},_.checkFPS=function(o,r,l){var n=performance.now();if(r){if(this.lastTime){var d=n-this.lastTime,u=l-this.lastDroppedFrames,h=r-this.lastDecodedFrames,t=1e3*u/d,e=this.hls;if(e.trigger(T.Events.FPS_DROP,{currentDropped:u,currentDecoded:h,totalDroppedFrames:l}),t>0&&u>e.config.fpsDroppedMonitoringThreshold*h){var s=e.currentLevel;p.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),s>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=s)&&(s=s-1,e.trigger(T.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:e.currentLevel}),e.autoLevelCapping=s,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=l,this.lastDecodedFrames=r}},_.checkFPSInterval=function(){var o=this.media;if(o)if(this.isVideoPlaybackQualityAvailable){var r=o.getVideoPlaybackQuality();this.checkFPS(o,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(o,o.webkitDecodedFrameCount,o.webkitDroppedFrameCount)},D}();P.default=m},"./src/controller/fragment-finders.ts":function(M,P,y){y.r(P),y.d(P,"findFragmentByPDT",function(){return m}),y.d(P,"findFragmentByPTS",function(){return D}),y.d(P,"fragmentWithinToleranceTest",function(){return _}),y.d(P,"pdtWithinToleranceTest",function(){return g}),y.d(P,"findFragWithCC",function(){return o});var T=y("./src/polyfills/number.ts"),p=y("./src/utils/binary-search.ts");function m(r,l,n){if(l===null||!Array.isArray(r)||!r.length||!Object(T.isFiniteNumber)(l))return null;var d=r[0].programDateTime;if(l<(d||0))return null;var u=r[r.length-1].endProgramDateTime;if(l>=(u||0))return null;n=n||0;for(var h=0;h<r.length;++h){var t=r[h];if(g(l,n,t))return t}return null}function D(r,l,n,d){n===void 0&&(n=0),d===void 0&&(d=0);var u=null;if(r?u=l[r.sn-l[0].sn+1]||null:n===0&&l[0].start===0&&(u=l[0]),u&&_(n,d,u)===0)return u;var h=p.default.search(l,_.bind(null,n,d));return h||u}function _(r,l,n){r===void 0&&(r=0),l===void 0&&(l=0);var d=Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-d<=r?1:n.start-d>r&&n.start?-1:0}function g(r,l,n){var d=Math.min(l,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3,u=n.endProgramDateTime||0;return u-d>r}function o(r,l){return p.default.search(r,function(n){return n.cc<l?1:n.cc>l?-1:0})}},"./src/controller/fragment-tracker.ts":function(M,P,y){y.r(P),y.d(P,"FragmentState",function(){return m}),y.d(P,"FragmentTracker",function(){return D});var T=y("./src/events.ts"),p=y("./src/types/loader.ts"),m;(function(o){o.NOT_LOADED="NOT_LOADED",o.APPENDING="APPENDING",o.PARTIAL="PARTIAL",o.OK="OK"})(m||(m={}));var D=function(){function o(l){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=l,this._registerListeners()}var r=o.prototype;return r._registerListeners=function(){var n=this.hls;n.on(T.Events.BUFFER_APPENDED,this.onBufferAppended,this),n.on(T.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(T.Events.FRAG_LOADED,this.onFragLoaded,this)},r._unregisterListeners=function(){var n=this.hls;n.off(T.Events.BUFFER_APPENDED,this.onBufferAppended,this),n.off(T.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(T.Events.FRAG_LOADED,this.onFragLoaded,this)},r.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},r.getAppendedFrag=function(n,d){if(d===p.PlaylistLevelType.MAIN){var u=this.activeFragment,h=this.activeParts;if(!u)return null;if(h)for(var t=h.length;t--;){var e=h[t],s=e?e.end:u.appendedPTS;if(e.start<=n&&s!==void 0&&n<=s)return t>9&&(this.activeParts=h.slice(t-9)),e}else if(u.start<=n&&u.appendedPTS!==void 0&&n<=u.appendedPTS)return u}return this.getBufferedFrag(n,d)},r.getBufferedFrag=function(n,d){for(var u=this.fragments,h=Object.keys(u),t=h.length;t--;){var e=u[h[t]];if((e==null?void 0:e.body.type)===d&&e.buffered){var s=e.body;if(s.start<=n&&n<=s.end)return s}}return null},r.detectEvictedFragments=function(n,d,u){var h=this;Object.keys(this.fragments).forEach(function(t){var e=h.fragments[t];if(!!e){if(!e.buffered){e.body.type===u&&h.removeFragment(e.body);return}var s=e.range[n];!s||s.time.some(function(i){var f=!h.isTimeBuffered(i.startPTS,i.endPTS,d);return f&&h.removeFragment(e.body),f})}})},r.detectPartialFragments=function(n){var d=this,u=this.timeRanges,h=n.frag,t=n.part;if(!(!u||h.sn==="initSegment")){var e=g(h),s=this.fragments[e];!s||(Object.keys(u).forEach(function(i){var f=h.elementaryStreams[i];if(!!f){var c=u[i],a=t!==null||f.partial===!0;s.range[i]=d.getBufferedTimes(h,t,a,c)}}),s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},r.fragBuffered=function(n){var d=g(n),u=this.fragments[d];u&&(u.loaded=null,u.buffered=!0)},r.getBufferedTimes=function(n,d,u,h){for(var t={time:[],partial:u},e=d?d.start:n.start,s=d?d.end:n.end,i=n.minEndPTS||s,f=n.maxStartPTS||e,c=0;c<h.length;c++){var a=h.start(c)-this.bufferPadding,v=h.end(c)+this.bufferPadding;if(f>=a&&i<=v){t.time.push({startPTS:Math.max(e,h.start(c)),endPTS:Math.min(s,h.end(c))});break}else if(e<v&&s>a)t.partial=!0,t.time.push({startPTS:Math.max(e,h.start(c)),endPTS:Math.min(s,h.end(c))});else if(s<=a)break}return t},r.getPartialFragment=function(n){var d=null,u,h,t,e=0,s=this.bufferPadding,i=this.fragments;return Object.keys(i).forEach(function(f){var c=i[f];!c||_(c)&&(h=c.body.start-s,t=c.body.end+s,n>=h&&n<=t&&(u=Math.min(n-h,t-n),e<=u&&(d=c.body,e=u)))}),d},r.getState=function(n){var d=g(n),u=this.fragments[d];return u?u.buffered?_(u)?m.PARTIAL:m.OK:m.APPENDING:m.NOT_LOADED},r.isTimeBuffered=function(n,d,u){for(var h,t,e=0;e<u.length;e++){if(h=u.start(e)-this.bufferPadding,t=u.end(e)+this.bufferPadding,n>=h&&d<=t)return!0;if(d<=h)return!1}return!1},r.onFragLoaded=function(n,d){var u=d.frag,h=d.part;if(!(u.sn==="initSegment"||u.bitrateTest||h)){var t=g(u);this.fragments[t]={body:u,loaded:d,buffered:!1,range:Object.create(null)}}},r.onBufferAppended=function(n,d){var u=this,h=d.frag,t=d.part,e=d.timeRanges;if(h.type===p.PlaylistLevelType.MAIN)if(this.activeFragment=h,t){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(t)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(i){var f=e[i];if(u.detectEvictedFragments(i,f),!t)for(var c=0;c<f.length;c++)h.appendedPTS=Math.max(f.end(c),h.appendedPTS||0)})},r.onFragBuffered=function(n,d){this.detectPartialFragments(d)},r.hasFragment=function(n){var d=g(n);return!!this.fragments[d]},r.removeFragmentsInRange=function(n,d,u){var h=this;Object.keys(this.fragments).forEach(function(t){var e=h.fragments[t];if(!!e&&e.buffered){var s=e.body;s.type===u&&s.start<d&&s.end>n&&h.removeFragment(s)}})},r.removeFragment=function(n){var d=g(n);n.stats.loaded=0,n.clearElementaryStreamInfo(),delete this.fragments[d]},r.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},o}();function _(o){var r,l;return o.buffered&&(((r=o.range.video)===null||r===void 0?void 0:r.partial)||((l=o.range.audio)===null||l===void 0?void 0:l.partial))}function g(o){return o.type+"_"+o.level+"_"+o.urlId+"_"+o.sn}},"./src/controller/gap-controller.ts":function(M,P,y){y.r(P),y.d(P,"STALL_MINIMUM_DURATION_MS",function(){return _}),y.d(P,"MAX_START_GAP_JUMP",function(){return g}),y.d(P,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),y.d(P,"SKIP_BUFFER_RANGE_START",function(){return r}),y.d(P,"default",function(){return l});var T=y("./src/utils/buffer-helper.ts"),p=y("./src/errors.ts"),m=y("./src/events.ts"),D=y("./src/utils/logger.ts"),_=250,g=2,o=.1,r=.05,l=function(){function n(u,h,t,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=u,this.media=h,this.fragmentTracker=t,this.hls=e}var d=n.prototype;return d.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},d.poll=function(h,t){var e=this.config,s=this.media,i=this.stalled;if(s!==null){var f=s.currentTime,c=s.seeking,a=this.seeking&&!c,v=!this.seeking&&c;if(this.seeking=c,f!==h){if(this.moved=!0,i!==null){if(this.stallReported){var S=self.performance.now()-i;D.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(S)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((v||a)&&(this.stalled=null),!(s.paused&&!c||s.ended||s.playbackRate===0||!T.BufferHelper.getBuffered(s).length)){var x=T.BufferHelper.bufferInfo(s,f,0),E=x.len>0,L=x.nextStart||0;if(!(!E&&!L)){if(c){var b=x.len>g,A=!L||t&&t.start<=f||L-f>g&&!this.fragmentTracker.getPartialFragment(f);if(b||A)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var O,R=Math.max(L,x.start||0)-f,I=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,C=I==null||(O=I.details)===null||O===void 0?void 0:O.live,F=C?I.details.targetduration*2:g;if(R>0&&R<=F){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(i===null){this.stalled=w;return}var k=w-i;if(!(!c&&k>=_&&(this._reportStall(x),!this.media))){var B=T.BufferHelper.bufferInfo(s,f,e.maxBufferHole);this._tryFixBufferStall(B,k)}}}}},d._tryFixBufferStall=function(h,t){var e=this.config,s=this.fragmentTracker,i=this.media;if(i!==null){var f=i.currentTime,c=s.getPartialFragment(f);if(c){var a=this._trySkipBufferHole(c);if(a||!this.media)return}h.len>e.maxBufferHole&&t>e.highBufferWatchdogPeriod*1e3&&(D.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},d._reportStall=function(h){var t=this.hls,e=this.media,s=this.stallReported;!s&&e&&(this.stallReported=!0,D.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(h)+")"),t.trigger(m.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h.len}))},d._trySkipBufferHole=function(h){var t=this.config,e=this.hls,s=this.media;if(s===null)return 0;for(var i=s.currentTime,f=0,c=T.BufferHelper.getBuffered(s),a=0;a<c.length;a++){var v=c.start(a);if(i+t.maxBufferHole>=f&&i<v){var S=Math.max(v+r,s.currentTime+o);return D.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+S),this.moved=!0,this.stalled=null,s.currentTime=S,h&&e.trigger(m.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+S,frag:h}),S}f=c.end(a)}return 0},d._tryNudgeBuffer=function(){var h=this.config,t=this.hls,e=this.media,s=this.nudgeRetry;if(e!==null){var i=e.currentTime;if(this.nudgeRetry++,s<h.nudgeMaxRetry){var f=i+(s+1)*h.nudgeOffset;D.logger.warn("Nudging 'currentTime' from "+i+" to "+f),e.currentTime=f,t.trigger(m.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else D.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+h.nudgeMaxRetry+" nudges"),t.trigger(m.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},n}()},"./src/controller/id3-track-controller.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/events.ts"),m=y("./src/utils/texttrack-utils.ts"),D=y("./src/demux/id3.ts"),_=y("./src/loader/date-range.ts"),g=y("./src/types/demuxer.ts"),o=.25;function r(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function l(u,h){return u.getTime()/1e3-h}function n(u){return Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var d=function(){function u(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var h=u.prototype;return h.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},h._registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},h._unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},h.onMediaAttached=function(e,s){this.media=s.media},h.onMediaDetaching=function(){!this.id3Track||(Object(m.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},h.onManifestLoading=function(){this.dateRangeCuesAppended={}},h.createTrack=function(e){var s=this.getID3Track(e.textTracks);return s.mode="hidden",s},h.getID3Track=function(e){if(!!this.media){for(var s=0;s<e.length;s++){var i=e[s];if(i.kind==="metadata"&&i.label==="id3")return Object(m.sendAddTrackEvent)(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},h.onFragParsingMetadata=function(e,s){if(!!this.media){var i=this.hls.config,f=i.enableEmsgMetadataCues,c=i.enableID3MetadataCues;if(!(!f&&!c)){var a=s.frag,v=s.samples,S=s.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var x=S.edge||a.end,E=r(),L=!1,b={},A=0;A<v.length;A++){var O=v[A].type;if(!(O===g.MetadataSchema.emsg&&!f||!c)){var R=D.getID3Frames(v[A].data);if(R){var I=v[A].pts,C=x,F=C-I;F<=0&&(C=I+o);for(var w=0;w<R.length;w++){var k=R[w];if(!D.isTimeStampFrame(k)){var B=new E(I,C,"");B.value=k,O&&(B.type=O),this.id3Track.addCue(B),b[k.key]=null,L=!0}}}}}L&&this.updateId3CueEnds(b)}}},h.updateId3CueEnds=function(e){var s,i=(s=this.id3Track)===null||s===void 0?void 0:s.cues;if(i)for(var f=i.length;f--;){var c,a=i[f],v=(c=a.value)===null||c===void 0?void 0:c.key;if(v&&v in e){var S=e[v];S&&a.endTime!==S&&(a.endTime=S),e[v]=a.startTime}}},h.onBufferFlushing=function(e,s){var i=s.startOffset,f=s.endOffset,c=s.type,a=this.id3Track,v=this.hls;if(!!v){var S=v.config,x=S.enableEmsgMetadataCues,E=S.enableID3MetadataCues;if(a&&(x||E)){var L;c==="audio"?L=function(A){return A.type===g.MetadataSchema.audioId3&&E}:c==="video"?L=function(A){return A.type===g.MetadataSchema.emsg&&x}:L=function(A){return A.type===g.MetadataSchema.audioId3&&E||A.type===g.MetadataSchema.emsg&&x},Object(m.removeCuesInRange)(a,i,f,L)}}},h.onLevelUpdated=function(e,s){var i=this,f=s.details;if(!(!this.media||!f.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var c=this.dateRangeCuesAppended,a=this.id3Track,v=f.dateRanges,S=Object.keys(v);if(a)for(var x=Object.keys(c).filter(function(F){return!S.includes(F)}),E=function(w){var k=x[w];Object.keys(c[k].cues).forEach(function(B){a.removeCue(c[k].cues[B])}),delete c[k]},L=x.length;L--;)E(L);var b=f.fragments[f.fragments.length-1];if(!(S.length===0||!Object(T.isFiniteNumber)(b==null?void 0:b.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var A=b.programDateTime/1e3-b.start,O=f.edge||b.end,R=r(),I=function(w){var k=S[w],B=v[k],U=c[k],N=(U==null?void 0:U.cues)||{},j=(U==null?void 0:U.durationKnown)||!1,K=l(B.startDate,A),V=O,H=B.endDate;if(H)V=l(H,A),j=!0;else if(B.endOnNext&&!j){var Y=S.reduce(function(ee,se){var ae=v[se];return ae.class===B.class&&ae.id!==se&&ae.startDate>B.startDate&&ee.push(ae),ee},[]).sort(function(ee,se){return ee.startDate.getTime()-se.startDate.getTime()})[0];Y&&(V=l(Y.startDate,A),j=!0)}for(var q=Object.keys(B.attr),$=0;$<q.length;$++){var G=q[$];if(!(G===_.DateRangeAttribute.ID||G===_.DateRangeAttribute.CLASS||G===_.DateRangeAttribute.START_DATE||G===_.DateRangeAttribute.DURATION||G===_.DateRangeAttribute.END_DATE||G===_.DateRangeAttribute.END_ON_NEXT)){var re=N[G];if(re)j&&!U.durationKnown&&(re.endTime=V);else{var Q=B.attr[G];re=new R(K,V,""),(G===_.DateRangeAttribute.SCTE35_OUT||G===_.DateRangeAttribute.SCTE35_IN)&&(Q=n(Q)),re.value={key:G,data:Q},re.type=g.MetadataSchema.dateRange,i.id3Track.addCue(re),N[G]=re}}}c[k]={cues:N,dateRange:B,durationKnown:j}},C=0;C<S.length;C++)I(C)}}},u}();P.default=d},"./src/controller/latency-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return g});var T=y("./src/errors.ts"),p=y("./src/events.ts"),m=y("./src/utils/logger.ts");function D(o,r){for(var l=0;l<r.length;l++){var n=r[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function _(o,r,l){return r&&D(o.prototype,r),l&&D(o,l),Object.defineProperty(o,"prototype",{writable:!1}),o}var g=function(){function o(l){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=l,this.config=l.config,this.registerListeners()}var r=o.prototype;return r.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},r.registerListeners=function(){this.hls.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(p.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(p.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){this.hls.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(p.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(p.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(p.Events.ERROR,this.onError)},r.onMediaAttached=function(n,d){this.media=d.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},r.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},r.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},r.onLevelUpdated=function(n,d){var u=d.details;this.levelDetails=u,u.advanced&&this.timeupdate(),!u.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},r.onError=function(n,d){d.details===T.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,m.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},r.timeupdate=function(){var n=this.media,d=this.levelDetails;if(!(!n||!d)){this.currentTime=n.currentTime;var u=this.computeLatency();if(u!==null){this._latency=u;var h=this.config,t=h.lowLatencyMode,e=h.maxLiveSyncPlaybackRate;if(!(!t||e===1)){var s=this.targetLatency;if(s!==null){var i=u-s,f=Math.min(this.maxLatency,s+d.targetduration),c=i<f;if(d.live&&c&&i>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,e)),v=Math.round(2/(1+Math.exp(-.75*i-this.edgeStalled))*20)/20;n.playbackRate=Math.min(a,Math.max(1,v))}else n.playbackRate!==1&&n.playbackRate!==0&&(n.playbackRate=1)}}}}},r.estimateLiveEdge=function(){var n=this.levelDetails;return n===null?null:n.edge+n.age},r.computeLatency=function(){var n=this.estimateLiveEdge();return n===null?null:n-this.currentTime},_(o,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var n=this.config,d=this.levelDetails;return n.liveMaxLatencyDuration!==void 0?n.liveMaxLatencyDuration:d?n.liveMaxLatencyDurationCount*d.targetduration:0}},{key:"targetLatency",get:function(){var n=this.levelDetails;if(n===null)return null;var d=n.holdBack,u=n.partHoldBack,h=n.targetduration,t=this.config,e=t.liveSyncDuration,s=t.liveSyncDurationCount,i=t.lowLatencyMode,f=this.hls.userConfig,c=i&&u||d;(f.liveSyncDuration||f.liveSyncDurationCount||c===0)&&(c=e!==void 0?e:s*h);var a=h,v=1;return c+Math.min(this.stallCount*v,a)}},{key:"liveSyncPosition",get:function(){var n=this.estimateLiveEdge(),d=this.targetLatency,u=this.levelDetails;if(n===null||d===null||u===null)return null;var h=u.edge,t=n-d-this.edgeStalled,e=h-u.totalduration,s=h-(this.config.lowLatencyMode&&u.partTarget||u.targetduration);return Math.min(Math.max(e,t),s)}},{key:"drift",get:function(){var n=this.levelDetails;return n===null?1:n.drift}},{key:"edgeStalled",get:function(){var n=this.levelDetails;if(n===null)return 0;var d=(this.config.lowLatencyMode&&n.partTarget||n.targetduration)*3;return Math.max(n.age-d,0)}},{key:"forwardBufferLength",get:function(){var n=this.media,d=this.levelDetails;if(!n||!d)return 0;var u=n.buffered.length;return(u?n.buffered.end(u-1):d.edge)-this.currentTime}}]),o}()},"./src/controller/level-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return t});var T=y("./src/types/level.ts"),p=y("./src/events.ts"),m=y("./src/errors.ts"),D=y("./src/utils/codecs.ts"),_=y("./src/controller/level-helper.ts"),g=y("./src/controller/base-playlist-controller.ts"),o=y("./src/types/loader.ts");function r(){return r=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&(e[f]=i[f])}return e},r.apply(this,arguments)}function l(e,s){for(var i=0;i<s.length;i++){var f=s[i];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function n(e,s,i){return s&&l(e.prototype,s),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,u(e,s)}function u(e,s){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,c){return f.__proto__=c,f},u(e,s)}var h=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t=function(e){d(s,e);function s(f){var c;return c=e.call(this,f,"[level-controller]")||this,c._levels=[],c._firstLevel=-1,c._startLevel=void 0,c.currentLevelIndex=-1,c.manualLevelIndex=-1,c.onParsedComplete=void 0,c._registerListeners(),c}var i=s.prototype;return i._registerListeners=function(){var c=this.hls;c.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(p.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var c=this.hls;c.off(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(p.Events.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},i.startLoad=function(){var c=this._levels;c.forEach(function(a){a.loadError=0}),e.prototype.startLoad.call(this)},i.onManifestLoaded=function(c,a){var v=[],S=[],x=[],E,L={},b,A=!1,O=!1,R=!1;if(a.levels.forEach(function(w){var k=w.attrs;A=A||!!(w.width&&w.height),O=O||!!w.videoCodec,R=R||!!w.audioCodec,h&&w.audioCodec&&w.audioCodec.indexOf("mp4a.40.34")!==-1&&(w.audioCodec=void 0);var B=w.bitrate+"-"+w.attrs.RESOLUTION+"-"+w.attrs.CODECS;b=L[B],b?b.url.push(w.url):(b=new T.Level(w),L[B]=b,v.push(b)),k&&(k.AUDIO&&Object(_.addGroupId)(b,"audio",k.AUDIO),k.SUBTITLES&&Object(_.addGroupId)(b,"text",k.SUBTITLES))}),(A||O)&&R&&(v=v.filter(function(w){var k=w.videoCodec,B=w.width,U=w.height;return!!k||!!(B&&U)})),v=v.filter(function(w){var k=w.audioCodec,B=w.videoCodec;return(!k||Object(D.isCodecSupportedInMp4)(k,"audio"))&&(!B||Object(D.isCodecSupportedInMp4)(B,"video"))}),a.audioTracks&&(S=a.audioTracks.filter(function(w){return!w.audioCodec||Object(D.isCodecSupportedInMp4)(w.audioCodec,"audio")}),Object(_.assignTrackIdsByGroup)(S)),a.subtitles&&(x=a.subtitles,Object(_.assignTrackIdsByGroup)(x)),v.length>0){E=v[0].bitrate,v.sort(function(w,k){return w.bitrate-k.bitrate}),this._levels=v;for(var I=0;I<v.length;I++)if(v[I].bitrate===E){this._firstLevel=I,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+E);break}var C=R&&!O,F={levels:v,audioTracks:S,subtitleTracks:x,firstLevel:this._firstLevel,stats:a.stats,audio:R,video:O,altAudio:!C&&S.some(function(w){return!!w.url})};this.hls.trigger(p.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(p.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(c,a){var v;if(e.prototype.onError.call(this,c,a),!a.fatal){var S=a.context,x=this._levels[this.currentLevelIndex];if(S&&(S.type===o.PlaylistContextType.AUDIO_TRACK&&x.audioGroupIds&&S.groupId===x.audioGroupIds[x.urlId]||S.type===o.PlaylistContextType.SUBTITLE_TRACK&&x.textGroupIds&&S.groupId===x.textGroupIds[x.urlId])){this.redundantFailover(this.currentLevelIndex);return}var E=!1,L=!0,b;switch(a.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var A=a.frag.type===o.PlaylistLevelType.MAIN?a.frag.level:this.currentLevelIndex,O=this._levels[A];O?(O.fragmentError++,O.fragmentError>this.hls.config.fragLoadingMaxRetry&&(b=A)):b=A}break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:S&&(S.deliveryDirectives&&(L=!1),b=S.level),E=!0;break;case m.ErrorDetails.REMUX_ALLOC_ERROR:b=(v=a.level)!=null?v:this.currentLevelIndex,E=!0;break}b!==void 0&&this.recoverLevel(a,b,E,L)}},i.recoverLevel=function(c,a,v,S){var x=c.details,E=this._levels[a];if(E.loadError++,v){var L=this.retryLoadingOrFail(c);if(L)c.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(S){var b=E.url.length;if(b>1&&E.loadError<b)c.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){for(var A=-1,O=this._levels,R=O.length;R--;){var I=(R+this.currentLevelIndex)%O.length;if(I!==this.currentLevelIndex&&O[I].loadError===0){A=I;break}}A>-1&&this.currentLevelIndex!==A&&(this.warn(x+": switch to "+A),c.levelRetry=!0,this.hls.nextAutoLevel=A)}}},i.redundantFailover=function(c){var a=this._levels[c],v=a.url.length;if(v>1){var S=(a.urlId+1)%v;this.warn("Switching to redundant URL-id "+S),this._levels.forEach(function(x){x.urlId=S}),this.level=c}},i.onFragLoaded=function(c,a){var v=a.frag;if(v!==void 0&&v.type===o.PlaylistLevelType.MAIN){var S=this._levels[v.level];S!==void 0&&(S.fragmentError=0,S.loadError=0)}},i.onLevelLoaded=function(c,a){var v,S=a.level,x=a.details,E=this._levels[S];if(!E){var L;this.warn("Invalid level index "+S),(L=a.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(x.deltaUpdateFailed=!0);return}S===this.currentLevelIndex?(E.fragmentError===0&&(E.loadError=0,this.retryCount=0),this.playlistLoaded(S,a,E.details)):(v=a.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(x.deltaUpdateFailed=!0)},i.onAudioTrackSwitched=function(c,a){var v=this.hls.levels[this.currentLevelIndex];if(!!v&&v.audioGroupIds){for(var S=-1,x=this.hls.audioTracks[a.id].groupId,E=0;E<v.audioGroupIds.length;E++)if(v.audioGroupIds[E]===x){S=E;break}S!==v.urlId&&(v.urlId=S,this.startLoad())}},i.loadPlaylist=function(c){var a=this.currentLevelIndex,v=this._levels[a];if(this.canLoad&&v&&v.url.length>0){var S=v.urlId,x=v.url[S];if(c)try{x=c.addDirectives(x)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("Attempt loading level index "+a+(c?" at sn "+c.msn+" part "+c.part:"")+" with URL-id "+S+" "+x),this.clearTimer(),this.hls.trigger(p.Events.LEVEL_LOADING,{url:x,level:a,id:S,deliveryDirectives:c||null})}},i.removeLevel=function(c,a){var v=function(E,L){return L!==a},S=this._levels.filter(function(x,E){return E!==c?!0:x.url.length>1&&a!==void 0?(x.url=x.url.filter(v),x.audioGroupIds&&(x.audioGroupIds=x.audioGroupIds.filter(v)),x.textGroupIds&&(x.textGroupIds=x.textGroupIds.filter(v)),x.urlId=0,!0):!1}).map(function(x,E){var L=x.details;return L!=null&&L.fragments&&L.fragments.forEach(function(b){b.level=E}),x});this._levels=S,this.hls.trigger(p.Events.LEVELS_UPDATED,{levels:S})},n(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(c){var a,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===c&&(a=v[c])!==null&&a!==void 0&&a.details)){if(c<0||c>=v.length){var S=c<0;if(this.hls.trigger(p.Events.ERROR,{type:m.ErrorTypes.OTHER_ERROR,details:m.ErrorDetails.LEVEL_SWITCH_ERROR,level:c,fatal:S,reason:"invalid level idx"}),S)return;c=Math.min(c,v.length-1)}this.clearTimer();var x=this.currentLevelIndex,E=v[x],L=v[c];this.log("switching to level "+c+" from "+x),this.currentLevelIndex=c;var b=r({},L,{level:c,maxBitrate:L.maxBitrate,uri:L.uri,urlId:L.urlId});delete b._urlId,this.hls.trigger(p.Events.LEVEL_SWITCHING,b);var A=L.details;if(!A||A.live){var O=this.switchParams(L.uri,E==null?void 0:E.details);this.loadPlaylist(O)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(c){this.manualLevelIndex=c,this._startLevel===void 0&&(this._startLevel=c),c!==-1&&(this.level=c)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(c){this._firstLevel=c}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var c=this.hls.config.startLevel;return c!==void 0?c:this._firstLevel}else return this._startLevel},set:function(c){this._startLevel=c}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(c){this.level=c,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=c)}}]),s}(g.default)},"./src/controller/level-helper.ts":function(M,P,y){y.r(P),y.d(P,"addGroupId",function(){return _}),y.d(P,"assignTrackIdsByGroup",function(){return g}),y.d(P,"updatePTS",function(){return o}),y.d(P,"updateFragPTSDTS",function(){return l}),y.d(P,"mergeDetails",function(){return n}),y.d(P,"mapPartIntersection",function(){return u}),y.d(P,"mapFragmentIntersection",function(){return h}),y.d(P,"adjustSliding",function(){return t}),y.d(P,"addSliding",function(){return e}),y.d(P,"computeReloadInterval",function(){return s}),y.d(P,"getFragmentWithSN",function(){return i}),y.d(P,"getPartWith",function(){return f});var T=y("./src/polyfills/number.ts"),p=y("./src/utils/logger.ts"),m=y("./src/loader/date-range.ts");function D(){return D=Object.assign?Object.assign.bind():function(c){for(var a=1;a<arguments.length;a++){var v=arguments[a];for(var S in v)Object.prototype.hasOwnProperty.call(v,S)&&(c[S]=v[S])}return c},D.apply(this,arguments)}function _(c,a,v){switch(a){case"audio":c.audioGroupIds||(c.audioGroupIds=[]),c.audioGroupIds.push(v);break;case"text":c.textGroupIds||(c.textGroupIds=[]),c.textGroupIds.push(v);break}}function g(c){var a={};c.forEach(function(v){var S=v.groupId||"";v.id=a[S]=a[S]||0,a[S]++})}function o(c,a,v){var S=c[a],x=c[v];r(S,x)}function r(c,a){var v=a.startPTS;if(Object(T.isFiniteNumber)(v)){var S=0,x;a.sn>c.sn?(S=v-c.start,x=c):(S=c.start-v,x=a),x.duration!==S&&(x.duration=S)}else if(a.sn>c.sn){var E=c.cc===a.cc;E&&c.minEndPTS?a.start=c.start+(c.minEndPTS-c.start):a.start=c.start+c.duration}else a.start=Math.max(c.start-a.duration,0)}function l(c,a,v,S,x,E){var L=S-v;L<=0&&(p.logger.warn("Fragment should have a positive duration",a),S=v+a.duration,E=x+a.duration);var b=v,A=S,O=a.startPTS,R=a.endPTS;if(Object(T.isFiniteNumber)(O)){var I=Math.abs(O-v);Object(T.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(I,a.deltaPTS):a.deltaPTS=I,b=Math.max(v,O),v=Math.min(v,O),x=Math.min(x,a.startDTS),A=Math.min(S,R),S=Math.max(S,R),E=Math.max(E,a.endDTS)}a.duration=S-v;var C=v-a.start;a.appendedPTS=S,a.start=a.startPTS=v,a.maxStartPTS=b,a.startDTS=x,a.endPTS=S,a.minEndPTS=A,a.endDTS=E;var F=a.sn;if(!c||F<c.startSN||F>c.endSN)return 0;var w,k=F-c.startSN,B=c.fragments;for(B[k]=a,w=k;w>0;w--)r(B[w],B[w-1]);for(w=k;w<B.length-1;w++)r(B[w],B[w+1]);return c.fragmentHint&&r(B[B.length-1],c.fragmentHint),c.PTSKnown=c.alignedSliding=!0,C}function n(c,a){for(var v=null,S=c.fragments,x=S.length-1;x>=0;x--){var E=S[x].initSegment;if(E){v=E;break}}c.fragmentHint&&delete c.fragmentHint.endPTS;var L=0,b;if(h(c,a,function(w,k){w.relurl&&(L=w.cc-k.cc),Object(T.isFiniteNumber)(w.startPTS)&&Object(T.isFiniteNumber)(w.endPTS)&&(k.start=k.startPTS=w.startPTS,k.startDTS=w.startDTS,k.appendedPTS=w.appendedPTS,k.maxStartPTS=w.maxStartPTS,k.endPTS=w.endPTS,k.endDTS=w.endDTS,k.minEndPTS=w.minEndPTS,k.duration=w.endPTS-w.startPTS,k.duration&&(b=k),a.PTSKnown=a.alignedSliding=!0),k.elementaryStreams=w.elementaryStreams,k.loader=w.loader,k.stats=w.stats,k.urlId=w.urlId,w.initSegment&&(k.initSegment=w.initSegment,v=w.initSegment)}),v){var A=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;A.forEach(function(w){var k;(!w.initSegment||w.initSegment.relurl===((k=v)===null||k===void 0?void 0:k.relurl))&&(w.initSegment=v)})}if(a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(w){return!w}),a.deltaUpdateFailed){p.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var O=a.skippedSegments;O--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=d(c.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var R=a.fragments;if(L){p.logger.warn("discontinuity sliding from playlist, take drift into account");for(var I=0;I<R.length;I++)R[I].cc+=L}a.skippedSegments&&(a.startCC=a.fragments[0].cc),u(c.partList,a.partList,function(w,k){k.elementaryStreams=w.elementaryStreams,k.stats=w.stats}),b?l(a,b,b.startPTS,b.endPTS,b.startDTS,b.endDTS):t(c,a),R.length&&(a.totalduration=a.edge-R[0].start),a.driftStartTime=c.driftStartTime,a.driftStart=c.driftStart;var C=a.advancedDateTime;if(a.advanced&&C){var F=a.edge;a.driftStart||(a.driftStartTime=C,a.driftStart=F),a.driftEndTime=C,a.driftEnd=F}else a.driftEndTime=c.driftEndTime,a.driftEnd=c.driftEnd,a.advancedDateTime=c.advancedDateTime}function d(c,a,v){var S=D({},c);return v&&v.forEach(function(x){delete S[x]}),Object.keys(a).forEach(function(x){var E=new m.DateRange(a[x].attr,S[x]);E.isValid?S[x]=E:p.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[x].attr)+'"')}),S}function u(c,a,v){if(c&&a)for(var S=0,x=0,E=c.length;x<=E;x++){var L=c[x],b=a[x+S];L&&b&&L.index===b.index&&L.fragment.sn===b.fragment.sn?v(L,b):S--}}function h(c,a,v){for(var S=a.skippedSegments,x=Math.max(c.startSN,a.startSN)-a.startSN,E=(c.fragmentHint?1:0)+(S?a.endSN:Math.min(c.endSN,a.endSN))-a.startSN,L=a.startSN-c.startSN,b=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,A=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments,O=x;O<=E;O++){var R=A[L+O],I=b[O];S&&!I&&O<S&&(I=a.fragments[O]=R),R&&I&&v(R,I)}}function t(c,a){var v=a.startSN+a.skippedSegments-c.startSN,S=c.fragments;v<0||v>=S.length||e(a,S[v].start)}function e(c,a){if(a){for(var v=c.fragments,S=c.skippedSegments;S<v.length;S++)v[S].start+=a;c.fragmentHint&&(c.fragmentHint.start+=a)}}function s(c,a){var v=1e3*c.levelTargetDuration,S=v/2,x=c.age,E=x>0&&x<v*3,L=a.loading.end-a.loading.start,b,A=c.availabilityDelay;if(c.updated===!1)if(E){var O=333*c.misses;b=Math.max(Math.min(S,L*2),O),c.availabilityDelay=(c.availabilityDelay||0)+b}else b=S;else E?(A=Math.min(A||v/2,x),c.availabilityDelay=A,b=A+v-x):b=v-L;return Math.round(b)}function i(c,a,v){if(!c||!c.details)return null;var S=c.details,x=S.fragments[a-S.startSN];return x||(x=S.fragmentHint,x&&x.sn===a)?x:a<S.startSN&&v&&v.sn===a?v:null}function f(c,a,v){if(!c||!c.details)return null;var S=c.details.partList;if(S)for(var x=S.length;x--;){var E=S[x];if(E.index===v&&E.fragment.sn===a)return E}return null}},"./src/controller/stream-controller.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return f});var T=y("./src/polyfills/number.ts"),p=y("./src/controller/base-stream-controller.ts"),m=y("./src/is-supported.ts"),D=y("./src/events.ts"),_=y("./src/utils/buffer-helper.ts"),g=y("./src/controller/fragment-tracker.ts"),o=y("./src/types/loader.ts"),r=y("./src/loader/fragment.ts"),l=y("./src/demux/transmuxer-interface.ts"),n=y("./src/types/transmuxer.ts"),d=y("./src/controller/gap-controller.ts"),u=y("./src/errors.ts");function h(c,a){for(var v=0;v<a.length;v++){var S=a[v];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(c,S.key,S)}}function t(c,a,v){return a&&h(c.prototype,a),v&&h(c,v),Object.defineProperty(c,"prototype",{writable:!1}),c}function e(c,a){c.prototype=Object.create(a.prototype),c.prototype.constructor=c,s(c,a)}function s(c,a){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,x){return S.__proto__=x,S},s(c,a)}var i=100,f=function(c){e(a,c);function a(S,x){var E;return E=c.call(this,S,x,"[stream-controller]")||this,E.audioCodecSwap=!1,E.gapController=null,E.level=-1,E._forceStartLoad=!1,E.altAudio=!1,E.audioOnly=!1,E.fragPlaying=null,E.onvplaying=null,E.onvseeked=null,E.fragLastKbps=0,E.couldBacktrack=!1,E.backtrackFragment=null,E.audioCodecSwitch=!1,E.videoBuffer=null,E._registerListeners(),E}var v=a.prototype;return v._registerListeners=function(){var x=this.hls;x.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),x.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.on(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),x.on(D.Events.ERROR,this.onError,this),x.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),x.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),x.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),x.on(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),x.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var x=this.hls;x.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.off(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),x.off(D.Events.ERROR,this.onError,this),x.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),x.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),x.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),x.off(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),x.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(x){if(this.levels){var E=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(i),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=L.startLevel;b===-1&&(L.config.testBandwidth&&this.levels.length>1?(b=0,this.bitrateTest=!0):b=L.nextAutoLevel),this.level=L.nextLoadLevel=b,this.loadedmetadata=!1}E>0&&x===-1&&(this.log("Override startPosition with lastCurrentTime @"+E.toFixed(3)),x=E),this.state=p.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=x,this.tick()}else this._forceStartLoad=!0,this.state=p.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,c.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case p.State.IDLE:this.doTickIdle();break;case p.State.WAITING_LEVEL:{var x,E=this.levels,L=this.level,b=E==null||(x=E[L])===null||x===void 0?void 0:x.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=p.State.IDLE;break}break}case p.State.FRAG_LOADING_WAITING_RETRY:{var A,O=self.performance.now(),R=this.retryDate;(!R||O>=R||(A=this.media)!==null&&A!==void 0&&A.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=p.State.IDLE)}break}this.onTickEnd()},v.onTickEnd=function(){c.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var x,E,L=this.hls,b=this.levelLastLoaded,A=this.levels,O=this.media,R=L.config,I=L.nextLoadLevel;if(!(b===null||!O&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!A||!A[I])){var C=A[I];this.level=L.nextLoadLevel=I;var F=C.details;if(!F||this.state===p.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==I){this.state=p.State.WAITING_LEVEL;return}var w=this.getMainFwdBufferInfo();if(w!==null){var k=w.len,B=this.getMaxBufferLength(C.maxBitrate);if(!(k>=B)){if(this._streamEnded(w,F)){var U={};this.altAudio&&(U.type="video"),this.hls.trigger(D.Events.BUFFER_EOS,U),this.state=p.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>w.end&&(this.backtrackFragment=null);var N=this.backtrackFragment?this.backtrackFragment.start:w.end,j=this.getNextFragment(N,F);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==g.FragmentState.OK){var K,V=((K=this.backtrackFragment)!=null?K:j).sn,H=V-F.startSN,Y=F.fragments[H-1];Y&&j.cc===Y.cc&&(j=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&w.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===g.FragmentState.OK&&this.nextLoadPosition>N){var q=this.audioOnly&&!this.altAudio?r.ElementaryStreamTypes.AUDIO:r.ElementaryStreamTypes.VIDEO;O&&this.afterBufferFlushed(O,q,o.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,F)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((x=j.decryptdata)===null||x===void 0?void 0:x.keyFormat)==="identity"&&!((E=j.decryptdata)!==null&&E!==void 0&&E.key)?this.loadKey(j,F):this.loadFragment(j,F,N))}}}},v.loadFragment=function(x,E,L){var b,A=this.fragmentTracker.getState(x);this.fragCurrent=x,A===g.FragmentState.NOT_LOADED?x.sn==="initSegment"?this._loadInitSegment(x):this.bitrateTest?(this.log("Fragment "+x.sn+" of level "+x.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(x)):(this.startFragRequested=!0,c.prototype.loadFragment.call(this,x,E,L)):A===g.FragmentState.APPENDING?this.reduceMaxBufferLength(x.duration)&&this.fragmentTracker.removeFragment(x):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(x){var E=this.fragmentTracker.getAppendedFrag(x,o.PlaylistLevelType.MAIN);return E&&"fragment"in E?E.fragment:E},v.getBufferedFrag=function(x){return this.fragmentTracker.getBufferedFrag(x,o.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(x){return x?this.getBufferedFrag(x.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var x=this.levels,E=this.media;if(E!=null&&E.readyState){var L,b=this.getAppendedFrag(E.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!E.paused&&x){var A=this.hls.nextLoadLevel,O=x[A],R=this.fragLastKbps;R&&this.fragCurrent?L=this.fragCurrent.duration*O.maxBitrate/(1e3*R)+1:L=0}else L=0;var I=this.getBufferedFrag(E.currentTime+L);if(I){var C=this.followingBufferedFrag(I);if(C){this.abortCurrentFrag();var F=C.maxStartPTS?C.maxStartPTS:C.start,w=C.duration,k=Math.max(I.end,F+Math.min(Math.max(w-this.config.maxFragLookUpTolerance,w*.5),w*.75));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var x=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,x!=null&&x.loader&&x.loader.abort(),this.state){case p.State.KEY_LOADING:case p.State.FRAG_LOADING:case p.State.FRAG_LOADING_WAITING_RETRY:case p.State.PARSING:case p.State.PARSED:this.state=p.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(x,E){c.prototype.flushMainBuffer.call(this,x,E,this.altAudio?"video":null)},v.onMediaAttached=function(x,E){c.prototype.onMediaAttached.call(this,x,E);var L=E.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new d.default(this.config,L,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var x=this.media;x&&this.onvplaying&&this.onvseeked&&(x.removeEventListener("playing",this.onvplaying),x.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),c.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var x=this.media,E=x?x.currentTime:null;Object(T.isFiniteNumber)(E)&&this.log("Media seeked to "+E.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},v.onManifestParsed=function(x,E){var L=!1,b=!1,A;E.levels.forEach(function(O){A=O.audioCodec,A&&(A.indexOf("mp4a.40.2")!==-1&&(L=!0),A.indexOf("mp4a.40.5")!==-1&&(b=!0))}),this.audioCodecSwitch=L&&b&&!Object(m.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=E.levels,this.startFragRequested=!1},v.onLevelLoading=function(x,E){var L=this.levels;if(!(!L||this.state!==p.State.IDLE)){var b=L[E.level];(!b.details||b.details.live&&this.levelLastLoaded!==E.level||this.waitForCdnTuneIn(b.details))&&(this.state=p.State.WAITING_LEVEL)}},v.onLevelLoaded=function(x,E){var L,b=this.levels,A=E.level,O=E.details,R=O.totalduration;if(!b){this.warn("Levels were reset while loading level "+A);return}this.log("Level "+A+" loaded ["+O.startSN+","+O.endSN+"], cc ["+O.startCC+", "+O.endCC+"] duration:"+R);var I=this.fragCurrent;I&&(this.state===p.State.FRAG_LOADING||this.state===p.State.FRAG_LOADING_WAITING_RETRY)&&I.level!==E.level&&I.loader&&(this.state=p.State.IDLE,this.backtrackFragment=null,I.loader.abort());var C=b[A],F=0;if(O.live||(L=C.details)!==null&&L!==void 0&&L.live){if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed)return;F=this.alignPlaylists(O,C.details)}if(C.details=O,this.levelLastLoaded=A,this.hls.trigger(D.Events.LEVEL_UPDATED,{details:O,level:A}),this.state===p.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(O))return;this.state=p.State.IDLE}this.startFragRequested?O.live&&this.synchronizeToLiveEdge(O):this.setStartPosition(O,F),this.tick()},v._handleFragmentLoadProgress=function(x){var E,L=x.frag,b=x.part,A=x.payload,O=this.levels;if(!O){this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var R=O[L.level],I=R.details;if(!I){this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset");return}var C=R.videoCodec,F=I.PTSKnown||!I.live,w=(E=L.initSegment)===null||E===void 0?void 0:E.data,k=this._getAudioCodec(R),B=this.transmuxer=this.transmuxer||new l.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=b?b.index:-1,N=U!==-1,j=new n.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,A.byteLength,U,N),K=this.initPTS[L.cc];B.push(A,w,k,C,L,b,I.totalduration,F,j,K)},v.onAudioTrackSwitching=function(x,E){var L=this.altAudio,b=!!E.url,A=E.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var O=this.fragCurrent;O!=null&&O.loader&&(this.log("Switching to main audio track, cancel main fragment load"),O.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;L&&R.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:A})}},v.onAudioTrackSwitched=function(x,E){var L=E.id,b=!!this.hls.audioTracks[L].url;if(b){var A=this.videoBuffer;A&&this.mediaBuffer!==A&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=A)}this.altAudio=b,this.tick()},v.onBufferCreated=function(x,E){var L=E.tracks,b,A,O=!1;for(var R in L){var I=L[R];if(I.id==="main"){if(A=R,b=I,R==="video"){var C=L[R];C&&(this.videoBuffer=C.buffer)}}else O=!0}O&&b?(this.log("Alternate track found, use "+A+".buffered to schedule main fragment loading"),this.mediaBuffer=b.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(x,E){var L=E.frag,b=E.part;if(!(L&&L.type!==o.PlaylistLevelType.MAIN)){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(b?" p: "+b.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===p.State.PARSED&&(this.state=p.State.IDLE);return}var A=b?b.stats:L.stats;this.fragLastKbps=Math.round(8*A.total/(A.buffering.end-A.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,b)}},v.onError=function(x,E){switch(E.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,E);break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==p.State.ERROR&&(E.fatal?(this.warn(""+E.details),this.state=p.State.ERROR):!E.levelRetry&&this.state===p.State.WAITING_LEVEL&&(this.state=p.State.IDLE));break;case u.ErrorDetails.BUFFER_FULL_ERROR:if(E.parent==="main"&&(this.state===p.State.PARSING||this.state===p.State.PARSED)){var L=!0,b=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);b&&b.len>.5&&(L=!this.reduceMaxBufferLength(b.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},v.checkBuffer=function(){var x=this.media,E=this.gapController;if(!(!x||!E||!x.readyState)){if(this.loadedmetadata||!_.BufferHelper.getBuffered(x).length){var L=this.state!==p.State.IDLE?this.fragCurrent:null;E.poll(this.lastCurrentTime,L)}this.lastCurrentTime=x.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=p.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(x,E){var L=E.type;if(L!==r.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(L===r.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,L,o.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(x,E){this.levels=E.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var x=this.media;if(!!x){var E=x.currentTime,L=this.startPosition;if(L>=0&&E<L){if(x.seeking){this.log("could not seek to "+L+", already seeking at "+E);return}var b=_.BufferHelper.getBuffered(x),A=b.length?b.start(0):0,O=A-L;O>0&&(O<this.config.maxBufferHole||O<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+O+" to match buffer start"),L+=O,this.startPosition=L),this.log("seek to target start position "+L+" from current time "+E),x.currentTime=L}}},v._getAudioCodec=function(x){var E=this.config.defaultAudioCodec||x.audioCodec;return this.audioCodecSwap&&E&&(this.log("Swapping audio codec"),E.indexOf("mp4a.40.5")!==-1?E="mp4a.40.2":E="mp4a.40.5"),E},v._loadBitrateTestFrag=function(x){var E=this;x.bitrateTest=!0,this._doFragLoad(x).then(function(L){var b=E.hls;if(!(!L||b.nextLoadLevel||E.fragContextChanged(x))){E.fragLoadError=0,E.state=p.State.IDLE,E.startFragRequested=!1,E.bitrateTest=!1;var A=x.stats;A.parsing.start=A.parsing.end=A.buffering.start=A.buffering.end=self.performance.now(),b.trigger(D.Events.FRAG_LOADED,L),x.bitrateTest=!1}})},v._handleTransmuxComplete=function(x){var E,L="main",b=this.hls,A=x.remuxResult,O=x.chunkMeta,R=this.getCurrentContext(O);if(!R){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(O.level);return}var I=R.frag,C=R.part,F=R.level,w=A.video,k=A.text,B=A.id3,U=A.initSegment,N=F.details,j=this.altAudio?void 0:A.audio;if(!this.fragContextChanged(I)){if(this.state=p.State.PARSING,U){U.tracks&&(this._bufferInitSegment(F,U.tracks,I,O),b.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:L,tracks:U.tracks}));var K=U.initPTS,V=U.timescale;Object(T.isFiniteNumber)(K)&&(this.initPTS[I.cc]=K,b.trigger(D.Events.INIT_PTS_FOUND,{frag:I,id:L,initPTS:K,timescale:V}))}if(w&&A.independent!==!1){if(N){var H=w.startPTS,Y=w.endPTS,q=w.startDTS,$=w.endDTS;if(C)C.elementaryStreams[w.type]={startPTS:H,endPTS:Y,startDTS:q,endDTS:$};else if(w.firstKeyFrame&&w.independent&&(this.couldBacktrack=!0),w.dropped&&w.independent){var G=this.getMainFwdBufferInfo(),re=(G?G.end:this.getLoadPosition())+this.config.maxBufferHole,Q=w.firstKeyFramePTS?w.firstKeyFramePTS:H;if(re<Q-this.config.maxBufferHole){this.backtrack(I);return}I.setElementaryStreamInfo(w.type,I.start,Y,I.start,$,!0)}I.setElementaryStreamInfo(w.type,H,Y,q,$),this.backtrackFragment&&(this.backtrackFragment=I),this.bufferFragmentData(w,I,C,O)}}else if(A.independent===!1){this.backtrack(I);return}if(j){var ee=j.startPTS,se=j.endPTS,ae=j.startDTS,oe=j.endDTS;C&&(C.elementaryStreams[r.ElementaryStreamTypes.AUDIO]={startPTS:ee,endPTS:se,startDTS:ae,endDTS:oe}),I.setElementaryStreamInfo(r.ElementaryStreamTypes.AUDIO,ee,se,ae,oe),this.bufferFragmentData(j,I,C,O)}if(N&&B!==null&&B!==void 0&&(E=B.samples)!==null&&E!==void 0&&E.length){var fe={id:L,frag:I,details:N,samples:B.samples};b.trigger(D.Events.FRAG_PARSING_METADATA,fe)}if(N&&k){var te={id:L,frag:I,details:N,samples:k.samples};b.trigger(D.Events.FRAG_PARSING_USERDATA,te)}}},v._bufferInitSegment=function(x,E,L,b){var A=this;if(this.state===p.State.PARSING){this.audioOnly=!!E.audio&&!E.video,this.altAudio&&!this.audioOnly&&delete E.audio;var O=E.audio,R=E.video,I=E.audiovideo;if(O){var C=x.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(C&&(C.indexOf("mp4a.40.5")!==-1?C="mp4a.40.2":C="mp4a.40.5"),O.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(C="mp4a.40.5")),F.indexOf("android")!==-1&&O.container!=="audio/mpeg"&&(C="mp4a.40.2",this.log("Android: force audio codec to "+C)),x.audioCodec&&x.audioCodec!==C&&this.log('Swapping manifest audio codec "'+x.audioCodec+'" for "'+C+'"'),O.levelCodec=C,O.id="main",this.log("Init audio buffer, container:"+O.container+", codecs[selected/level/parsed]=["+(C||"")+"/"+(x.audioCodec||"")+"/"+O.codec+"]")}R&&(R.levelCodec=x.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(x.videoCodec||"")+"/"+R.codec+"]")),I&&this.log("Init audiovideo buffer, container:"+I.container+", codecs[level/parsed]=["+(x.attrs.CODECS||"")+"/"+I.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,E),Object.keys(E).forEach(function(w){var k=E[w],B=k.initSegment;B!=null&&B.byteLength&&A.hls.trigger(D.Events.BUFFER_APPENDING,{type:w,data:B,frag:L,part:null,chunkMeta:b,parent:L.type})}),this.tick()}},v.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.MAIN)},v.backtrack=function(x){this.couldBacktrack=!0,this.backtrackFragment=x,this.resetTransmuxer(),this.flushBufferGap(x),this.fragmentTracker.removeFragment(x),this.fragPrevious=null,this.nextLoadPosition=x.start,this.state=p.State.IDLE},v.checkFragmentChanged=function(){var x=this.media,E=null;if(x&&x.readyState>1&&x.seeking===!1){var L=x.currentTime;if(_.BufferHelper.isBuffered(x,L)?E=this.getAppendedFrag(L):_.BufferHelper.isBuffered(x,L+.1)&&(E=this.getAppendedFrag(L+.1)),E){this.backtrackFragment=null;var b=this.fragPlaying,A=E.level;(!b||E.sn!==b.sn||b.level!==A||E.urlId!==b.urlId)&&(this.hls.trigger(D.Events.FRAG_CHANGED,{frag:E}),(!b||b.level!==A)&&this.hls.trigger(D.Events.LEVEL_SWITCHED,{level:A}),this.fragPlaying=E)}}},t(a,[{key:"nextLevel",get:function(){var x=this.nextBufferedFrag;return x?x.level:-1}},{key:"currentFrag",get:function(){var x=this.media;return x?this.fragPlaying||this.getAppendedFrag(x.currentTime):null}},{key:"currentProgramDateTime",get:function(){var x=this.media;if(x){var E=x.currentTime,L=this.currentFrag;if(L&&Object(T.isFiniteNumber)(E)&&Object(T.isFiniteNumber)(L.programDateTime)){var b=L.programDateTime+(E-L.start)*1e3;return new Date(b)}}return null}},{key:"currentLevel",get:function(){var x=this.currentFrag;return x?x.level:-1}},{key:"nextBufferedFrag",get:function(){var x=this.currentFrag;return x?this.followingBufferedFrag(x):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(p.default)},"./src/controller/subtitle-stream-controller.ts":function(M,P,y){y.r(P),y.d(P,"SubtitleStreamController",function(){return e});var T=y("./src/events.ts"),p=y("./src/utils/buffer-helper.ts"),m=y("./src/controller/fragment-finders.ts"),D=y("./src/utils/discontinuities.ts"),_=y("./src/controller/level-helper.ts"),g=y("./src/controller/fragment-tracker.ts"),o=y("./src/controller/base-stream-controller.ts"),r=y("./src/types/loader.ts"),l=y("./src/types/level.ts");function n(i,f){for(var c=0;c<f.length;c++){var a=f[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function d(i,f,c){return f&&n(i.prototype,f),c&&n(i,c),Object.defineProperty(i,"prototype",{writable:!1}),i}function u(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,h(i,f)}function h(i,f){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,v){return a.__proto__=v,a},h(i,f)}var t=500,e=function(i){u(f,i);function f(a,v){var S;return S=i.call(this,a,v,"[subtitle-stream-controller]")||this,S.levels=[],S.currentTrackId=-1,S.tracksBuffered=[],S.mainDetails=null,S._registerListeners(),S}var c=f.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var v=this.hls;v.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(T.Events.ERROR,this.onError,this),v.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(T.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(T.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(T.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c._unregisterListeners=function(){var v=this.hls;v.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(T.Events.ERROR,this.onError,this),v.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(T.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(T.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(T.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c.startLoad=function(){this.stopLoad(),this.state=o.State.IDLE,this.setInterval(t),this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(v,S){this.mainDetails=S.details},c.onSubtitleFragProcessed=function(v,S){var x=S.frag,E=S.success;if(this.fragPrevious=x,this.state=o.State.IDLE,!!E){var L=this.tracksBuffered[this.currentTrackId];if(!!L){for(var b,A=x.start,O=0;O<L.length;O++)if(A>=L[O].start&&A<=L[O].end){b=L[O];break}var R=x.start+x.duration;b?b.end=R:(b={start:A,end:R},L.push(b)),this.fragmentTracker.fragBuffered(x)}}},c.onBufferFlushing=function(v,S){var x=S.startOffset,E=S.endOffset;if(x===0&&E!==Number.POSITIVE_INFINITY){var L=this.currentTrackId,b=this.levels;if(!b.length||!b[L]||!b[L].details)return;var A=b[L].details,O=A.targetduration,R=E-O;if(R<=0)return;S.endOffsetSubtitles=Math.max(0,R),this.tracksBuffered.forEach(function(I){for(var C=0;C<I.length;){if(I[C].end<=R){I.shift();continue}else if(I[C].start<R)I[C].start=R;else break;C++}}),this.fragmentTracker.removeFragmentsInRange(x,R,r.PlaylistLevelType.SUBTITLE)}},c.onError=function(v,S){var x,E=S.frag;!E||E.type!==r.PlaylistLevelType.SUBTITLE||((x=this.fragCurrent)!==null&&x!==void 0&&x.loader&&this.fragCurrent.loader.abort(),this.state=o.State.IDLE)},c.onSubtitleTracksUpdated=function(v,S){var x=this,E=S.subtitleTracks;this.tracksBuffered=[],this.levels=E.map(function(L){return new l.Level(L)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(L){x.tracksBuffered[L.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(v,S){if(this.currentTrackId=S.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var x=this.levels[this.currentTrackId];x!=null&&x.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,x&&this.setInterval(t)},c.onSubtitleTrackLoaded=function(v,S){var x,E=S.details,L=S.id,b=this.currentTrackId,A=this.levels;if(!!A.length){var O=A[b];if(!(L>=A.length||L!==b||!O)){if(this.mediaBuffer=this.mediaBufferTimeRanges,E.live||(x=O.details)!==null&&x!==void 0&&x.live){var R=this.mainDetails;if(E.deltaUpdateFailed||!R)return;var I=R.fragments[0];if(!O.details)E.hasProgramDateTime&&R.hasProgramDateTime?Object(D.alignMediaPlaylistByPDT)(E,R):I&&Object(_.addSliding)(E,I.start);else{var C=this.alignPlaylists(E,O.details);C===0&&I&&Object(_.addSliding)(E,I.start)}}if(O.details=E,this.levelLastLoaded=L,this.tick(),E.live&&!this.fragCurrent&&this.media&&this.state===o.State.IDLE){var F=Object(m.findFragmentByPTS)(null,E.fragments,this.media.currentTime,0);F||(this.warn("Subtitle playlist not aligned with playback"),O.details=void 0)}}}},c._handleFragmentLoadComplete=function(v){var S=v.frag,x=v.payload,E=S.decryptdata,L=this.hls;if(!this.fragContextChanged(S)&&x&&x.byteLength>0&&E&&E.key&&E.iv&&E.method==="AES-128"){var b=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(x),E.key.buffer,E.iv.buffer).then(function(A){var O=performance.now();L.trigger(T.Events.FRAG_DECRYPTED,{frag:S,payload:A,stats:{tstart:b,tdecrypt:O}})})}},c.doTick=function(){if(!this.media){this.state=o.State.IDLE;return}if(this.state===o.State.IDLE){var v=this.currentTrackId,S=this.levels;if(!S.length||!S[v]||!S[v].details)return;var x=S[v].details,E=x.targetduration,L=this.config,b=this.media,A=p.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],b.currentTime-E,L.maxBufferHole),O=A.end,R=A.len,I=this.getMaxBufferLength()+E;if(R>I)return;console.assert(x,"Subtitle track details are defined on idle subtitle stream controller tick");var C=x.fragments,F=C.length,w=x.edge,k,B=this.fragPrevious;if(O<w){var U=L.maxFragLookUpTolerance;k=Object(m.findFragmentByPTS)(B,C,Math.max(C[0].start,O),U),!k&&B&&B.start<C[0].start&&(k=C[0])}else k=C[F-1];if(k=this.mapToInitFragWhenRequired(k),!k||this.fragmentTracker.getState(k)!==g.FragmentState.NOT_LOADED)return;k.encrypted?this.loadKey(k,x):this.loadFragment(k,x,O)}},c.loadFragment=function(v,S,x){this.fragCurrent=v,v.sn==="initSegment"?this._loadInitSegment(v):i.prototype.loadFragment.call(this,v,S,x)},d(f,[{key:"mediaBufferTimeRanges",get:function(){return new s(this.tracksBuffered[this.currentTrackId]||[])}}]),f}(o.default),s=function(f){this.buffered=void 0;var c=function(v,S,x){if(S=S>>>0,S>x-1)throw new DOMException("Failed to execute '"+v+"' on 'TimeRanges': The index provided ("+S+") is greater than the maximum bound ("+x+")");return f[S][v]};this.buffered={get length(){return f.length},end:function(v){return c("end",v,f.length)},start:function(v){return c("start",v,f.length)}}}},"./src/controller/subtitle-track-controller.ts":function(M,P,y){y.r(P);var T=y("./src/events.ts"),p=y("./src/utils/texttrack-utils.ts"),m=y("./src/controller/base-playlist-controller.ts"),D=y("./src/types/loader.ts");function _(d,u){for(var h=0;h<u.length;h++){var t=u[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function g(d,u,h){return u&&_(d.prototype,u),h&&_(d,h),Object.defineProperty(d,"prototype",{writable:!1}),d}function o(d,u){d.prototype=Object.create(u.prototype),d.prototype.constructor=d,r(d,u)}function r(d,u){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(d,u)}var l=function(d){o(u,d);function u(t){var e;return e=d.call(this,t,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var h=u.prototype;return h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},h.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.Events.ERROR,this.onError,this)},h.onMediaAttached=function(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},h.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},h.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=n(this.media.textTracks);e.forEach(function(s){Object(p.clearCurrentCues)(s)}),this.subtitleTrack=-1,this.media=null}},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},h.onManifestParsed=function(e,s){this.tracks=s.subtitleTracks},h.onSubtitleTrackLoaded=function(e,s){var i=s.id,f=s.details,c=this.trackId,a=this.tracksInGroup[c];if(!a){this.warn("Invalid subtitle track id "+i);return}var v=a.details;a.details=s.details,this.log("subtitle track "+i+" loaded ["+f.startSN+"-"+f.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,s,v))},h.onLevelLoading=function(e,s){this.switchLevel(s.level)},h.onLevelSwitching=function(e,s){this.switchLevel(s.level)},h.switchLevel=function(e){var s=this.hls.levels[e];if(!!(s!=null&&s.textGroupIds)){var i=s.textGroupIds[s.urlId];if(this.groupId!==i){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,c=this.tracks.filter(function(S){return!i||S.groupId===i});this.tracksInGroup=c;var a=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=i;var v={subtitleTracks:c};this.log("Updating subtitle tracks, "+c.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(T.Events.SUBTITLE_TRACKS_UPDATED,v),a!==-1&&this.setSubtitleTrack(a,f)}}},h.findTrackId=function(e){for(var s=this.tracksInGroup,i=0;i<s.length;i++){var f=s[i];if((!this.selectDefaultTrack||f.default)&&(!e||e===f.name))return f.id}return-1},h.onError=function(e,s){d.prototype.onError.call(this,e,s),!(s.fatal||!s.context)&&s.context.type===D.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},h.loadPlaylist=function(e){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var i=s.id,f=s.groupId,c=s.url;if(e)try{c=e.addDirectives(c)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADING,{url:c,id:i,groupId:f,deliveryDirectives:e||null})}},h.toggleTrackModes=function(e){var s=this,i=this.media,f=this.trackId;if(!!i){var c=n(i.textTracks),a=c.filter(function(x){return x.groupId===s.groupId});if(e===-1)[].slice.call(c).forEach(function(x){x.mode="disabled"});else{var v=a[f];v&&(v.mode="disabled")}var S=a[e];S&&(S.mode=this.subtitleDisplay?"showing":"hidden")}},h.setSubtitleTrack=function(e,s){var i,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(i=f[e])!==null&&i!==void 0&&i.details)||e<-1||e>=f.length)){this.clearTimer();var c=f[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,c){var a=c.id,v=c.groupId,S=v===void 0?"":v,x=c.name,E=c.type,L=c.url;this.hls.trigger(T.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:S,name:x,type:E,url:L});var b=this.switchParams(c.url,s==null?void 0:s.details);this.loadPlaylist(b)}else this.hls.trigger(T.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},h.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,s=n(this.media.textTracks),i=0;i<s.length;i++)if(s[i].mode==="hidden")e=i;else if(s[i].mode==="showing"){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},g(u,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,s)}}]),u}(m.default);function n(d){for(var u=[],h=0;h<d.length;h++){var t=d[h];t.kind==="subtitles"&&t.label&&u.push(d[h])}return u}P.default=l},"./src/controller/timeline-controller.ts":function(M,P,y){y.r(P),y.d(P,"TimelineController",function(){return d});var T=y("./src/polyfills/number.ts"),p=y("./src/events.ts"),m=y("./src/utils/cea-608-parser.ts"),D=y("./src/utils/output-filter.ts"),_=y("./src/utils/webvtt-parser.ts"),g=y("./src/utils/texttrack-utils.ts"),o=y("./src/utils/imsc1-ttml-parser.ts"),r=y("./src/utils/mp4-tools.ts"),l=y("./src/types/loader.ts"),n=y("./src/utils/logger.ts"),d=function(){function e(i){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var f=new D.default(this,"textTrack1"),c=new D.default(this,"textTrack2"),a=new D.default(this,"textTrack3"),v=new D.default(this,"textTrack4");this.cea608Parser1=new m.default(1,f,c),this.cea608Parser2=new m.default(3,a,v)}i.on(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(p.Events.FRAG_LOADING,this.onFragLoading,this),i.on(p.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(p.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(p.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(p.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=e.prototype;return s.destroy=function(){var f=this.hls;f.off(p.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(p.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.off(p.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.off(p.Events.FRAG_LOADING,this.onFragLoading,this),f.off(p.Events.FRAG_LOADED,this.onFragLoaded,this),f.off(p.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),f.off(p.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),f.off(p.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.off(p.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),f.off(p.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},s.addCues=function(f,c,a,v,S){for(var x=!1,E=S.length;E--;){var L=S[E],b=h(L[0],L[1],c,a);if(b>=0&&(L[0]=Math.min(L[0],c),L[1]=Math.max(L[1],a),x=!0,b/(a-c)>.5))return}if(x||S.push([c,a]),this.config.renderTextTracksNatively){var A=this.captionsTracks[f];this.Cues.newCue(A,c,a,v)}else{var O=this.Cues.newCue(null,c,a,v);this.hls.trigger(p.Events.CUES_PARSED,{type:"captions",cues:O,track:f})}},s.onInitPtsFound=function(f,c){var a=this,v=c.frag,S=c.id,x=c.initPTS,E=c.timescale,L=this.unparsedVttFrags;S==="main"&&(this.initPTS[v.cc]=x,this.timescale[v.cc]=E),L.length&&(this.unparsedVttFrags=[],L.forEach(function(b){a.onFragLoaded(p.Events.FRAG_LOADED,b)}))},s.getExistingTrack=function(f){var c=this.media;if(c)for(var a=0;a<c.textTracks.length;a++){var v=c.textTracks[a];if(v[f])return v}return null},s.createCaptionsTrack=function(f){this.config.renderTextTracksNatively?this.createNativeTrack(f):this.createNonNativeTrack(f)},s.createNativeTrack=function(f){if(!this.captionsTracks[f]){var c=this.captionsProperties,a=this.captionsTracks,v=this.media,S=c[f],x=S.label,E=S.languageCode,L=this.getExistingTrack(f);if(L)a[f]=L,Object(g.clearCurrentCues)(a[f]),Object(g.sendAddTrackEvent)(a[f],v);else{var b=this.createTextTrack("captions",x,E);b&&(b[f]=!0,a[f]=b)}}},s.createNonNativeTrack=function(f){if(!this.nonNativeCaptionsTracks[f]){var c=this.captionsProperties[f];if(!!c){var a=c.label,v={_id:f,label:a,kind:"captions",default:c.media?!!c.media.default:!1,closedCaptions:c.media};this.nonNativeCaptionsTracks[f]=v,this.hls.trigger(p.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[v]})}}},s.createTextTrack=function(f,c,a){var v=this.media;if(!!v)return v.addTextTrack(f,c,a)},s.onMediaAttaching=function(f,c){this.media=c.media,this._cleanTracks()},s.onMediaDetaching=function(){var f=this.captionsTracks;Object.keys(f).forEach(function(c){Object(g.clearCurrentCues)(f[c]),delete f[c]}),this.nonNativeCaptionsTracks={}},s.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var f=this.media;if(!!f){var c=f.textTracks;if(c)for(var a=0;a<c.length;a++)Object(g.clearCurrentCues)(c[a])}},s.onSubtitleTracksUpdated=function(f,c){var a=this;this.textTracks=[];var v=c.subtitleTracks||[],S=v.some(function(b){return b.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||S&&this.config.enableIMSC1){var x=this.tracks&&v&&this.tracks.length===v.length;if(this.tracks=v||[],this.config.renderTextTracksNatively){var E=this.media?this.media.textTracks:[];this.tracks.forEach(function(b,A){var O;if(A<E.length){for(var R=null,I=0;I<E.length;I++)if(u(E[I],b)){R=E[I];break}R&&(O=R)}if(O)Object(g.clearCurrentCues)(O);else{var C=a._captionsOrSubtitlesFromCharacteristics(b);O=a.createTextTrack(C,b.name,b.lang),O&&(O.mode="disabled")}O&&(O.groupId=b.groupId,a.textTracks.push(O))})}else if(!x&&this.tracks&&this.tracks.length){var L=this.tracks.map(function(b){return{label:b.name,kind:b.type.toLowerCase(),default:b.default,subtitleTrack:b}});this.hls.trigger(p.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:L})}}},s._captionsOrSubtitlesFromCharacteristics=function(f){var c;if((c=f.attrs)!==null&&c!==void 0&&c.CHARACTERISTICS){var a=/transcribes-spoken-dialog/gi.test(f.attrs.CHARACTERISTICS),v=/describes-music-and-sound/gi.test(f.attrs.CHARACTERISTICS);if(a&&v)return"captions"}return"subtitles"},s.onManifestLoaded=function(f,c){var a=this;this.config.enableCEA708Captions&&c.captions&&c.captions.forEach(function(v){var S=/(?:CC|SERVICE)([1-4])/.exec(v.instreamId);if(!!S){var x="textTrack"+S[1],E=a.captionsProperties[x];!E||(E.label=v.name,v.lang&&(E.languageCode=v.lang),E.media=v)}})},s.onFragLoading=function(f,c){var a=this.cea608Parser1,v=this.cea608Parser2,S=this.lastSn,x=this.lastPartIndex;if(!(!this.enabled||!(a&&v))&&c.frag.type===l.PlaylistLevelType.MAIN){var E,L,b=c.frag.sn,A=(E=c==null||(L=c.part)===null||L===void 0?void 0:L.index)!=null?E:-1;b===S+1||b===S&&A===x+1||(a.reset(),v.reset()),this.lastSn=b,this.lastPartIndex=A}},s.onFragLoaded=function(f,c){var a=c.frag,v=c.payload,S=this.initPTS,x=this.unparsedVttFrags;if(a.type===l.PlaylistLevelType.SUBTITLE)if(v.byteLength){if(!Object(T.isFiniteNumber)(S[a.cc])){x.push(c),S.length&&this.hls.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var E=a.decryptdata,L="stats"in c;if(E==null||E.key==null||E.method!=="AES-128"||L){var b=this.tracks[a.level],A=this.vttCCs;A[a.cc]||(A[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),b&&b.textCodec===o.IMSC1_CODEC?this._parseIMSC1(a,v):this._parseVTTs(a,v,A)}}else this.hls.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(f,c){var a=this,v=this.hls;Object(o.parseIMSC1)(c,this.initPTS[f.cc],this.timescale[f.cc],function(S){a._appendCues(S,f.level),v.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:f})},function(S){n.logger.log("Failed to parse IMSC1: "+S),v.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f,error:S})})},s._parseVTTs=function(f,c,a){var v,S=this,x=this.hls,E=(v=f.initSegment)!==null&&v!==void 0&&v.data?Object(r.appendUint8Array)(f.initSegment.data,new Uint8Array(c)):c;Object(_.parseWebVTT)(E,this.initPTS[f.cc],this.timescale[f.cc],a,f.cc,f.start,function(L){S._appendCues(L,f.level),x.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:f})},function(L){S._fallbackToIMSC1(f,c),n.logger.log("Failed to parse VTT cue: "+L),x.trigger(p.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f,error:L})})},s._fallbackToIMSC1=function(f,c){var a=this,v=this.tracks[f.level];v.textCodec||Object(o.parseIMSC1)(c,this.initPTS[f.cc],this.timescale[f.cc],function(){v.textCodec=o.IMSC1_CODEC,a._parseIMSC1(f,c)},function(){v.textCodec="wvtt"})},s._appendCues=function(f,c){var a=this.hls;if(this.config.renderTextTracksNatively){var v=this.textTracks[c];if(!v||v.mode==="disabled")return;f.forEach(function(E){return Object(g.addCueToTrack)(v,E)})}else{var S=this.tracks[c];if(!S)return;var x=S.default?"default":"subtitles"+c;a.trigger(p.Events.CUES_PARSED,{type:"subtitles",cues:f,track:x})}},s.onFragDecrypted=function(f,c){var a=c.frag;if(a.type===l.PlaylistLevelType.SUBTITLE){if(!Object(T.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(c);return}this.onFragLoaded(p.Events.FRAG_LOADED,c)}},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(f,c){var a=this.cea608Parser1,v=this.cea608Parser2;if(!(!this.enabled||!(a&&v)))for(var S=0;S<c.samples.length;S++){var x=c.samples[S].bytes;if(x){var E=this.extractCea608Data(x);a.addData(c.samples[S].pts,E[0]),v.addData(c.samples[S].pts,E[1])}}},s.onBufferFlushing=function(f,c){var a=c.startOffset,v=c.endOffset,S=c.endOffsetSubtitles,x=c.type,E=this.media;if(!(!E||E.currentTime<v)){if(!x||x==="video"){var L=this.captionsTracks;Object.keys(L).forEach(function(A){return Object(g.removeCuesInRange)(L[A],a,v)})}if(this.config.renderTextTracksNatively&&a===0&&S!==void 0){var b=this.textTracks;Object.keys(b).forEach(function(A){return Object(g.removeCuesInRange)(b[A],a,S)})}}},s.extractCea608Data=function(f){for(var c=[[],[]],a=f[0]&31,v=2,S=0;S<a;S++){var x=f[v++],E=127&f[v++],L=127&f[v++];if(!(E===0&&L===0)){var b=(4&x)!==0;if(b){var A=3&x;(A===0||A===1)&&(c[A].push(E),c[A].push(L))}}}return c},e}();function u(e,s){return e&&e.label===s.name&&!(e.textTrack1||e.textTrack2)}function h(e,s,i,f){return Math.min(s,f)-Math.max(e,i)}function t(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return T});var T=function(){function p(D,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=D,this.aesIV=_}var m=p.prototype;return m.decrypt=function(_,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,_)},p}()},"./src/crypt/aes-decryptor.ts":function(M,P,y){y.r(P),y.d(P,"removePadding",function(){return p}),y.d(P,"default",function(){return m});var T=y("./src/utils/typed-array.ts");function p(D){var _=D.byteLength,g=_&&new DataView(D.buffer).getUint8(_-1);return g?Object(T.sliceUint8)(D,0,_-g):D}var m=function(){function D(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=D.prototype;return _.uint8ArrayToUint32Array_=function(o){for(var r=new DataView(o),l=new Uint32Array(4),n=0;n<4;n++)l[n]=r.getUint32(n*4);return l},_.initTable=function(){var o=this.sBox,r=this.invSBox,l=this.subMix,n=l[0],d=l[1],u=l[2],h=l[3],t=this.invSubMix,e=t[0],s=t[1],i=t[2],f=t[3],c=new Uint32Array(256),a=0,v=0,S=0;for(S=0;S<256;S++)S<128?c[S]=S<<1:c[S]=S<<1^283;for(S=0;S<256;S++){var x=v^v<<1^v<<2^v<<3^v<<4;x=x>>>8^x&255^99,o[a]=x,r[x]=a;var E=c[a],L=c[E],b=c[L],A=c[x]*257^x*16843008;n[a]=A<<24|A>>>8,d[a]=A<<16|A>>>16,u[a]=A<<8|A>>>24,h[a]=A,A=b*16843009^L*65537^E*257^a*16843008,e[x]=A<<24|A>>>8,s[x]=A<<16|A>>>16,i[x]=A<<8|A>>>24,f[x]=A,a?(a=E^c[c[c[b^E]]],v^=c[c[v]]):a=v=1}},_.expandKey=function(o){for(var r=this.uint8ArrayToUint32Array_(o),l=!0,n=0;n<r.length&&l;)l=r[n]===this.key[n],n++;if(!l){this.key=r;var d=this.keySize=r.length;if(d!==4&&d!==6&&d!==8)throw new Error("Invalid aes key size="+d);var u=this.ksRows=(d+6+1)*4,h,t,e=this.keySchedule=new Uint32Array(u),s=this.invKeySchedule=new Uint32Array(u),i=this.sBox,f=this.rcon,c=this.invSubMix,a=c[0],v=c[1],S=c[2],x=c[3],E,L;for(h=0;h<u;h++){if(h<d){E=e[h]=r[h];continue}L=E,h%d===0?(L=L<<8|L>>>24,L=i[L>>>24]<<24|i[L>>>16&255]<<16|i[L>>>8&255]<<8|i[L&255],L^=f[h/d|0]<<24):d>6&&h%d===4&&(L=i[L>>>24]<<24|i[L>>>16&255]<<16|i[L>>>8&255]<<8|i[L&255]),e[h]=E=(e[h-d]^L)>>>0}for(t=0;t<u;t++)h=u-t,t&3?L=e[h]:L=e[h-4],t<4||h<=4?s[t]=L:s[t]=a[i[L>>>24]]^v[i[L>>>16&255]]^S[i[L>>>8&255]]^x[i[L&255]],s[t]=s[t]>>>0}},_.networkToHostOrderSwap=function(o){return o<<24|(o&65280)<<8|(o&16711680)>>8|o>>>24},_.decrypt=function(o,r,l){for(var n=this.keySize+6,d=this.invKeySchedule,u=this.invSBox,h=this.invSubMix,t=h[0],e=h[1],s=h[2],i=h[3],f=this.uint8ArrayToUint32Array_(l),c=f[0],a=f[1],v=f[2],S=f[3],x=new Int32Array(o),E=new Int32Array(x.length),L,b,A,O,R,I,C,F,w,k,B,U,N,j,K=this.networkToHostOrderSwap;r<x.length;){for(w=K(x[r]),k=K(x[r+1]),B=K(x[r+2]),U=K(x[r+3]),R=w^d[0],I=U^d[1],C=B^d[2],F=k^d[3],N=4,j=1;j<n;j++)L=t[R>>>24]^e[I>>16&255]^s[C>>8&255]^i[F&255]^d[N],b=t[I>>>24]^e[C>>16&255]^s[F>>8&255]^i[R&255]^d[N+1],A=t[C>>>24]^e[F>>16&255]^s[R>>8&255]^i[I&255]^d[N+2],O=t[F>>>24]^e[R>>16&255]^s[I>>8&255]^i[C&255]^d[N+3],R=L,I=b,C=A,F=O,N=N+4;L=u[R>>>24]<<24^u[I>>16&255]<<16^u[C>>8&255]<<8^u[F&255]^d[N],b=u[I>>>24]<<24^u[C>>16&255]<<16^u[F>>8&255]<<8^u[R&255]^d[N+1],A=u[C>>>24]<<24^u[F>>16&255]<<16^u[R>>8&255]<<8^u[I&255]^d[N+2],O=u[F>>>24]<<24^u[R>>16&255]<<16^u[I>>8&255]<<8^u[C&255]^d[N+3],E[r]=K(L^c),E[r+1]=K(O^a),E[r+2]=K(A^v),E[r+3]=K(b^S),c=w,a=k,v=B,S=U,r=r+4}return E.buffer},D}()},"./src/crypt/decrypter.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return r});var T=y("./src/crypt/aes-crypto.ts"),p=y("./src/crypt/fast-aes-key.ts"),m=y("./src/crypt/aes-decryptor.ts"),D=y("./src/utils/logger.ts"),_=y("./src/utils/mp4-tools.ts"),g=y("./src/utils/typed-array.ts"),o=16,r=function(){function l(d,u,h){var t=h===void 0?{}:h,e=t.removePKCS7Padding,s=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=d,this.config=u,this.removePKCS7Padding=s,s)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var n=l.prototype;return n.destroy=function(){this.observer=null},n.isSync=function(){return this.config.enableSoftwareAES},n.flush=function(){var u=this.currentResult;if(!u){this.reset();return}var h=new Uint8Array(u);return this.reset(),this.removePKCS7Padding?Object(m.removePadding)(h):h},n.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},n.decrypt=function(u,h,t,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(u),h,t);var s=this.flush();s&&e(s.buffer)}else this.webCryptoDecrypt(new Uint8Array(u),h,t).then(e)},n.softwareDecrypt=function(u,h,t){var e=this.currentIV,s=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(u=Object(_.appendUint8Array)(i,u),this.remainderData=null);var f=this.getValidChunk(u);if(!f.length)return null;e&&(t=e);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new m.default),c.expandKey(h);var a=s;return this.currentResult=c.decrypt(f.buffer,0,t),this.currentIV=Object(g.sliceUint8)(f,-16).buffer,a||null},n.webCryptoDecrypt=function(u,h,t){var e=this,s=this.subtle;return(this.key!==h||!this.fastAesKey)&&(this.key=h,this.fastAesKey=new p.default(s,h)),this.fastAesKey.expandKey().then(function(i){if(!s)return Promise.reject(new Error("web crypto not initialized"));var f=new T.default(s,t);return f.decrypt(u.buffer,i)}).catch(function(i){return e.onWebCryptoError(i,u,h,t)})},n.onWebCryptoError=function(u,h,t,e){return D.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",u),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(h,t,e)},n.getValidChunk=function(u){var h=u,t=u.length-u.length%o;return t!==u.length&&(h=Object(g.sliceUint8)(u,0,t),this.remainderData=Object(g.sliceUint8)(u,t)),h},n.logOnce=function(u){!this.logEnabled||(D.logger.log("[decrypter.ts]: "+u),this.logEnabled=!1)},l}()},"./src/crypt/fast-aes-key.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return T});var T=function(){function p(D,_){this.subtle=void 0,this.key=void 0,this.subtle=D,this.key=_}var m=p.prototype;return m.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},p}()},"./src/demux/aacdemuxer.ts":function(M,P,y){y.r(P);var T=y("./src/demux/base-audio-demuxer.ts"),p=y("./src/demux/adts.ts"),m=y("./src/utils/logger.ts"),D=y("./src/demux/id3.ts");function _(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,g(r,l)}function g(r,l){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,u){return d.__proto__=u,d},g(r,l)}var o=function(r){_(l,r);function l(d,u){var h;return h=r.call(this)||this,h.observer=void 0,h.config=void 0,h.observer=d,h.config=u,h}var n=l.prototype;return n.resetInitSegment=function(u,h,t,e){r.prototype.resetInitSegment.call(this,u,h,t,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:h,duration:e,inputTimeScale:9e4,dropped:0}},l.probe=function(u){if(!u)return!1;for(var h=D.getID3Data(u,0)||[],t=h.length,e=u.length;t<e;t++)if(p.probe(u,t))return m.logger.log("ADTS sync word found !"),!0;return!1},n.canParse=function(u,h){return p.canParse(u,h)},n.appendFrame=function(u,h,t){p.initTrackConfig(u,this.observer,h,t,u.manifestCodec);var e=p.appendFrame(u,h,t,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},l}(T.default);P.default=o},"./src/demux/adts.ts":function(M,P,y){y.r(P),y.d(P,"getAudioConfig",function(){return D}),y.d(P,"isHeaderPattern",function(){return _}),y.d(P,"getHeaderLength",function(){return g}),y.d(P,"getFullFrameLength",function(){return o}),y.d(P,"canGetFrameLength",function(){return r}),y.d(P,"isHeader",function(){return l}),y.d(P,"canParse",function(){return n}),y.d(P,"probe",function(){return d}),y.d(P,"initTrackConfig",function(){return u}),y.d(P,"getFrameDuration",function(){return h}),y.d(P,"parseFrameHeader",function(){return t}),y.d(P,"appendFrame",function(){return e});var T=y("./src/utils/logger.ts"),p=y("./src/errors.ts"),m=y("./src/events.ts");function D(s,i,f,c){var a,v,S,x,E=navigator.userAgent.toLowerCase(),L=c,b=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((i[f+2]&192)>>>6)+1;var A=(i[f+2]&60)>>>2;if(A>b.length-1){s.trigger(m.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+A});return}return S=(i[f+2]&1)<<2,S|=(i[f+3]&192)>>>6,T.logger.log("manifest codec:"+c+", ADTS type:"+a+", samplingIndex:"+A),/firefox/i.test(E)?A>=6?(a=5,x=new Array(4),v=A-3):(a=2,x=new Array(2),v=A):E.indexOf("android")!==-1?(a=2,x=new Array(2),v=A):(a=5,x=new Array(4),c&&(c.indexOf("mp4a.40.29")!==-1||c.indexOf("mp4a.40.5")!==-1)||!c&&A>=6?v=A-3:((c&&c.indexOf("mp4a.40.2")!==-1&&(A>=6&&S===1||/vivaldi/i.test(E))||!c&&S===1)&&(a=2,x=new Array(2)),v=A)),x[0]=a<<3,x[0]|=(A&14)>>1,x[1]|=(A&1)<<7,x[1]|=S<<3,a===5&&(x[1]|=(v&14)>>1,x[2]=(v&1)<<7,x[2]|=2<<2,x[3]=0),{config:x,samplerate:b[A],channelCount:S,codec:"mp4a.40."+a,manifestCodec:L}}function _(s,i){return s[i]===255&&(s[i+1]&246)===240}function g(s,i){return s[i+1]&1?7:9}function o(s,i){return(s[i+3]&3)<<11|s[i+4]<<3|(s[i+5]&224)>>>5}function r(s,i){return i+5<s.length}function l(s,i){return i+1<s.length&&_(s,i)}function n(s,i){return r(s,i)&&_(s,i)&&o(s,i)<=s.length-i}function d(s,i){if(l(s,i)){var f=g(s,i);if(i+f>=s.length)return!1;var c=o(s,i);if(c<=f)return!1;var a=i+c;return a===s.length||l(s,a)}return!1}function u(s,i,f,c,a){if(!s.samplerate){var v=D(i,f,c,a);if(!v)return;s.config=v.config,s.samplerate=v.samplerate,s.channelCount=v.channelCount,s.codec=v.codec,s.manifestCodec=v.manifestCodec,T.logger.log("parsed codec:"+s.codec+", rate:"+v.samplerate+", channels:"+v.channelCount)}}function h(s){return 1024*9e4/s}function t(s,i){var f=g(s,i);if(i+f<=s.length){var c=o(s,i)-f;if(c>0)return{headerLength:f,frameLength:c}}}function e(s,i,f,c,a){var v=h(s.samplerate),S=c+a*v,x=t(i,f),E;if(x){var L=x.frameLength,b=x.headerLength,A=b+L,O=Math.max(0,f+A-i.length);O?(E=new Uint8Array(A-b),E.set(i.subarray(f+b,i.length),0)):E=i.subarray(f+b,f+A);var R={unit:E,pts:S};return O||s.samples.push(R),{sample:R,length:A,missing:O}}var I=i.length-f;E=new Uint8Array(I),E.set(i.subarray(f,i.length),0);var C={unit:E,pts:S};return{sample:C,length:I,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(M,P,y){y.r(P),y.d(P,"initPTSFn",function(){return r});var T=y("./src/polyfills/number.ts"),p=y("./src/demux/id3.ts"),m=y("./src/types/demuxer.ts"),D=y("./src/demux/dummy-demuxed-track.ts"),_=y("./src/utils/mp4-tools.ts"),g=y("./src/utils/typed-array.ts"),o=function(){function l(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var n=l.prototype;return n.resetInitSegment=function(u,h,t,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},n.resetTimeStamp=function(u){this.initPTS=u,this.resetContiguity()},n.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},n.canParse=function(u,h){return!1},n.appendFrame=function(u,h,t){},n.demux=function(u,h){this.cachedData&&(u=Object(_.appendUint8Array)(this.cachedData,u),this.cachedData=null);var t=p.getID3Data(u,0),e=t?t.length:0,s,i,f=this._audioTrack,c=this._id3Track,a=t?p.getTimeStamp(t):void 0,v=u.length;for((this.basePTS===null||this.frameIndex===0&&Object(T.isFiniteNumber)(a))&&(this.basePTS=r(a,h,this.initPTS)),t&&t.length>0&&c.samples.push({pts:this.basePTS,dts:this.basePTS,data:t,type:m.MetadataSchema.audioId3}),i=this.basePTS;e<v;){if(this.canParse(u,e)){var S=this.appendFrame(f,u,e);S?(this.frameIndex++,i=S.sample.pts,e+=S.length,s=e):e=v}else p.canParse(u,e)?(t=p.getID3Data(u,e),c.samples.push({pts:i,dts:i,data:t,type:m.MetadataSchema.audioId3}),e+=t.length,s=e):e++;if(e===v&&s!==v){var x=Object(g.sliceUint8)(u,s);this.cachedData?this.cachedData=Object(_.appendUint8Array)(this.cachedData,x):this.cachedData=x}}return{audioTrack:f,videoTrack:Object(D.dummyTrack)(),id3Track:c,textTrack:Object(D.dummyTrack)()}},n.demuxSampleAes=function(u,h,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},n.flush=function(u){var h=this.cachedData;return h&&(this.cachedData=null,this.demux(h,0)),{audioTrack:this._audioTrack,videoTrack:Object(D.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(D.dummyTrack)()}},n.destroy=function(){},l}(),r=function(n,d,u){return Object(T.isFiniteNumber)(n)?n*90:d*9e4+(u||0)};P.default=o},"./src/demux/chunk-cache.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return T});var T=function(){function m(){this.chunks=[],this.dataLength=0}var D=m.prototype;return D.push=function(g){this.chunks.push(g),this.dataLength+=g.length},D.flush=function(){var g=this.chunks,o=this.dataLength,r;if(g.length)g.length===1?r=g[0]:r=p(g,o);else return new Uint8Array(0);return this.reset(),r},D.reset=function(){this.chunks.length=0,this.dataLength=0},m}();function p(m,D){for(var _=new Uint8Array(D),g=0,o=0;o<m.length;o++){var r=m[o];_.set(r,g),g+=r.length}return _}},"./src/demux/dummy-demuxed-track.ts":function(M,P,y){y.r(P),y.d(P,"dummyTrack",function(){return T});function T(p,m){return p===void 0&&(p=""),m===void 0&&(m=9e4),{type:p,id:-1,pid:-1,inputTimeScale:m,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(M,P,y){y.r(P);var T=y("./src/utils/logger.ts"),p=function(){function m(_){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_,this.bytesAvailable=_.byteLength,this.word=0,this.bitsAvailable=0}var D=m.prototype;return D.loadWord=function(){var g=this.data,o=this.bytesAvailable,r=g.byteLength-o,l=new Uint8Array(4),n=Math.min(4,o);if(n===0)throw new Error("no bytes available");l.set(g.subarray(r,r+n)),this.word=new DataView(l.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n},D.skipBits=function(g){var o;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,o=g>>3,g-=o>>3,this.bytesAvailable-=o,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},D.readBits=function(g){var o=Math.min(this.bitsAvailable,g),r=this.word>>>32-o;return g>32&&T.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=o,this.bitsAvailable>0?this.word<<=o:this.bytesAvailable>0&&this.loadWord(),o=g-o,o>0&&this.bitsAvailable?r<<o|this.readBits(o):r},D.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if((this.word&2147483648>>>g)!==0)return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},D.skipUEG=function(){this.skipBits(1+this.skipLZ())},D.skipEG=function(){this.skipBits(1+this.skipLZ())},D.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},D.readEG=function(){var g=this.readUEG();return 1&g?1+g>>>1:-1*(g>>>1)},D.readBoolean=function(){return this.readBits(1)===1},D.readUByte=function(){return this.readBits(8)},D.readUShort=function(){return this.readBits(16)},D.readUInt=function(){return this.readBits(32)},D.skipScalingList=function(g){for(var o=8,r=8,l,n=0;n<g;n++)r!==0&&(l=this.readEG(),r=(o+l+256)%256),o=r===0?o:r},D.readSPS=function(){var g=0,o=0,r=0,l=0,n,d,u,h=this.readUByte.bind(this),t=this.readBits.bind(this),e=this.readUEG.bind(this),s=this.readBoolean.bind(this),i=this.skipBits.bind(this),f=this.skipEG.bind(this),c=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);h();var v=h();if(t(5),i(3),h(),c(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var S=e();if(S===3&&i(1),c(),c(),i(1),s())for(d=S!==3?8:12,u=0;u<d;u++)s()&&(u<6?a(16):a(64))}c();var x=e();if(x===0)e();else if(x===1)for(i(1),f(),f(),n=e(),u=0;u<n;u++)f();c(),i(1);var E=e(),L=e(),b=t(1);b===0&&i(1),i(1),s()&&(g=e(),o=e(),r=e(),l=e());var A=[1,1];if(s()&&s()){var O=h();switch(O){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[h()<<8|h(),h()<<8|h()];break}}}return{width:Math.ceil((E+1)*16-g*2-o*2),height:(2-b)*(L+1)*16-(b?2:4)*(r+l),pixelRatio:A}},D.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},m}();P.default=p},"./src/demux/id3.ts":function(M,P,y){y.r(P),y.d(P,"isHeader",function(){return T}),y.d(P,"isFooter",function(){return p}),y.d(P,"getID3Data",function(){return m}),y.d(P,"canParse",function(){return _}),y.d(P,"getTimeStamp",function(){return g}),y.d(P,"isTimeStampFrame",function(){return o}),y.d(P,"getID3Frames",function(){return l}),y.d(P,"decodeFrame",function(){return n}),y.d(P,"utf8ArrayToStr",function(){return e}),y.d(P,"testables",function(){return s});var T=function(a,v){return v+10<=a.length&&a[v]===73&&a[v+1]===68&&a[v+2]===51&&a[v+3]<255&&a[v+4]<255&&a[v+6]<128&&a[v+7]<128&&a[v+8]<128&&a[v+9]<128},p=function(a,v){return v+10<=a.length&&a[v]===51&&a[v+1]===68&&a[v+2]===73&&a[v+3]<255&&a[v+4]<255&&a[v+6]<128&&a[v+7]<128&&a[v+8]<128&&a[v+9]<128},m=function(a,v){for(var S=v,x=0;T(a,v);){x+=10;var E=D(a,v+6);x+=E,p(a,v+10)&&(x+=10),v+=x}if(x>0)return a.subarray(S,S+x)},D=function(a,v){var S=0;return S=(a[v]&127)<<21,S|=(a[v+1]&127)<<14,S|=(a[v+2]&127)<<7,S|=a[v+3]&127,S},_=function(a,v){return T(a,v)&&D(a,v+6)+10<=a.length-v},g=function(a){for(var v=l(a),S=0;S<v.length;S++){var x=v[S];if(o(x))return t(x)}},o=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},r=function(a){var v=String.fromCharCode(a[0],a[1],a[2],a[3]),S=D(a,4),x=10;return{type:v,size:S,data:a.subarray(x,x+S)}},l=function(a){for(var v=0,S=[];T(a,v);){var x=D(a,v+6);v+=10;for(var E=v+x;v+8<E;){var L=r(a.subarray(v)),b=n(L);b&&S.push(b),v+=L.size+10}p(a,v)&&(v+=10)}return S},n=function(a){return a.type==="PRIV"?d(a):a.type[0]==="W"?h(a):u(a)},d=function(a){if(!(a.size<2)){var v=e(a.data,!0),S=new Uint8Array(a.data.subarray(v.length+1));return{key:a.type,info:v,data:S.buffer}}},u=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var v=1,S=e(a.data.subarray(v),!0);v+=S.length+1;var x=e(a.data.subarray(v));return{key:a.type,info:S,data:x}}var E=e(a.data.subarray(1));return{key:a.type,data:E}}},h=function(a){if(a.type==="WXXX"){if(a.size<2)return;var v=1,S=e(a.data.subarray(v),!0);v+=S.length+1;var x=e(a.data.subarray(v));return{key:a.type,info:S,data:x}}var E=e(a.data);return{key:a.type,data:E}},t=function(a){if(a.data.byteLength===8){var v=new Uint8Array(a.data),S=v[3]&1,x=(v[4]<<23)+(v[5]<<15)+(v[6]<<7)+v[7];return x/=45,S&&(x+=4772185884e-2),Math.round(x)}},e=function(a,v){v===void 0&&(v=!1);var S=f();if(S){var x=S.decode(a);if(v){var E=x.indexOf("\0");return E!==-1?x.substring(0,E):x}return x.replace(/\0/g,"")}for(var L=a.length,b,A,O,R="",I=0;I<L;){if(b=a[I++],b===0&&v)return R;if(b===0||b===3)continue;switch(b>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:R+=String.fromCharCode(b);break;case 12:case 13:A=a[I++],R+=String.fromCharCode((b&31)<<6|A&63);break;case 14:A=a[I++],O=a[I++],R+=String.fromCharCode((b&15)<<12|(A&63)<<6|(O&63)<<0);break}}return R},s={decodeTextFrame:u},i;function f(){return!i&&typeof self.TextDecoder<"u"&&(i=new self.TextDecoder("utf-8")),i}},"./src/demux/mp3demuxer.ts":function(M,P,y){y.r(P);var T=y("./src/demux/base-audio-demuxer.ts"),p=y("./src/demux/id3.ts"),m=y("./src/utils/logger.ts"),D=y("./src/demux/mpegaudio.ts");function _(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,g(r,l)}function g(r,l){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,u){return d.__proto__=u,d},g(r,l)}var o=function(r){_(l,r);function l(){return r.apply(this,arguments)||this}var n=l.prototype;return n.resetInitSegment=function(u,h,t,e){r.prototype.resetInitSegment.call(this,u,h,t,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:h,duration:e,inputTimeScale:9e4,dropped:0}},l.probe=function(u){if(!u)return!1;for(var h=p.getID3Data(u,0)||[],t=h.length,e=u.length;t<e;t++)if(D.probe(u,t))return m.logger.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(u,h){return D.canParse(u,h)},n.appendFrame=function(u,h,t){if(this.basePTS!==null)return D.appendFrame(u,h,t,this.basePTS,this.frameIndex)},l}(T.default);P.default=o},"./src/demux/mp4demuxer.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/types/demuxer.ts"),m=y("./src/utils/mp4-tools.ts"),D=y("./src/demux/dummy-demuxed-track.ts"),_=/\/emsg[-/]ID3/i,g=function(){function o(l,n){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}var r=o.prototype;return r.resetTimeStamp=function(){},r.resetInitSegment=function(n,d,u,h){var t=Object(m.parseInitSegment)(n),e=this.videoTrack=Object(D.dummyTrack)("video",1),s=this.audioTrack=Object(D.dummyTrack)("audio",1),i=this.txtTrack=Object(D.dummyTrack)("text",1);if(this.id3Track=Object(D.dummyTrack)("id3",1),this.timeOffset=0,t.video){var f=t.video,c=f.id,a=f.timescale,v=f.codec;e.id=c,e.timescale=i.timescale=a,e.codec=v}if(t.audio){var S=t.audio,x=S.id,E=S.timescale,L=S.codec;s.id=x,s.timescale=E,s.codec=L}i.id=m.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=s.duration=h},r.resetContiguity=function(){},o.probe=function(n){return n=n.length>16384?n.subarray(0,16384):n,Object(m.findBox)(n,["moof"]).length>0},r.demux=function(n,d){this.timeOffset=d;var u=n,h=this.videoTrack,t=this.txtTrack;if(this.config.progressive){this.remainderData&&(u=Object(m.appendUint8Array)(this.remainderData,n));var e=Object(m.segmentValidRange)(u);this.remainderData=e.remainder,h.samples=e.valid||new Uint8Array}else h.samples=u;var s=this.extractID3Track(h,d);return t.samples=Object(m.parseSamples)(d,h),{videoTrack:h,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},r.flush=function(){var n=this.timeOffset,d=this.videoTrack,u=this.txtTrack;d.samples=this.remainderData||new Uint8Array,this.remainderData=null;var h=this.extractID3Track(d,this.timeOffset);return u.samples=Object(m.parseSamples)(n,d),{videoTrack:d,audioTrack:Object(D.dummyTrack)(),id3Track:h,textTrack:Object(D.dummyTrack)()}},r.extractID3Track=function(n,d){var u=this.id3Track;if(n.samples.length){var h=Object(m.findBox)(n.samples,["emsg"]);h&&h.forEach(function(t){var e=Object(m.parseEmsg)(t);if(_.test(e.schemeIdUri)){var s=Object(T.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:d+e.presentationTimeDelta/e.timeScale,i=e.payload;u.samples.push({data:i,len:i.byteLength,dts:s,pts:s,type:p.MetadataSchema.emsg})}})}return u},r.demuxSampleAes=function(n,d,u){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},r.destroy=function(){},o}();P.default=g},"./src/demux/mpegaudio.ts":function(M,P,y){y.r(P),y.d(P,"appendFrame",function(){return g}),y.d(P,"parseHeader",function(){return o}),y.d(P,"isHeaderPattern",function(){return r}),y.d(P,"isHeader",function(){return l}),y.d(P,"canParse",function(){return n}),y.d(P,"probe",function(){return d});var T=null,p=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],m=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function g(u,h,t,e,s){if(!(t+24>h.length)){var i=o(h,t);if(i&&t+i.frameLength<=h.length){var f=i.samplesPerFrame*9e4/i.sampleRate,c=e+s*f,a={unit:h.subarray(t,t+i.frameLength),pts:c,dts:c};return u.config=[],u.channelCount=i.channelCount,u.samplerate=i.sampleRate,u.samples.push(a),{sample:a,length:i.frameLength,missing:0}}}}function o(u,h){var t=u[h+1]>>3&3,e=u[h+1]>>1&3,s=u[h+2]>>4&15,i=u[h+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){var f=u[h+2]>>1&1,c=u[h+3]>>6,a=t===3?3-e:e===3?3:4,v=p[a*14+s-1]*1e3,S=t===3?0:t===2?1:2,x=m[S*3+i],E=c===3?1:2,L=D[t][e],b=_[e],A=L*8*b,O=Math.floor(L*v/x+f)*b;if(T===null){var R=navigator.userAgent||"",I=R.match(/Chrome\/(\d+)/i);T=I?parseInt(I[1]):0}var C=!!T&&T<=87;return C&&e===2&&v>=224e3&&c===0&&(u[h+3]=u[h+3]|128),{sampleRate:x,channelCount:E,frameLength:O,samplesPerFrame:A}}}function r(u,h){return u[h]===255&&(u[h+1]&224)===224&&(u[h+1]&6)!==0}function l(u,h){return h+1<u.length&&r(u,h)}function n(u,h){var t=4;return r(u,h)&&t<=u.length-h}function d(u,h){if(h+1<u.length&&r(u,h)){var t=4,e=o(u,h),s=t;e!=null&&e.frameLength&&(s=e.frameLength);var i=h+s;return i===u.length||l(u,i)}return!1}},"./src/demux/sample-aes.ts":function(M,P,y){y.r(P);var T=y("./src/crypt/decrypter.ts"),p=y("./src/demux/tsdemuxer.ts"),m=function(){function D(g,o,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new T.default(g,o,{removePKCS7Padding:!1})}var _=D.prototype;return _.decryptBuffer=function(o,r){this.decrypter.decrypt(o,this.keyData.key.buffer,this.keyData.iv.buffer,r)},_.decryptAacSample=function(o,r,l,n){var d=o[r].unit;if(!(d.length<=16)){var u=d.subarray(16,d.length-d.length%16),h=u.buffer.slice(u.byteOffset,u.byteOffset+u.length),t=this;this.decryptBuffer(h,function(e){var s=new Uint8Array(e);d.set(s,16),n||t.decryptAacSamples(o,r+1,l)})}},_.decryptAacSamples=function(o,r,l){for(;;r++){if(r>=o.length){l();return}if(!(o[r].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(o,r,l,n),!n)return}}},_.getAvcEncryptedData=function(o){for(var r=Math.floor((o.length-48)/160)*16+16,l=new Int8Array(r),n=0,d=32;d<o.length-16;d+=160,n+=16)l.set(o.subarray(d,d+16),n);return l},_.getAvcDecryptedUnit=function(o,r){for(var l=new Uint8Array(r),n=0,d=32;d<o.length-16;d+=160,n+=16)o.set(l.subarray(n,n+16),d);return o},_.decryptAvcSample=function(o,r,l,n,d,u){var h=Object(p.discardEPB)(d.data),t=this.getAvcEncryptedData(h),e=this;this.decryptBuffer(t.buffer,function(s){d.data=e.getAvcDecryptedUnit(h,s),u||e.decryptAvcSamples(o,r,l+1,n)})},_.decryptAvcSamples=function(o,r,l,n){if(o instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;r++,l=0){if(r>=o.length){n();return}for(var d=o[r].units;!(l>=d.length);l++){var u=d[l];if(!(u.data.length<=48||u.type!==1&&u.type!==5)){var h=this.decrypter.isSync();if(this.decryptAvcSample(o,r,l,n,u,h),!h)return}}}},D}();P.default=m},"./src/demux/transmuxer-interface.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return l});var T=y("./node_modules/webworkify-webpack/index.js"),p=y("./src/events.ts"),m=y("./src/demux/transmuxer.ts"),D=y("./src/utils/logger.ts"),_=y("./src/errors.ts"),g=y("./src/utils/mediasource-helper.ts"),o=y("./node_modules/eventemitter3/index.js"),r=Object(g.getMediaSource)()||{isTypeSupported:function(){return!1}},l=function(){function n(u,h,t,e){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=u,this.id=h,this.onTransmuxComplete=t,this.onFlush=e;var i=u.config,f=function(x,E){E=E||{},E.frag=s.frag,E.id=s.id,u.trigger(x,E)};this.observer=new o.EventEmitter,this.observer.on(p.Events.FRAG_DECRYPTED,f),this.observer.on(p.Events.ERROR,f);var c={mp4:r.isTypeSupported("video/mp4"),mpeg:r.isTypeSupported("audio/mpeg"),mp3:r.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(i.enableWorker&&typeof Worker<"u"){D.logger.log("demuxing in webworker");var v;try{v=this.worker=T("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(S){u.trigger(p.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(S.message+"  ("+S.filename+":"+S.lineno+")")})},v.postMessage({cmd:"init",typeSupported:c,vendor:a,id:h,config:JSON.stringify(i)})}catch(S){D.logger.warn("Error in worker:",S),D.logger.error("Error while initializing DemuxerWorker, fallback to inline"),v&&self.URL.revokeObjectURL(v.objectURL),this.transmuxer=new m.default(this.observer,c,i,a,h),this.worker=null}}else this.transmuxer=new m.default(this.observer,c,i,a,h)}var d=n.prototype;return d.destroy=function(){var h=this.worker;if(h)h.removeEventListener("message",this.onwmsg),h.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},d.push=function(h,t,e,s,i,f,c,a,v,S){var x,E,L=this;v.transmuxing.start=self.performance.now();var b=this.transmuxer,A=this.worker,O=f?f.start:i.start,R=i.decryptdata,I=this.frag,C=!(I&&i.cc===I.cc),F=!(I&&v.level===I.level),w=I?v.sn-I.sn:-1,k=this.part?v.part-this.part.index:-1,B=w===0&&v.id>1&&v.id===(I==null?void 0:I.stats.chunkCount),U=!F&&(w===1||w===0&&(k===1||B&&k<=0)),N=self.performance.now();(F||w||i.stats.parsing.start===0)&&(i.stats.parsing.start=N),f&&(k||!U)&&(f.stats.parsing.start=N);var j=!(I&&((x=i.initSegment)===null||x===void 0?void 0:x.url)===((E=I.initSegment)===null||E===void 0?void 0:E.url)),K=new m.TransmuxState(C,U,a,F,O,j);if(!U||C||j){D.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+v.sn+" p: "+v.part+" level: "+v.level+" id: "+v.id+`
        discontinuity: `+C+`
        trackSwitch: `+F+`
        contiguous: `+U+`
        accurateTimeOffset: `+a+`
        timeOffset: `+O+`
        initSegmentChange: `+j);var V=new m.TransmuxConfig(e,s,t,c,S);this.configureTransmuxer(V)}if(this.frag=i,this.part=f,A)A.postMessage({cmd:"demux",data:h,decryptdata:R,chunkMeta:v,state:K},h instanceof ArrayBuffer?[h]:[]);else if(b){var H=b.push(h,R,v,K);Object(m.isPromise)(H)?H.then(function(Y){L.handleTransmuxComplete(Y)}):this.handleTransmuxComplete(H)}},d.flush=function(h){var t=this;h.transmuxing.start=self.performance.now();var e=this.transmuxer,s=this.worker;if(s)s.postMessage({cmd:"flush",chunkMeta:h});else if(e){var i=e.flush(h);Object(m.isPromise)(i)?i.then(function(f){t.handleFlushResult(f,h)}):this.handleFlushResult(i,h)}},d.handleFlushResult=function(h,t){var e=this;h.forEach(function(s){e.handleTransmuxComplete(s)}),this.onFlush(t)},d.onWorkerMessage=function(h){var t=h.data,e=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":D.logger[t.data.logType]&&D.logger[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,e.trigger(t.event,t.data);break}}},d.configureTransmuxer=function(h){var t=this.worker,e=this.transmuxer;t?t.postMessage({cmd:"configure",config:h}):e&&e.configure(h)},d.handleTransmuxComplete=function(h){h.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(h)},n}()},"./src/demux/transmuxer-worker.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return _});var T=y("./src/demux/transmuxer.ts"),p=y("./src/events.ts"),m=y("./src/utils/logger.ts"),D=y("./node_modules/eventemitter3/index.js");function _(n){var d=new D.EventEmitter,u=function(e,s){n.postMessage({event:e,data:s})};d.on(p.Events.FRAG_DECRYPTED,u),d.on(p.Events.ERROR,u);var h=function(){var e=function(f){var c=function(v){u("workerLog",{logType:f,message:v})};m.logger[f]=c};for(var s in m.logger)e(s)};n.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":{var s=JSON.parse(e.config);n.transmuxer=new T.default(d,e.typeSupported,s,e.vendor,e.id),Object(m.enableLogs)(s.debug),h(),u("init",null);break}case"configure":{n.transmuxer.configure(e.config);break}case"demux":{var i=n.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(T.isPromise)(i)?i.then(function(a){g(n,a)}):g(n,i);break}case"flush":{var f=e.chunkMeta,c=n.transmuxer.flush(f);Object(T.isPromise)(c)?c.then(function(a){r(n,a,f)}):r(n,c,f);break}}})}function g(n,d){if(l(d.remuxResult))return!1;var u=[],h=d.remuxResult,t=h.audio,e=h.video;return t&&o(u,t),e&&o(u,e),n.postMessage({event:"transmuxComplete",data:d},u),!0}function o(n,d){d.data1&&n.push(d.data1.buffer),d.data2&&n.push(d.data2.buffer)}function r(n,d,u){var h=d.reduce(function(t,e){return g(n,e)||t},!1);h||n.postMessage({event:"transmuxComplete",data:d[0]}),n.postMessage({event:"flush",data:u})}function l(n){return!n.audio&&!n.video&&!n.text&&!n.id3&&!n.initSegment}},"./src/demux/transmuxer.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return h}),y.d(P,"isPromise",function(){return s}),y.d(P,"TransmuxConfig",function(){return i}),y.d(P,"TransmuxState",function(){return f});var T=y("./src/events.ts"),p=y("./src/errors.ts"),m=y("./src/crypt/decrypter.ts"),D=y("./src/demux/aacdemuxer.ts"),_=y("./src/demux/mp4demuxer.ts"),g=y("./src/demux/tsdemuxer.ts"),o=y("./src/demux/mp3demuxer.ts"),r=y("./src/remux/mp4-remuxer.ts"),l=y("./src/remux/passthrough-remuxer.ts"),n=y("./src/utils/logger.ts"),d;try{d=self.performance.now.bind(self.performance)}catch{n.logger.debug("Unable to use Performance API on this environment"),d=self.Date.now}var u=[{demux:g.default,remux:r.default},{demux:_.default,remux:l.default},{demux:D.default,remux:r.default},{demux:o.default,remux:r.default}],h=function(){function c(v,S,x,E,L){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=v,this.typeSupported=S,this.config=x,this.vendor=E,this.id=L}var a=c.prototype;return a.configure=function(S){this.transmuxConfig=S,this.decrypter&&this.decrypter.reset()},a.push=function(S,x,E,L){var b=this,A=E.transmuxing;A.executeStart=d();var O=new Uint8Array(S),R=this.config,I=this.currentTransmuxState,C=this.transmuxConfig;L&&(this.currentTransmuxState=L);var F=L||I,w=F.contiguous,k=F.discontinuity,B=F.trackSwitch,U=F.accurateTimeOffset,N=F.timeOffset,j=F.initSegmentChange,K=C.audioCodec,V=C.videoCodec,H=C.defaultInitPts,Y=C.duration,q=C.initSegmentData;(k||B||j)&&this.resetInitSegment(q,K,V,Y),(k||j)&&this.resetInitialTimestamp(H),w||this.resetContiguity();var $=t(O,x);if($&&$.method==="AES-128"){var G=this.getDecrypter();if(R.enableSoftwareAES){var re=G.softwareDecrypt(O,$.key.buffer,$.iv.buffer);if(!re)return A.executeEnd=d(),e(E);O=new Uint8Array(re)}else return this.decryptionPromise=G.webCryptoDecrypt(O,$.key.buffer,$.iv.buffer).then(function(se){var ae=b.push(se,null,E);return b.decryptionPromise=null,ae}),this.decryptionPromise}this.needsProbing(O,k,B)&&this.configureTransmuxer(O,C);var Q=this.transmux(O,$,N,U,E),ee=this.currentTransmuxState;return ee.contiguous=!0,ee.discontinuity=!1,ee.trackSwitch=!1,A.executeEnd=d(),Q},a.flush=function(S){var x=this,E=S.transmuxing;E.executeStart=d();var L=this.decrypter,b=this.currentTransmuxState,A=this.decryptionPromise;if(A)return A.then(function(){return x.flush(S)});var O=[],R=b.timeOffset;if(L){var I=L.flush();I&&O.push(this.push(I,null,S))}var C=this.demuxer,F=this.remuxer;if(!C||!F)return this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),E.executeEnd=d(),[e(S)];var w=C.flush(R);return s(w)?w.then(function(k){return x.flushRemux(O,k,S),O}):(this.flushRemux(O,w,S),O)},a.flushRemux=function(S,x,E){var L=x.audioTrack,b=x.videoTrack,A=x.id3Track,O=x.textTrack,R=this.currentTransmuxState,I=R.accurateTimeOffset,C=R.timeOffset;n.logger.log("[transmuxer.ts]: Flushed fragment "+E.sn+(E.part>-1?" p: "+E.part:"")+" of level "+E.level);var F=this.remuxer.remux(L,b,A,O,C,I,!0,this.id);S.push({remuxResult:F,chunkMeta:E}),E.transmuxing.executeEnd=d()},a.resetInitialTimestamp=function(S){var x=this.demuxer,E=this.remuxer;!x||!E||(x.resetTimeStamp(S),E.resetTimeStamp(S))},a.resetContiguity=function(){var S=this.demuxer,x=this.remuxer;!S||!x||(S.resetContiguity(),x.resetNextTimestamp())},a.resetInitSegment=function(S,x,E,L){var b=this.demuxer,A=this.remuxer;!b||!A||(b.resetInitSegment(S,x,E,L),A.resetInitSegment(S,x,E))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(S,x,E,L,b){var A;return x&&x.method==="SAMPLE-AES"?A=this.transmuxSampleAes(S,x,E,L,b):A=this.transmuxUnencrypted(S,E,L,b),A},a.transmuxUnencrypted=function(S,x,E,L){var b=this.demuxer.demux(S,x,!1,!this.config.progressive),A=b.audioTrack,O=b.videoTrack,R=b.id3Track,I=b.textTrack,C=this.remuxer.remux(A,O,R,I,x,E,!1,this.id);return{remuxResult:C,chunkMeta:L}},a.transmuxSampleAes=function(S,x,E,L,b){var A=this;return this.demuxer.demuxSampleAes(S,x,E).then(function(O){var R=A.remuxer.remux(O.audioTrack,O.videoTrack,O.id3Track,O.textTrack,E,L,!1,A.id);return{remuxResult:R,chunkMeta:b}})},a.configureTransmuxer=function(S,x){for(var E=this.config,L=this.observer,b=this.typeSupported,A=this.vendor,O=x.audioCodec,R=x.defaultInitPts,I=x.duration,C=x.initSegmentData,F=x.videoCodec,w,k=0,B=u.length;k<B;k++)if(u[k].demux.probe(S)){w=u[k];break}w||(n.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),w={demux:_.default,remux:l.default});var U=this.demuxer,N=this.remuxer,j=w.remux,K=w.demux;(!N||!(N instanceof j))&&(this.remuxer=new j(L,E,b,A)),(!U||!(U instanceof K))&&(this.demuxer=new K(L,E,b),this.probe=K.probe),this.resetInitSegment(C,O,F,I),this.resetInitialTimestamp(R)},a.needsProbing=function(S,x,E){return!this.demuxer||!this.remuxer||x||E},a.getDecrypter=function(){var S=this.decrypter;return S||(S=this.decrypter=new m.default(this.observer,this.config)),S},c}();function t(c,a){var v=null;return c.byteLength>0&&a!=null&&a.key!=null&&a.iv!==null&&a.method!=null&&(v=a),v}var e=function(a){return{remuxResult:{},chunkMeta:a}};function s(c){return"then"in c&&c.then instanceof Function}var i=function(a,v,S,x,E){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=v,this.initSegmentData=S,this.duration=x,this.defaultInitPts=E},f=function(a,v,S,x,E,L){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=a,this.contiguous=v,this.accurateTimeOffset=S,this.trackSwitch=x,this.timeOffset=E,this.initSegmentChange=L}},"./src/demux/tsdemuxer.ts":function(M,P,y){y.r(P),y.d(P,"discardEPB",function(){return i});var T=y("./src/demux/adts.ts"),p=y("./src/demux/mpegaudio.ts"),m=y("./src/demux/exp-golomb.ts"),D=y("./src/demux/sample-aes.ts"),_=y("./src/events.ts"),g=y("./src/utils/mp4-tools.ts"),o=y("./src/utils/logger.ts"),r=y("./src/errors.ts"),l=y("./src/types/demuxer.ts");function n(){return n=Object.assign?Object.assign.bind():function(f){for(var c=1;c<arguments.length;c++){var a=arguments[c];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(f[v]=a[v])}return f},n.apply(this,arguments)}var d=function(){function f(a,v,S){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=v,this.typeSupported=S}f.probe=function(v){return v[0]===71&&v[188]===71},f.createTrack=function(v,S){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:g.RemuxerTrackIdConfig[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?S:void 0}};var c=f.prototype;return c.resetInitSegment=function(v,S,x,E){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=f.createTrack("video"),this._audioTrack=f.createTrack("audio",E),this._id3Track=f.createTrack("id3"),this._txtTrack=f.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=S,this.videoCodec=x,this._duration=E},c.resetTimeStamp=function(){},c.resetContiguity=function(){var v=this._audioTrack,S=this._avcTrack,x=this._id3Track;v&&(v.pesData=null),S&&(S.pesData=null),x&&(x.pesData=null),this.aacOverFlow=null},c.demux=function(v,S,x,E){x===void 0&&(x=!1),E===void 0&&(E=!1),x||(this.sampleAes=null);var L,b=this._avcTrack,A=this._audioTrack,O=this._id3Track,R=this._txtTrack,I=b.pid,C=b.pesData,F=A.pid,w=O.pid,k=A.pesData,B=O.pesData,U=null,N=this.pmtParsed,j=this._pmtId,K=v.length;if(this.remainderData&&(v=Object(g.appendUint8Array)(this.remainderData,v),K=v.length,this.remainderData=null),K<188&&!E)return this.remainderData=v,{audioTrack:A,videoTrack:b,id3Track:O,textTrack:R};K-=K%188,K<v.byteLength&&!E&&(this.remainderData=new Uint8Array(v.buffer,K,v.buffer.byteLength-K));for(var V=0,H=0;H<K;H+=188)if(v[H]===71){var Y=!!(v[H+1]&64),q=((v[H+1]&31)<<8)+v[H+2],$=(v[H+3]&48)>>4,G=void 0;if($>1){if(G=H+5+v[H+4],G===H+188)continue}else G=H+4;switch(q){case I:Y&&(C&&(L=e(C))&&this.parseAVCPES(b,R,L,!1),C={data:[],size:0}),C&&(C.data.push(v.subarray(G,H+188)),C.size+=H+188-G);break;case F:if(Y){if(k&&(L=e(k)))switch(A.segmentCodec){case"aac":this.parseAACPES(A,L);break;case"mp3":this.parseMPEGPES(A,L);break}k={data:[],size:0}}k&&(k.data.push(v.subarray(G,H+188)),k.size+=H+188-G);break;case w:Y&&(B&&(L=e(B))&&this.parseID3PES(O,L),B={data:[],size:0}),B&&(B.data.push(v.subarray(G,H+188)),B.size+=H+188-G);break;case 0:Y&&(G+=v[G]+1),j=this._pmtId=h(v,G);break;case j:{Y&&(G+=v[G]+1);var re=t(v,G,this.typeSupported,x);I=re.avc,I>0&&(b.pid=I),F=re.audio,F>0&&(A.pid=F,A.segmentCodec=re.segmentCodec),w=re.id3,w>0&&(O.pid=w),U!==null&&!N&&(o.logger.log("unknown PID '"+U+"' in TS found"),U=null),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:U=q;break}}else V++;V>0&&this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),b.pesData=C,A.pesData=k,O.pesData=B;var Q={audioTrack:A,videoTrack:b,id3Track:O,textTrack:R};return E&&this.extractRemainingSamples(Q),Q},c.flush=function(){var v=this.remainderData;this.remainderData=null;var S;return v?S=this.demux(v,-1,!1,!0):S={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(S),this.sampleAes?this.decrypt(S,this.sampleAes):S},c.extractRemainingSamples=function(v){var S=v.audioTrack,x=v.videoTrack,E=v.id3Track,L=v.textTrack,b=x.pesData,A=S.pesData,O=E.pesData,R;if(b&&(R=e(b))?(this.parseAVCPES(x,L,R,!0),x.pesData=null):x.pesData=b,A&&(R=e(A))){switch(S.segmentCodec){case"aac":this.parseAACPES(S,R);break;case"mp3":this.parseMPEGPES(S,R);break}S.pesData=null}else A!=null&&A.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),S.pesData=A;O&&(R=e(O))?(this.parseID3PES(E,R),E.pesData=null):E.pesData=O},c.demuxSampleAes=function(v,S,x){var E=this.demux(v,x,!0,!this.config.progressive),L=this.sampleAes=new D.default(this.observer,this.config,S);return this.decrypt(E,L)},c.decrypt=function(v,S){return new Promise(function(x){var E=v.audioTrack,L=v.videoTrack;E.samples&&E.segmentCodec==="aac"?S.decryptAacSamples(E.samples,0,function(){L.samples?S.decryptAvcSamples(L.samples,0,0,function(){x(v)}):x(v)}):L.samples&&S.decryptAvcSamples(L.samples,0,0,function(){x(v)})})},c.destroy=function(){this._duration=0},c.parseAVCPES=function(v,S,x,E){var L=this,b=this.parseAVCNALu(v,x.data),A=this.avcSample,O,R=!1;x.data=null,A&&b.length&&!v.audFound&&(s(A,v),A=this.avcSample=u(!1,x.pts,x.dts,"")),b.forEach(function(I){switch(I.type){case 1:{O=!0,A||(A=L.avcSample=u(!0,x.pts,x.dts,"")),A.frame=!0;var C=I.data;if(R&&C.length>4){var F=new m.default(C).readSliceType();(F===2||F===4||F===7||F===9)&&(A.key=!0)}break}case 5:O=!0,A||(A=L.avcSample=u(!0,x.pts,x.dts,"")),A.key=!0,A.frame=!0;break;case 6:{O=!0,Object(g.parseSEIMessageFromNALu)(i(I.data),x.pts,S.samples);break}case 7:if(O=!0,R=!0,!v.sps){var w=new m.default(I.data),k=w.readSPS();v.width=k.width,v.height=k.height,v.pixelRatio=k.pixelRatio,v.sps=[I.data],v.duration=L._duration;for(var B=I.data.subarray(1,4),U="avc1.",N=0;N<3;N++){var j=B[N].toString(16);j.length<2&&(j="0"+j),U+=j}v.codec=U}break;case 8:O=!0,v.pps||(v.pps=[I.data]);break;case 9:O=!1,v.audFound=!0,A&&s(A,v),A=L.avcSample=u(!1,x.pts,x.dts,"");break;case 12:O=!0;break;default:O=!1,A&&(A.debug+="unknown NAL "+I.type+" ");break}if(A&&O){var K=A.units;K.push(I)}}),E&&A&&(s(A,v),this.avcSample=null)},c.getLastNalUnit=function(v){var S,x=this.avcSample,E;if((!x||x.units.length===0)&&(x=v[v.length-1]),(S=x)!==null&&S!==void 0&&S.units){var L=x.units;E=L[L.length-1]}return E},c.parseAVCNALu=function(v,S){var x=S.byteLength,E=v.naluState||0,L=E,b=[],A=0,O,R,I,C=-1,F=0;for(E===-1&&(C=0,F=S[0]&31,E=0,A=1);A<x;){if(O=S[A++],!E){E=O?0:1;continue}if(E===1){E=O?0:2;continue}if(!O)E=3;else if(O===1){if(C>=0){var w={data:S.subarray(C,A-E-1),type:F};b.push(w)}else{var k=this.getLastNalUnit(v.samples);if(k&&(L&&A<=4-L&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-L)),R=A-E-1,R>0)){var B=new Uint8Array(k.data.byteLength+R);B.set(k.data,0),B.set(S.subarray(0,R),k.data.byteLength),k.data=B,k.state=0}}A<x?(I=S[A]&31,C=A,F=I,E=0):E=-1}else E=0}if(C>=0&&E>=0){var U={data:S.subarray(C,x),type:F,state:E};b.push(U)}if(b.length===0){var N=this.getLastNalUnit(v.samples);if(N){var j=new Uint8Array(N.data.byteLength+S.byteLength);j.set(N.data,0),j.set(S,N.data.byteLength),N.data=j}}return v.naluState=E,b},c.parseAACPES=function(v,S){var x=0,E=this.aacOverFlow,L=S.data;if(E){this.aacOverFlow=null;var b=E.missing,A=E.sample.unit.byteLength;if(b===-1){var O=new Uint8Array(A+L.byteLength);O.set(E.sample.unit,0),O.set(L,A),L=O}else{var R=A-b;E.sample.unit.set(L.subarray(0,b),R),v.samples.push(E.sample),x=E.missing}}var I,C;for(I=x,C=L.length;I<C-1&&!T.isHeader(L,I);I++);if(I!==x){var F,w;if(I<C-1?(F="AAC PES did not start with ADTS header,offset:"+I,w=!1):(F="no ADTS header found in AAC PES",w=!0),o.logger.warn("parsing error:"+F),this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:F}),w)return}T.initTrackConfig(v,this.observer,L,I,this.audioCodec);var k;if(S.pts!==void 0)k=S.pts;else if(E){var B=T.getFrameDuration(v.samplerate);k=E.sample.pts+B}else{o.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var U=0,N;I<C;)if(N=T.appendFrame(v,L,I,k,U),I+=N.length,N.missing){this.aacOverFlow=N;break}else for(U++;I<C-1&&!T.isHeader(L,I);I++);},c.parseMPEGPES=function(v,S){var x=S.data,E=x.length,L=0,b=0,A=S.pts;if(A===void 0){o.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;b<E;)if(p.isHeader(x,b)){var O=p.appendFrame(v,x,b,A,L);if(O)b+=O.length,L++;else break}else b++},c.parseID3PES=function(v,S){if(S.pts===void 0){o.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var x=n({},S,{type:this._avcTrack?l.MetadataSchema.emsg:l.MetadataSchema.audioId3});v.samples.push(x)},f}();function u(f,c,a,v){return{key:f,frame:!1,pts:c,dts:a,units:[],debug:v,length:0}}function h(f,c){return(f[c+10]&31)<<8|f[c+11]}function t(f,c,a,v){var S={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},x=(f[c+1]&15)<<8|f[c+2],E=c+3+x-4,L=(f[c+10]&15)<<8|f[c+11];for(c+=12+L;c<E;){var b=(f[c+1]&31)<<8|f[c+2];switch(f[c]){case 207:if(!v){o.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:S.audio===-1&&(S.audio=b);break;case 21:S.id3===-1&&(S.id3=b);break;case 219:if(!v){o.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:S.avc===-1&&(S.avc=b);break;case 3:case 4:a.mpeg!==!0&&a.mp3!==!0?o.logger.log("MPEG audio found, not supported in this browser"):S.audio===-1&&(S.audio=b,S.segmentCodec="mp3");break;case 36:o.logger.warn("Unsupported HEVC stream type found");break}c+=((f[c+3]&15)<<8|f[c+4])+5}return S}function e(f){var c=0,a,v,S,x,E,L=f.data;if(!f||f.size===0)return null;for(;L[0].length<19&&L.length>1;){var b=new Uint8Array(L[0].length+L[1].length);b.set(L[0]),b.set(L[1],L[0].length),L[0]=b,L.splice(1,1)}a=L[0];var A=(a[0]<<16)+(a[1]<<8)+a[2];if(A===1){if(v=(a[4]<<8)+a[5],v&&v>f.size-6)return null;var O=a[7];O&192&&(x=(a[9]&14)*536870912+(a[10]&255)*4194304+(a[11]&254)*16384+(a[12]&255)*128+(a[13]&254)/2,O&64?(E=(a[14]&14)*536870912+(a[15]&255)*4194304+(a[16]&254)*16384+(a[17]&255)*128+(a[18]&254)/2,x-E>60*9e4&&(o.logger.warn(Math.round((x-E)/9e4)+"s delta between PTS and DTS, align them"),x=E)):E=x),S=a[8];var R=S+9;if(f.size<=R)return null;f.size-=R;for(var I=new Uint8Array(f.size),C=0,F=L.length;C<F;C++){a=L[C];var w=a.byteLength;if(R)if(R>w){R-=w;continue}else a=a.subarray(R),w-=R,R=0;I.set(a,c),c+=w}return v&&(v-=S+3),{data:I,pts:x,dts:E,len:v}}return null}function s(f,c){if(f.units.length&&f.frame){if(f.pts===void 0){var a=c.samples,v=a.length;if(v){var S=a[v-1];f.pts=S.pts,f.dts=S.dts}else{c.dropped++;return}}c.samples.push(f)}f.debug.length&&o.logger.log(f.pts+"/"+f.dts+":"+f.debug)}function i(f){for(var c=f.byteLength,a=[],v=1;v<c-2;)f[v]===0&&f[v+1]===0&&f[v+2]===3?(a.push(v+2),v+=2):v++;if(a.length===0)return f;var S=c-a.length,x=new Uint8Array(S),E=0;for(v=0;v<S;E++,v++)E===a[0]&&(E++,a.shift()),x[v]=f[E];return x}P.default=d},"./src/errors.ts":function(M,P,y){y.r(P),y.d(P,"ErrorTypes",function(){return T}),y.d(P,"ErrorDetails",function(){return p});var T;(function(m){m.NETWORK_ERROR="networkError",m.MEDIA_ERROR="mediaError",m.KEY_SYSTEM_ERROR="keySystemError",m.MUX_ERROR="muxError",m.OTHER_ERROR="otherError"})(T||(T={}));var p;(function(m){m.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",m.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",m.KEY_SYSTEM_NO_SESSION="keySystemNoSession",m.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",m.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",m.MANIFEST_LOAD_ERROR="manifestLoadError",m.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",m.MANIFEST_PARSING_ERROR="manifestParsingError",m.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",m.LEVEL_EMPTY_ERROR="levelEmptyError",m.LEVEL_LOAD_ERROR="levelLoadError",m.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",m.LEVEL_SWITCH_ERROR="levelSwitchError",m.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",m.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",m.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",m.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",m.FRAG_LOAD_ERROR="fragLoadError",m.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",m.FRAG_DECRYPT_ERROR="fragDecryptError",m.FRAG_PARSING_ERROR="fragParsingError",m.REMUX_ALLOC_ERROR="remuxAllocError",m.KEY_LOAD_ERROR="keyLoadError",m.KEY_LOAD_TIMEOUT="keyLoadTimeOut",m.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",m.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",m.BUFFER_APPEND_ERROR="bufferAppendError",m.BUFFER_APPENDING_ERROR="bufferAppendingError",m.BUFFER_STALLED_ERROR="bufferStalledError",m.BUFFER_FULL_ERROR="bufferFullError",m.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",m.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",m.INTERNAL_EXCEPTION="internalException",m.INTERNAL_ABORTED="aborted",m.UNKNOWN="unknown"})(p||(p={}))},"./src/events.ts":function(M,P,y){y.r(P),y.d(P,"Events",function(){return T});var T;(function(p){p.MEDIA_ATTACHING="hlsMediaAttaching",p.MEDIA_ATTACHED="hlsMediaAttached",p.MEDIA_DETACHING="hlsMediaDetaching",p.MEDIA_DETACHED="hlsMediaDetached",p.BUFFER_RESET="hlsBufferReset",p.BUFFER_CODECS="hlsBufferCodecs",p.BUFFER_CREATED="hlsBufferCreated",p.BUFFER_APPENDING="hlsBufferAppending",p.BUFFER_APPENDED="hlsBufferAppended",p.BUFFER_EOS="hlsBufferEos",p.BUFFER_FLUSHING="hlsBufferFlushing",p.BUFFER_FLUSHED="hlsBufferFlushed",p.MANIFEST_LOADING="hlsManifestLoading",p.MANIFEST_LOADED="hlsManifestLoaded",p.MANIFEST_PARSED="hlsManifestParsed",p.LEVEL_SWITCHING="hlsLevelSwitching",p.LEVEL_SWITCHED="hlsLevelSwitched",p.LEVEL_LOADING="hlsLevelLoading",p.LEVEL_LOADED="hlsLevelLoaded",p.LEVEL_UPDATED="hlsLevelUpdated",p.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",p.LEVELS_UPDATED="hlsLevelsUpdated",p.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",p.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",p.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",p.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",p.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",p.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",p.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",p.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",p.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",p.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",p.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",p.CUES_PARSED="hlsCuesParsed",p.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",p.INIT_PTS_FOUND="hlsInitPtsFound",p.FRAG_LOADING="hlsFragLoading",p.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",p.FRAG_LOADED="hlsFragLoaded",p.FRAG_DECRYPTED="hlsFragDecrypted",p.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",p.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",p.FRAG_PARSING_METADATA="hlsFragParsingMetadata",p.FRAG_PARSED="hlsFragParsed",p.FRAG_BUFFERED="hlsFragBuffered",p.FRAG_CHANGED="hlsFragChanged",p.FPS_DROP="hlsFpsDrop",p.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",p.ERROR="hlsError",p.DESTROYING="hlsDestroying",p.KEY_LOADING="hlsKeyLoading",p.KEY_LOADED="hlsKeyLoaded",p.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",p.BACK_BUFFER_REACHED="hlsBackBufferReached"})(T||(T={}))},"./src/hls.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return i});var T=y("./node_modules/url-toolkit/src/url-toolkit.js"),p=y("./src/loader/playlist-loader.ts"),m=y("./src/loader/key-loader.ts"),D=y("./src/controller/id3-track-controller.ts"),_=y("./src/controller/latency-controller.ts"),g=y("./src/controller/level-controller.ts"),o=y("./src/controller/fragment-tracker.ts"),r=y("./src/controller/stream-controller.ts"),l=y("./src/is-supported.ts"),n=y("./src/utils/logger.ts"),d=y("./src/config.ts"),u=y("./node_modules/eventemitter3/index.js"),h=y("./src/events.ts"),t=y("./src/errors.ts");function e(f,c){for(var a=0;a<c.length;a++){var v=c[a];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}function s(f,c,a){return c&&e(f.prototype,c),a&&e(f,a),Object.defineProperty(f,"prototype",{writable:!1}),f}var i=function(){f.isSupported=function(){return Object(l.isSupported)()};function f(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new u.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var v=this.config=Object(d.mergeConfig)(f.DefaultConfig,a);this.userConfig=a,Object(n.enableLogs)(v.debug),this._autoLevelCapping=-1,v.progressive&&Object(d.enableStreamingMode)(v);var S=v.abrController,x=v.bufferController,E=v.capLevelController,L=v.fpsController,b=this.abrController=new S(this),A=this.bufferController=new x(this),O=this.capLevelController=new E(this),R=new L(this),I=new p.default(this),C=new m.default(this),F=new D.default(this),w=this.levelController=new g.default(this),k=new o.FragmentTracker(this),B=this.streamController=new r.default(this,k);O.setStreamController(B),R.setStreamController(B);var U=[I,C,w,B];this.networkControllers=U;var N=[b,A,O,R,F,k];this.audioTrackController=this.createController(v.audioTrackController,null,U),this.createController(v.audioStreamController,k,U),this.subtitleTrackController=this.createController(v.subtitleTrackController,null,U),this.createController(v.subtitleStreamController,k,U),this.createController(v.timelineController,null,N),this.emeController=this.createController(v.emeController,null,N),this.cmcdController=this.createController(v.cmcdController,null,N),this.latencyController=this.createController(_.default,null,N),this.coreComponents=N}var c=f.prototype;return c.createController=function(v,S,x){if(v){var E=S?new v(this,S):new v(this);return x&&x.push(E),E}return null},c.on=function(v,S,x){x===void 0&&(x=this),this._emitter.on(v,S,x)},c.once=function(v,S,x){x===void 0&&(x=this),this._emitter.once(v,S,x)},c.removeAllListeners=function(v){this._emitter.removeAllListeners(v)},c.off=function(v,S,x,E){x===void 0&&(x=this),this._emitter.off(v,S,x,E)},c.listeners=function(v){return this._emitter.listeners(v)},c.emit=function(v,S,x){return this._emitter.emit(v,S,x)},c.trigger=function(v,S){if(this.config.debug)return this.emit(v,v,S);try{return this.emit(v,v,S)}catch(x){n.logger.error("An internal error happened while handling event "+v+'. Error message: "'+x.message+'". Here is a stacktrace:',x),this.trigger(h.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:v,error:x})}return!1},c.listenerCount=function(v){return this._emitter.listenerCount(v)},c.destroy=function(){n.logger.log("destroy"),this.trigger(h.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(v){return v.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(v){return v.destroy()}),this.coreComponents.length=0},c.attachMedia=function(v){n.logger.log("attachMedia"),this._media=v,this.trigger(h.Events.MEDIA_ATTACHING,{media:v})},c.detachMedia=function(){n.logger.log("detachMedia"),this.trigger(h.Events.MEDIA_DETACHING,void 0),this._media=null},c.loadSource=function(v){this.stopLoad();var S=this.media,x=this.url,E=this.url=T.buildAbsoluteURL(self.location.href,v,{alwaysNormalize:!0});n.logger.log("loadSource:"+E),S&&x&&x!==E&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(S)),this.trigger(h.Events.MANIFEST_LOADING,{url:v})},c.startLoad=function(v){v===void 0&&(v=-1),n.logger.log("startLoad("+v+")"),this.networkControllers.forEach(function(S){S.startLoad(v)})},c.stopLoad=function(){n.logger.log("stopLoad"),this.networkControllers.forEach(function(v){v.stopLoad()})},c.swapAudioCodec=function(){n.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},c.recoverMediaError=function(){n.logger.log("recoverMediaError");var v=this._media;this.detachMedia(),v&&this.attachMedia(v)},c.removeLevel=function(v,S){S===void 0&&(S=0),this.levelController.removeLevel(v,S)},s(f,[{key:"levels",get:function(){var v=this.levelController.levels;return v||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(v){n.logger.log("set currentLevel:"+v),this.loadLevel=v,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(v){n.logger.log("set nextLevel:"+v),this.levelController.manualLevel=v,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(v){n.logger.log("set loadLevel:"+v),this.levelController.manualLevel=v}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(v){this.levelController.nextLoadLevel=v}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(v){n.logger.log("set firstLevel:"+v),this.levelController.firstLevel=v}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(v){n.logger.log("set startLevel:"+v),v!==-1&&(v=Math.max(v,this.minAutoLevel)),this.levelController.startLevel=v}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(v){var S=!!v;S!==this.config.capLevelToPlayerSize&&(S?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=S)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(v){this._autoLevelCapping!==v&&(n.logger.log("set autoLevelCapping:"+v),this._autoLevelCapping=v)}},{key:"bandwidthEstimate",get:function(){var v=this.abrController.bwEstimator;return v?v.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var v=this.levels,S=this.config.minAutoBitrate;if(!v)return 0;for(var x=v.length,E=0;E<x;E++)if(v[E].maxBitrate>=S)return E;return 0}},{key:"maxAutoLevel",get:function(){var v=this.levels,S=this.autoLevelCapping,x;return S===-1&&v&&v.length?x=v.length-1:x=S,x}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(v){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,v)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var v=this.audioTrackController;return v?v.audioTracks:[]}},{key:"audioTrack",get:function(){var v=this.audioTrackController;return v?v.audioTrack:-1},set:function(v){var S=this.audioTrackController;S&&(S.audioTrack=v)}},{key:"subtitleTracks",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var v=this.subtitleTrackController;return v?v.subtitleTrack:-1},set:function(v){var S=this.subtitleTrackController;S&&(S.subtitleTrack=v)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var v=this.subtitleTrackController;return v?v.subtitleDisplay:!1},set:function(v){var S=this.subtitleTrackController;S&&(S.subtitleDisplay=v)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(v){this.config.lowLatencyMode=v}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.3"}},{key:"Events",get:function(){return h.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:d.hlsDefaultConfig},set:function(v){f.defaultConfig=v}}]),f}();i.defaultConfig=void 0},"./src/is-supported.ts":function(M,P,y){y.r(P),y.d(P,"isSupported",function(){return m}),y.d(P,"changeTypeSupported",function(){return D});var T=y("./src/utils/mediasource-helper.ts");function p(){return self.SourceBuffer||self.WebKitSourceBuffer}function m(){var _=Object(T.getMediaSource)();if(!_)return!1;var g=p(),o=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!g||g.prototype&&typeof g.prototype.appendBuffer=="function"&&typeof g.prototype.remove=="function";return!!o&&!!r}function D(){var _,g=p();return typeof(g==null||(_=g.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/date-range.ts":function(M,P,y){y.r(P),y.d(P,"DateRangeAttribute",function(){return o}),y.d(P,"DateRange",function(){return r});var T=y("./src/polyfills/number.ts"),p=y("./src/utils/attr-list.ts"),m=y("./src/utils/logger.ts");function D(){return D=Object.assign?Object.assign.bind():function(l){for(var n=1;n<arguments.length;n++){var d=arguments[n];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},D.apply(this,arguments)}function _(l,n){for(var d=0;d<n.length;d++){var u=n[d];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(l,u.key,u)}}function g(l,n,d){return n&&_(l.prototype,n),d&&_(l,d),Object.defineProperty(l,"prototype",{writable:!1}),l}var o;(function(l){l.ID="ID",l.CLASS="CLASS",l.START_DATE="START-DATE",l.DURATION="DURATION",l.END_DATE="END-DATE",l.END_ON_NEXT="END-ON-NEXT",l.PLANNED_DURATION="PLANNED-DURATION",l.SCTE35_OUT="SCTE35-OUT",l.SCTE35_IN="SCTE35-IN"})(o||(o={}));var r=function(){function l(n,d){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,d){var u=d.attr;for(var h in u)if(Object.prototype.hasOwnProperty.call(n,h)&&n[h]!==u[h]){m.logger.warn('DATERANGE tag attribute: "'+h+'" does not match for tags with ID: "'+n.ID+'"'),this._badValueForSameId=h;break}n=D(new p.AttrList({}),u,n)}if(this.attr=n,this._startDate=new Date(n[o.START_DATE]),o.END_DATE in this.attr){var t=new Date(this.attr[o.END_DATE]);Object(T.isFiniteNumber)(t.getTime())&&(this._endDate=t)}}return g(l,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var d=this.duration;return d!==null?new Date(this._startDate.getTime()+d*1e3):null}},{key:"duration",get:function(){if(o.DURATION in this.attr){var d=this.attr.decimalFloatingPoint(o.DURATION);if(Object(T.isFiniteNumber)(d))return d}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return o.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(o.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(o.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(T.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),l}()},"./src/loader/fragment-loader.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return d}),y.d(P,"LoadError",function(){return h});var T=y("./src/polyfills/number.ts"),p=y("./src/errors.ts");function m(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function D(t){var e=typeof Map=="function"?new Map:void 0;return D=function(i){if(i===null||!o(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(i))return e.get(i);e.set(i,f)}function f(){return _(i,arguments,l(this).constructor)}return f.prototype=Object.create(i.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),r(f,i)},D(t)}function _(t,e,s){return g()?_=Reflect.construct.bind():_=function(f,c,a){var v=[null];v.push.apply(v,c);var S=Function.bind.apply(f,v),x=new S;return a&&r(x,a.prototype),x},_.apply(null,arguments)}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,f){return i.__proto__=f,i},r(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},l(t)}var n=Math.pow(2,17),d=function(){function t(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(i,f){var c=this,a=i.url;if(!a)return Promise.reject(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var v=this.config,S=v.fLoader,x=v.loader;return new Promise(function(E,L){c.loader&&c.loader.destroy();var b=c.loader=i.loader=S?new S(v):new x(v),A=u(i),O={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:i.sn==="initSegment"?1/0:n};i.stats=b.stats,b.load(A,O,{onSuccess:function(I,C,F,w){c.resetLoader(i,b),E({frag:i,part:null,payload:I.data,networkDetails:w})},onError:function(I,C,F){c.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:I,networkDetails:F}))},onAbort:function(I,C,F){c.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,networkDetails:F}))},onTimeout:function(I,C,F){c.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,networkDetails:F}))},onProgress:function(I,C,F,w){f&&f({frag:i,part:null,payload:F,networkDetails:w})}})})},e.loadPart=function(i,f,c){var a=this;this.abort();var v=this.config,S=v.fLoader,x=v.loader;return new Promise(function(E,L){a.loader&&a.loader.destroy();var b=a.loader=i.loader=S?new S(v):new x(v),A=u(i,f),O={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:n};f.stats=b.stats,b.load(A,O,{onSuccess:function(I,C,F,w){a.resetLoader(i,b),a.updateStatsFromPart(i,f);var k={frag:i,part:f,payload:I.data,networkDetails:w};c(k),E(k)},onError:function(I,C,F){a.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:f,response:I,networkDetails:F}))},onAbort:function(I,C,F){i.stats.aborted=f.stats.aborted,a.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,part:f,networkDetails:F}))},onTimeout:function(I,C,F){a.resetLoader(i,b),L(new h({type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:f,networkDetails:F}))}})})},e.updateStatsFromPart=function(i,f){var c=i.stats,a=f.stats,v=a.total;if(c.loaded+=a.loaded,v){var S=Math.round(i.duration/f.duration),x=Math.min(Math.round(c.loaded/v),S),E=S-x,L=E*Math.round(c.loaded/x);c.total=c.loaded+L}else c.total=Math.max(c.loaded,c.total);var b=c.loading,A=a.loading;b.start?b.first+=A.first-A.start:(b.start=A.start,b.first=A.first),b.end=A.end},e.resetLoader=function(i,f){i.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},t}();function u(t,e){e===void 0&&(e=null);var s=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},f=s.byteRangeStartOffset,c=s.byteRangeEndOffset;return Object(T.isFiniteNumber)(f)&&Object(T.isFiniteNumber)(c)&&(i.rangeStart=f,i.rangeEnd=c),i}var h=function(t){m(e,t);function e(s){for(var i,f=arguments.length,c=new Array(f>1?f-1:0),a=1;a<f;a++)c[a-1]=arguments[a];return i=t.call.apply(t,[this].concat(c))||this,i.data=void 0,i.data=s,i}return e}(D(Error))},"./src/loader/fragment.ts":function(M,P,y){y.r(P),y.d(P,"ElementaryStreamTypes",function(){return n}),y.d(P,"BaseSegment",function(){return d}),y.d(P,"Fragment",function(){return u}),y.d(P,"Part",function(){return h});var T=y("./src/polyfills/number.ts"),p=y("./node_modules/url-toolkit/src/url-toolkit.js"),m=y("./src/utils/logger.ts"),D=y("./src/loader/level-key.ts"),_=y("./src/loader/load-stats.ts");function g(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,f){return i.__proto__=f,i},o(t,e)}function r(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,s){return e&&r(t.prototype,e),s&&r(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}var n;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(n||(n={}));var d=function(){function t(s){var i;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(i={},i[n.AUDIO]=null,i[n.VIDEO]=null,i[n.AUDIOVIDEO]=null,i),this.baseurl=s}var e=t.prototype;return e.setByteRange=function(i,f){var c=i.split("@",2),a=[];c.length===1?a[0]=f?f.byteRangeEndOffset:0:a[0]=parseInt(c[1]),a[1]=parseInt(c[0])+a[0],this._byteRange=a},l(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(p.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(i){this._url=i}}]),t}(),u=function(t){g(e,t);function e(i,f){var c;return c=t.call(this,f)||this,c._decryptdata=null,c.rawProgramDateTime=null,c.programDateTime=null,c.tagList=[],c.duration=0,c.sn=0,c.levelkey=void 0,c.type=void 0,c.loader=null,c.level=-1,c.cc=0,c.startPTS=void 0,c.endPTS=void 0,c.appendedPTS=void 0,c.startDTS=void 0,c.endDTS=void 0,c.start=0,c.deltaPTS=void 0,c.maxStartPTS=void 0,c.minEndPTS=void 0,c.stats=new _.LoadStats,c.urlId=0,c.data=void 0,c.bitrateTest=!1,c.title=null,c.initSegment=null,c.type=i,c}var s=e.prototype;return s.createInitializationVector=function(f){for(var c=new Uint8Array(16),a=12;a<16;a++)c[a]=f>>8*(15-a)&255;return c},s.setDecryptDataFromLevelKey=function(f,c){var a=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(a=D.LevelKey.fromURI(f.uri),a.method=f.method,a.iv=this.createInitializationVector(c),a.keyFormat="identity"),a},s.setElementaryStreamInfo=function(f,c,a,v,S,x){x===void 0&&(x=!1);var E=this.elementaryStreams,L=E[f];if(!L){E[f]={startPTS:c,endPTS:a,startDTS:v,endDTS:S,partial:x};return}L.startPTS=Math.min(L.startPTS,c),L.endPTS=Math.max(L.endPTS,a),L.startDTS=Math.min(L.startDTS,v),L.endDTS=Math.max(L.endDTS,S)},s.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[n.AUDIO]=null,f[n.VIDEO]=null,f[n.AUDIOVIDEO]=null},l(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&m.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(T.isFiniteNumber)(this.programDateTime))return null;var f=Object(T.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),e}(d),h=function(t){g(e,t);function e(s,i,f,c,a){var v;v=t.call(this,f)||this,v.fragOffset=0,v.duration=0,v.gap=!1,v.independent=!1,v.relurl=void 0,v.fragment=void 0,v.index=void 0,v.stats=new _.LoadStats,v.duration=s.decimalFloatingPoint("DURATION"),v.gap=s.bool("GAP"),v.independent=s.bool("INDEPENDENT"),v.relurl=s.enumeratedString("URI"),v.fragment=i,v.index=c;var S=s.enumeratedString("BYTERANGE");return S&&v.setByteRange(S,a),a&&(v.fragOffset=a.fragOffset+a.duration),v}return l(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var i=this.elementaryStreams;return!!(i.audio||i.video||i.audiovideo)}}]),e}(d)},"./src/loader/key-loader.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return D});var T=y("./src/events.ts"),p=y("./src/errors.ts"),m=y("./src/utils/logger.ts"),D=function(){function _(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this.registerListeners()}var g=_.prototype;return g.startLoad=function(r){},g.stopLoad=function(){this.destroyInternalLoaders()},g.registerListeners=function(){this.hls.on(T.Events.KEY_LOADING,this.onKeyLoading,this)},g.unregisterListeners=function(){this.hls.off(T.Events.KEY_LOADING,this.onKeyLoading)},g.destroyInternalLoaders=function(){for(var r in this.loaders){var l=this.loaders[r];l&&l.destroy()}this.loaders={}},g.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},g.onKeyLoading=function(r,l){var n=l.frag,d=n.type,u=this.loaders[d];if(!n.decryptdata){m.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var h=n.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var t=this.hls.config;if(u&&(m.logger.warn("abort previous key loader for type:"+d),u.abort()),!h){m.logger.warn("key uri is falsy");return}var e=t.loader,s=n.loader=this.loaders[d]=new e(t);this.decrypturl=h,this.decryptkey=null;var i={url:h,frag:n,responseType:"arraybuffer"},f={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};s.load(i,f,c)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(T.Events.KEY_LOADED,{frag:n}))},g.loadsuccess=function(r,l,n){var d=n.frag;if(!d.decryptdata){m.logger.error("after key load, decryptdata unset");return}this.decryptkey=d.decryptdata.key=new Uint8Array(r.data),d.loader=null,delete this.loaders[d.type],this.hls.trigger(T.Events.KEY_LOADED,{frag:d})},g.loaderror=function(r,l){var n=l.frag,d=n.loader;d&&d.abort(),delete this.loaders[n.type],this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:r})},g.loadtimeout=function(r,l){var n=l.frag,d=n.loader;d&&d.abort(),delete this.loaders[n.type],this.hls.trigger(T.Events.ERROR,{type:p.ErrorTypes.NETWORK_ERROR,details:p.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},_}()},"./src/loader/level-details.ts":function(M,P,y){y.r(P),y.d(P,"LevelDetails",function(){return _});var T=y("./src/polyfills/number.ts");function p(g,o){for(var r=0;r<o.length;r++){var l=o[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function m(g,o,r){return o&&p(g.prototype,o),r&&p(g,r),Object.defineProperty(g,"prototype",{writable:!1}),g}var D=10,_=function(){function g(r){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=r}var o=g.prototype;return o.reloaded=function(l){if(!l){this.advanced=!0,this.updated=!0;return}var n=this.lastPartSn-l.lastPartSn,d=this.lastPartIndex-l.lastPartIndex;this.updated=this.endSN!==l.endSN||!!d||!!n,this.advanced=this.endSN>l.endSN||n>0||n===0&&d>0,this.updated||this.advanced?this.misses=Math.floor(l.misses*.6):this.misses=l.misses+1,this.availabilityDelay=l.availabilityDelay},m(g,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(T.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||D}},{key:"drift",get:function(){var l=this.driftEndTime-this.driftStartTime;if(l>0){var n=this.driftEnd-this.driftStart;return n*1e3/l}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var l;return(l=this.fragments)!==null&&l!==void 0&&l.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var l;return(l=this.partList)!==null&&l!==void 0&&l.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),g}()},"./src/loader/level-key.ts":function(M,P,y){y.r(P),y.d(P,"LevelKey",function(){return D});var T=y("./node_modules/url-toolkit/src/url-toolkit.js");function p(_,g){for(var o=0;o<g.length;o++){var r=g[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(_,r.key,r)}}function m(_,g,o){return g&&p(_.prototype,g),o&&p(_,o),Object.defineProperty(_,"prototype",{writable:!1}),_}var D=function(){_.fromURL=function(o,r){return new _(o,r)},_.fromURI=function(o){return new _(o)};function _(g,o){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,o?this._uri=Object(T.buildAbsoluteURL)(g,o,{alwaysNormalize:!0}):this._uri=g}return m(_,[{key:"uri",get:function(){return this._uri}}]),_}()},"./src/loader/load-stats.ts":function(M,P,y){y.r(P),y.d(P,"LoadStats",function(){return T});var T=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return s});var T=y("./src/polyfills/number.ts"),p=y("./node_modules/url-toolkit/src/url-toolkit.js"),m=y("./src/loader/date-range.ts"),D=y("./src/loader/fragment.ts"),_=y("./src/loader/level-details.ts"),g=y("./src/loader/level-key.ts"),o=y("./src/utils/attr-list.ts"),r=y("./src/utils/logger.ts"),l=y("./src/utils/codecs.ts"),n=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,u=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),h=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),t=/\.(mp4|m4s|m4v|m4a)$/i;function e(S){var x,E;return t.test((x=(E=p.parseURL(S))===null||E===void 0?void 0:E.path)!=null?x:"")}var s=function(){function S(){}return S.findGroup=function(E,L){for(var b=0;b<E.length;b++){var A=E[b];if(A.id===L)return A}},S.convertAVC1ToAVCOTI=function(E){var L=E.split(".");if(L.length>2){var b=L.shift()+".";return b+=parseInt(L.shift()).toString(16),b+=("000"+parseInt(L.shift()).toString(16)).slice(-4),b}return E},S.resolve=function(E,L){return p.buildAbsoluteURL(L,E,{alwaysNormalize:!0})},S.parseMasterPlaylist=function(E,L){var b=[],A={},O=!1;n.lastIndex=0;for(var R;(R=n.exec(E))!=null;)if(R[1]){var I=new o.AttrList(R[1]),C={attrs:I,bitrate:I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),name:I.NAME,url:S.resolve(R[2],L)},F=I.decimalResolution("RESOLUTION");F&&(C.width=F.width,C.height=F.height),i((I.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),C),C.videoCodec&&C.videoCodec.indexOf("avc1")!==-1&&(C.videoCodec=S.convertAVC1ToAVCOTI(C.videoCodec)),b.push(C)}else if(R[3]){var w=new o.AttrList(R[3]);w["DATA-ID"]&&(O=!0,A[w["DATA-ID"]]=w)}return{levels:b,sessionData:O?A:null}},S.parseMasterPlaylistMedia=function(E,L,b,A){A===void 0&&(A=[]);var O,R=[],I=0;for(d.lastIndex=0;(O=d.exec(E))!==null;){var C=new o.AttrList(O[1]);if(C.TYPE===b){var F={attrs:C,bitrate:0,id:I++,groupId:C["GROUP-ID"],instreamId:C["INSTREAM-ID"],name:C.NAME||C.LANGUAGE||"",type:b,default:C.bool("DEFAULT"),autoselect:C.bool("AUTOSELECT"),forced:C.bool("FORCED"),lang:C.LANGUAGE,url:C.URI?S.resolve(C.URI,L):""};if(A.length){var w=S.findGroup(A,F.groupId)||A[0];f(F,w,"audioCodec"),f(F,w,"textCodec")}R.push(F)}}return R},S.parseLevelPlaylist=function(E,L,b,A,O){var R=new _.LevelDetails(L),I=R.fragments,C=null,F=0,w=0,k=0,B=0,U=null,N=new D.Fragment(A,L),j,K,V,H=-1,Y=!1;for(u.lastIndex=0,R.m3u8=E;(j=u.exec(E))!==null;){Y&&(Y=!1,N=new D.Fragment(A,L),N.start=k,N.sn=F,N.cc=B,N.level=b,C&&(N.initSegment=C,N.rawProgramDateTime=C.rawProgramDateTime,C.rawProgramDateTime=null));var q=j[1];if(q){N.duration=parseFloat(q);var $=(" "+j[2]).slice(1);N.title=$||null,N.tagList.push($?["INF",q,$]:["INF",q])}else if(j[3])Object(T.isFiniteNumber)(N.duration)&&(N.start=k,V&&(N.levelkey=V),N.sn=F,N.level=b,N.cc=B,N.urlId=O,I.push(N),N.relurl=(" "+j[3]).slice(1),a(N,U),U=N,k+=N.duration,F++,w=0,Y=!0);else if(j[4]){var G=(" "+j[4]).slice(1);U?N.setByteRange(G,U):N.setByteRange(G)}else if(j[5])N.rawProgramDateTime=(" "+j[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),H===-1&&(H=I.length);else{if(j=j[0].match(h),!j){r.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<j.length&&!(typeof j[K]<"u");K++);var re=(" "+j[K]).slice(1),Q=(" "+j[K+1]).slice(1),ee=j[K+2]?(" "+j[K+2]).slice(1):"";switch(re){case"PLAYLIST-TYPE":R.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":F=R.startSN=parseInt(Q);break;case"SKIP":{var se=new o.AttrList(Q),ae=se.decimalInteger("SKIPPED-SEGMENTS");if(Object(T.isFiniteNumber)(ae)){R.skippedSegments=ae;for(var oe=ae;oe--;)I.unshift(null);F+=ae}var fe=se.enumeratedString("RECENTLY-REMOVED-DATERANGES");fe&&(R.recentlyRemovedDateranges=fe.split("	"));break}case"TARGETDURATION":R.targetduration=parseFloat(Q);break;case"VERSION":R.version=parseInt(Q);break;case"EXTM3U":break;case"ENDLIST":R.live=!1;break;case"#":(Q||ee)&&N.tagList.push(ee?[Q,ee]:[Q]);break;case"DISCONTINUITY":B++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([re]);break;case"BITRATE":N.tagList.push([re,Q]);break;case"DATERANGE":{var te=new o.AttrList(Q),le=new m.DateRange(te,R.dateRanges[te.ID]);le.isValid||R.skippedSegments?R.dateRanges[le.id]=le:r.logger.warn('Ignoring invalid DATERANGE tag: "'+Q+'"'),N.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt(Q);break;case"KEY":{var de,ce=new o.AttrList(Q),he=ce.enumeratedString("METHOD"),ve=ce.URI,me=ce.hexadecimalInteger("IV"),ue=ce.enumeratedString("KEYFORMATVERSIONS"),ge=ce.enumeratedString("KEYID"),W=(de=ce.enumeratedString("KEYFORMAT"))!=null?de:"identity",z=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(z.indexOf(W)>-1){r.logger.warn("Keyformat "+W+" is not supported from the manifest");continue}else if(W!=="identity")continue;he&&(V=g.LevelKey.fromURL(L,ve),ve&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(he)>=0&&(V.method=he,V.keyFormat=W,ge&&(V.keyID=ge),ue&&(V.keyFormatVersions=ue),V.iv=me));break}case"START":{var X=new o.AttrList(Q),J=X.decimalFloatingPoint("TIME-OFFSET");Object(T.isFiniteNumber)(J)&&(R.startTimeOffset=J);break}case"MAP":{var ie=new o.AttrList(Q);if(N.duration){var ne=new D.Fragment(A,L);v(ne,ie,b,V),C=ne,N.initSegment=C,C.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=C.rawProgramDateTime)}else v(N,ie,b,V),C=N,Y=!0;break}case"SERVER-CONTROL":{var Z=new o.AttrList(Q);R.canBlockReload=Z.bool("CAN-BLOCK-RELOAD"),R.canSkipUntil=Z.optionalFloat("CAN-SKIP-UNTIL",0),R.canSkipDateRanges=R.canSkipUntil>0&&Z.bool("CAN-SKIP-DATERANGES"),R.partHoldBack=Z.optionalFloat("PART-HOLD-BACK",0),R.holdBack=Z.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var pe=new o.AttrList(Q);R.partTarget=pe.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ye=R.partList;ye||(ye=R.partList=[]);var xe=w>0?ye[ye.length-1]:void 0,_e=w++,Ie=new D.Part(new o.AttrList(Q),N,L,_e,xe);ye.push(Ie),N.duration+=Ie.duration;break}case"PRELOAD-HINT":{var be=new o.AttrList(Q);R.preloadHint=be;break}case"RENDITION-REPORT":{var Be=new o.AttrList(Q);R.renditionReports=R.renditionReports||[],R.renditionReports.push(Be);break}default:r.logger.warn("line parsed but not handled: "+j);break}}}U&&!U.relurl?(I.pop(),k-=U.duration,R.partList&&(R.fragmentHint=U)):R.partList&&(a(N,U),N.cc=B,R.fragmentHint=N);var Ae=I.length,Le=I[0],Me=I[Ae-1];if(k+=R.skippedSegments*R.targetduration,k>0&&Ae&&Me){R.averagetargetduration=k/Ae;var De=Me.sn;R.endSN=De!=="initSegment"?De:0,Le&&(R.startCC=Le.cc,Le.initSegment||R.fragments.every(function(Ce){return Ce.relurl&&e(Ce.relurl)})&&(r.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new D.Fragment(A,L),N.relurl=Me.relurl,N.level=b,N.sn="initSegment",Le.initSegment=N,R.needSidxRanges=!0))}else R.endSN=0,R.startCC=0;return R.fragmentHint&&(k+=R.fragmentHint.duration),R.totalduration=k,R.endCC=B,H>0&&c(I,H),R},S}();function i(S,x){["video","audio","text"].forEach(function(E){var L=S.filter(function(A){return Object(l.isCodecType)(A,E)});if(L.length){var b=L.filter(function(A){return A.lastIndexOf("avc1",0)===0||A.lastIndexOf("mp4a",0)===0});x[E+"Codec"]=b.length>0?b[0]:L[0],S=S.filter(function(A){return L.indexOf(A)===-1})}}),x.unknownCodecs=S}function f(S,x,E){var L=x[E];L&&(S[E]=L)}function c(S,x){for(var E=S[x],L=x;L--;){var b=S[L];if(!b)return;b.programDateTime=E.programDateTime-b.duration*1e3,E=b}}function a(S,x){S.rawProgramDateTime?S.programDateTime=Date.parse(S.rawProgramDateTime):x!=null&&x.programDateTime&&(S.programDateTime=x.endProgramDateTime),Object(T.isFiniteNumber)(S.programDateTime)||(S.programDateTime=null,S.rawProgramDateTime=null)}function v(S,x,E,L){S.relurl=x.URI,x.BYTERANGE&&S.setByteRange(x.BYTERANGE),S.level=E,S.sn="initSegment",L&&(S.levelkey=L),S.initSegment=null}},"./src/loader/playlist-loader.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/events.ts"),m=y("./src/errors.ts"),D=y("./src/utils/logger.ts"),_=y("./src/utils/mp4-tools.ts"),g=y("./src/loader/m3u8-parser.ts"),o=y("./src/types/loader.ts"),r=y("./src/utils/attr-list.ts");function l(u){var h=u.type;switch(h){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}function n(u,h){var t=u.url;return(t===void 0||t.indexOf("data:")===0)&&(t=h.url),t}var d=function(){function u(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var h=u.prototype;return h.startLoad=function(e){},h.stopLoad=function(){this.destroyInternalLoaders()},h.registerListeners=function(){var e=this.hls;e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(p.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.unregisterListeners=function(){var e=this.hls;e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(p.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(p.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.createInternalLoader=function(e){var s=this.hls.config,i=s.pLoader,f=s.loader,c=i||f,a=new c(s);return e.loader=a,this.loaders[e.type]=a,a},h.getInternalLoader=function(e){return this.loaders[e.type]},h.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},h.destroyInternalLoaders=function(){for(var e in this.loaders){var s=this.loaders[e];s&&s.destroy(),this.resetInternalLoader(e)}},h.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},h.onManifestLoading=function(e,s){var i=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},h.onLevelLoading=function(e,s){var i=s.id,f=s.level,c=s.url,a=s.deliveryDirectives;this.load({id:i,groupId:null,level:f,responseType:"text",type:o.PlaylistContextType.LEVEL,url:c,deliveryDirectives:a})},h.onAudioTrackLoading=function(e,s){var i=s.id,f=s.groupId,c=s.url,a=s.deliveryDirectives;this.load({id:i,groupId:f,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:c,deliveryDirectives:a})},h.onSubtitleTrackLoading=function(e,s){var i=s.id,f=s.groupId,c=s.url,a=s.deliveryDirectives;this.load({id:i,groupId:f,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:c,deliveryDirectives:a})},h.load=function(e){var s,i=this.hls.config,f=this.getInternalLoader(e);if(f){var c=f.context;if(c&&c.url===e.url){D.logger.trace("[playlist-loader]: playlist request ongoing");return}D.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}var a,v,S,x;switch(e.type){case o.PlaylistContextType.MANIFEST:a=i.manifestLoadingMaxRetry,v=i.manifestLoadingTimeOut,S=i.manifestLoadingRetryDelay,x=i.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:a=0,v=i.levelLoadingTimeOut;break;default:a=i.levelLoadingMaxRetry,v=i.levelLoadingTimeOut,S=i.levelLoadingRetryDelay,x=i.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(e),(s=e.deliveryDirectives)!==null&&s!==void 0&&s.part){var E;if(e.type===o.PlaylistContextType.LEVEL&&e.level!==null?E=this.hls.levels[e.level].details:e.type===o.PlaylistContextType.AUDIO_TRACK&&e.id!==null?E=this.hls.audioTracks[e.id].details:e.type===o.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(E=this.hls.subtitleTracks[e.id].details),E){var L=E.partTarget,b=E.targetduration;L&&b&&(v=Math.min(Math.max(L*3,b*.8)*1e3,v))}}var A={timeout:v,maxRetry:a,retryDelay:S,maxRetryDelay:x,highWaterMark:0},O={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,A,O)},h.loadsuccess=function(e,s,i,f){if(f===void 0&&(f=null),i.isSidxRequest){this.handleSidxRequest(e,i),this.handlePlaylistLoaded(e,s,i,f);return}this.resetInternalLoader(i.type);var c=e.data;if(c.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,i,"no EXTM3U delimiter",f);return}s.parsing.start=performance.now(),c.indexOf("#EXTINF:")>0||c.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,s,i,f):this.handleMasterPlaylist(e,s,i,f)},h.loaderror=function(e,s,i){i===void 0&&(i=null),this.handleNetworkError(s,i,!1,e)},h.loadtimeout=function(e,s,i){i===void 0&&(i=null),this.handleNetworkError(s,i,!0)},h.handleMasterPlaylist=function(e,s,i,f){var c=this.hls,a=e.data,v=n(e,i),S=g.default.parseMasterPlaylist(a,v),x=S.levels,E=S.sessionData;if(!x.length){this.handleManifestParsingError(e,i,"no level found in manifest",f);return}var L=x.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),b=x.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),A=g.default.parseMasterPlaylistMedia(a,v,"AUDIO",L),O=g.default.parseMasterPlaylistMedia(a,v,"SUBTITLES",b),R=g.default.parseMasterPlaylistMedia(a,v,"CLOSED-CAPTIONS");if(A.length){var I=A.some(function(C){return!C.url});!I&&x[0].audioCodec&&!x[0].attrs.AUDIO&&(D.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new r.AttrList({}),bitrate:0,url:""}))}c.trigger(p.Events.MANIFEST_LOADED,{levels:x,audioTracks:A,subtitles:O,captions:R,url:v,stats:s,networkDetails:f,sessionData:E})},h.handleTrackOrLevelPlaylist=function(e,s,i,f){var c=this.hls,a=i.id,v=i.level,S=i.type,x=n(e,i),E=Object(T.isFiniteNumber)(a)?a:0,L=Object(T.isFiniteNumber)(v)?v:E,b=l(i),A=g.default.parseLevelPlaylist(e.data,x,L,b,E);if(!A.fragments.length){c.trigger(p.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:x,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0});return}if(S===o.PlaylistContextType.MANIFEST){var O={attrs:new r.AttrList({}),bitrate:0,details:A,name:"",url:x};c.trigger(p.Events.MANIFEST_LOADED,{levels:[O],audioTracks:[],url:x,stats:s,networkDetails:f,sessionData:null})}if(s.parsing.end=performance.now(),A.needSidxRanges){var R,I=(R=A.fragments[0].initSegment)===null||R===void 0?void 0:R.url;this.load({url:I,isSidxRequest:!0,type:S,level:v,levelDetails:A,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}i.levelDetails=A,this.handlePlaylistLoaded(e,s,i,f)},h.handleSidxRequest=function(e,s){var i=new Uint8Array(e.data),f=Object(_.findBox)(i,["sidx"])[0];if(!!f){var c=Object(_.parseSegmentIndex)(f);if(!!c){var a=c.references,v=s.levelDetails;a.forEach(function(S,x){var E=S.info,L=v.fragments[x];if(L.byteRange.length===0&&L.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),L.initSegment){var b=Object(_.findBox)(i,["moov"])[0],A=b?b.length:null;L.initSegment.setByteRange(String(A)+"@0")}})}}},h.handleManifestParsingError=function(e,s,i,f){this.hls.trigger(p.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===o.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:s,networkDetails:f})},h.handleNetworkError=function(e,s,i,f){i===void 0&&(i=!1),D.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var c=m.ErrorDetails.UNKNOWN,a=!1,v=this.getInternalLoader(e);switch(e.type){case o.PlaylistContextType.MANIFEST:c=i?m.ErrorDetails.MANIFEST_LOAD_TIMEOUT:m.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case o.PlaylistContextType.LEVEL:c=i?m.ErrorDetails.LEVEL_LOAD_TIMEOUT:m.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case o.PlaylistContextType.AUDIO_TRACK:c=i?m.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:m.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:c=i?m.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:m.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}v&&this.resetInternalLoader(e.type);var S={type:m.ErrorTypes.NETWORK_ERROR,details:c,fatal:a,url:e.url,loader:v,context:e,networkDetails:s};f&&(S.response=f),this.hls.trigger(p.Events.ERROR,S)},h.handlePlaylistLoaded=function(e,s,i,f){var c=i.type,a=i.level,v=i.id,S=i.groupId,x=i.loader,E=i.levelDetails,L=i.deliveryDirectives;if(!(E!=null&&E.targetduration)){this.handleManifestParsingError(e,i,"invalid target duration",f);return}if(!!x)switch(E.live&&(x.getCacheAge&&(E.ageHeader=x.getCacheAge()||0),(!x.getCacheAge||isNaN(E.ageHeader))&&(E.ageHeader=0)),c){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(p.Events.LEVEL_LOADED,{details:E,level:a||0,id:v||0,stats:s,networkDetails:f,deliveryDirectives:L});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(p.Events.AUDIO_TRACK_LOADED,{details:E,id:v||0,groupId:S||"",stats:s,networkDetails:f,deliveryDirectives:L});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(p.Events.SUBTITLE_TRACK_LOADED,{details:E,id:v||0,groupId:S||"",stats:s,networkDetails:f,deliveryDirectives:L});break}},u}();P.default=d},"./src/polyfills/number.ts":function(M,P,y){y.r(P),y.d(P,"isFiniteNumber",function(){return T}),y.d(P,"MAX_SAFE_INTEGER",function(){return p});var T=Number.isFinite||function(m){return typeof m=="number"&&isFinite(m)},p=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(M,P,y){y.r(P);var T=function(){function p(){}return p.getSilentFrame=function(D,_){switch(D){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},p}();P.default=T},"./src/remux/mp4-generator.ts":function(M,P,y){y.r(P);var T=Math.pow(2,32)-1,p=function(){function m(){}return m.init=function(){m.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var _;for(_ in m.types)m.types.hasOwnProperty(_)&&(m.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var g=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);m.HDLR_TYPES={video:g,audio:o};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);m.STTS=m.STSC=m.STCO=l,m.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),m.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),m.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),m.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);m.FTYP=m.box(m.types.ftyp,n,u,n,d),m.DINF=m.box(m.types.dinf,m.box(m.types.dref,r))},m.box=function(_){for(var g=8,o=arguments.length,r=new Array(o>1?o-1:0),l=1;l<o;l++)r[l-1]=arguments[l];for(var n=r.length,d=n;n--;)g+=r[n].byteLength;var u=new Uint8Array(g);for(u[0]=g>>24&255,u[1]=g>>16&255,u[2]=g>>8&255,u[3]=g&255,u.set(_,4),n=0,g=8;n<d;n++)u.set(r[n],g),g+=r[n].byteLength;return u},m.hdlr=function(_){return m.box(m.types.hdlr,m.HDLR_TYPES[_])},m.mdat=function(_){return m.box(m.types.mdat,_)},m.mdhd=function(_,g){g*=_;var o=Math.floor(g/(T+1)),r=Math.floor(g%(T+1));return m.box(m.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,o>>24,o>>16&255,o>>8&255,o&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))},m.mdia=function(_){return m.box(m.types.mdia,m.mdhd(_.timescale,_.duration),m.hdlr(_.type),m.minf(_))},m.mfhd=function(_){return m.box(m.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255]))},m.minf=function(_){return _.type==="audio"?m.box(m.types.minf,m.box(m.types.smhd,m.SMHD),m.DINF,m.stbl(_)):m.box(m.types.minf,m.box(m.types.vmhd,m.VMHD),m.DINF,m.stbl(_))},m.moof=function(_,g,o){return m.box(m.types.moof,m.mfhd(_),m.traf(o,g))},m.moov=function(_){for(var g=_.length,o=[];g--;)o[g]=m.trak(_[g]);return m.box.apply(null,[m.types.moov,m.mvhd(_[0].timescale,_[0].duration)].concat(o).concat(m.mvex(_)))},m.mvex=function(_){for(var g=_.length,o=[];g--;)o[g]=m.trex(_[g]);return m.box.apply(null,[m.types.mvex].concat(o))},m.mvhd=function(_,g){g*=_;var o=Math.floor(g/(T+1)),r=Math.floor(g%(T+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,o>>24,o>>16&255,o>>8&255,o&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return m.box(m.types.mvhd,l)},m.sdtp=function(_){var g=_.samples||[],o=new Uint8Array(4+g.length),r,l;for(r=0;r<g.length;r++)l=g[r].flags,o[r+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return m.box(m.types.sdtp,o)},m.stbl=function(_){return m.box(m.types.stbl,m.stsd(_),m.box(m.types.stts,m.STTS),m.box(m.types.stsc,m.STSC),m.box(m.types.stsz,m.STSZ),m.box(m.types.stco,m.STCO))},m.avc1=function(_){var g=[],o=[],r,l,n;for(r=0;r<_.sps.length;r++)l=_.sps[r],n=l.byteLength,g.push(n>>>8&255),g.push(n&255),g=g.concat(Array.prototype.slice.call(l));for(r=0;r<_.pps.length;r++)l=_.pps[r],n=l.byteLength,o.push(n>>>8&255),o.push(n&255),o=o.concat(Array.prototype.slice.call(l));var d=m.box(m.types.avcC,new Uint8Array([1,g[3],g[4],g[5],255,224|_.sps.length].concat(g).concat([_.pps.length]).concat(o))),u=_.width,h=_.height,t=_.pixelRatio[0],e=_.pixelRatio[1];return m.box(m.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,m.box(m.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),m.box(m.types.pasp,new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255,e>>24,e>>16&255,e>>8&255,e&255])))},m.esds=function(_){var g=_.config.length;return new Uint8Array([0,0,0,0,3,23+g,0,1,0,4,15+g,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([g]).concat(_.config).concat([6,1,2]))},m.mp4a=function(_){var g=_.samplerate;return m.box(m.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]),m.box(m.types.esds,m.esds(_)))},m.mp3=function(_){var g=_.samplerate;return m.box(m.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]))},m.stsd=function(_){return _.type==="audio"?_.segmentCodec==="mp3"&&_.codec==="mp3"?m.box(m.types.stsd,m.STSD,m.mp3(_)):m.box(m.types.stsd,m.STSD,m.mp4a(_)):m.box(m.types.stsd,m.STSD,m.avc1(_))},m.tkhd=function(_){var g=_.id,o=_.duration*_.timescale,r=_.width,l=_.height,n=Math.floor(o/(T+1)),d=Math.floor(o%(T+1));return m.box(m.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,l>>8&255,l&255,0,0]))},m.traf=function(_,g){var o=m.sdtp(_),r=_.id,l=Math.floor(g/(T+1)),n=Math.floor(g%(T+1));return m.box(m.types.traf,m.box(m.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),m.box(m.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,n>>24,n>>16&255,n>>8&255,n&255])),m.trun(_,o.length+16+20+8+16+8+8),o)},m.trak=function(_){return _.duration=_.duration||4294967295,m.box(m.types.trak,m.tkhd(_),m.mdia(_))},m.trex=function(_){var g=_.id;return m.box(m.types.trex,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},m.trun=function(_,g){var o=_.samples||[],r=o.length,l=12+16*r,n=new Uint8Array(l),d,u,h,t,e,s;for(g+=8+l,n.set([_.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255],0),d=0;d<r;d++)u=o[d],h=u.duration,t=u.size,e=u.flags,s=u.cts,n.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,s>>>24&255,s>>>16&255,s>>>8&255,s&255],12+16*d);return m.box(m.types.trun,n)},m.initSegment=function(_){m.types||m.init();var g=m.moov(_),o=new Uint8Array(m.FTYP.byteLength+g.byteLength);return o.set(m.FTYP),o.set(g,m.FTYP.byteLength),o},m}();p.types=void 0,p.HDLR_TYPES=void 0,p.STTS=void 0,p.STSC=void 0,p.STCO=void 0,p.STSZ=void 0,p.VMHD=void 0,p.SMHD=void 0,p.STSD=void 0,p.FTYP=void 0,p.DINF=void 0,P.default=p},"./src/remux/mp4-remuxer.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return e}),y.d(P,"normalizePts",function(){return s}),y.d(P,"flushTextTrackMetadataCueSamples",function(){return f}),y.d(P,"flushTextTrackUserdataCueSamples",function(){return c});var T=y("./src/polyfills/number.ts"),p=y("./src/remux/aac-helper.ts"),m=y("./src/remux/mp4-generator.ts"),D=y("./src/events.ts"),_=y("./src/errors.ts"),g=y("./src/utils/logger.ts"),o=y("./src/types/loader.ts"),r=y("./src/utils/timescale-conversion.ts");function l(){return l=Object.assign?Object.assign.bind():function(S){for(var x=1;x<arguments.length;x++){var E=arguments[x];for(var L in E)Object.prototype.hasOwnProperty.call(E,L)&&(S[L]=E[L])}return S},l.apply(this,arguments)}var n=10*1e3,d=1024,u=1152,h=null,t=null,e=function(){function S(E,L,b,A){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=E,this.config=L,this.typeSupported=b,this.ISGenerated=!1,h===null){var O=navigator.userAgent||"",R=O.match(/Chrome\/(\d+)/i);h=R?parseInt(R[1]):0}if(t===null){var I=navigator.userAgent.match(/Safari\/(\d+)/i);t=I?parseInt(I[1]):0}}var x=S.prototype;return x.destroy=function(){},x.resetTimeStamp=function(L){g.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=L},x.resetNextTimestamp=function(){g.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},x.resetInitSegment=function(){g.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},x.getVideoStartPts=function(L){var b=!1,A=L.reduce(function(O,R){var I=R.pts-O;return I<-4294967296?(b=!0,s(O,R.pts)):I>0?O:R.pts},L[0].pts);return b&&g.logger.debug("PTS rollover detected"),A},x.remux=function(L,b,A,O,R,I,C,F){var w,k,B,U,N,j,K=R,V=R,H=L.pid>-1,Y=b.pid>-1,q=b.samples.length,$=L.samples.length>0,G=C&&q>0||q>1,re=(!H||$)&&(!Y||G)||this.ISGenerated||C;if(re){this.ISGenerated||(B=this.generateIS(L,b,R));var Q=this.isVideoContiguous,ee=-1,se;if(G&&(ee=i(b.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(j=!0,ee>0){g.logger.warn("[mp4-remuxer]: Dropped "+ee+" out of "+q+" video samples due to a missing keyframe");var ae=this.getVideoStartPts(b.samples);b.samples=b.samples.slice(ee),b.dropped+=ee,V+=(b.samples[0].pts-ae)/b.inputTimeScale,se=V}else ee===-1&&(g.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),j=!1);if(this.ISGenerated){if($&&G){var oe=this.getVideoStartPts(b.samples),fe=s(L.samples[0].pts,oe)-oe,te=fe/b.inputTimeScale;K+=Math.max(0,te),V+=Math.max(0,-te)}if($){if(L.samplerate||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),B=this.generateIS(L,b,R)),k=this.remuxAudio(L,K,this.isAudioContiguous,I,Y||G||F===o.PlaylistLevelType.AUDIO?V:void 0),G){var le=k?k.endPTS-k.startPTS:0;b.inputTimeScale||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),B=this.generateIS(L,b,R)),w=this.remuxVideo(b,V,Q,le)}}else G&&(w=this.remuxVideo(b,V,Q,0));w&&(w.firstKeyFrame=ee,w.independent=ee!==-1,w.firstKeyFramePTS=se)}}return this.ISGenerated&&(A.samples.length&&(N=f(A,R,this._initPTS,this._initDTS)),O.samples.length&&(U=c(O,R,this._initPTS))),{audio:k,video:w,initSegment:B,independent:j,text:U,id3:N}},x.generateIS=function(L,b,A){var O=L.samples,R=b.samples,I=this.typeSupported,C={},F=!Object(T.isFiniteNumber)(this._initPTS),w="audio/mp4",k,B,U;if(F&&(k=B=1/0),L.config&&O.length){switch(L.timescale=L.samplerate,L.segmentCodec){case"mp3":I.mpeg?(w="audio/mpeg",L.codec=""):I.mp3&&(L.codec="mp3");break}C.audio={id:"audio",container:w,codec:L.codec,initSegment:L.segmentCodec==="mp3"&&I.mpeg?new Uint8Array(0):m.default.initSegment([L]),metadata:{channelCount:L.channelCount}},F&&(U=L.inputTimeScale,k=B=O[0].pts-Math.round(U*A))}if(b.sps&&b.pps&&R.length&&(b.timescale=b.inputTimeScale,C.video={id:"main",container:"video/mp4",codec:b.codec,initSegment:m.default.initSegment([b]),metadata:{width:b.width,height:b.height}},F)){U=b.inputTimeScale;var N=this.getVideoStartPts(R),j=Math.round(U*A);B=Math.min(B,s(R[0].dts,N)-j),k=Math.min(k,N-j)}if(Object.keys(C).length)return this.ISGenerated=!0,F&&(this._initPTS=k,this._initDTS=B),{tracks:C,initPTS:k,timescale:U}},x.remuxVideo=function(L,b,A,O){var R=L.inputTimeScale,I=L.samples,C=[],F=I.length,w=this._initPTS,k=this.nextAvcDts,B=8,U=this.videoSampleDuration,N,j,K=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,H=!1;if(!A||k===null){var Y=b*R,q=I[0].pts-s(I[0].dts,I[0].pts);k=Y-q}for(var $=0;$<F;$++){var G=I[$];G.pts=s(G.pts-w,k),G.dts=s(G.dts-w,k),G.dts<I[$>0?$-1:$].dts&&(H=!0)}H&&I.sort(function(je,He){var it=je.dts-He.dts,nt=je.pts-He.pts;return it||nt}),N=I[0].dts,j=I[I.length-1].dts;var re=j-N,Q=re?Math.round(re/(F-1)):U||L.inputTimeScale/30;if(A){var ee=N-k,se=ee>Q,ae=ee<-1;if(se||ae){se?g.logger.warn("AVC: "+Object(r.toMsFromMpegTsClock)(ee,!0)+" ms ("+ee+"dts) hole between fragments detected, filling it"):g.logger.warn("AVC: "+Object(r.toMsFromMpegTsClock)(-ee,!0)+" ms ("+ee+"dts) overlapping between fragments detected"),N=k;var oe=I[0].pts-ee;I[0].dts=N,I[0].pts=oe,g.logger.log("Video: First PTS/DTS adjusted: "+Object(r.toMsFromMpegTsClock)(oe,!0)+"/"+Object(r.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(r.toMsFromMpegTsClock)(ee,!0)+" ms")}}N=Math.max(0,N);for(var fe=0,te=0,le=0;le<F;le++){for(var de=I[le],ce=de.units,he=ce.length,ve=0,me=0;me<he;me++)ve+=ce[me].data.length;te+=ve,fe+=he,de.length=ve,de.dts=Math.max(de.dts,N),K=Math.min(de.pts,K),V=Math.max(de.pts,V)}j=I[F-1].dts;var ue=te+4*fe+8,ge;try{ge=new Uint8Array(ue)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ue,reason:"fail allocating video mdat "+ue});return}var W=new DataView(ge.buffer);W.setUint32(0,ue),ge.set(m.default.types.mdat,4);for(var z=!1,X=Number.POSITIVE_INFINITY,J=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,Z=0;Z<F;Z++){for(var pe=I[Z],ye=pe.units,xe=0,_e=0,Ie=ye.length;_e<Ie;_e++){var be=ye[_e],Be=be.data,Ae=be.data.byteLength;W.setUint32(B,Ae),B+=4,ge.set(Be,B),B+=Ae,xe+=4+Ae}var Le=void 0;if(Z<F-1)U=I[Z+1].dts-pe.dts,Le=I[Z+1].pts-pe.pts;else{var Me=this.config,De=Z>0?pe.dts-I[Z-1].dts:Q;if(Le=Z>0?pe.pts-I[Z-1].pts:Q,Me.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ce=Math.floor(Me.maxBufferHole*R),Ue=(O?K+O*R:this.nextAudioPts)-pe.pts;Ue>Ce?(U=Ue-De,U<0?U=De:z=!0,g.logger.log("[mp4-remuxer]: It is approximately "+Ue/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=De}else U=De}var Qe=Math.round(pe.pts-pe.dts);X=Math.min(X,U),ie=Math.max(ie,U),J=Math.min(J,Le),ne=Math.max(ne,Le),C.push(new a(pe.key,U,xe,Qe))}if(C.length){if(h){if(h<70){var Ke=C[0].flags;Ke.dependsOn=2,Ke.isNonSync=0}}else if(t&&ne-J<ie-X&&Q/ie<.025&&C[0].cts===0){g.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ne=N,Te=0,We=C.length;Te<We;Te++){var Ge=Ne+C[Te].duration,Ze=Ne+C[Te].cts;if(Te<We-1){var qe=Ge+C[Te+1].cts;C[Te].duration=qe-Ze}else C[Te].duration=Te?C[Te-1].duration:Q;C[Te].cts=0,Ne=Ge}}}console.assert(U!==null,"mp4SampleDuration must be computed"),U=z||!U?Q:U,this.nextAvcDts=k=j+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var et=m.default.moof(L.sequenceNumber++,N,l({},L,{samples:C})),tt="video",rt={data1:et,data2:ge,startPTS:K/R,endPTS:(V+U)/R,startDTS:N/R,endDTS:k/R,type:tt,hasAudio:!1,hasVideo:!0,nb:C.length,dropped:L.dropped};return L.samples=[],L.dropped=0,console.assert(ge.length,"MDAT length must not be zero"),rt},x.remuxAudio=function(L,b,A,O,R){var I=L.inputTimeScale,C=L.samplerate?L.samplerate:I,F=I/C,w=L.segmentCodec==="aac"?d:u,k=w*F,B=this._initPTS,U=L.segmentCodec==="mp3"&&this.typeSupported.mpeg,N=[],j=R!==void 0,K=L.samples,V=U?0:8,H=this.nextAudioPts||-1,Y=b*I;if(this.isAudioContiguous=A=A||K.length&&H>0&&(O&&Math.abs(Y-H)<9e3||Math.abs(s(K[0].pts-B,Y)-H)<20*k),K.forEach(function(be){be.pts=s(be.pts-B,Y)}),!A||H<0){if(K=K.filter(function(be){return be.pts>=0}),!K.length)return;R===0?H=0:O&&!j?H=Math.max(0,Y):H=K[0].pts}if(L.segmentCodec==="aac")for(var q=this.config.maxAudioFramesDrift,$=0,G=H;$<K.length;$++){var re=K[$],Q=re.pts,ee=Q-G,se=Math.abs(1e3*ee/I);if(ee<=-q*k&&j)$===0&&(g.logger.warn("Audio frame @ "+(Q/I).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ee/I)+" ms."),this.nextAudioPts=H=G=Q);else if(ee>=q*k&&se<n&&j){var ae=Math.round(ee/k);G=Q-ae*k,G<0&&(ae--,G+=k),$===0&&(this.nextAudioPts=H=G),g.logger.warn("[mp4-remuxer]: Injecting "+ae+" audio frame @ "+(G/I).toFixed(3)+"s due to "+Math.round(1e3*ee/I)+" ms gap.");for(var oe=0;oe<ae;oe++){var fe=Math.max(G,0),te=p.default.getSilentFrame(L.manifestCodec||L.codec,L.channelCount);te||(g.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),te=re.unit.subarray()),K.splice($,0,{unit:te,pts:fe}),G+=k,$++}}re.pts=G,G+=k}for(var le=null,de=null,ce,he=0,ve=K.length;ve--;)he+=K[ve].unit.byteLength;for(var me=0,ue=K.length;me<ue;me++){var ge=K[me],W=ge.unit,z=ge.pts;if(de!==null){var X=N[me-1];X.duration=Math.round((z-de)/F)}else if(A&&L.segmentCodec==="aac"&&(z=H),le=z,he>0){he+=V;try{ce=new Uint8Array(he)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:he,reason:"fail allocating audio mdat "+he});return}if(!U){var J=new DataView(ce.buffer);J.setUint32(0,he),ce.set(m.default.types.mdat,4)}}else return;ce.set(W,V);var ie=W.byteLength;V+=ie,N.push(new a(!0,w,ie,0)),de=z}var ne=N.length;if(!!ne){var Z=N[N.length-1];this.nextAudioPts=H=de+F*Z.duration;var pe=U?new Uint8Array(0):m.default.moof(L.sequenceNumber++,le/F,l({},L,{samples:N}));L.samples=[];var ye=le/I,xe=H/I,_e="audio",Ie={data1:pe,data2:ce,startPTS:ye,endPTS:xe,startDTS:ye,endDTS:xe,type:_e,hasAudio:!0,hasVideo:!1,nb:ne};return this.isAudioContiguous=!0,console.assert(ce.length,"MDAT length must not be zero"),Ie}},x.remuxEmptyAudio=function(L,b,A,O){var R=L.inputTimeScale,I=L.samplerate?L.samplerate:R,C=R/I,F=this.nextAudioPts,w=(F!==null?F:O.startDTS*R)+this._initDTS,k=O.endDTS*R+this._initDTS,B=C*d,U=Math.ceil((k-w)/B),N=p.default.getSilentFrame(L.manifestCodec||L.codec,L.channelCount);if(g.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){g.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var j=[],K=0;K<U;K++){var V=w+K*B;j.push({unit:N,pts:V,dts:V})}return L.samples=j,this.remuxAudio(L,b,A,!1)},S}();function s(S,x){var E;if(x===null)return S;for(x<S?E=-8589934592:E=8589934592;Math.abs(S-x)>4294967296;)S+=E;return S}function i(S){for(var x=0;x<S.length;x++)if(S[x].key)return x;return-1}function f(S,x,E,L){var b=S.samples.length;if(!!b){for(var A=S.inputTimeScale,O=0;O<b;O++){var R=S.samples[O];R.pts=s(R.pts-E,x*A)/A,R.dts=s(R.dts-L,x*A)/A}var I=S.samples;return S.samples=[],{samples:I}}}function c(S,x,E){var L=S.samples.length;if(!!L){for(var b=S.inputTimeScale,A=0;A<L;A++){var O=S.samples[A];O.pts=s(O.pts-E,x*b)/b}S.samples.sort(function(I,C){return I.pts-C.pts});var R=S.samples;return S.samples=[],{samples:R}}}var a=function(x,E,L,b){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=E,this.size=L,this.cts=b,this.flags=new v(x)},v=function(x){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=x?2:1,this.isNonSync=x?0:1}},"./src/remux/passthrough-remuxer.ts":function(M,P,y){y.r(P);var T=y("./src/polyfills/number.ts"),p=y("./src/remux/mp4-remuxer.ts"),m=y("./src/utils/mp4-tools.ts"),D=y("./src/loader/fragment.ts"),_=y("./src/utils/logger.ts"),g=function(){function r(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var l=r.prototype;return l.destroy=function(){},l.resetTimeStamp=function(d){this.initPTS=d,this.lastEndTime=null},l.resetNextTimestamp=function(){this.lastEndTime=null},l.resetInitSegment=function(d,u,h){this.audioCodec=u,this.videoCodec=h,this.generateInitSegment(d),this.emitInitSegment=!0},l.generateInitSegment=function(d){var u=this.audioCodec,h=this.videoCodec;if(!d||!d.byteLength){this.initTracks=void 0,this.initData=void 0;return}var t=this.initData=Object(m.parseInitSegment)(d);u||(u=o(t.audio,D.ElementaryStreamTypes.AUDIO)),h||(h=o(t.video,D.ElementaryStreamTypes.VIDEO));var e={};t.audio&&t.video?e.audiovideo={container:"video/mp4",codec:u+","+h,initSegment:d,id:"main"}:t.audio?e.audio={container:"audio/mp4",codec:u,initSegment:d,id:"audio"}:t.video?e.video={container:"video/mp4",codec:h,initSegment:d,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},l.remux=function(d,u,h,t,e){var s,i=this.initPTS,f=this.lastEndTime,c={audio:void 0,video:void 0,text:t,id3:h,initSegment:void 0};Object(T.isFiniteNumber)(f)||(f=this.lastEndTime=e||0);var a=u.samples;if(!a||!a.length)return c;var v={initPTS:void 0,timescale:1},S=this.initData;if((!S||!S.length)&&(this.generateInitSegment(a),S=this.initData),!S||!S.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);var x=Object(m.getStartDTS)(S,a);Object(T.isFiniteNumber)(i)||(this.initPTS=v.initPTS=i=x-e);var E=Object(m.getDuration)(a,S),L=d?x-i:f,b=L+E;Object(m.offsetStartDTS)(S,a,i),E>0?this.lastEndTime=b:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var A=!!S.audio,O=!!S.video,R="";A&&(R+="audio"),O&&(R+="video");var I={data1:a,startPTS:L,startDTS:L,endPTS:b,endDTS:b,type:R,hasAudio:A,hasVideo:O,nb:1,dropped:0};c.audio=I.type==="audio"?I:void 0,c.video=I.type!=="audio"?I:void 0,c.initSegment=v;var C=(s=this.initPTS)!=null?s:0;return c.id3=Object(p.flushTextTrackMetadataCueSamples)(h,e,C,C),t.samples.length&&(c.text=Object(p.flushTextTrackUserdataCueSamples)(t,e,C)),c},r}();function o(r,l){var n=r==null?void 0:r.codec;return n&&n.length>4?n:n==="hvc1"||n==="hev1"?"hvc1.1.c.L120.90":n==="av01"?"av01.0.04M.08":n==="avc1"||l===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}P.default=g},"./src/task-loop.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return T});var T=function(){function p(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var m=p.prototype;return m.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},m.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},m.onHandlerDestroyed=function(){},m.hasInterval=function(){return!!this._tickInterval},m.hasNextTick=function(){return!!this._tickTimer},m.setInterval=function(_){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,_),!0)},m.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},m.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},m.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},m.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},m.doTick=function(){},p}()},"./src/types/cmcd.ts":function(M,P,y){y.r(P),y.d(P,"CMCDVersion",function(){return T}),y.d(P,"CMCDObjectType",function(){return p}),y.d(P,"CMCDStreamingFormat",function(){return m}),y.d(P,"CMCDStreamType",function(){return D});var T=1,p;(function(_){_.MANIFEST="m",_.AUDIO="a",_.VIDEO="v",_.MUXED="av",_.INIT="i",_.CAPTION="c",_.TIMED_TEXT="tt",_.KEY="k",_.OTHER="o"})(p||(p={}));var m;(function(_){_.DASH="d",_.HLS="h",_.SMOOTH="s",_.OTHER="o"})(m||(m={}));var D;(function(_){_.VOD="v",_.LIVE="l"})(D||(D={}))},"./src/types/demuxer.ts":function(M,P,y){y.r(P),y.d(P,"MetadataSchema",function(){return T});var T;(function(p){p.audioId3="org.id3",p.dateRange="com.apple.quicktime.HLS",p.emsg="https://aomedia.org/emsg/ID3"})(T||(T={}))},"./src/types/level.ts":function(M,P,y){y.r(P),y.d(P,"HlsSkip",function(){return m}),y.d(P,"getSkipValue",function(){return D}),y.d(P,"HlsUrlParameters",function(){return _}),y.d(P,"Level",function(){return g});function T(o,r){for(var l=0;l<r.length;l++){var n=r[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function p(o,r,l){return r&&T(o.prototype,r),l&&T(o,l),Object.defineProperty(o,"prototype",{writable:!1}),o}var m;(function(o){o.No="",o.Yes="YES",o.v2="v2"})(m||(m={}));function D(o,r){var l=o.canSkipUntil,n=o.canSkipDateRanges,d=o.endSN,u=r!==void 0?r-d:0;return l&&u<l?n?m.v2:m.Yes:m.No}var _=function(){function o(l,n,d){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=l,this.part=n,this.skip=d}var r=o.prototype;return r.addDirectives=function(n){var d=new self.URL(n);return this.msn!==void 0&&d.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&d.searchParams.set("_HLS_part",this.part.toString()),this.skip&&d.searchParams.set("_HLS_skip",this.skip),d.toString()},o}(),g=function(){function o(r){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[r.url],this.attrs=r.attrs,this.bitrate=r.bitrate,r.details&&(this.details=r.details),this.id=r.id||0,this.name=r.name,this.width=r.width||0,this.height=r.height||0,this.audioCodec=r.audioCodec,this.videoCodec=r.videoCodec,this.unknownCodecs=r.unknownCodecs,this.codecSet=[r.videoCodec,r.audioCodec].filter(function(l){return l}).join(",").replace(/\.[^.,]+/g,"")}return p(o,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(l){var n=l%this.url.length;this._urlId!==n&&(this.details=void 0,this._urlId=n)}}]),o}()},"./src/types/loader.ts":function(M,P,y){y.r(P),y.d(P,"PlaylistContextType",function(){return T}),y.d(P,"PlaylistLevelType",function(){return p});var T;(function(m){m.MANIFEST="manifest",m.LEVEL="level",m.AUDIO_TRACK="audioTrack",m.SUBTITLE_TRACK="subtitleTrack"})(T||(T={}));var p;(function(m){m.MAIN="main",m.AUDIO="audio",m.SUBTITLE="subtitle"})(p||(p={}))},"./src/types/transmuxer.ts":function(M,P,y){y.r(P),y.d(P,"ChunkMetadata",function(){return T});var T=function(D,_,g,o,r,l){o===void 0&&(o=0),r===void 0&&(r=-1),l===void 0&&(l=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=p(),this.buffering={audio:p(),video:p(),audiovideo:p()},this.level=D,this.sn=_,this.id=g,this.size=o,this.part=r,this.partial=l};function p(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(M,P,y){y.r(P),y.d(P,"AttrList",function(){return m});var T=/^(\d+)x(\d+)$/,p=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,m=function(){function D(g){typeof g=="string"&&(g=D.parseAttrList(g));for(var o in g)g.hasOwnProperty(o)&&(this[o]=g[o])}var _=D.prototype;return _.decimalInteger=function(o){var r=parseInt(this[o],10);return r>Number.MAX_SAFE_INTEGER?1/0:r},_.hexadecimalInteger=function(o){if(this[o]){var r=(this[o]||"0x").slice(2);r=(r.length&1?"0":"")+r;for(var l=new Uint8Array(r.length/2),n=0;n<r.length/2;n++)l[n]=parseInt(r.slice(n*2,n*2+2),16);return l}else return null},_.hexadecimalIntegerAsNumber=function(o){var r=parseInt(this[o],16);return r>Number.MAX_SAFE_INTEGER?1/0:r},_.decimalFloatingPoint=function(o){return parseFloat(this[o])},_.optionalFloat=function(o,r){var l=this[o];return l?parseFloat(l):r},_.enumeratedString=function(o){return this[o]},_.bool=function(o){return this[o]==="YES"},_.decimalResolution=function(o){var r=T.exec(this[o]);if(r!==null)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}},D.parseAttrList=function(o){var r,l={},n='"';for(p.lastIndex=0;(r=p.exec(o))!==null;){var d=r[2];d.indexOf(n)===0&&d.lastIndexOf(n)===d.length-1&&(d=d.slice(1,-1)),l[r[1]]=d}return l},D}()},"./src/utils/binary-search.ts":function(M,P,y){y.r(P);var T={search:function(m,D){for(var _=0,g=m.length-1,o=null,r=null;_<=g;){o=(_+g)/2|0,r=m[o];var l=D(r);if(l>0)_=o+1;else if(l<0)g=o-1;else return r}return null}};P.default=T},"./src/utils/buffer-helper.ts":function(M,P,y){y.r(P),y.d(P,"BufferHelper",function(){return m});var T=y("./src/utils/logger.ts"),p={length:0,start:function(){return 0},end:function(){return 0}},m=function(){function D(){}return D.isBuffered=function(g,o){try{if(g){for(var r=D.getBuffered(g),l=0;l<r.length;l++)if(o>=r.start(l)&&o<=r.end(l))return!0}}catch{}return!1},D.bufferInfo=function(g,o,r){try{if(g){var l=D.getBuffered(g),n=[],d;for(d=0;d<l.length;d++)n.push({start:l.start(d),end:l.end(d)});return this.bufferedInfo(n,o,r)}}catch{}return{len:0,start:o,end:o,nextStart:void 0}},D.bufferedInfo=function(g,o,r){o=Math.max(0,o),g.sort(function(a,v){var S=a.start-v.start;return S||v.end-a.end});var l=[];if(r)for(var n=0;n<g.length;n++){var d=l.length;if(d){var u=l[d-1].end;g[n].start-u<r?g[n].end>u&&(l[d-1].end=g[n].end):l.push(g[n])}else l.push(g[n])}else l=g;for(var h=0,t,e=o,s=o,i=0;i<l.length;i++){var f=l[i].start,c=l[i].end;if(o+r>=f&&o<c)e=f,s=c,h=s-o;else if(o+r<f){t=f;break}}return{len:h,start:e||0,end:s||0,nextStart:t}},D.getBuffered=function(g){try{return g.buffered}catch(o){return T.logger.log("failed to get media.buffered",o),p}},D}()},"./src/utils/cea-608-parser.ts":function(M,P,y){y.r(P),y.d(P,"Row",function(){return s}),y.d(P,"CaptionScreen",function(){return i});var T=y("./src/utils/logger.ts"),p={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},m=function(E){var L=E;return p.hasOwnProperty(E)&&(L=p[E]),String.fromCharCode(L)},D=15,_=100,g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},r={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],d;(function(x){x[x.ERROR=0]="ERROR",x[x.TEXT=1]="TEXT",x[x.WARNING=2]="WARNING",x[x.INFO=2]="INFO",x[x.DEBUG=3]="DEBUG",x[x.DATA=3]="DATA"})(d||(d={}));var u=function(){function x(){this.time=null,this.verboseLevel=d.ERROR}var E=x.prototype;return E.log=function(b,A){this.verboseLevel>=b&&T.logger.log(this.time+" ["+b+"] "+A)},x}(),h=function(E){for(var L=[],b=0;b<E.length;b++)L.push(E[b].toString(16));return L},t=function(){function x(L,b,A,O,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=L||"white",this.underline=b||!1,this.italics=A||!1,this.background=O||"black",this.flash=R||!1}var E=x.prototype;return E.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},E.setStyles=function(b){for(var A=["foreground","underline","italics","background","flash"],O=0;O<A.length;O++){var R=A[O];b.hasOwnProperty(R)&&(this[R]=b[R])}},E.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},E.equals=function(b){return this.foreground===b.foreground&&this.underline===b.underline&&this.italics===b.italics&&this.background===b.background&&this.flash===b.flash},E.copy=function(b){this.foreground=b.foreground,this.underline=b.underline,this.italics=b.italics,this.background=b.background,this.flash=b.flash},E.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},x}(),e=function(){function x(L,b,A,O,R,I){this.uchar=void 0,this.penState=void 0,this.uchar=L||" ",this.penState=new t(b,A,O,R,I)}var E=x.prototype;return E.reset=function(){this.uchar=" ",this.penState.reset()},E.setChar=function(b,A){this.uchar=b,this.penState.copy(A)},E.setPenState=function(b){this.penState.copy(b)},E.equals=function(b){return this.uchar===b.uchar&&this.penState.equals(b.penState)},E.copy=function(b){this.uchar=b.uchar,this.penState.copy(b.penState)},E.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},x}(),s=function(){function x(L){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var b=0;b<_;b++)this.chars.push(new e);this.logger=L,this.pos=0,this.currPenState=new t}var E=x.prototype;return E.equals=function(b){for(var A=!0,O=0;O<_;O++)if(!this.chars[O].equals(b.chars[O])){A=!1;break}return A},E.copy=function(b){for(var A=0;A<_;A++)this.chars[A].copy(b.chars[A])},E.isEmpty=function(){for(var b=!0,A=0;A<_;A++)if(!this.chars[A].isEmpty()){b=!1;break}return b},E.setCursor=function(b){this.pos!==b&&(this.pos=b),this.pos<0?(this.logger.log(d.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>_&&(this.logger.log(d.DEBUG,"Too large cursor position "+this.pos),this.pos=_)},E.moveCursor=function(b){var A=this.pos+b;if(b>1)for(var O=this.pos+1;O<A+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(A)},E.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},E.insertChar=function(b){b>=144&&this.backSpace();var A=m(b);if(this.pos>=_){this.logger.log(d.ERROR,"Cannot insert "+b.toString(16)+" ("+A+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(A,this.currPenState),this.moveCursor(1)},E.clearFromPos=function(b){var A;for(A=b;A<_;A++)this.chars[A].reset()},E.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},E.clearToEndOfRow=function(){this.clearFromPos(this.pos)},E.getTextString=function(){for(var b=[],A=!0,O=0;O<_;O++){var R=this.chars[O].uchar;R!==" "&&(A=!1),b.push(R)}return A?"":b.join("")},E.setPenStyles=function(b){this.currPenState.setStyles(b);var A=this.chars[this.pos];A.setPenState(this.currPenState)},x}(),i=function(){function x(L){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var b=0;b<D;b++)this.rows.push(new s(L));this.logger=L,this.currRow=D-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var E=x.prototype;return E.reset=function(){for(var b=0;b<D;b++)this.rows[b].clear();this.currRow=D-1},E.equals=function(b){for(var A=!0,O=0;O<D;O++)if(!this.rows[O].equals(b.rows[O])){A=!1;break}return A},E.copy=function(b){for(var A=0;A<D;A++)this.rows[A].copy(b.rows[A])},E.isEmpty=function(){for(var b=!0,A=0;A<D;A++)if(!this.rows[A].isEmpty()){b=!1;break}return b},E.backSpace=function(){var b=this.rows[this.currRow];b.backSpace()},E.clearToEndOfRow=function(){var b=this.rows[this.currRow];b.clearToEndOfRow()},E.insertChar=function(b){var A=this.rows[this.currRow];A.insertChar(b)},E.setPen=function(b){var A=this.rows[this.currRow];A.setPenStyles(b)},E.moveCursor=function(b){var A=this.rows[this.currRow];A.moveCursor(b)},E.setCursor=function(b){this.logger.log(d.INFO,"setCursor: "+b);var A=this.rows[this.currRow];A.setCursor(b)},E.setPAC=function(b){this.logger.log(d.INFO,"pacData = "+JSON.stringify(b));var A=b.row-1;if(this.nrRollUpRows&&A<this.nrRollUpRows-1&&(A=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==A){for(var O=0;O<D;O++)this.rows[O].clear();var R=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var C=I.rows[R].cueStartTime,F=this.logger.time;if(C&&F!==null&&C<F)for(var w=0;w<this.nrRollUpRows;w++)this.rows[A-this.nrRollUpRows+w+1].copy(I.rows[R+w])}}this.currRow=A;var k=this.rows[this.currRow];if(b.indent!==null){var B=b.indent,U=Math.max(B-1,0);k.setCursor(b.indent),b.color=k.chars[U].penState.foreground}var N={foreground:b.color,underline:b.underline,italics:b.italics,background:"black",flash:!1};this.setPen(N)},E.setBkgData=function(b){this.logger.log(d.INFO,"bkgData = "+JSON.stringify(b)),this.backSpace(),this.setPen(b),this.insertChar(32)},E.setRollUpRows=function(b){this.nrRollUpRows=b},E.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(d.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(d.TEXT,this.getDisplayText());var b=this.currRow+1-this.nrRollUpRows,A=this.rows.splice(b,1)[0];A.clear(),this.rows.splice(this.currRow,0,A),this.logger.log(d.INFO,"Rolling up")},E.getDisplayText=function(b){b=b||!1;for(var A=[],O="",R=-1,I=0;I<D;I++){var C=this.rows[I].getTextString();C&&(R=I+1,b?A.push("Row "+R+": '"+C+"'"):A.push(C.trim()))}return A.length>0&&(b?O="["+A.join(" | ")+"]":O=A.join(`
`)),O},E.getTextAndFormat=function(){return this.rows},x}(),f=function(){function x(L,b,A){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=L,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new i(A),this.nonDisplayedMemory=new i(A),this.lastOutputScreen=new i(A),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=A}var E=x.prototype;return E.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},E.getHandler=function(){return this.outputFilter},E.setHandler=function(b){this.outputFilter=b},E.setPAC=function(b){this.writeScreen.setPAC(b)},E.setBkgData=function(b){this.writeScreen.setBkgData(b)},E.setMode=function(b){b!==this.mode&&(this.mode=b,this.logger.log(d.INFO,"MODE="+b),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=b)},E.insertChars=function(b){for(var A=0;A<b.length;A++)this.writeScreen.insertChar(b[A]);var O=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(d.INFO,O+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(d.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},E.ccRCL=function(){this.logger.log(d.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},E.ccBS=function(){this.logger.log(d.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},E.ccAOF=function(){},E.ccAON=function(){},E.ccDER=function(){this.logger.log(d.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},E.ccRU=function(b){this.logger.log(d.INFO,"RU("+b+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(b)},E.ccFON=function(){this.logger.log(d.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},E.ccRDC=function(){this.logger.log(d.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},E.ccTR=function(){this.logger.log(d.INFO,"TR"),this.setMode("MODE_TEXT")},E.ccRTD=function(){this.logger.log(d.INFO,"RTD"),this.setMode("MODE_TEXT")},E.ccEDM=function(){this.logger.log(d.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},E.ccCR=function(){this.logger.log(d.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},E.ccENM=function(){this.logger.log(d.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},E.ccEOC=function(){if(this.logger.log(d.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var b=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=b,this.writeScreen=this.nonDisplayedMemory,this.logger.log(d.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},E.ccTO=function(b){this.logger.log(d.INFO,"TO("+b+") - Tab Offset"),this.writeScreen.moveCursor(b)},E.ccMIDROW=function(b){var A={flash:!1};if(A.underline=b%2===1,A.italics=b>=46,A.italics)A.foreground="white";else{var O=Math.floor(b/2)-16,R=["white","green","blue","cyan","red","yellow","magenta"];A.foreground=R[O]}this.logger.log(d.INFO,"MIDROW: "+JSON.stringify(A)),this.writeScreen.setPen(A)},E.outputDataUpdate=function(b){b===void 0&&(b=!1);var A=this.logger.time;A!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=A:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,A,this.lastOutputScreen),b&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:A),this.lastOutputScreen.copy(this.displayedMemory))},E.cueSplitAtTime=function(b){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,b,this.displayedMemory),this.cueStartTime=b))},x}(),c=function(){function x(L,b,A){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var O=new u;this.channels=[null,new f(L,b,O),new f(L+1,A,O)],this.cmdHistory=S(),this.logger=O}var E=x.prototype;return E.getHandler=function(b){return this.channels[b].getHandler()},E.setHandler=function(b,A){this.channels[b].setHandler(A)},E.addData=function(b,A){var O,R,I,C=!1;this.logger.time=b;for(var F=0;F<A.length;F+=2)if(R=A[F]&127,I=A[F+1]&127,!(R===0&&I===0)){if(this.logger.log(d.DATA,"["+h([A[F],A[F+1]])+"] -> ("+h([R,I])+")"),O=this.parseCmd(R,I),O||(O=this.parseMidrow(R,I)),O||(O=this.parsePAC(R,I)),O||(O=this.parseBackgroundAttributes(R,I)),!O&&(C=this.parseChars(R,I),C)){var w=this.currentChannel;if(w&&w>0){var k=this.channels[w];k.insertChars(C)}else this.logger.log(d.WARNING,"No channel found yet. TEXT-MODE?")}!O&&!C&&this.logger.log(d.WARNING,"Couldn't parse cleaned data "+h([R,I])+" orig: "+h([A[F],A[F+1]]))}},E.parseCmd=function(b,A){var O=this.cmdHistory,R=(b===20||b===28||b===21||b===29)&&A>=32&&A<=47,I=(b===23||b===31)&&A>=33&&A<=35;if(!(R||I))return!1;if(v(b,A,O))return a(null,null,O),this.logger.log(d.DEBUG,"Repeated command ("+h([b,A])+") is dropped"),!0;var C=b===20||b===21||b===23?1:2,F=this.channels[C];return b===20||b===21||b===28||b===29?A===32?F.ccRCL():A===33?F.ccBS():A===34?F.ccAOF():A===35?F.ccAON():A===36?F.ccDER():A===37?F.ccRU(2):A===38?F.ccRU(3):A===39?F.ccRU(4):A===40?F.ccFON():A===41?F.ccRDC():A===42?F.ccTR():A===43?F.ccRTD():A===44?F.ccEDM():A===45?F.ccCR():A===46?F.ccENM():A===47&&F.ccEOC():F.ccTO(A-32),a(b,A,O),this.currentChannel=C,!0},E.parseMidrow=function(b,A){var O=0;if((b===17||b===25)&&A>=32&&A<=47){if(b===17?O=1:O=2,O!==this.currentChannel)return this.logger.log(d.ERROR,"Mismatch channel in midrow parsing"),!1;var R=this.channels[O];return R?(R.ccMIDROW(A),this.logger.log(d.DEBUG,"MIDROW ("+h([b,A])+")"),!0):!1}return!1},E.parsePAC=function(b,A){var O,R=this.cmdHistory,I=(b>=17&&b<=23||b>=25&&b<=31)&&A>=64&&A<=127,C=(b===16||b===24)&&A>=64&&A<=95;if(!(I||C))return!1;if(v(b,A,R))return a(null,null,R),!0;var F=b<=23?1:2;A>=64&&A<=95?O=F===1?g[b]:r[b]:O=F===1?o[b]:l[b];var w=this.channels[F];return w?(w.setPAC(this.interpretPAC(O,A)),a(b,A,R),this.currentChannel=F,!0):!1},E.interpretPAC=function(b,A){var O,R={color:null,italics:!1,indent:null,underline:!1,row:b};return A>95?O=A-96:O=A-64,R.underline=(O&1)===1,O<=13?R.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(O/2)]:O<=15?(R.italics=!0,R.color="white"):R.indent=Math.floor((O-16)/2)*4,R},E.parseChars=function(b,A){var O,R=null,I=null;if(b>=25?(O=2,I=b-8):(O=1,I=b),I>=17&&I<=19){var C;I===17?C=A+80:I===18?C=A+112:C=A+144,this.logger.log(d.INFO,"Special char '"+m(C)+"' in channel "+O),R=[C]}else b>=32&&b<=127&&(R=A===0?[b]:[b,A]);if(R){var F=h(R);this.logger.log(d.DEBUG,"Char codes =  "+F.join(",")),a(b,A,this.cmdHistory)}return R},E.parseBackgroundAttributes=function(b,A){var O=(b===16||b===24)&&A>=32&&A<=47,R=(b===23||b===31)&&A>=45&&A<=47;if(!(O||R))return!1;var I,C={};b===16||b===24?(I=Math.floor((A-32)/2),C.background=n[I],A%2===1&&(C.background=C.background+"_semi")):A===45?C.background="transparent":(C.foreground="black",A===47&&(C.underline=!0));var F=b<=23?1:2,w=this.channels[F];return w.setBkgData(C),a(b,A,this.cmdHistory),!0},E.reset=function(){for(var b=0;b<Object.keys(this.channels).length;b++){var A=this.channels[b];A&&A.reset()}this.cmdHistory=S()},E.cueSplitAtTime=function(b){for(var A=0;A<this.channels.length;A++){var O=this.channels[A];O&&O.cueSplitAtTime(b)}},x}();function a(x,E,L){L.a=x,L.b=E}function v(x,E,L){return L.a===x&&L.b===E}function S(){return{a:null,b:null}}P.default=c},"./src/utils/codecs.ts":function(M,P,y){y.r(P),y.d(P,"isCodecType",function(){return p}),y.d(P,"isCodecSupportedInMp4",function(){return m});var T={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function p(D,_){var g=T[_];return!!g&&g[D.slice(0,4)]===!0}function m(D,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+D+'"')}},"./src/utils/cues.ts":function(M,P,y){y.r(P);var T=y("./src/utils/vttparser.ts"),p=y("./src/utils/webvtt-parser.ts"),m=y("./src/utils/texttrack-utils.ts"),D=/\s/,_={newCue:function(o,r,l,n){for(var d=[],u,h,t,e,s,i=self.VTTCue||self.TextTrackCue,f=0;f<n.rows.length;f++)if(u=n.rows[f],t=!0,e=0,s="",!u.isEmpty()){for(var c=0;c<u.chars.length;c++)D.test(u.chars[c].uchar)&&t?e++:(s+=u.chars[c].uchar,t=!1);u.cueStartTime=r,r===l&&(l+=1e-4),e>=16?e--:e++;var a=Object(T.fixLineBreaks)(s.trim()),v=Object(p.generateCueId)(r,l,a);(!o||!o.cues||!o.cues.getCueById(v))&&(h=new i(r,l,a),h.id=v,h.line=f+1,h.align="left",h.position=10+Math.min(80,Math.floor(e*8/32)*10),d.push(h))}return o&&d.length&&(d.sort(function(S,x){return S.line==="auto"||x.line==="auto"?0:S.line>8&&x.line>8?x.line-S.line:S.line-x.line}),d.forEach(function(S){return Object(m.addCueToTrack)(o,S)})),d}};P.default=_},"./src/utils/discontinuities.ts":function(M,P,y){y.r(P),y.d(P,"findFirstFragWithCC",function(){return D}),y.d(P,"shouldAlignOnDiscontinuities",function(){return _}),y.d(P,"findDiscontinuousReferenceFrag",function(){return g}),y.d(P,"adjustSlidingStart",function(){return r}),y.d(P,"alignStream",function(){return l}),y.d(P,"alignPDT",function(){return d}),y.d(P,"alignFragmentByPDTDelta",function(){return u}),y.d(P,"alignMediaPlaylistByPDT",function(){return h});var T=y("./src/polyfills/number.ts"),p=y("./src/utils/logger.ts"),m=y("./src/controller/level-helper.ts");function D(t,e){for(var s=null,i=0,f=t.length;i<f;i++){var c=t[i];if(c&&c.cc===e){s=c;break}}return s}function _(t,e,s){return!!(e.details&&(s.endCC>s.startCC||t&&t.cc<s.startCC))}function g(t,e){var s=t.fragments,i=e.fragments;if(!i.length||!s.length){p.logger.log("No fragments to align");return}var f=D(s,i[0].cc);if(!f||f&&!f.startPTS){p.logger.log("No frag in previous level to align on");return}return f}function o(t,e){if(t){var s=t.start+e;t.start=t.startPTS=s,t.endPTS=s+t.duration}}function r(t,e){for(var s=e.fragments,i=0,f=s.length;i<f;i++)o(s[i],t);e.fragmentHint&&o(e.fragmentHint,t),e.alignedSliding=!0}function l(t,e,s){!e||(n(t,s,e),!s.alignedSliding&&e.details&&d(s,e.details),!s.alignedSliding&&e.details&&!s.skippedSegments&&Object(m.adjustSliding)(e.details,s))}function n(t,e,s){if(_(t,s,e)){var i=g(s.details,e);i&&Object(T.isFiniteNumber)(i.start)&&(p.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),r(i.start,e))}}function d(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,i=t.fragments[0].programDateTime,f=(i-s)/1e3+e.fragments[0].start;f&&Object(T.isFiniteNumber)(f)&&(p.logger.log("Adjusting PTS using programDateTime delta "+(i-s)+"ms, sliding:"+f.toFixed(3)+" "+t.url+" "),r(f,t))}}function u(t,e){var s=t.programDateTime;if(!!s){var i=(s-e)/1e3;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function h(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,i=e.fragments[0].start,f=s-i*1e3;t.fragments.forEach(function(c){u(c,f)}),t.fragmentHint&&u(t.fragmentHint,f),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(M,P,y){y.r(P);var T=y("./src/utils/ewma.ts"),p=function(){function m(_,g,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new T.default(_),this.fast_=new T.default(g)}var D=m.prototype;return D.update=function(g,o){var r=this.slow_,l=this.fast_;this.slow_.halfLife!==g&&(this.slow_=new T.default(g,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==o&&(this.fast_=new T.default(o,l.getEstimate(),l.getTotalWeight()))},D.sample=function(g,o){g=Math.max(g,this.minDelayMs_);var r=8*o,l=g/1e3,n=r/l;this.fast_.sample(l,n),this.slow_.sample(l,n)},D.canEstimate=function(){var g=this.fast_;return g&&g.getTotalWeight()>=this.minWeight_},D.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},D.destroy=function(){},m}();P.default=p},"./src/utils/ewma.ts":function(M,P,y){y.r(P);var T=function(){function p(D,_,g){_===void 0&&(_=0),g===void 0&&(g=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=D,this.alpha_=D?Math.exp(Math.log(.5)/D):0,this.estimate_=_,this.totalWeight_=g}var m=p.prototype;return m.sample=function(_,g){var o=Math.pow(this.alpha_,_);this.estimate_=g*(1-o)+o*this.estimate_,this.totalWeight_+=_},m.getTotalWeight=function(){return this.totalWeight_},m.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},p}();P.default=T},"./src/utils/fetch-loader.ts":function(M,P,y){y.r(P),y.d(P,"fetchSupported",function(){return u});var T=y("./src/polyfills/number.ts"),p=y("./src/loader/load-stats.ts"),m=y("./src/demux/chunk-cache.ts");function D(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,l(i,f)}function _(i){var f=typeof Map=="function"?new Map:void 0;return _=function(a){if(a===null||!r(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f<"u"){if(f.has(a))return f.get(a);f.set(a,v)}function v(){return g(a,arguments,n(this).constructor)}return v.prototype=Object.create(a.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),l(v,a)},_(i)}function g(i,f,c){return o()?g=Reflect.construct.bind():g=function(v,S,x){var E=[null];E.push.apply(E,S);var L=Function.bind.apply(v,E),b=new L;return x&&l(b,x.prototype),b},g.apply(null,arguments)}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function r(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function l(i,f){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,v){return a.__proto__=v,a},l(i,f)}function n(i){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},n(i)}function d(){return d=Object.assign?Object.assign.bind():function(i){for(var f=1;f<arguments.length;f++){var c=arguments[f];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(i[a]=c[a])}return i},d.apply(this,arguments)}function u(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var h=function(){function i(c){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=c.fetchSetup||e,this.controller=new self.AbortController,this.stats=new p.LoadStats}var f=i.prototype;return f.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},f.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},f.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},f.load=function(a,v,S){var x=this,E=this.stats;if(E.loading.start)throw new Error("Loader can only be used once.");E.loading.start=self.performance.now();var L=t(a,this.controller.signal),b=S.onProgress,A=a.responseType==="arraybuffer",O=A?"byteLength":"length";this.context=a,this.config=v,this.callbacks=S,this.request=this.fetchSetup(a,L),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){x.abortInternal(),S.onTimeout(E,a,x.response)},v.timeout),self.fetch(this.request).then(function(R){if(x.response=x.loader=R,!R.ok){var I=R.status,C=R.statusText;throw new s(C||"fetch, bad network response",I,R)}return E.loading.first=Math.max(self.performance.now(),E.loading.start),E.total=parseInt(R.headers.get("Content-Length")||"0"),b&&Object(T.isFiniteNumber)(v.highWaterMark)?x.loadProgressively(R,E,a,v.highWaterMark,b):A?R.arrayBuffer():R.text()}).then(function(R){var I=x.response;self.clearTimeout(x.requestTimeout),E.loading.end=Math.max(self.performance.now(),E.loading.first),E.loaded=E.total=R[O];var C={url:I.url,data:R};b&&!Object(T.isFiniteNumber)(v.highWaterMark)&&b(E,a,R,I),S.onSuccess(C,E,a,I)}).catch(function(R){if(self.clearTimeout(x.requestTimeout),!E.aborted){var I=R&&R.code||0,C=R?R.message:null;S.onError({code:I,text:C},a,R?R.details:null)}})},f.getCacheAge=function(){var a=null;if(this.response){var v=this.response.headers.get("age");a=v?parseFloat(v):null}return a},f.loadProgressively=function(a,v,S,x,E){x===void 0&&(x=0);var L=new m.default,b=a.body.getReader(),A=function O(){return b.read().then(function(R){if(R.done)return L.dataLength&&E(v,S,L.flush(),a),Promise.resolve(new ArrayBuffer(0));var I=R.value,C=I.length;return v.loaded+=C,C<x||L.dataLength?(L.push(I),L.dataLength>=x&&E(v,S,L.flush(),a)):E(v,S,I,a),O()}).catch(function(){return Promise.reject()})};return A()},i}();function t(i,f){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(d({},i.headers))};return i.rangeEnd&&c.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),c}function e(i,f){return new self.Request(i.url,f)}var s=function(i){D(f,i);function f(c,a,v){var S;return S=i.call(this,c)||this,S.code=void 0,S.details=void 0,S.code=a,S.details=v,S}return f}(_(Error));P.default=h},"./src/utils/imsc1-ttml-parser.ts":function(M,P,y){y.r(P),y.d(P,"IMSC1_CODEC",function(){return r}),y.d(P,"parseIMSC1",function(){return u});var T=y("./src/utils/mp4-tools.ts"),p=y("./src/utils/vttparser.ts"),m=y("./src/utils/vttcue.ts"),D=y("./src/demux/id3.ts"),_=y("./src/utils/timescale-conversion.ts"),g=y("./src/utils/webvtt-parser.ts");function o(){return o=Object.assign?Object.assign.bind():function(x){for(var E=1;E<arguments.length;E++){var L=arguments[E];for(var b in L)Object.prototype.hasOwnProperty.call(L,b)&&(x[b]=L[b])}return x},o.apply(this,arguments)}var r="stpp.ttml.im1t",l=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,n=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,d={left:"start",center:"center",right:"end",start:"start",end:"end"};function u(x,E,L,b,A){var O=Object(T.findBox)(new Uint8Array(x),["mdat"]);if(O.length===0){A(new Error("Could not parse IMSC1 mdat"));return}var R=O.map(function(C){return Object(D.utf8ArrayToStr)(C)}),I=Object(_.toTimescaleFromScale)(E,1,L);try{R.forEach(function(C){return b(h(C,I))})}catch(C){A(C)}}function h(x,E){var L=new DOMParser,b=L.parseFromString(x,"text/xml"),A=b.getElementsByTagName("tt")[0];if(!A)throw new Error("Invalid ttml");var O={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(O).reduce(function(k,B){return k[B]=A.getAttribute("ttp:"+B)||O[B],k},{}),I=A.getAttribute("xml:space")!=="preserve",C=e(t(A,"styling","style")),F=e(t(A,"layout","region")),w=t(A,"body","[begin]");return[].map.call(w,function(k){var B=s(k,I);if(!B||!k.hasAttribute("begin"))return null;var U=a(k.getAttribute("begin"),R),N=a(k.getAttribute("dur"),R),j=a(k.getAttribute("end"),R);if(U===null)throw c(k);if(j===null){if(N===null)throw c(k);j=U+N}var K=new m.default(U-E,j-E,B);K.id=Object(g.generateCueId)(K.startTime,K.endTime,K.text);var V=F[k.getAttribute("region")],H=C[k.getAttribute("style")];K.position=10,K.size=80;var Y=i(V,H,C),q=Y.textAlign;if(q){var $=d[q];$&&(K.lineAlign=$),K.align=q}return o(K,Y),K}).filter(function(k){return k!==null})}function t(x,E,L){var b=x.getElementsByTagName(E)[0];return b?[].slice.call(b.querySelectorAll(L)):[]}function e(x){return x.reduce(function(E,L){var b=L.getAttribute("xml:id");return b&&(E[b]=L),E},{})}function s(x,E){return[].slice.call(x.childNodes).reduce(function(L,b,A){var O;return b.nodeName==="br"&&A?L+`
`:(O=b.childNodes)!==null&&O!==void 0&&O.length?s(b,E):E?L+b.textContent.trim().replace(/\s+/g," "):L+b.textContent},"")}function i(x,E,L){var b="http://www.w3.org/ns/ttml#styling",A=null,O=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],R=x!=null&&x.hasAttribute("style")?x.getAttribute("style"):null;return R&&L.hasOwnProperty(R)&&(A=L[R]),O.reduce(function(I,C){var F=f(E,b,C)||f(x,b,C)||f(A,b,C);return F&&(I[C]=F),I},{})}function f(x,E,L){return x&&x.hasAttributeNS(E,L)?x.getAttributeNS(E,L):null}function c(x){return new Error("Could not parse ttml timestamp "+x)}function a(x,E){if(!x)return null;var L=Object(p.parseTimeStamp)(x);return L===null&&(l.test(x)?L=v(x,E):n.test(x)&&(L=S(x,E))),L}function v(x,E){var L=l.exec(x),b=(L[4]|0)+(L[5]|0)/E.subFrameRate;return(L[1]|0)*3600+(L[2]|0)*60+(L[3]|0)+b/E.frameRate}function S(x,E){var L=n.exec(x),b=Number(L[1]),A=L[2];switch(A){case"h":return b*3600;case"m":return b*60;case"ms":return b*1e3;case"f":return b/E.frameRate;case"t":return b/E.tickRate}return b}},"./src/utils/logger.ts":function(M,P,y){y.r(P),y.d(P,"enableLogs",function(){return g}),y.d(P,"logger",function(){return o});var T=function(){},p={trace:T,debug:T,log:T,warn:T,info:T,error:T},m=p;function D(r){var l=self.console[r];return l?l.bind(self.console,"["+r+"] >"):T}function _(r){for(var l=arguments.length,n=new Array(l>1?l-1:0),d=1;d<l;d++)n[d-1]=arguments[d];n.forEach(function(u){m[u]=r[u]?r[u].bind(r):D(u)})}function g(r){if(self.console&&r===!0||typeof r=="object"){_(r,"debug","log","info","warn","error");try{m.log()}catch{m=p}}else m=p}var o=m},"./src/utils/mediakeys-helper.ts":function(M,P,y){y.r(P),y.d(P,"KeySystems",function(){return T}),y.d(P,"requestMediaKeySystemAccess",function(){return p});var T;(function(m){m.WIDEVINE="com.widevine.alpha",m.PLAYREADY="com.microsoft.playready"})(T||(T={}));var p=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(M,P,y){y.r(P),y.d(P,"getMediaSource",function(){return T});function T(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(M,P,y){y.r(P),y.d(P,"RemuxerTrackIdConfig",function(){return g}),y.d(P,"bin2str",function(){return o}),y.d(P,"readUint16",function(){return r}),y.d(P,"readUint32",function(){return l}),y.d(P,"readSint32",function(){return n}),y.d(P,"writeUint32",function(){return d}),y.d(P,"findBox",function(){return u}),y.d(P,"parseSegmentIndex",function(){return h}),y.d(P,"parseInitSegment",function(){return t}),y.d(P,"getStartDTS",function(){return e}),y.d(P,"getDuration",function(){return s}),y.d(P,"computeRawDurationFromSamples",function(){return i}),y.d(P,"offsetStartDTS",function(){return f}),y.d(P,"segmentValidRange",function(){return c}),y.d(P,"appendUint8Array",function(){return a}),y.d(P,"parseSamples",function(){return v}),y.d(P,"parseSEIMessageFromNALu",function(){return E}),y.d(P,"parseEmsg",function(){return b});var T=y("./src/utils/typed-array.ts"),p=y("./src/loader/fragment.ts"),m=y("./src/demux/id3.ts"),D=Math.pow(2,32)-1,_=[].push,g={video:1,audio:2,id3:3,text:4};function o(A){return String.fromCharCode.apply(null,A)}function r(A,O){var R=A[O]<<8|A[O+1];return R<0?65536+R:R}function l(A,O){var R=n(A,O);return R<0?4294967296+R:R}function n(A,O){return A[O]<<24|A[O+1]<<16|A[O+2]<<8|A[O+3]}function d(A,O,R){A[O]=R>>24,A[O+1]=R>>16&255,A[O+2]=R>>8&255,A[O+3]=R&255}function u(A,O){var R=[];if(!O.length)return R;for(var I=A.byteLength,C=0;C<I;){var F=l(A,C),w=o(A.subarray(C+4,C+8)),k=F>1?C+F:I;if(w===O[0])if(O.length===1)R.push(A.subarray(C+8,k));else{var B=u(A.subarray(C+8,k),O.slice(1));B.length&&_.apply(R,B)}C=k}return R}function h(A){var O=[],R=A[0],I=8,C=l(A,I);I+=4;var F=0,w=0;R===0?I+=8:I+=16,I+=2;var k=A.length+w,B=r(A,I);I+=2;for(var U=0;U<B;U++){var N=I,j=l(A,N);N+=4;var K=j&2147483647,V=(j&2147483648)>>>31;if(V===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=l(A,N);N+=4,O.push({referenceSize:K,subsegmentDuration:H,info:{duration:H/C,start:k,end:k+K-1}}),k+=K,N+=4,I=N}return{earliestPresentationTime:F,timescale:C,version:R,referencesCount:B,references:O}}function t(A){for(var O=[],R=u(A,["moov","trak"]),I=0;I<R.length;I++){var C=R[I],F=u(C,["tkhd"])[0];if(F){var w=F[0],k=w===0?12:20,B=l(F,k),U=u(C,["mdia","mdhd"])[0];if(U){w=U[0],k=w===0?12:20;var N=l(U,k),j=u(C,["mdia","hdlr"])[0];if(j){var K=o(j.subarray(8,12)),V={soun:p.ElementaryStreamTypes.AUDIO,vide:p.ElementaryStreamTypes.VIDEO}[K];if(V){var H=u(C,["mdia","minf","stbl","stsd"])[0],Y=void 0;H&&(Y=o(H.subarray(12,16))),O[B]={timescale:N,type:V},O[V]={timescale:N,id:B,codec:Y}}}}}}var q=u(A,["moov","mvex","trex"]);return q.forEach(function($){var G=l($,4),re=O[G];re&&(re.default={duration:l($,12),flags:l($,20)})}),O}function e(A,O){return u(O,["moof","traf"]).reduce(function(R,I){var C=u(I,["tfdt"])[0],F=C[0],w=u(I,["tfhd"]).reduce(function(k,B){var U=l(B,4),N=A[U];if(N){var j=l(C,4);F===1&&(j*=Math.pow(2,32),j+=l(C,8));var K=N.timescale||9e4,V=j/K;if(isFinite(V)&&(k===null||V<k))return V}return k},null);return w!==null&&isFinite(w)&&(R===null||w<R)?w:R},null)||0}function s(A,O){for(var R=0,I=0,C=0,F=u(A,["moof","traf"]),w=0;w<F.length;w++){var k=F[w],B=u(k,["tfhd"])[0],U=l(B,4),N=O[U];if(!!N){var j=N.default,K=l(B,0)|(j==null?void 0:j.flags),V=j==null?void 0:j.duration;K&8&&(K&2?V=l(B,12):V=l(B,8));for(var H=N.timescale||9e4,Y=u(k,["trun"]),q=0;q<Y.length;q++){if(R=i(Y[q]),!R&&V){var $=l(Y[q],4);R=V*$}N.type===p.ElementaryStreamTypes.VIDEO?I+=R/H:N.type===p.ElementaryStreamTypes.AUDIO&&(C+=R/H)}}}if(I===0&&C===0){for(var G=0,re=u(A,["sidx"]),Q=0;Q<re.length;Q++){var ee=h(re[Q]);ee!=null&&ee.references&&(G+=ee.references.reduce(function(se,ae){return se+ae.info.duration||0},0))}return G}return I||C}function i(A){var O=l(A,0),R=8;O&1&&(R+=4),O&4&&(R+=4);for(var I=0,C=l(A,4),F=0;F<C;F++){if(O&256){var w=l(A,R);I+=w,R+=4}O&512&&(R+=4),O&1024&&(R+=4),O&2048&&(R+=4)}return I}function f(A,O,R){u(O,["moof","traf"]).forEach(function(I){u(I,["tfhd"]).forEach(function(C){var F=l(C,4),w=A[F];if(!!w){var k=w.timescale||9e4;u(I,["tfdt"]).forEach(function(B){var U=B[0],N=l(B,4);if(U===0)N-=R*k,N=Math.max(N,0),d(B,4,N);else{N*=Math.pow(2,32),N+=l(B,8),N-=R*k,N=Math.max(N,0);var j=Math.floor(N/(D+1)),K=Math.floor(N%(D+1));d(B,4,j),d(B,8,K)}})}})})}function c(A){var O={valid:null,remainder:null},R=u(A,["moof"]);if(R){if(R.length<2)return O.remainder=A,O}else return O;var I=R[R.length-1];return O.valid=Object(T.sliceUint8)(A,0,I.byteOffset-8),O.remainder=Object(T.sliceUint8)(A,I.byteOffset-8),O}function a(A,O){var R=new Uint8Array(A.length+O.length);return R.set(A),R.set(O,A.length),R}function v(A,O){var R=[],I=O.samples,C=O.timescale,F=O.id,w=!1,k=u(I,["moof"]);return k.map(function(B){var U=B.byteOffset-8,N=u(B,["traf"]);N.map(function(j){var K=u(j,["tfdt"]).map(function(V){var H=V[0],Y=l(V,4);return H===1&&(Y*=Math.pow(2,32),Y+=l(V,8)),Y/C})[0];return K!==void 0&&(A=K),u(j,["tfhd"]).map(function(V){var H=l(V,4),Y=l(V,0)&16777215,q=(Y&1)!==0,$=(Y&2)!==0,G=(Y&8)!==0,re=0,Q=(Y&16)!==0,ee=0,se=(Y&32)!==0,ae=8;H===F&&(q&&(ae+=8),$&&(ae+=4),G&&(re=l(V,ae),ae+=4),Q&&(ee=l(V,ae),ae+=4),se&&(ae+=4),O.type==="video"&&(w=S(O.codec)),u(j,["trun"]).map(function(oe){var fe=oe[0],te=l(oe,0)&16777215,le=(te&1)!==0,de=0,ce=(te&4)!==0,he=(te&256)!==0,ve=0,me=(te&512)!==0,ue=0,ge=(te&1024)!==0,W=(te&2048)!==0,z=0,X=l(oe,4),J=8;le&&(de=l(oe,J),J+=4),ce&&(J+=4);for(var ie=de+U,ne=0;ne<X;ne++){if(he?(ve=l(oe,J),J+=4):ve=re,me?(ue=l(oe,J),J+=4):ue=ee,ge&&(J+=4),W&&(fe===0?z=l(oe,J):z=n(oe,J),J+=4),O.type===p.ElementaryStreamTypes.VIDEO)for(var Z=0;Z<ue;){var pe=l(I,ie);ie+=4;var ye=I[ie]&31;if(x(w,ye)){var xe=I.subarray(ie,ie+pe);E(xe,A+z/C,R)}ie+=pe,Z+=pe+4}A+=ve/C}}))})})}),R}function S(A){if(!A)return!1;var O=A.indexOf("."),R=O<0?A:A.substring(0,O);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}function x(A,O){return A?O===39||O===40:O===6}function E(A,O,R){var I=L(A),C=0;C++;for(var F=0,w=0,k=!1,B=0;C<I.length;){F=0;do{if(C>=I.length)break;B=I[C++],F+=B}while(B===255);w=0;do{if(C>=I.length)break;B=I[C++],w+=B}while(B===255);var U=I.length-C;if(!k&&F===4&&C<I.length){k=!0;var N=I[C++];if(N===181){var j=r(I,C);if(C+=2,j===49){var K=l(I,C);if(C+=4,K===1195456820){var V=I[C++];if(V===3){var H=I[C++],Y=31&H,q=64&H,$=q?2+Y*3:0,G=new Uint8Array($);if(q){G[0]=H;for(var re=1;re<$;re++)G[re]=I[C++]}R.push({type:V,payloadType:F,pts:O,bytes:G})}}}}}else if(F===5&&w<U){if(k=!0,w>16){for(var Q=[],ee=0;ee<16;ee++){var se=I[C++].toString(16);Q.push(se.length==1?"0"+se:se),(ee===3||ee===5||ee===7||ee===9)&&Q.push("-")}for(var ae=w-16,oe=new Uint8Array(ae),fe=0;fe<ae;fe++)oe[fe]=I[C++];R.push({payloadType:F,pts:O,uuid:Q.join(""),userData:Object(m.utf8ArrayToStr)(oe),userDataBytes:oe})}}else if(w<U)C+=w;else if(w>U)break}}function L(A){for(var O=A.byteLength,R=[],I=1;I<O-2;)A[I]===0&&A[I+1]===0&&A[I+2]===3?(R.push(I+2),I+=2):I++;if(R.length===0)return A;var C=O-R.length,F=new Uint8Array(C),w=0;for(I=0;I<C;w++,I++)w===R[0]&&(w++,R.shift()),F[I]=A[w];return F}function b(A){var O=A[0],R="",I="",C=0,F=0,w=0,k=0,B=0,U=0;if(O===0){for(;o(A.subarray(U,U+1))!=="\0";)R+=o(A.subarray(U,U+1)),U+=1;for(R+=o(A.subarray(U,U+1)),U+=1;o(A.subarray(U,U+1))!=="\0";)I+=o(A.subarray(U,U+1)),U+=1;I+=o(A.subarray(U,U+1)),U+=1,C=l(A,12),F=l(A,16),k=l(A,20),B=l(A,24),U=28}else if(O===1){U+=4,C=l(A,U),U+=4;var N=l(A,U);U+=4;var j=l(A,U);for(U+=4,w=Math.pow(2,32)*N+j,Number.isSafeInteger(w)||(w=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),k=l(A,U),U+=4,B=l(A,U),U+=4;o(A.subarray(U,U+1))!=="\0";)R+=o(A.subarray(U,U+1)),U+=1;for(R+=o(A.subarray(U,U+1)),U+=1;o(A.subarray(U,U+1))!=="\0";)I+=o(A.subarray(U,U+1)),U+=1;I+=o(A.subarray(U,U+1)),U+=1}var K=A.subarray(U,A.byteLength);return{schemeIdUri:R,value:I,timeScale:C,presentationTime:w,presentationTimeDelta:F,eventDuration:k,id:B,payload:K}}},"./src/utils/output-filter.ts":function(M,P,y){y.r(P),y.d(P,"default",function(){return T});var T=function(){function p(D,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=D,this.trackName=_}var m=p.prototype;return m.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},m.newCue=function(_,g,o){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=g,this.screen=o,this.timelineController.createCaptionsTrack(this.trackName)},m.reset=function(){this.cueRanges=[],this.startTime=null},p}()},"./src/utils/texttrack-utils.ts":function(M,P,y){y.r(P),y.d(P,"sendAddTrackEvent",function(){return p}),y.d(P,"addCueToTrack",function(){return m}),y.d(P,"clearCurrentCues",function(){return D}),y.d(P,"removeCuesInRange",function(){return _}),y.d(P,"getCuesInRange",function(){return o});var T=y("./src/utils/logger.ts");function p(r,l){var n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=r,l.dispatchEvent(n)}function m(r,l){var n=r.mode;if(n==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(l.id))try{if(r.addCue(l),!r.cues.getCueById(l.id))throw new Error("addCue is failed for: "+l)}catch(u){T.logger.debug("[texttrack-utils]: "+u);var d=new self.TextTrackCue(l.startTime,l.endTime,l.text);d.id=l.id,r.addCue(d)}n==="disabled"&&(r.mode=n)}function D(r){var l=r.mode;if(l==="disabled"&&(r.mode="hidden"),r.cues)for(var n=r.cues.length;n--;)r.removeCue(r.cues[n]);l==="disabled"&&(r.mode=l)}function _(r,l,n,d){var u=r.mode;if(u==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0)for(var h=o(r.cues,l,n),t=0;t<h.length;t++)(!d||d(h[t]))&&r.removeCue(h[t]);u==="disabled"&&(r.mode=u)}function g(r,l){if(l<r[0].startTime)return 0;var n=r.length-1;if(l>r[n].endTime)return-1;for(var d=0,u=n;d<=u;){var h=Math.floor((u+d)/2);if(l<r[h].startTime)u=h-1;else if(l>r[h].startTime&&d<n)d=h+1;else return h}return r[d].startTime-l<l-r[u].startTime?d:u}function o(r,l,n){var d=[],u=g(r,l);if(u>-1)for(var h=u,t=r.length;h<t;h++){var e=r[h];if(e.startTime>=l&&e.endTime<=n)d.push(e);else if(e.startTime>n)return d}return d}},"./src/utils/time-ranges.ts":function(M,P,y){y.r(P);var T={toString:function(m){for(var D="",_=m.length,g=0;g<_;g++)D+="["+m.start(g).toFixed(3)+","+m.end(g).toFixed(3)+"]";return D}};P.default=T},"./src/utils/timescale-conversion.ts":function(M,P,y){y.r(P),y.d(P,"toTimescaleFromBase",function(){return p}),y.d(P,"toTimescaleFromScale",function(){return m}),y.d(P,"toMsFromMpegTsClock",function(){return D}),y.d(P,"toMpegTsClockFromTimescale",function(){return _});var T=9e4;function p(g,o,r,l){r===void 0&&(r=1),l===void 0&&(l=!1);var n=g*o*r;return l?Math.round(n):n}function m(g,o,r,l){return r===void 0&&(r=1),l===void 0&&(l=!1),p(g,o,1/r,l)}function D(g,o){return o===void 0&&(o=!1),p(g,1e3,1/T,o)}function _(g,o){return o===void 0&&(o=1),p(g,T,1/o)}},"./src/utils/typed-array.ts":function(M,P,y){y.r(P),y.d(P,"sliceUint8",function(){return T});function T(p,m,D){return Uint8Array.prototype.slice?p.slice(m,D):new Uint8Array(Array.prototype.slice.call(p,m,D))}},"./src/utils/vttcue.ts":function(M,P,y){y.r(P),P.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var T=["","lr","rl"],p=["start","middle","end","left","right"];function m(r,l){if(typeof l!="string"||!Array.isArray(r))return!1;var n=l.toLowerCase();return~r.indexOf(n)?n:!1}function D(r){return m(T,r)}function _(r){return m(p,r)}function g(r){for(var l=arguments.length,n=new Array(l>1?l-1:0),d=1;d<l;d++)n[d-1]=arguments[d];for(var u=1;u<arguments.length;u++){var h=arguments[u];for(var t in h)r[t]=h[t]}return r}function o(r,l,n){var d=this,u={enumerable:!0};d.hasBeenReset=!1;var h="",t=!1,e=r,s=l,i=n,f=null,c="",a=!0,v="auto",S="start",x=50,E="middle",L=50,b="middle";Object.defineProperty(d,"id",g({},u,{get:function(){return h},set:function(O){h=""+O}})),Object.defineProperty(d,"pauseOnExit",g({},u,{get:function(){return t},set:function(O){t=!!O}})),Object.defineProperty(d,"startTime",g({},u,{get:function(){return e},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");e=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",g({},u,{get:function(){return s},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");s=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",g({},u,{get:function(){return i},set:function(O){i=""+O,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",g({},u,{get:function(){return f},set:function(O){f=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",g({},u,{get:function(){return c},set:function(O){var R=D(O);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");c=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",g({},u,{get:function(){return a},set:function(O){a=!!O,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",g({},u,{get:function(){return v},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");v=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",g({},u,{get:function(){return S},set:function(O){var R=_(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");S=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",g({},u,{get:function(){return x},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");x=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",g({},u,{get:function(){return E},set:function(O){var R=_(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");E=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",g({},u,{get:function(){return L},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");L=O,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",g({},u,{get:function(){return b},set:function(O){var R=_(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");b=R,this.hasBeenReset=!0}})),d.displayState=void 0}return o.prototype.getCueAsHTML=function(){var r=self.WebVTT;return r.convertCueToDOMTree(self,this.text)},o}()},"./src/utils/vttparser.ts":function(M,P,y){y.r(P),y.d(P,"parseTimeStamp",function(){return m}),y.d(P,"fixLineBreaks",function(){return l}),y.d(P,"VTTParser",function(){return n});var T=y("./src/utils/vttcue.ts"),p=function(){function d(){}var u=d.prototype;return u.decode=function(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},d}();function m(d){function u(t,e,s,i){return(t|0)*3600+(e|0)*60+(s|0)+parseFloat(i||0)}var h=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return h?parseFloat(h[2])>59?u(h[2],h[3],0,h[4]):u(h[1],h[2],h[3],h[4]):null}var D=function(){function d(){this.values=Object.create(null)}var u=d.prototype;return u.set=function(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)},u.get=function(t,e,s){return s?this.has(t)?this.values[t]:e[s]:this.has(t)?this.values[t]:e},u.has=function(t){return t in this.values},u.alt=function(t,e,s){for(var i=0;i<s.length;++i)if(e===s[i]){this.set(t,e);break}},u.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},u.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var s=parseFloat(e);if(s>=0&&s<=100)return this.set(t,s),!0}return!1},d}();function _(d,u,h,t){var e=t?d.split(t):[d];for(var s in e)if(typeof e[s]=="string"){var i=e[s].split(h);if(i.length===2){var f=i[0],c=i[1];u(f,c)}}}var g=new T.default(0,0,""),o=g.align==="middle"?"middle":"center";function r(d,u,h){var t=d;function e(){var f=m(d);if(f===null)throw new Error("Malformed timestamp: "+t);return d=d.replace(/^[^\sa-zA-Z-]+/,""),f}function s(f,c){var a=new D;_(f,function(x,E){var L;switch(x){case"region":for(var b=h.length-1;b>=0;b--)if(h[b].id===E){a.set(x,h[b].region);break}break;case"vertical":a.alt(x,E,["rl","lr"]);break;case"line":L=E.split(","),a.integer(x,L[0]),a.percent(x,L[0])&&a.set("snapToLines",!1),a.alt(x,L[0],["auto"]),L.length===2&&a.alt("lineAlign",L[1],["start",o,"end"]);break;case"position":L=E.split(","),a.percent(x,L[0]),L.length===2&&a.alt("positionAlign",L[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":a.percent(x,E);break;case"align":a.alt(x,E,["start",o,"end","left","right"]);break}},/:/,/\s/),c.region=a.get("region",null),c.vertical=a.get("vertical","");var v=a.get("line","auto");v==="auto"&&g.line===-1&&(v=-1),c.line=v,c.lineAlign=a.get("lineAlign","start"),c.snapToLines=a.get("snapToLines",!0),c.size=a.get("size",100),c.align=a.get("align",o);var S=a.get("position","auto");S==="auto"&&g.position===50&&(S=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=S}function i(){d=d.replace(/^\s+/,"")}if(i(),u.startTime=e(),i(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);d=d.slice(3),i(),u.endTime=e(),i(),s(d,u)}function l(d){return d.replace(/<br(?: \/)?>/gi,`
`)}var n=function(){function d(){this.state="INITIAL",this.buffer="",this.decoder=new p,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var u=d.prototype;return u.parse=function(t){var e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function s(){var S=e.buffer,x=0;for(S=l(S);x<S.length&&S[x]!=="\r"&&S[x]!==`
`;)++x;var E=S.slice(0,x);return S[x]==="\r"&&++x,S[x]===`
`&&++x,e.buffer=S.slice(x),E}function i(S){_(S,function(x,E){},/:/)}try{var f="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;f=s();var c=f.match(/^()?WEBVTT([ \t].*)?$/);if(!c||!c[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:f=s(),e.state){case"HEADER":/:/.test(f)?i(f):f||(e.state="ID");continue;case"NOTE":f||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){e.state="NOTE";break}if(!f)continue;if(e.cue=new T.default(0,0,""),e.state="CUE",f.indexOf("-->")===-1){e.cue.id=f;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{r(f,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var v=f.indexOf("-->")!==-1;if(!f||v&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=f}continue;case"BADCUE":f||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},u.flush=function(){var t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},d}()},"./src/utils/webvtt-parser.ts":function(M,P,y){y.r(P),y.d(P,"generateCueId",function(){return n}),y.d(P,"parseWebVTT",function(){return u});var T=y("./src/polyfills/number.ts"),p=y("./src/utils/vttparser.ts"),m=y("./src/demux/id3.ts"),D=y("./src/utils/timescale-conversion.ts"),_=y("./src/remux/mp4-remuxer.ts"),g=/\r\n|\n\r|\n|\r/g,o=function(t,e,s){return s===void 0&&(s=0),t.slice(s,s+e.length)===e},r=function(t){var e=parseInt(t.slice(-3)),s=parseInt(t.slice(-6,-4)),i=parseInt(t.slice(-9,-7)),f=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!Object(T.isFiniteNumber)(e)||!Object(T.isFiniteNumber)(s)||!Object(T.isFiniteNumber)(i)||!Object(T.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*s,e+=60*1e3*i,e+=60*60*1e3*f,e},l=function(t){for(var e=5381,s=t.length;s;)e=e*33^t.charCodeAt(--s);return(e>>>0).toString()};function n(h,t,e){return l(h.toString())+l(t.toString())+l(e)}var d=function(t,e,s){var i=t[e],f=t[i.prevCC];if(!f||!f.new&&i.new){t.ccOffset=t.presentationOffset=i.start,i.new=!1;return}for(;(c=f)!==null&&c!==void 0&&c.new;){var c;t.ccOffset+=i.start-f.start,i.new=!1,i=f,f=t[i.prevCC]}t.presentationOffset=s};function u(h,t,e,s,i,f,c,a){var v=new p.VTTParser,S=Object(m.utf8ArrayToStr)(new Uint8Array(h)).trim().replace(g,`
`).split(`
`),x=[],E=Object(D.toMpegTsClockFromTimescale)(t,e),L="00:00.000",b=0,A=0,O,R=!0;v.oncue=function(I){var C=s[i],F=s.ccOffset,w=(b-E)/9e4;C!=null&&C.new&&(A!==void 0?F=s.ccOffset=C.start:d(s,i,w)),w&&(F=w-s.presentationOffset);var k=I.endTime-I.startTime,B=Object(_.normalizePts)((I.startTime+F-A)*9e4,f*9e4)/9e4;I.startTime=Math.max(B,0),I.endTime=Math.max(B+k,0);var U=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(U)),I.id||(I.id=n(I.startTime,I.endTime,U)),I.endTime>0&&x.push(I)},v.onparsingerror=function(I){O=I},v.onflush=function(){if(O){a(O);return}c(x)},S.forEach(function(I){if(R)if(o(I,"X-TIMESTAMP-MAP=")){R=!1,I.slice(16).split(",").forEach(function(C){o(C,"LOCAL:")?L=C.slice(6):o(C,"MPEGTS:")&&(b=parseInt(C.slice(7)))});try{A=r(L)/1e3}catch(C){O=C}return}else I===""&&(R=!1);v.parse(I+`
`)}),v.flush()}},"./src/utils/xhr-loader.ts":function(M,P,y){y.r(P);var T=y("./src/utils/logger.ts"),p=y("./src/loader/load-stats.ts"),m=/^age:\s*[\d.]+\s*$/m,D=function(){function _(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new p.LoadStats,this.retryDelay=0}var g=_.prototype;return g.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},g.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},g.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},g.load=function(r,l,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=l,this.callbacks=n,this.retryDelay=l.retryDelay,this.loadInternal()},g.loadInternal=function(){var r=this.config,l=this.context;if(!!r){var n=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var u=this.xhrSetup;try{if(u)try{u(n,l.url)}catch{n.open("GET",l.url,!0),u(n,l.url)}n.readyState||n.open("GET",l.url,!0);var h=this.context.headers;if(h)for(var t in h)n.setRequestHeader(t,h[t])}catch(e){this.callbacks.onError({code:n.status,text:e.message},l,n);return}l.rangeEnd&&n.setRequestHeader("Range","bytes="+l.rangeStart+"-"+(l.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=l.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),n.send()}},g.readystatechange=function(){var r=this.context,l=this.loader,n=this.stats;if(!(!r||!l)){var d=l.readyState,u=this.config;if(!n.aborted&&d>=2)if(self.clearTimeout(this.requestTimeout),n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),d===4){l.onreadystatechange=null,l.onprogress=null;var h=l.status;if(h>=200&&h<300){n.loading.end=Math.max(self.performance.now(),n.loading.first);var t,e;if(r.responseType==="arraybuffer"?(t=l.response,e=t.byteLength):(t=l.responseText,e=t.length),n.loaded=n.total=e,!this.callbacks)return;var s=this.callbacks.onProgress;if(s&&s(n,r,t,l),!this.callbacks)return;var i={url:l.responseURL,data:t};this.callbacks.onSuccess(i,n,r,l)}else n.retry>=u.maxRetry||h>=400&&h<499?(T.logger.error(h+" while loading "+r.url),this.callbacks.onError({code:h,text:l.statusText},r,l)):(T.logger.warn(h+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,u.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),u.timeout)}},g.loadtimeout=function(){T.logger.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))},g.loadprogress=function(r){var l=this.stats;l.loaded=r.loaded,r.lengthComputable&&(l.total=r.total)},g.getCacheAge=function(){var r=null;if(this.loader&&m.test(this.loader.getAllResponseHeaders())){var l=this.loader.getResponseHeader("age");r=l?parseFloat(l):null}return r},_}();P.default=D}}).default})})(Je);const Tt=Fe(Je.exports),ke=typeof window<"u"?window.navigator.userAgent:"",St=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ke);/^((?!chrome|android).)*safari/i.test(ke);/MicroMessenger/i.test(ke);/MSIE|Trident/i.test(ke);const bt=[{icon:"iina",scheme:"iina://weblink?url=$url"},{icon:"potplayer",scheme:"potplayer://$e_url"},{icon:"vlc",scheme:"vlc://$url"},{icon:"nplayer",scheme:"nplayer-$url"},{icon:"mxplayer",scheme:"intent:$url#Intent;package=com.mxtech.videoplayer.ad;S.title=$name;end"},{icon:"mxplayer-pro",scheme:"intent:$url#Intent;package=com.mxtech.videoplayer.pro;S.title=$name;end"}],It=()=>{const{replace:Ee}=at(),{proxyLink:Re,rawLink:M}=gt();let P=Se.objs.filter(D=>D.type===yt.VIDEO);P.length===0&&(P=[Se.obj]);let y,T={id:"player",container:"#video-player",url:Se.raw_url,title:Se.obj.name,volume:.5,autoplay:st("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:Ve(Se.obj.name),customType:{flv:function(D,_){const g=_t.createPlayer({type:"flv",url:_},{referrerPolicy:"same-origin"});g.attachMediaElement(D),g.load()},m3u8:function(D,_){var g=new Tt;g.loadSource(_),g.attachMedia(D)}},lang:["en","zh-cn","zh-tw"].includes($e().toLowerCase())?$e().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};St&&(T.moreVideoAttr.controls=!0);const p=Se.related.find(D=>{for(const _ of[".srt",".ass",".vtt"])if(D.name.endsWith(_))return!0;return!1}),m=Se.related.find(D=>{for(const _ of[".xml"])if(D.name.endsWith(_))return!0;return!1});return p&&(T.subtitle={url:Re(p,!0),type:Ve(p.name)}),m&&(T.plugins=[xt({danmuku:Re(m,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"})]),ot(()=>{y=new Et(T),y.on("video:ended",()=>{const D=P.findIndex(_=>_.name===Se.obj.name);D<P.length-1&&Ee(P[D+1].name)})}),lt(()=>{y==null||y.destroy()}),Oe(mt,{w:"$full",spacing:"$2",get children(){return[Oe(ut,{w:"$full",h:"60vh",id:"video-player"}),Oe(ft,{onChange:D=>{Ee(D)},get value(){return Se.obj.name},get options(){return P.map(D=>({value:D.name}))}}),Oe(dt,{wrap:"wrap",gap:"$2",justifyContent:"center",get children(){return Oe(ct,{each:bt,children:D=>Oe(ht,{get href(){return pt(D.scheme,M(Se.obj,!0),Se.obj.name)},get children(){return Oe(vt,{boxSize:"$8",get src(){return`/images/${D.icon}.webp`}})}})})}})]}})};export{It as default};
