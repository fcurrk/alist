import{f as t,b0 as j,a0 as A,al as P,a1 as o,I as $,bN as G,T as H,bO as J,bP as M,bQ as Q,bR as U,bS as W,bT as X,bU as z,E as b,bV as K,bW as Y,bX as Z,x as k,F as p,b2 as ee,u as te,a as m,b7 as h,q as ne,bq as C,ag as re,ch as ae,m as T,B as ie,n as x,N as de,be as v,a6 as ue}from"./index.6b69baf0.js";import{u as _}from"./useT.a69111de.js";import{T as u}from"./item_type.be442da4.js";import{R as ge}from"./ResponsiveGrid.3982a743.js";const y=e=>{const d=_();return t(ee,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(j,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var r;return d(((r=e.full_name_path)!=null?r:e.driver==="common")?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(A,{get fallback(){return t(P,{get children(){return d("settings.unknown_type")}})},get children(){return[t(o,{get when(){return e.type===u.String},get children(){return t($,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===u.String?r=>{var n;return(n=e.onChange)==null?void 0:n.call(e,r.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===u.Number},get children(){return t($,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===u.Number?r=>{var n;return(n=e.onChange)==null?void 0:n.call(e,parseInt(r.currentTarget.value))}:void 0}})}}),t(o,{get when(){return e.type===u.Bool},get children(){return t(G,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===u.Bool?r=>{var n;return(n=e.onChange)==null?void 0:n.call(e,r.currentTarget.checked)}:void 0}})}}),t(o,{get when(){return e.type===u.Text},get children(){return t(H,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===u.Text?r=>{var n;return(n=e.onChange)==null?void 0:n.call(e,r.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===u.Select},get children(){return t(J,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===u.Select?r=>{var n;return(n=e.onChange)==null?void 0:n.call(e,r)}:void 0},get children(){return[t(M,{get children(){return[t(Q,{get children(){return d("global.choose")}}),t(U,{}),t(W,{})]}}),t(X,{get children(){return t(z,{get children(){return t(b,{get each(){var r;return(r=e.options)==null?void 0:r.split(",")},children:r=>t(K,{value:r,get children(){return[t(Y,{get children(){var n;return d(((n=e.options_prefix)!=null?n:e.driver==="common"?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${r}`)}}),t(Z,{})]}})})}})}})]}})}})]}}),t(k,{get when(){return e.help},get children(){return t(p,{get children(){return d(e.driver==="common"?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function O(e,d){switch(e){case u.Bool:return d?d==="true":!1;case u.Number:return d?parseInt(d):0;default:return d||""}}const he=()=>{const e=_(),{params:d,back:r}=te(),{id:n}=d,[I,L]=m(()=>h.get("/admin/driver/list"),!0),[l,S]=ne({}),N=async()=>{const a=await L();v(a,S)},[R,B]=m(()=>h.get(`/admin/storage/get?id=${n}`),!0),[F,q]=m(()=>h.get(`/admin/driver/info?driver=${g.driver}`),!0);n?(async()=>{const a=await B();v(a,async i=>{c(i),s(JSON.parse(i.addition));const f=await q();v(f,V=>S({[g.driver]:V}))})})():N();const[g,c]=C({}),[w,s]=C({}),[D,E]=m(()=>(c("addition",JSON.stringify(w)),h.post(`/admin/storage/${n?"update":"create"}`,g)));return t(ue,{get loading(){return n?R()||F():I()},get children(){return[t(re,{mb:"$2",get children(){return e(`global.${n?"edit":"add"}`)}}),t(ge,{get children(){return[t(y,{name:"driver",default:"",readonly:n!==void 0,required:!0,get type(){return u.Select},get options(){return n?g.driver:Object.keys(l()).join(",")},get value(){return g.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:a=>{for(const i of l()[a].common)c(i.name,O(i.type,i.default));s(ae(i=>{for(const f in i)delete i[f]}));for(const i of l()[a].additional)s(i.name,O(i.type,i.default));c("driver",a)}}),t(k,{get when(){return l()[g.driver]},get children(){return[t(b,{get each(){return l()[g.driver].common},children:a=>t(y,T(a,{driver:"common",get value(){return g[a.name]},onChange:i=>{c(a.name,i)}}))}),t(b,{get each(){return l()[g.driver].additional},children:a=>t(y,T(a,{get driver(){return g.driver},get value(){return w[a.name]},onChange:i=>{s(a.name,i)}}))})]}})]}}),t(ie,{mt:"$2",get loading(){return D()},onClick:async()=>{l()[g.driver].config.need_ms&&(x.info(e("manage.add_storage-tips")),window.open(de("/@manage/messenger"),"_blank"));const a=await E();v(a,()=>{x.success(e("global.save_success")),r()})},get children(){return e(`global.${n?"save":"add"}`)}})]}})};export{he as default};
