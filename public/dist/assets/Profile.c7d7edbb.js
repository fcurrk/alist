import{d as y,u as B,r as p,ac as n,a as F,b7 as b,b_ as g,j as e,y as a,ab as _,b$ as U,c0 as P,c1 as x,c2 as A,a8 as s,a9 as f,ao as w,c3 as M,b4 as $,b2 as k,I as S,F as R,B as i,ay as H,E as L,aw as D,a3 as j,bt as E,bd as G,n as N}from"./index.98d565c5.js";import{b as V}from"./useTitle.56ba616f.js";import{L as W}from"./index.7f74676e.js";const q=r=>e(E,{get colorScheme(){return r.can?"success":"danger"},get children(){return r.children}}),O=()=>{const r=y();V("manage.sidemenu.profile");const{to:u,searchParams:v}=B(),[c,C]=p(n().username),[d,I]=p(""),[h,T]=F(t=>b.post("/me/update",{username:t?n().username:c(),password:t?"":d(),github_id:n().github_id})),o=async t=>{const l=await T(t);G(l,()=>{g({...n(),username:c()}),t?u(""):(N.success(r("users.update_profile_success")),u(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})},m=v.githubID;return m&&(g({...n(),github_id:Number(m)}),o(!0)),e(j,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[e(a,{get when(){return!_.is_guest(n())},get fallback(){return[e(U,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[e(P,{mr:"$2_5"}),e(x,{mr:"$2_5",get children(){return r("users.guest-tips")}}),e(A,{get children(){return r("users.modify_nothing")}})]}}),e(s,{spacing:"$2",get children(){return[e(f,{get children(){return r("global.have_account")}}),e(f,{color:"$info9",as:W,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return r("global.go_login")}})]}})]},get children(){return[e(w,{get children(){return r("users.update_profile")}}),e(M,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[e($,{get children(){return[e(k,{for:"username",get children(){return r("users.change_username")}}),e(S,{id:"username",get value(){return c()},onInput:t=>{C(t.currentTarget.value)}})]}}),e($,{get children(){return[e(k,{for:"password",get children(){return r("users.change_password")}}),e(S,{id:"password",type:"password",placeholder:"********",get value(){return d()},onInput:t=>{I(t.currentTarget.value)}}),e(R,{get children(){return r("users.change_password-tips")}})]}})]}}),e(s,{spacing:"$2",get children(){return[e(i,{get loading(){return h()},onClick:[o,!1],get children(){return r("global.save")}}),e(a,{get when(){return!n().otp},get children(){return e(i,{colorScheme:"accent",onClick:()=>{u("/@manage/2fa")},get children(){return r("users.enable_2fa")}})}})]}})]}}),e(a,{get when(){return H("github_login_enabled")},get children(){return[e(w,{get children(){return r("users.github_login")}}),e(s,{spacing:"$2",get children(){return e(a,{get when(){return n().github_id},get fallback(){return e(i,{onClick:()=>{window.location.href=b.getUri()+"/auth/github?callback_url="+window.location.href+"&method=get_github_id"},get children(){return r("users.connect_github")}})},get children(){return e(i,{colorScheme:"danger",get loading(){return h()},onClick:()=>{g({...n(),github_id:0}),o(!0)},get children(){return r("users.disconnect_github")}})}})}})]}}),e(s,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return e(L,{each:D,children:(t,l)=>e(q,{get can(){return _.can(n(),l())},get children(){return r(`users.permissions.${t}`)}})})}})]}})};export{O as default};
