import{a as N,b as se,b0 as D,dQ as ie,dR as oe,k as le,m as c,x as ce,h as e,U as ue,K as U,L as F,H as W,R as de,a0 as ge,a1 as S,a3 as he,S as H,a6 as g,ak as me,ad as fe,a7 as J,J as K,di as we,aj as I,N as be,aE as Q,ar as pe,cl as xe,cX as ke,ai as $e,bK as Ce,cr as _e,aM as je,al as ye,am as ve,aD as Me,_ as L,t as x,dS as Se,l as Le,aL as Pe}from"./index.6a11a750.js";import{L as Oe,c as m}from"./List.ecc478a7.js";import{T as Be,c as Ie}from"./index.8bc73261.js";import ze from"./Password.ddbae722.js";import{a as Ae}from"./helper.4949571f.js";import{g as Ee}from"./icon.029b8f0a.js";import{x as P,w as Te,b as qe}from"./solid-contextmenu.fb6e198f.js";import"./index.c15292bb.js";import"./Layout.ee282d79.js";import"./useTitle.b1279957.js";import"./FolderTree.55d56418.js";import"./index.97e8bcc5.js";import"./index.dc25b8cb.js";function Re(){let n=!1,i=[];return{acquire:()=>new Promise(a=>{n?i.push(a):(n=!0,a())}),release:()=>{i.length>0?i.shift()():n=!1}}}const V=n=>{window.open(n,"_blank")},De=n=>{const{show:i}=qe({id:2}),{isMouseSupported:a}=Ae(),u=()=>Le.list_item_filename_overflow;return e($e.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(I,{class:"list-item viselect-item",get["data-index"](){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:be()}},get cursor(){return a()?"default":"pointer"},"on:click":f=>{n.obj.is_dir?n.jumpCallback():n.url&&V(n.url)},onContextMenu:f=>{i(f,{props:n})},get children(){return[e(I,{class:"name-box",spacing:"$1",get w(){return m[0].w},get children(){return[e(Q,{class:"icon",boxSize:"$6",get color(){return pe()},get as(){return Ee(n.obj)},mr:"$1"}),e(g,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:u()==="multi_line"?"unset":"nowrap","overflow-x":u()==="scrollable"?"auto":"hidden",textOverflow:u()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(g,{class:"size",get w(){return m[1].w},get textAlign(){return m[1].textAlign},get children(){return xe(n.obj.size)}}),e(g,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return m[2].w},get textAlign(){return m[2].textAlign},get children(){return ke(n.obj.modified)}})]}})}})},O={extract:{icon:Be,color:"$success9"},copy_link:{icon:Ie,color:"$info9"},download:{icon:Pe,color:"$primary9"}},Ue=()=>{const{copy:n}=Ce(),{colorMode:i}=_e();return e(Te,{id:2,animation:"scale",get theme(){return i()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(P,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{V(a.url+"&attachment=true")},get children(){return e(B,{name:"download"})}}),e(P,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{n(a.url)},get children(){return e(B,{name:"copy_link"})}}),e(P,{hidden:()=>{const a=je.findIndex(u=>u==="decompress");return!ye.can(ve(),a)},onClick:({props:a})=>{Me.emit("extract",JSON.stringify({inner:a.innerPath,pass:a.pass}))},get children(){return e(B,{name:"extract"})}})]}})},B=n=>{const i=N();return e(I,{spacing:"$2",get children(){return[e(Q,{get p(){return O[n.name].p?"$1":void 0},get as(){return O[n.name].icon},boxSize:"$7",get color(){return O[n.name].color}}),e(g,{get children(){return i(`home.toolbar.${n.name}`)}})]}})},tt=()=>{const n=N(),{pathname:i}=se(),[a,u]=D(ie),[f,z]=D(oe),X=le(()=>a()||f());let o="",k="",$="",w=null;const[C,b]=c(""),[G,A]=c(!1),[_,j]=c(!1),[E,Y]=c(""),[l,y]=c([]),[v,Z]=c(),[ee,te]=c(!1),d=Re(),p=r=>{let s={};return r.forEach(t=>{s[t.name]={...t,children:t.children?p(t.children):null}}),s},M=r=>r.code===200?!1:(r.code===202?x(()=>{o!==""&&A(!0),j(!0),b("")}):b(r.message),!0),T=async r=>{if(await d.acquire(),_()&&o==="")return d.release(),[];if(k===""){const t=await u(i(),L(),o);if(M(t))return d.release(),[];if(t.data.content!==null&&(w=p(t.data.content)),k=t.data.raw_url,$=t.data.sign,Y(t.data.comment),t.data.encrypted&&o==="")return x(()=>{j(!0),b("")}),d.release(),[]}if(w===null){const t=await z(i(),L(),o,"/");if(M(t))return d.release(),[];w=p(t.data.content)}let s=w;for(let t=0;t<r.length;t++){if(s[r[t]].children===null){const h=await z(i(),L(),o,"/"+r.slice(0,t+1).join("/"));if(M(h))return d.release(),[];s[r[t]].children=p(h.data.content)}s=s[r[t]].children}return x(()=>{j(!1),A(!1),b("")}),d.release(),Object.values(s)},[re,q]=c([]);ce(()=>{T(l()).then(r=>q(r))});const R=()=>{T(l()).then(r=>q(r))};R();const ne=()=>{let r=re();return v()&&(r=r.sort((s,t)=>(ee()?-1:1)*Se(s[v()],t[v()]))),r},ae=(r,s)=>{x(()=>{Z(r),s!==void 0&&te(s)})};return e(J,{spacing:"$2",w:"$full",get children(){return[e(ue,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(U,{get children(){return e(F,{get currentPage(){return l().length===0},"on:click":()=>y([]),children:"."})}}),e(W,{get each(){return l()},children:(r,s)=>e(U,{get children(){return[e(de,{}),e(F,{get currentPage(){return l().length===s()+1},"on:click":()=>y(l().slice(0,s()+1)),children:r})]}})})]}}),e(ge,{get children(){return[e(S,{get when(){return C()!==""},get children(){return e(he,{get msg(){return C()},disableColor:!0})}}),e(S,{get when(){return _()},get children(){return e(ze,{get title(){return n("home.toolbar.archive.input_password")},password:()=>o,setPassword:r=>o=r,enterCallback:()=>R(),get children(){return e(H,{get when(){return G()},get children(){return e(g,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(S,{get when(){return me(()=>!_(),!0)()&&C()===""},get children(){return e(fe,{get loading(){return X()},get children(){return e(J,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Oe,{sortCallback:ae,disableCheckbox:!0}),e(W,{get each(){return ne()},children:(r,s)=>{let t,h=(l().length>0?"/"+l().join("/"):"")+"/"+r.name;return r.is_dir||(t=k+"?inner="+K(h),o!==""&&(t=t+"&pass="+K(o)),$!==""&&(t=t+"&sign="+$)),e(De,{obj:r,get index(){return s()},jumpCallback:()=>y(l().concat(r.name)),innerPath:h,url:t,pass:o})}}),e(Ue,{})]}})}})}})]}}),e(H,{get when(){return E()!==""},get children(){return[e(we,{}),e(g,{w:"$full",pl:"$1",pr:"$1",get children(){return E()}})]}})]}})};export{tt as default};
