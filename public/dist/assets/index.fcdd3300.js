import{bC as W,R as E,e,B as q,au as L,O as F,a as U,by as u,bD as m,k as Q,am as z,bl as I,bu as X,bE as Y,bF as Z,bG as ee,u as te,g as ne,f as h,bH as oe,aO as v,a0 as re,bt as x,ak as se,S,I as R,bI as ae,a4 as ie,x as O,a_ as le,a$ as ce,bJ as ue,ao as ge,bo as P,n as k,br as de}from"./index.6230e6c5.js";import{p as pe,c as he}from"./index.f46f11c1.js";import{s as me,g as fe,a as we}from"./webauthn-json.browser-ponyfill.1c672167.js";const be="https://github.com/fcurrk/alist";function Se(s){return W(`${s}-${be}`)}const ke=()=>{const s=E("#f1f3f5","#666666");return e(q,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},Ie=()=>{const s=L("sso_login_enabled"),n=F("sso_login_platform"),f=L("sso_compatibility_mode"),{searchParams:g,to:r}=U(),i=g.token;i!=null&&i!=""&&(u(i),r(decodeURIComponent(g.redirect||m||"/"),!0));function l(c){const o=c.data;o.token&&(u(o.token),r(decodeURIComponent(g.redirect||m||"/"),!0))}if(window.addEventListener("message",l),Q(()=>{window.removeEventListener("message",l)}),s){const c=()=>{const d=I.getUri()+"/auth/sso?method=sso_get_token";if(f){window.location.href=d;return}window.open(d,"authPopup","width=500,height=600")};let o;switch(n){case"Github":o=ee;break;case"Microsoft":o=pe;break;case"Google":o=Z;break;case"Dingtalk":o=Y;break;default:o=X}return e(z,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:c})}},ye=()=>{const s=F("logo").split(`
`);E(s[0],s.pop());const n=te(),f=ne(()=>`${n("login.login_to")} ${F("site_title")}`);he(f);const g=E("white","$neutral1"),[r,i]=h(localStorage.getItem("username")||""),[l,c]=h(localStorage.getItem("password")||""),[o,d]=h(""),[w,B]=h(!1),[b,T]=oe("remember-pwd","false"),[D,G]=v(async()=>I.post("/auth/login/hash",{username:r(),password:Se(l()),otp_code:o()})),[,M]=v((t,a,p)=>I.post("/authn/webauthn_finish_login?username="+p,JSON.stringify(a),{headers:{session:t}})),[,A]=v(t=>I.get("/authn/webauthn_begin_login?username="+t)),{searchParams:$,to:_}=U(),N=L("webauthn_login_enabled"),j=async()=>{B(!w())},C=async()=>{if(w()){if(!me()){k.error(n("users.webauthn_not_supported"));return}u(),b()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const t=await A(r());de(t,async a=>{const p=fe(a.options),J=await we(p),K=await M(a.session,J,r());P(K,V=>{k.success(n("login.success")),u(V.token),_(decodeURIComponent($.redirect||m||"/"),!0)})})}else{b()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",l())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await G();P(t,a=>{k.success(n("login.success")),u(a.token),_(decodeURIComponent($.redirect||m||"/"),!0)},(a,p)=>{!y()&&p===402?H(!0):k.error(a)})}},[y,H]=h(!1);return e(ge,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(re,{get bgColor(){return g()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(x,{alignItems:"center",justifyContent:"space-around",get children(){return e(se,{color:"$info9",fontSize:"$2xl",get children(){return f()}})}}),e(S,{get when(){return!y()},get fallback(){return e(R,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return o()},onInput:t=>d(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&C()}})},get children(){return[e(R,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:t=>i(t.currentTarget.value)}),e(S,{get when(){return!w()},get children(){return e(R,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return l()},onInput:t=>c(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&C()}})}}),e(x,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(ae,{get checked(){return b()==="true"},onChange:()=>T(b()==="true"?"false":"true"),get children(){return n("login.remember")}})}})]}}),e(ie,{w:"$full",spacing:"$2",get children(){return[e(S,{get when(){return!w()},get children(){return e(O,{colorScheme:"primary",w:"$full",onClick:()=>{y()?d(""):(i(""),c(""))},get children(){return n("login.clear")}})}}),e(O,{w:"$full",get loading(){return D()},onClick:C,get children(){return n("login.login")}})]}}),e(O,{w:"$full",colorScheme:"accent",onClick:()=>{u(),_(decodeURIComponent($.redirect||m||"/"),!0)},get children(){return n("login.use_guest")}}),e(x,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(le,{}),e(ce,{}),e(Ie,{}),e(S,{when:N,get children(){return e(z,{cursor:"pointer",boxSize:"$8",as:ue,p:"$0_5",onclick:j})}})]}})]}}),e(ke,{})]}})};export{ye as default};
