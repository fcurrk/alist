import{bC as V,a0 as R,j as e,B as W,aA as F,Y as E,u as P,z as Y,as as B,by as f,bD as w,bp as b,bu as Q,bE as X,bF as Z,bG as ee,d as te,v as ne,r as c,bH as oe,a as _,a6 as re,bt as v,aq as se,y as p,I as y,bI as ae,aa as le,H as x,b2 as ie,b3 as ce,bJ as ue,au as ge,h as z,n as m,br as de}from"./index.daf16ee3.js";import{p as he,c as pe}from"./index.2dec522c.js";import{s as me,g as fe,a as we}from"./webauthn-json.browser-ponyfill.1c672167.js";const be="https://github.com/fcurrk/alist";function Se(s){return V(`${s}-${be}`)}const Ie=()=>{const s=R("#f1f3f5","#666666");return e(W,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},$e=()=>{const s=F("sso_login_enabled"),n=E("sso_login_platform"),{searchParams:u,to:S}=P();function r(l){const o=l.data;o.token&&(f(o.token),S(decodeURIComponent(u.redirect||w||"/"),!0))}if(window.addEventListener("message",r),Y(()=>{window.removeEventListener("message",r)}),s){const l=()=>{const g=b.getUri()+"/auth/sso?method=sso_get_token";window.open(g,"authPopup","width=500,height=600")};let o;switch(n){case"Github":o=ee;break;case"Microsoft":o=he;break;case"Google":o=Z;break;case"Dingtalk":o=X;break;default:o=Q}return e(B,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:l})}},ve=()=>{const s=E("logo").split(`
`);R(s[0],s.pop());const n=te(),u=ne(()=>`${n("login.login_to")} ${E("site_title")}`);pe(u);const S=R("white","$neutral1"),[r,l]=c(localStorage.getItem("username")||""),[o,g]=c(localStorage.getItem("password")||""),[L,O]=c(""),[d,T]=c(!1),[h,U]=oe("remember-pwd","false"),[A,D]=_(async()=>b.post("/auth/login/hash",{username:r(),password:Se(o()),otp_code:L()})),[,G]=_((t,a,i)=>b.post("/authn/webauthn_finish_login?username="+i,JSON.stringify(a),{headers:{session:t}})),[,M]=_(t=>b.get("/authn/webauthn_begin_login?username="+t)),{searchParams:I,to:$}=P(),j=F("webauthn_login_enabled"),H=async()=>{T(!d())},k=async()=>{if(d()){if(!me()){m.error(n("users.webauthn_not_supported"));return}h()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const t=await M(r());de(t,async a=>{const i=fe(a.options),J=await we(i),q=await G(a.session,J,r());z(q,K=>{m.success(n("login.success")),f(K.token),$(decodeURIComponent(I.redirect||w||"/"),!0)})})}else{h()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",o())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await D();z(t,a=>{m.success(n("login.success")),f(a.token),$(decodeURIComponent(I.redirect||w||"/"),!0)},(a,i)=>{!C()&&i===402?N(!0):m.error(a)})}},[C,N]=c(!1);return e(ge,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(re,{get bgColor(){return S()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(v,{alignItems:"center",justifyContent:"space-around",get children(){return e(se,{color:"$info9",fontSize:"$2xl",get children(){return u()}})}}),e(p,{get when(){return!C()},get fallback(){return e(y,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return L()},onInput:t=>O(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&k()}})},get children(){return[e(y,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:t=>l(t.currentTarget.value)}),e(p,{get when(){return!d()},get children(){return e(y,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return o()},onInput:t=>g(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&k()}})}}),e(v,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(ae,{get checked(){return h()==="true"},onChange:()=>U(h()==="true"?"false":"true"),get children(){return n("login.remember")}})}})]}}),e(le,{w:"$full",spacing:"$2",get children(){return[e(p,{get when(){return!d()},get children(){return e(x,{colorScheme:"primary",w:"$full",onClick:()=>{C()?O(""):(l(""),g(""))},get children(){return n("login.clear")}})}}),e(x,{w:"$full",get loading(){return A()},onClick:k,get children(){return n("login.login")}})]}}),e(x,{w:"$full",colorScheme:"accent",onClick:()=>{f(),$(decodeURIComponent(I.redirect||w||"/"),!0)},get children(){return n("login.use_guest")}}),e(v,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(ie,{}),e(ce,{}),e($e,{}),e(p,{when:j,get children(){return e(B,{cursor:"pointer",boxSize:"$8",as:ue,p:"$0_5",onclick:H})}})]}})]}}),e(Ie,{})]}})};export{ve as default};
