import{bV as Q,W as P,e,a6 as ee,aH as I,R as $,b as M,bR as g,bW as w,d as te,ax as A,b6 as f,bN as ne,bX as oe,bY as re,bZ as se,a as ae,j as ie,k as u,b_ as le,aU as R,a3 as ce,bM as E,av as ue,S as m,I as U,b$ as B,ad as ge,B as O,bh as de,bi as pe,c0 as he,aA as me,bE as F,n as k,b7 as fe}from"./index.1f331848.js";import{o as we,c as be}from"./index.4033d7a9.js";import{s as Se,g as _e,a as ke}from"./webauthn-json.browser-ponyfill.1c672167.js";const $e="https://github.com/fcurrk/alist";function Ie(s){return Q(`${s}-${$e}`)}const Ce=()=>{const s=P("#f1f3f5","#666666");return e(ee,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},ve=()=>{const s=I("sso_login_enabled"),n=$("sso_login_platform"),b=I("sso_compatibility_mode"),{searchParams:d,to:r}=M(),l=d.token;l!=null&&l!=""&&(g(l),r(decodeURIComponent(d.redirect||w||"/"),!0));function i(c){const o=c.data;o.token&&(g(o.token),r(decodeURIComponent(d.redirect||w||"/"),!0))}if(window.addEventListener("message",i),te(()=>{window.removeEventListener("message",i)}),s){const c=()=>{const p=f.getUri()+"/auth/sso?method=sso_get_token";if(b){window.location.href=p;return}window.open(p,"authPopup","width=500,height=600")};let o;switch(n){case"Github":o=se;break;case"Microsoft":o=we;break;case"Google":o=re;break;case"Dingtalk":o=oe;break;default:o=ne}return e(A,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:c})}},Re=()=>{const s=$("logo").split(`
`);P(s[0],s.pop());const n=ae(),b=ie(()=>`${n("login.login_to")} ${$("site_title")}`);be(b);const d=P("white","$neutral1"),[r,l]=u(localStorage.getItem("username")||""),[i,c]=u(localStorage.getItem("password")||""),[o,p]=u(""),[S,N]=u(!1),[_,j]=le("remember-pwd","false"),[C,T]=u(!1),[D,G]=R(async()=>C()?f.post("/auth/login/ldap",{username:r(),password:i(),otp_code:o()}):f.post("/auth/login/hash",{username:r(),password:Ie(i()),otp_code:o()})),[,W]=R((t,a,h)=>f.post("/authn/webauthn_finish_login?username="+h,JSON.stringify(a),{headers:{session:t}})),[,H]=R(t=>f.get("/authn/webauthn_begin_login?username="+t)),{searchParams:v,to:y}=M(),V=I("webauthn_login_enabled"),J=async()=>{N(!S())},x=async()=>{if(S()){if(!Se()){k.error(n("users.webauthn_not_supported"));return}g(),_()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const t=await H(r());fe(t,async a=>{const h=_e(a.options),X=await ke(h),Y=await W(a.session,X,r());F(Y,Z=>{k.success(n("login.success")),g(Z.token),y(decodeURIComponent(v.redirect||w||"/"),!0)})})}else{_()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",i())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await G();F(t,a=>{k.success(n("login.success")),g(a.token),y(decodeURIComponent(v.redirect||w||"/"),!0)},(a,h)=>{!L()&&h===402?K(!0):k.error(a)})}},[L,K]=u(!1),z=I("ldap_login_enabled"),q=$("ldap_login_tips");return z&&T(!0),e(me,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ce,{get bgColor(){return d()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(E,{alignItems:"center",justifyContent:"space-around",get children(){return e(ue,{color:"$info9",fontSize:"$2xl",get children(){return b()}})}}),e(m,{get when(){return!L()},get fallback(){return e(U,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return o()},onInput:t=>p(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})},get children(){return[e(U,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:t=>l(t.currentTarget.value)}),e(m,{get when(){return!S()},get children(){return e(U,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return i()},onInput:t=>c(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})}}),e(E,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(B,{get checked(){return _()==="true"},onChange:()=>j(_()==="true"?"false":"true"),get children(){return n("login.remember")}})}})]}}),e(ge,{w:"$full",spacing:"$2",get children(){return[e(m,{get when(){return!S()},get children(){return e(O,{colorScheme:"primary",w:"$full",onClick:()=>{L()?p(""):(l(""),c(""))},get children(){return n("login.clear")}})}}),e(O,{w:"$full",get loading(){return D()},onClick:x,get children(){return n("login.login")}})]}}),e(m,{when:z,get children(){return e(B,{w:"$full",get checked(){return C()===!0},onChange:()=>T(!C()),children:q})}}),e(O,{w:"$full",colorScheme:"accent",onClick:()=>{g(),y(decodeURIComponent(v.redirect||w||"/"),!0)},get children(){return n("login.use_guest")}}),e(E,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(de,{}),e(pe,{}),e(ve,{}),e(m,{when:V,get children(){return e(A,{cursor:"pointer",boxSize:"$8",as:he,p:"$0_5",onclick:J})}})]}})]}}),e(Ce,{})]}})};export{Re as default};
