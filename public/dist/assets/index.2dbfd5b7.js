import{bN as W,J as O,h as e,Y as q,aw as L,E as P,b as z,bJ as u,bO as m,o as Q,am as F,b3 as I,bF as Y,bP as X,bQ as Z,bR as ee,a as te,r as ne,d as p,bS as oe,aR as v,V as re,bE as x,ak as se,S,I as R,bT as ae,a2 as ie,B as E,be as le,bf as ce,bU as ue,ao as ge,bz as U,n as k,b4 as de}from"./index.d2f0d1cf.js";import{o as he,c as pe}from"./index.a18b52df.js";import{s as me,g as fe,a as we}from"./webauthn-json.browser-ponyfill.1c672167.js";const be="https://github.com/fcurrk/alist";function Se(s){return W(`${s}-${be}`)}const ke=()=>{const s=O("#f1f3f5","#666666");return e(q,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},Ie=()=>{const s=L("sso_login_enabled"),n=P("sso_login_platform"),f=L("sso_compatibility_mode"),{searchParams:g,to:r}=z(),i=g.token;i!=null&&i!=""&&(u(i),r(decodeURIComponent(g.redirect||m||"/"),!0));function l(c){const o=c.data;o.token&&(u(o.token),r(decodeURIComponent(g.redirect||m||"/"),!0))}if(window.addEventListener("message",l),Q(()=>{window.removeEventListener("message",l)}),s){const c=()=>{const d=I.getUri()+"/auth/sso?method=sso_get_token";if(f){window.location.href=d;return}window.open(d,"authPopup","width=500,height=600")};let o;switch(n){case"Github":o=ee;break;case"Microsoft":o=he;break;case"Google":o=Z;break;case"Dingtalk":o=X;break;default:o=Y}return e(F,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:c})}},ye=()=>{const s=P("logo").split(`
`);O(s[0],s.pop());const n=te(),f=ne(()=>`${n("login.login_to")} ${P("site_title")}`);pe(f);const g=O("white","$neutral1"),[r,i]=p(localStorage.getItem("username")||""),[l,c]=p(localStorage.getItem("password")||""),[o,d]=p(""),[w,T]=p(!1),[b,B]=oe("remember-pwd","false"),[M,N]=v(async()=>I.post("/auth/login/hash",{username:r(),password:Se(l()),otp_code:o()})),[,A]=v((t,a,h)=>I.post("/authn/webauthn_finish_login?username="+h,JSON.stringify(a),{headers:{session:t}})),[,D]=v(t=>I.get("/authn/webauthn_begin_login?username="+t)),{searchParams:$,to:_}=z(),G=L("webauthn_login_enabled"),J=async()=>{T(!w())},C=async()=>{if(w()){if(!me()){k.error(n("users.webauthn_not_supported"));return}u(),b()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const t=await D(r());de(t,async a=>{const h=fe(a.options),V=await we(h),H=await A(a.session,V,r());U(H,K=>{k.success(n("login.success")),u(K.token),_(decodeURIComponent($.redirect||m||"/"),!0)})})}else{b()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",l())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await N();U(t,a=>{k.success(n("login.success")),u(a.token),_(decodeURIComponent($.redirect||m||"/"),!0)},(a,h)=>{!y()&&h===402?j(!0):k.error(a)})}},[y,j]=p(!1);return e(ge,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(re,{get bgColor(){return g()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(x,{alignItems:"center",justifyContent:"space-around",get children(){return e(se,{color:"$info9",fontSize:"$2xl",get children(){return f()}})}}),e(S,{get when(){return!y()},get fallback(){return e(R,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return o()},onInput:t=>d(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&C()}})},get children(){return[e(R,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:t=>i(t.currentTarget.value)}),e(S,{get when(){return!w()},get children(){return e(R,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return l()},onInput:t=>c(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&C()}})}}),e(x,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(ae,{get checked(){return b()==="true"},onChange:()=>B(b()==="true"?"false":"true"),get children(){return n("login.remember")}})}})]}}),e(ie,{w:"$full",spacing:"$2",get children(){return[e(S,{get when(){return!w()},get children(){return e(E,{colorScheme:"primary",w:"$full",onClick:()=>{y()?d(""):(i(""),c(""))},get children(){return n("login.clear")}})}}),e(E,{w:"$full",get loading(){return M()},onClick:C,get children(){return n("login.login")}})]}}),e(E,{w:"$full",colorScheme:"accent",onClick:()=>{u(),_(decodeURIComponent($.redirect||m||"/"),!0)},get children(){return n("login.use_guest")}}),e(x,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(le,{}),e(ce,{}),e(Ie,{}),e(S,{when:G,get children(){return e(F,{cursor:"pointer",boxSize:"$8",as:ue,p:"$0_5",onclick:J})}})]}})]}}),e(ke,{})]}})};export{ye as default};
