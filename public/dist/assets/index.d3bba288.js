import{bB as P,Y as b,j as e,a6 as R,az as T,V as k,u as _,w as D,ar as F,bx as S,bC as $,bk as L,bt as M,bD as U,bE as j,bF as A,d as H,G as V,r as c,bG as K,a as N,a4 as W,bs as m,ap as Y,A as q,I as f,bH as J,a9 as Q,C as w,b2 as X,b3 as Z,at as ee,h as te,n as y}from"./index.285c2f53.js";import{p as ne,c as oe}from"./index.3c450805.js";const re="https://github.com/fcurrk/alist";function se(r){return P(`${r}-${re}`)}const ae=()=>{const r=b("#f1f3f5","#666666");return e(R,{get bgColor(){return r()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh"})},le=()=>{const r=T("sso_login_enabled"),n=k("sso_login_platform"),{searchParams:l,to:u}=_();function s(a){const t=a.data;t.token&&(S(t.token),u(decodeURIComponent(l.redirect||$||"/"),!0))}if(window.addEventListener("message",s),D(()=>{window.removeEventListener("message",s)}),r){const a=()=>{const i=L.getUri()+"/auth/sso?method=sso_get_token";window.open(i,"authPopup","width=500,height=600")};let t;switch(n){case"Github":t=A;break;case"Microsoft":t=ne;break;case"Google":t=j;break;case"Dingtalk":t=U;break;default:t=M}return e(F,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},ue=()=>{const r=k("logo").split(`
`);b(r[0],r.pop());const n=H(),l=V(()=>`${n("login.login_to")} ${k("site_title")}`);oe(l);const u=b("white","$neutral1"),[s,a]=c(localStorage.getItem("username")||""),[t,i]=c(localStorage.getItem("password")||""),[C,I]=c(""),[g,E]=K("remember-pwd","false"),[z,B]=N(async()=>L.post("/auth/login/hash",{username:s(),password:se(t()),otp_code:C()})),{searchParams:v,to:x}=_(),d=async()=>{g()==="true"?(localStorage.setItem("username",s()),localStorage.setItem("password",t())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const o=await B();te(o,h=>{y.success(n("login.success")),S(h.token),x(decodeURIComponent(v.redirect||$||"/"),!0)},(h,O)=>{!p()&&O===402?G(!0):y.error(h)})},[p,G]=c(!1);return e(ee,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(W,{get bgColor(){return u()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(m,{alignItems:"center",justifyContent:"space-around",get children(){return e(Y,{color:"$info9",fontSize:"$2xl",get children(){return l()}})}}),e(q,{get when(){return!p()},get fallback(){return e(f,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return C()},onInput:o=>I(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&d()}})},get children(){return[e(f,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return s()},onInput:o=>a(o.currentTarget.value)}),e(f,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return t()},onInput:o=>i(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&d()}}),e(m,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return e(J,{get checked(){return g()==="true"},onChange:()=>E(g()==="true"?"false":"true"),get children(){return n("login.remember")}})}})]}}),e(Q,{w:"$full",spacing:"$2",get children(){return[e(w,{colorScheme:"primary",w:"$full",onClick:()=>{p()?I(""):(a(""),i(""))},get children(){return n("login.clear")}}),e(w,{w:"$full",get loading(){return z()},onClick:d,get children(){return n("login.login")}})]}}),e(w,{w:"$full",colorScheme:"accent",onClick:()=>{S(),x(decodeURIComponent(v.redirect||$||"/"),!0)},get children(){return n("login.use_guest")}}),e(m,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(X,{}),e(Z,{}),e(le,{})]}})]}}),e(ae,{})]}})};export{ue as default};
